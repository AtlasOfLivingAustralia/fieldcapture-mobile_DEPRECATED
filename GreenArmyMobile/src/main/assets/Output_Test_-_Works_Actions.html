

<!DOCTYPE html>
<head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <style type="text/css">
        input[type=checkbox] {
            -webkit-transform: scale(1.5); margin:50px;
        }
    </style>
    
    <script src="fieldcapture/static/UGoJGyG3j2UCffTg3vnOdi0FsnS2OvrmrsZD6WxaXGy.js" type="text/javascript" ></script>
<link href="fieldcapture/static/090onaZX1M508oSWqGmMeETZ9NkUA9p4CCTW3MUpRPc.css" type="text/css" rel="stylesheet" media="screen, projection" />

<link href="fieldcapture/static/CidRUyEAqkZsnDRPRiaGZBy7vd4DOlnRqweu4CsVcIG.css" type="text/css" rel="stylesheet" media="screen" />
<link href="fieldcapture/static/tDKPE9VWZfBnSnxBkPC52ml2dXticvlQDl9aR8VpM2o.css" type="text/css" rel="stylesheet" media="screen, projection" />
<!--[if lt IE 7]><link href="fieldcapture/static/v1vjA9BeNpSU8cuoTuVhTEUm6boSzwYQcgfPKKMkqgv.css" type="text/css" rel="stylesheet" media="screen, projection" /><![endif]-->

<link href="fieldcapture/static/Eu8FNKwJJQI8mVJO3VIshatRN1bunflYHvvdqk06tbf.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="http://www.ala.org.au/wp-content/themes/ala2011/images/favicon.ico" rel="shortcut icon" />
<!--[if lt IE 9]><script src="fieldcapture/static/Yh1Txee3hFzExJ4P1str7tGV24zQMEYtxqtlYJ5ukR0.js" type="text/javascript" ></script><![endif]-->
<link href="fieldcapture/static/6tuLClj7N5eYCZpx7vLn8juIbQUXBkCnWRUJFY7UDCz.css" type="text/css" rel="stylesheet" media="screen,print" />
<link href="/fieldcapture/static/7ARiB2rJgSkfi68hxnSlcG9Ot0gQ863DYxkCmSHQweE.png" rel="shortcut icon" />
<link href="/fieldcapture/static/14SWTr4VqVh6tnlUlgBtue6IJZ7gwE1y42RT7ya5GGW.png" rel="shortcut icon" />

<link href="fieldcapture/static/KYGDEVRRaKjNbTXJkHmicmzo9vFrnnzCnGLcxKjR04f.css" type="text/css" rel="stylesheet" media="screen,print" />

<link href="fieldcapture/static/uUQBvO5ITMKwLfoRb2u62GbHXEzxtsbrSWq8MBAOrbX.css" type="text/css" rel="stylesheet" media="screen,print" />
<link href="fieldcapture/static/2OXdKoom668LE7PLl0qjJCaLG7Pu7Jv869tAsS4e1oT.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="fieldcapture/static/AcXIjLTuc87n8sfxBjJRQSoBIUwP9RnCyK8Sv82i7eV.css" type="text/css" rel="stylesheet" media="screen, projection" />
<script type="text/javascript">
    var fcConfig = {
        serverUrl: "http://devt.ala.org.au:8087/fieldcapture",
        activityUpdateUrl: "/fieldcapture/activity/ajaxUpdate",
        activityDeleteUrl: "/fieldcapture/activity/ajaxDelete",
        projectViewUrl: "/fieldcapture/project/index/",
        siteViewUrl: "/fieldcapture/site/index/",
        bieUrl: "http://bie.ala.org.au",
        speciesProfileUrl: "/fieldcapture/proxy/speciesProfile"
        },
        here = document.location.href;
    </script>
    

    <meta name="layout" content="mobile"/>

    <script type="text/javascript" src="//maps.google.com/maps/api/js?sensor=false&language=en"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jstimezonedetect/1.0.4/jstz.min.js"></script>
    
    

</head>

<body>

<div id="content" class="clearfix">
    
<div class="container-fluid validationEngineContainer" id="validation-container">
<div id="koActivityMainBlock">

    <div class="row-fluid">
        <div class="span9">
            <!-- Common activity fields -->

            <div class="row-fluid space-after">
                <div class="span6">
                    <label for="theme">Major theme</label>
                    <select id="theme" data-bind="value:mainTheme, options:transients.themes, optionsCaption:'Choose..'" class="input-xlarge">
                    </select>
                </div>
                <div class="span6">
                    <label class="for-readonly">Description</label>
                    <span class="readonly-text" data-bind="text:description"></span>
                </div>
            </div>

            <div class="row-fluid space-after">

                <div class="span6">
                    <label class="for-readonly inline">Activity progress</label>
                    <button type="button" class="btn btn-small"
                            data-bind="css: {'btn-warning':progress()=='planned','btn-success':progress()=='started','btn-info':progress()=='finished','btn-danger':progress()=='deferred','btn-inverse':progress()=='cancelled'}"
                            style="line-height:16px;cursor:default;color:white">
                        <span data-bind="text: progress"></span>
                    </button>
                </div>
            </div>

            <div class="row-fluid space-after">
                <div class="span6">
                    <label class="for-readonly inline">Planned start date</label>
                    <span class="readonly-text" data-bind="text:plannedStartDate.formattedDate"></span>
                </div>
                <div class="span6">
                    <label class="for-readonly inline">Planned end date</label>
                    <span class="readonly-text" data-bind="text:plannedEndDate.formattedDate"></span>
                </div>
            </div>

            <div class="row-fluid">
                <div class="span6 required">
                    <label for="startDate"><b>Actual start date</b>
                        <a href='#' class='helphover' data-original-title='Start date' data-placement='top' data-content='Date the activity was started.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a>
                    </label>


                    <div class="input-append">
                        <input data-bind='datepicker:startDate.date' name='startDate' id='startDate' type='text' size='16' class='input-xlarge' targetField='startDate.date' data-validation-engine='validate[required]' />
<span class='add-on open-datepicker'>
  <i class='icon-th'>&nbsp;</i>
</span>
                    </div>

                </div>
                <div class="span6 required">
                    <label for="endDate"><b>Actual end date</b>
                        <a href='#' class='helphover' data-original-title='End date' data-placement='top' data-content='Date the activity finished.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a>
                    </label>

                    <div class="input-append">
                        <input data-bind='datepicker:endDate.date' name='endDate' id='endDate' type='text' size='16' class='input-xlarge' targetField='endDate.date' data-validation-engine='validate[future[startDate]]' />
<span class='add-on open-datepicker'>
  <i class='icon-th'>&nbsp;</i>
</span>
                    </div>

                </div>
            </div>


        </div>
        
            <div class="span3">
                <div id="smallMap" style="width:100%"></div>
            </div>
        
    </div>

</div>

<!-- ko stopBinding: true -->

    
    
    <style type="text/css">
        table.planting td:nth-child(1) {width:30%;}
        table.planting td:nth-child(1) select {width:100%;}
        table.planting td:nth-child(2) {width:10%;text-align:center;}
        table.planting td:nth-child(2) select {width:100%;}
        table.planting td:nth-child(3) {width:10%;text-align:center;}
        table.planting td:nth-child(3) select {width:100%;}
        table.planting td:nth-child(4) {width:10%;}
        table.planting td:nth-child(4) select {width:100%;}
        table.planting td:nth-child(5) {width:10%;}
        table.planting td:nth-child(5) select {width:100%;}
        table.planting td:nth-child(6) {width:10%;}
        table.planting td:nth-child(6) select {width:100%;}
        table.planting td:nth-child(7) {width:10%;}
        table.planting td:nth-child(7) select {width:100%;}
        table.planting td:last-child {width:4%;text-align:center;}
        table.planting textarea {width:98%;}
    </style>
    <div class="output-block" id="koRevegetation_Details">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Revegetation Details<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid output-section">
            <table class="table table-bordered planting " >
                <thead><tr><th class="required">Species:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The species planted / sown. (start typing a  scientific or common name for a species)'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th class="required">No. Planted:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Number of plants planted'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th class="required">Seed Sown (Kg):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Weight of seed direct sown in kilograms'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Type of stock<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The type of plantstock used for plantings'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Structural Layer<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The structural layer of vegetation that planted plants will occupy when mature'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Stock Provenance<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The name of the locality from which the seedstock was collected'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Type of Guard<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Type of guard used to protect planted seedlings'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'plantingviewTmpl', foreach: data.planting}"></tbody>
                <script id="plantingviewTmpl" type="text/html"><tr>
                    <td>
<span class="input-prepend input-append" data-bind="with:species">
    <span class="add-on" data-bind="visible:!transients.editing(), css:{'btn-success':name()}"><i class="icon-white" data-bind="css:{'icon-ok':listId()!='unmatched' && name(), 'icon-question-sign':listId()=='unmatched'}"></i></span><span class="add-on" data-bind="visible:transients.editing()"><img src="/fieldcapture/static/Xo2jbaJ5EFqa59u9g4c4ybpCpw3wFWKhQdzZwNmmktO.gif" alt="saving icon" /></span><input type="text" data-bind="value:transients.textFieldValue,event:{focusout:focusLost},autocomplete:{url:'/fieldcapture/search/species', render: renderItem, listId: list, result:speciesSelected, valueChangeCallback:textFieldChanged}"  data-validation-engine='validate[required]'/>
    <span class="add-on" data-bind="visible: !transients.editing() && name()">
        <a href="#" data-bind="popover: {title: name, content: transients.speciesInformation}"><i class="icon-info-sign"></i></a>
    </span>
</span>
</td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:numberPlanted' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:seedSownKg' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><select data-bind='value:stockType,options:transients.stockTypeConstraints,optionsCaption:"Please select"'></select></td>
                    <td><select data-bind='value:structuralLayer,options:transients.structuralLayerConstraints,optionsCaption:"Please select"'></select></td>
                    <td><input  class="input-mini" data-bind='value:stockProvenance'  type='text' class='input-small'/></td>
                    <td><select data-bind='value:guardType,options:transients.guardTypeConstraints,optionsCaption:"Please select"'></select></td>
                    <td><i data-bind='click:$root.removeplantingRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr>
                    <td><span >Total Seedlings Planted:</span></td>
                    <td><span  class="value" data-bind='text:data.totalNumberPlanted'></span></td>
                    <td><span >Total Seed Sown (Kg):</span></td>
                    <td><span  class="value" data-bind='text:data.totalSeedSownKg'></span></td>
                    <td colspan='3'><span ></span></td>
                    <td></td>
                </tr>
                <tr><td colspan="8" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addplantingRow">
                        <i class="icon-plus"></i> Add a row</button>
                        <button type="button" class="btn btn-small" data-bind="click:showplantingTableDataUpload"><i class="icon-upload"></i> Upload data for this table</button>


                    </td></tr>
<tr data-bind="visible:plantingTableDataUploadVisible"><td colspan="8">
                <div class="text-error text-left">
                    Note: Only valid exact scientific names will be matched and populated from the database (indicated by a green tick). Unmatched species will load, but will be indicated by a green <b>?</b>. Please check your uploaded data and correct as required.
                </div>
                <div class="text-left" style="margin:5px">
                    <a href="/fieldcapture/proxy/excelOutputTemplate?type=Revegetation Details&listName=planting" target="plantingTemplateDownload" class="btn">Step 1 - Download template (.xlsx)</a>
                </div>
                <div class="text-left" style="margin:5px;">
                    <input type="checkbox" data-bind="checked:appendTableRows" style="margin-right:5px">Append uploaded data to table (unticking this checkbox will result in all table rows being replaced)
                </div>

                <div class="btn fileinput-button" style="margin-left:5px">
                        <input id="plantingTableDataUpload" type="file" name="data" data-bind="fileUploadNoImage:plantingTableDataUploadOptions">
                        Step 2 - Upload populated template
                </div>

                    </td></tr> <script id="plantingtemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="plantingtemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>
<div class="row-fluid space-after output-section" >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Vegetation at time of planting:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='General description of the vegetative cover on the planting site at the time of planting'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.vegDescriptionAtPlanting,options:transients.vegDescriptionAtPlantingConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Revegetation method:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The method used for planting'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.revegetationMethod,options:transients.revegetationMethodConstraints,optionsCaption:"Please select"'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Equipment used:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Simple description of the type of planting equipment used'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span8" data-bind='value:data.equipmentUsed'></textarea></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Adjacent landuse:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The predominant land use adjoining the planting site'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.adjacentLanduse,options:transients.adjacentLanduseConstraints,optionsCaption:"Please select"'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Landscape connectivity:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Estimate of the &apos;connectedness&apos; of the planting site with other native vegetation around it. Choose the most representative category.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.connectivityIndex,options:transients.connectivityIndexConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></span></div></div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Area of revegetation works (Ha):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The area in hectares of the revegetation works area'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.areaRevegHa' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 checkbox-list-label  preLabel"><label>Environmental benefits / outcomes expected to be achieved from this planting:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Environmental benefits /outcomes expected to be achieved through implementing the activity.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span>
            <ul class="checkbox-list" data-bind="foreach: transients.environmentalBenefitsConstraints">
                <li>
                    <input type="checkbox" name="data.environmentalBenefits" data-bind="value:$data,checked:$root.data.environmentalBenefits" /><span data-bind="text:$data"></span>
                </li>
            </ul>
        </span></div></div></div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>Comments / Notes:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Please enter any additional comments or notes about this planting activity'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span12" data-bind='value:data.notes'></textarea></span></div>

        
    </div>

    
    
    <style type="text/css">
        table.seedsList td:nth-child(2) {text-align:center;}
        table.seedsList td:last-child {width:4%;text-align:center;}
        table.seedsList textarea {width:98%;}
    </style>
    <div class="output-block" id="koSeed_Collection_Details">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Seed Collection Details<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after output-section" >
<span class="span6">    <span  class="preLabel required"><label>Provenance of source plant(s):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The locality from which the source seedstock was collected'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input  class="span12 input-small" data-bind='value:data.seedSourceProvenance'  data-validation-engine='validate[required]' type='text' class='input-small'/></span><span class="span6">    <span  class="preLabel"><label>Name of seed bank storing the seed:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The name of the seedbank repository in which collected seedstock is stored'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input  class="span12 input-small" data-bind='value:data.seedBankRepository'  type='text' class='input-small'/></span></div>
<div class="row-fluid output-section">
            <table class="table table-bordered seedsList " >
                <thead><tr><th class="required">Species:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The species providing source seedstock  (start typing a  scientific or common name for a species)'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th class="required">Seed collected (Kg):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The weight of seed collected in kilograms'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Health of source plant(s):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The health of the plant(s) providing source seedstock'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'seedsListviewTmpl', foreach: data.seedsList}"></tbody>
                <script id="seedsListviewTmpl" type="text/html"><tr>
                    <td>
<span class="input-prepend input-append" data-bind="with:seedSourceSpecies">
    <span class="add-on" data-bind="visible:!transients.editing(), css:{'btn-success':name()}"><i class="icon-white" data-bind="css:{'icon-ok':listId()!='unmatched' && name(), 'icon-question-sign':listId()=='unmatched'}"></i></span><span class="add-on" data-bind="visible:transients.editing()"><img src="/fieldcapture/static/Xo2jbaJ5EFqa59u9g4c4ybpCpw3wFWKhQdzZwNmmktO.gif" alt="saving icon" /></span><input type="text" data-bind="value:transients.textFieldValue,event:{focusout:focusLost},autocomplete:{url:'/fieldcapture/search/species', render: renderItem, listId: list, result:speciesSelected, valueChangeCallback:textFieldChanged}"  data-validation-engine='validate[required]'/>
    <span class="add-on" data-bind="visible: !transients.editing() && name()">
        <a href="#" data-bind="popover: {title: name, content: transients.speciesInformation}"><i class="icon-info-sign"></i></a>
    </span>
</span>
</td>
                    <td><input class="input-small" style="text-align:center" data-bind='value:seedCollectedKg' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><select data-bind='value:sourcePlantHealth,options:transients.sourcePlantHealthConstraints,optionsCaption:"Please select"'></select></td>
                    <td><i data-bind='click:$root.removeseedsListRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr>
                    <td><span >Total seed collected (kg)</span></td>
                    <td><span  class="value" data-bind='text:data.totalSeedCollectedKg'></span></td>
                    <td colspan='2'><span ></span></td>
                    <td></td>
                </tr>
                <tr><td colspan="5" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addseedsListRow">
                        <i class="icon-plus"></i> Add a row</button>
                        <button type="button" class="btn btn-small" data-bind="click:showseedsListTableDataUpload"><i class="icon-upload"></i> Upload data for this table</button>


                    </td></tr>
<tr data-bind="visible:seedsListTableDataUploadVisible"><td colspan="5">
                <div class="text-error text-left">
                    Note: Only valid exact scientific names will be matched and populated from the database (indicated by a green tick). Unmatched species will load, but will be indicated by a green <b>?</b>. Please check your uploaded data and correct as required.
                </div>
                <div class="text-left" style="margin:5px">
                    <a href="/fieldcapture/proxy/excelOutputTemplate?type=Seed Collection Details&listName=seedsList" target="seedsListTemplateDownload" class="btn">Step 1 - Download template (.xlsx)</a>
                </div>
                <div class="text-left" style="margin:5px;">
                    <input type="checkbox" data-bind="checked:appendTableRows" style="margin-right:5px">Append uploaded data to table (unticking this checkbox will result in all table rows being replaced)
                </div>

                <div class="btn fileinput-button" style="margin-left:5px">
                        <input id="seedsListTableDataUpload" type="file" name="data" data-bind="fileUploadNoImage:seedsListTableDataUploadOptions">
                        Step 2 - Upload populated template
                </div>

                    </td></tr> <script id="seedsListtemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="seedsListtemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>Comments / Notes:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='General comments and notes about the seed collection activity and related observations'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span12" data-bind='value:data.notes'></textarea></span></div>

        
    </div>

    
    
    <style type="text/css">
        table.actionsList td:nth-child(1) {width:10%;}
        table.actionsList td:nth-child(1) select {width:100%;}
        table.actionsList td:nth-child(2) {width:10%;text-align:center;}
        table.actionsList td:nth-child(2) select {width:100%;}
        table.actionsList td:nth-child(3) {width:15%;}
        table.actionsList td:nth-child(3) select {width:100%;}
        table.actionsList td:nth-child(4) {width:65%;}
        table.actionsList td:nth-child(4) select {width:100%;}
        table.actionsList td:last-child {width:4%;text-align:center;}
        table.actionsList textarea {width:98%;}
    </style>
    <div class="output-block" id="koSite_Preparation_Actions">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Site Preparation Actions<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid output-section">
            <table class="table table-bordered actionsList " >
                <thead><tr><th class="required">Ground preparation works:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Type of ground preparation works undertaken'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th class="required">Area prepared (Ha):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Area in hectares subject to the associated site preparation works'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Associated follow-up activity:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The type of activity for which the preparation action is being undertaken'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Comments / Notes:</th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'actionsListviewTmpl', foreach: data.actionsList}"></tbody>
                <script id="actionsListviewTmpl" type="text/html"><tr>
                    <td><select data-bind='value:groundPreparationWorks,options:transients.groundPreparationWorksConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:preparationArea' data-validation-engine='validate[required,min[0],custom[number]]' type='number' class='input-mini'/></td>
                    <td><select data-bind='value:associatedActivity,options:transients.associatedActivityConstraints,optionsCaption:"Please select"'></select></td>
                    <td><textarea  data-bind='value:notes'></textarea></td>
                    <td><i data-bind='click:$root.removeactionsListRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr>
                    <td><span >Total area of site preparation works (Ha):</span></td>
                    <td><span  class="value" data-bind='text:data.preparationAreaTotal'></span></td>
                    <td colspan='2'><span ></span></td>
                    <td></td>
                </tr>
                <tr><td colspan="5" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addactionsListRow">
                        <i class="icon-plus"></i> Add a row</button>
                        <button type="button" class="btn btn-small" data-bind="click:showactionsListTableDataUpload"><i class="icon-upload"></i> Upload data for this table</button>


                    </td></tr>
<tr data-bind="visible:actionsListTableDataUploadVisible"><td colspan="5">
                <div class="text-error text-left">
                    Note: Only valid exact scientific names will be matched and populated from the database (indicated by a green tick). Unmatched species will load, but will be indicated by a green <b>?</b>. Please check your uploaded data and correct as required.
                </div>
                <div class="text-left" style="margin:5px">
                    <a href="/fieldcapture/proxy/excelOutputTemplate?type=Site Preparation Actions&listName=actionsList" target="actionsListTemplateDownload" class="btn">Step 1 - Download template (.xlsx)</a>
                </div>
                <div class="text-left" style="margin:5px;">
                    <input type="checkbox" data-bind="checked:appendTableRows" style="margin-right:5px">Append uploaded data to table (unticking this checkbox will result in all table rows being replaced)
                </div>

                <div class="btn fileinput-button" style="margin-left:5px">
                        <input id="actionsListTableDataUpload" type="file" name="data" data-bind="fileUploadNoImage:actionsListTableDataUploadOptions">
                        Step 2 - Upload populated template
                </div>

                    </td></tr> <script id="actionsListtemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="actionsListtemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>

        
    </div>

    
    
    
    <div class="output-block" id="koFence_Details">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Fence Details<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after output-section" >
<span class="span3">    <span  class="preLabel required"><label>Fence Type:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The type of fence erected'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span12" data-bind='value:data.fenceType,options:transients.fenceTypeConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></span><span class="span3">    <span  class="preLabel required"><label>Length of fence (Km):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Length of fence erected in kilometres'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.lengthOfFence' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></span><span class="span3">    <span  class="preLabel"><label>Fence cost ($/Km):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Cost of the erected fence in $ per kilometre'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.fenceCostPerKm' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span><span class="span3">    <span  class="checkbox-list-label  preLabel required"><label>Purpose of fence:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The purpose for which the fence has been erected'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span>
            <ul class="checkbox-list" data-bind="foreach: transients.purposeOfFenceConstraints">
                <li>
                    <input type="checkbox" name="data.purposeOfFence" data-bind="value:$data,checked:$root.data.purposeOfFence"  data-validation-engine='validate[minCheckbox[1]]'/><span data-bind="text:$data"></span>
                </li>
            </ul>
        </span></div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>Comments/Notes:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Notes'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span12" data-bind='value:data.fenceNotes'></textarea></span></div>

        
    </div>

    
    
    
    <div class="output-block" id="koFire_Information">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Fire Information<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after " >
<span class="span12">    <span  class="span12">Please enter as much information about this fire activity as possible. If the type of fire event is 'Fire prevention works' and fire was not used as a tool (eg. for fuel reduction), then please ignore any non-relevant questions.</span></span></div>
<div class="row-fluid space-after output-section" >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Ignition source:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The source of fire ignition'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.fireIgnitionSource,options:transients.fireIgnitionSourceConstraints,optionsCaption:"Please select"'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Type of event:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Type of fire event'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.fireEventType,options:transients.fireEventTypeConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 checkbox-list-label  preLabel required"><label>Reason(s) for burn:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Purpose of undertaking the fire management activity'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span>
            <ul class="checkbox-list" data-bind="foreach: transients.fireReasonConstraints">
                <li>
                    <input type="checkbox" name="data.fireReason" data-bind="value:$data,checked:$root.data.fireReason"  data-validation-engine='validate[minCheckbox[1]]'/><span data-bind="text:$data"></span>
                </li>
            </ul>
        </span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Area of fire ground (Ha):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Area in hectares of the fire ground'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.areaOfFireHa' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Actual burnt area (% of fire ground area):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Area of the fire ground actually burnt expressed as a percentage of the total fire ground area'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.areaBurntPercent' data-validation-engine='validate[required,min[0],max[100],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Previous burn date:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Date at which the last known fire occurred on the subject fire ground'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><div class="input-append"><input data-bind="datepicker:data.fireLastBurnDate.date" type="text" size="12"/><span class="add-on open-datepicker"><i class="icon-th"></i></span></div></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Time since last burn:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Approximate time period since the  last known fire occurred on the subject fire ground'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.fireTimeSinceLastBurn,options:transients.fireTimeSinceLastBurnConstraints,optionsCaption:"Please select"'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Temperature of burn:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Generalised indicator of the intensity of the fire event'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.fireBurnTemp,options:transients.fireBurnTempConstraints,optionsCaption:"Please select"'></select></span></div></div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 checkbox-list-label  preLabel"><label>Fire prevention works (if applicable):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Actions implemented to prevent or better manage wildfire events'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span>
            <ul class="checkbox-list" data-bind="foreach: transients.firePreventionActionConstraints">
                <li>
                    <input type="checkbox" name="data.firePreventionAction" data-bind="value:$data,checked:$root.data.firePreventionAction" /><span data-bind="text:$data"></span>
                </li>
            </ul>
        </span></div><div class="row-fluid"><span class="span12">    <span  class="span4 checkbox-list-label  preLabel"><label>Machinery used:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Classes of machinery deployed onto the fire ground to manage the fire event'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span>
            <ul class="checkbox-list" data-bind="foreach: transients.fireMachineryUsedConstraints">
                <li>
                    <input type="checkbox" name="data.fireMachineryUsed" data-bind="value:$data,checked:$root.data.fireMachineryUsed" /><span data-bind="text:$data"></span>
                </li>
            </ul>
        </span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Total machinery hours:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Total aggregate number of hours for all machinery deployed onto the fire ground'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.totalMachineHours' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Length of control line - machinery (km):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Length in kilometres of fire breaks and back burn lines implemented by machinery to manage the fire event'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.controlLineKmMachine' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Length of control line - hand tools (km):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Length in kilometres of fire breaks and back burn lines implemented by hand tools and manual labor to manage the fire event'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.controlLineKmHand' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Did the fire stay with initial control lines?:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Indicator as to whether the fire total fire ground was contained within the initial control lines'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.fireContainment,options:transients.fireContainmentConstraints,optionsCaption:"Please select"'></select></span></div></div></div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>Comments / Notes:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='General comments and notes about this management action, the subject site, etc.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span12" data-bind='value:data.notes'></textarea></span></div>

        
    </div>

    
    
    <style type="text/css">
        table.weedsTreated th {white-space:normal;}
        table.weedsTreated td:nth-child(1) {width:25%;}
        table.weedsTreated td:nth-child(1) select {width:100%;}
        table.weedsTreated td:nth-child(2) {width:15%;}
        table.weedsTreated td:nth-child(2) select {width:100%;}
        table.weedsTreated td:nth-child(3) {width:15%;}
        table.weedsTreated td:nth-child(3) select {width:100%;}
        table.weedsTreated td:nth-child(4) {width:15%;}
        table.weedsTreated td:nth-child(4) select {width:100%;}
        table.weedsTreated td:nth-child(5) {width:30%;}
        table.weedsTreated td:nth-child(5) select {width:100%;}
        table.weedsTreated td:last-child {width:4%;text-align:center;}
        table.weedsTreated textarea {width:98%;}
    </style>
    <div class="output-block" id="koWeed_Treatment_Details">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Weed Treatment Details<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after output-section" >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Type of treatment event:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The stage of treatment for the patch of weeds being treated'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.treatmentEventType,options:transients.treatmentEventTypeConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Treatment area (Ha):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The area in hectares of the patch of the target species being treated'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.areaTreatedHa' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Length of riparian or roadside area treated (Km):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The length in kilometres of the longest axis (eg. riparian, road, beach, etc.) of the treated area'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.linearAreaTreated' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Treatment cost ($/Ha):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The cost per hectare of the treatment'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.treatmentCostPerHa' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div></div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Locality of the treatment area:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Brief description of the general locality in which the treatment works were undertaken'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span8" data-bind='value:data.locality'></textarea></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>If chemical treatment, please provide details (chemical & application rate):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Details of chemical treatment including chemical agent and rate of application'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span8" data-bind='value:data.chemicalDetails'></textarea></span></div></div></div>
<div class="row-fluid ">
            <table class="table table-bordered weedsTreated " >
                <thead><tr><th class="required">Target species:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The plant species being targeted for treatment (start typing a  scientific or common name for a species)'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Reproductive status at the time of treatment:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The reproductive status of the target species being treated'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Plant health at the time of treatment:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The general health of the patch of the target species being treated'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th class="required">Control status:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The control status of the patch of the target species being treated'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th class="required">Treatment method:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The method used to treat the patch of the target species'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'weedsTreatedviewTmpl', foreach: data.weedsTreated}"></tbody>
                <script id="weedsTreatedviewTmpl" type="text/html"><tr>
                    <td>
<span class="input-prepend input-append" data-bind="with:targetSpecies">
    <span class="add-on" data-bind="visible:!transients.editing(), css:{'btn-success':name()}"><i class="icon-white" data-bind="css:{'icon-ok':listId()!='unmatched' && name(), 'icon-question-sign':listId()=='unmatched'}"></i></span><span class="add-on" data-bind="visible:transients.editing()"><img src="/fieldcapture/static/Xo2jbaJ5EFqa59u9g4c4ybpCpw3wFWKhQdzZwNmmktO.gif" alt="saving icon" /></span><input type="text" data-bind="value:transients.textFieldValue,event:{focusout:focusLost},autocomplete:{url:'/fieldcapture/search/species', render: renderItem, listId: list, result:speciesSelected, valueChangeCallback:textFieldChanged}"  data-validation-engine='validate[required]'/>
    <span class="add-on" data-bind="visible: !transients.editing() && name()">
        <a href="#" data-bind="popover: {title: name, content: transients.speciesInformation}"><i class="icon-info-sign"></i></a>
    </span>
</span>
</td>
                    <td><select data-bind='value:reproductiveStatus,options:transients.reproductiveStatusConstraints,optionsCaption:"Please select"'></select></td>
                    <td><select data-bind='value:plantHealth,options:transients.plantHealthConstraints,optionsCaption:"Please select"'></select></td>
                    <td><select data-bind='value:controlStatus,options:transients.controlStatusConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></td>
                    <td><select data-bind='value:treatmentMethod,options:transients.treatmentMethodConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></td>
                    <td><i data-bind='click:$root.removeweedsTreatedRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr><td colspan="0" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addweedsTreatedRow">
                        <i class="icon-plus"></i> Add a row</button>
                        <button type="button" class="btn btn-small" data-bind="click:showweedsTreatedTableDataUpload"><i class="icon-upload"></i> Upload data for this table</button>


                    </td></tr>
<tr data-bind="visible:weedsTreatedTableDataUploadVisible"><td colspan="0">
                <div class="text-error text-left">
                    Note: Only valid exact scientific names will be matched and populated from the database (indicated by a green tick). Unmatched species will load, but will be indicated by a green <b>?</b>. Please check your uploaded data and correct as required.
                </div>
                <div class="text-left" style="margin:5px">
                    <a href="/fieldcapture/proxy/excelOutputTemplate?type=Weed Treatment Details&listName=weedsTreated" target="weedsTreatedTemplateDownload" class="btn">Step 1 - Download template (.xlsx)</a>
                </div>
                <div class="text-left" style="margin:5px;">
                    <input type="checkbox" data-bind="checked:appendTableRows" style="margin-right:5px">Append uploaded data to table (unticking this checkbox will result in all table rows being replaced)
                </div>

                <div class="btn fileinput-button" style="margin-left:5px">
                        <input id="weedsTreatedTableDataUpload" type="file" name="data" data-bind="fileUploadNoImage:weedsTreatedTableDataUploadOptions">
                        Step 2 - Upload populated template
                </div>

                    </td></tr> <script id="weedsTreatedtemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="weedsTreatedtemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>Comments / Notes</label></span><textarea  class="span12" data-bind='value:data.notes'></textarea></span></div>

        
    </div>

    
    
    <style type="text/css">
        table.stockingDetails td:nth-child(1) {width:50%;}
        table.stockingDetails td:nth-child(1) select {width:100%;}
        table.stockingDetails td:nth-child(2) {text-align:center;}
        table.stockingDetails td:last-child {width:4%;text-align:center;}
        table.stockingDetails textarea {width:98%;}
    </style>
    <div class="output-block" id="koStock_Management_Details">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Stock Management Details<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after output-section" >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 checkbox-list-label  preLabel required"><label>What land management issue(s) are you using stock grazing to manage?:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Purpose for which grazing is being used as a management tool'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span>
            <ul class="checkbox-list" data-bind="foreach: transients.stockManagementReasonConstraints">
                <li>
                    <input type="checkbox" name="data.stockManagementReason" data-bind="value:$data,checked:$root.data.stockManagementReason"  data-validation-engine='validate[minCheckbox[1]]'/><span data-bind="text:$data"></span>
                </li>
            </ul>
        </span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Area managed (Ha):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Area in hectares where grazing is used as a management tool under this activity'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.areaOfStockManagementHa' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></span></div></div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Stocking strategy:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Description of the grazing strategy/methodology being used to achieve the purpose'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span8" data-bind='value:data.stockingStrategy'></textarea></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Comments / Notes:</label></span><textarea  class="span8" data-bind='value:data.notes'></textarea></span></div></div></div>
<div class="row-fluid output-section">
            <table class="table table-bordered stockingDetails " >
                <thead><tr><th class="required">Type of stock used:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Type of stock species being used to achieve the purpose of the activity'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th class="required">Stocking density (DSE / Ha):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The density of grazing stock used to achieve the purpose of the activity expressed in Dry Sheep Equivalents per hectare'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'stockingDetailsviewTmpl', foreach: data.stockingDetails}"></tbody>
                <script id="stockingDetailsviewTmpl" type="text/html"><tr>
                    <td><select data-bind='value:stockingManagementSpecies,options:transients.stockingManagementSpeciesConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></td>
                    <td><input class="input-small" style="text-align:center" data-bind='value:stockingDensity' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><i data-bind='click:$root.removestockingDetailsRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr><td colspan="0" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addstockingDetailsRow">
                        <i class="icon-plus"></i> Add a row</button>
                        <button type="button" class="btn btn-small" data-bind="click:showstockingDetailsTableDataUpload"><i class="icon-upload"></i> Upload data for this table</button>


                    </td></tr>
<tr data-bind="visible:stockingDetailsTableDataUploadVisible"><td colspan="0">
                <div class="text-error text-left">
                    Note: Only valid exact scientific names will be matched and populated from the database (indicated by a green tick). Unmatched species will load, but will be indicated by a green <b>?</b>. Please check your uploaded data and correct as required.
                </div>
                <div class="text-left" style="margin:5px">
                    <a href="/fieldcapture/proxy/excelOutputTemplate?type=Stock Management Details&listName=stockingDetails" target="stockingDetailsTemplateDownload" class="btn">Step 1 - Download template (.xlsx)</a>
                </div>
                <div class="text-left" style="margin:5px;">
                    <input type="checkbox" data-bind="checked:appendTableRows" style="margin-right:5px">Append uploaded data to table (unticking this checkbox will result in all table rows being replaced)
                </div>

                <div class="btn fileinput-button" style="margin-left:5px">
                        <input id="stockingDetailsTableDataUpload" type="file" name="data" data-bind="fileUploadNoImage:stockingDetailsTableDataUploadOptions">
                        Step 2 - Upload populated template
                </div>

                    </td></tr> <script id="stockingDetailstemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="stockingDetailstemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>

        
    </div>

    
    
    <style type="text/css">
        table.infrastructureInstallations td:nth-child(1) {width:30%;}
        table.infrastructureInstallations td:nth-child(1) select {width:100%;}
        table.infrastructureInstallations td:nth-child(3) {width:10%;text-align:center;}
        table.infrastructureInstallations td:nth-child(3) select {width:100%;}
        table.infrastructureInstallations td:last-child {width:4%;text-align:center;}
        table.infrastructureInstallations textarea {width:98%;}
    </style>
    <div class="output-block" id="koInfrastructure_Details">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Infrastructure Details<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after " >
<span class="span12">    <span  class="span12">Please list the numbers of each different type of infrastructure facility established.</span></span></div>
<div class="row-fluid output-section">
            <table class="table table-bordered infrastructureInstallations " >
                <thead><tr><th class="required">Type of infrastructure:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The type of infrastructure being established.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Description of infrastructure installed:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Brief description of the infrastructure implemented.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th class="required">No. of installations:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of individual installations / facilities established for each type of infrastructure.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'infrastructureInstallationsviewTmpl', foreach: data.infrastructureInstallations}"></tbody>
                <script id="infrastructureInstallationsviewTmpl" type="text/html"><tr>
                    <td><select data-bind='value:infrastructureType,options:transients.infrastructureTypeConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></td>
                    <td><textarea  data-bind='value:infrastructureDescription'></textarea></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:noInstallations' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><i data-bind='click:$root.removeinfrastructureInstallationsRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr>
                    <td><span ></span></td>
                    <td><span >Total No. of installations/facilities:</span></td>
                    <td><span  class="value" data-bind='text:data.noInstallationsTotal'></span></td>
                    <td></td>
                </tr>
                <tr><td colspan="4" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addinfrastructureInstallationsRow">
                        <i class="icon-plus"></i> Add a row</button>
                        <button type="button" class="btn btn-small" data-bind="click:showinfrastructureInstallationsTableDataUpload"><i class="icon-upload"></i> Upload data for this table</button>


                    </td></tr>
<tr data-bind="visible:infrastructureInstallationsTableDataUploadVisible"><td colspan="4">
                <div class="text-error text-left">
                    Note: Only valid exact scientific names will be matched and populated from the database (indicated by a green tick). Unmatched species will load, but will be indicated by a green <b>?</b>. Please check your uploaded data and correct as required.
                </div>
                <div class="text-left" style="margin:5px">
                    <a href="/fieldcapture/proxy/excelOutputTemplate?type=Infrastructure Details&listName=infrastructureInstallations" target="infrastructureInstallationsTemplateDownload" class="btn">Step 1 - Download template (.xlsx)</a>
                </div>
                <div class="text-left" style="margin:5px;">
                    <input type="checkbox" data-bind="checked:appendTableRows" style="margin-right:5px">Append uploaded data to table (unticking this checkbox will result in all table rows being replaced)
                </div>

                <div class="btn fileinput-button" style="margin-left:5px">
                        <input id="infrastructureInstallationsTableDataUpload" type="file" name="data" data-bind="fileUploadNoImage:infrastructureInstallationsTableDataUploadOptions">
                        Step 2 - Upload populated template
                </div>

                    </td></tr> <script id="infrastructureInstallationstemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="infrastructureInstallationstemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>Comments / Notes</label></span><textarea  class="span12" data-bind='value:data.notes'></textarea></span></div>

        
    </div>

    
    
    
    <div class="output-block" id="koPest_Management_Details">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Pest Management Details<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after output-section" >
<div class="span4">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Target species:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Pest species targeted for treatment (start typing a  scientific or common name for a species)'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span>
<span class="input-prepend input-append" data-bind="with:data.targetSpecies">
    <span class="add-on" data-bind="visible:!transients.editing(), css:{'btn-success':name()}"><i class="icon-white" data-bind="css:{'icon-ok':listId()!='unmatched' && name(), 'icon-question-sign':listId()=='unmatched'}"></i></span><span class="add-on" data-bind="visible:transients.editing()"><img src="/fieldcapture/static/Xo2jbaJ5EFqa59u9g4c4ybpCpw3wFWKhQdzZwNmmktO.gif" alt="saving icon" /></span><input type="text" data-bind="value:transients.textFieldValue,event:{focusout:focusLost},autocomplete:{url:'/fieldcapture/search/species', render: renderItem, listId: list, result:speciesSelected, valueChangeCallback:textFieldChanged}"  data-validation-engine='validate[required]'/>
    <span class="add-on" data-bind="visible: !transients.editing() && name()">
        <a href="#" data-bind="popover: {title: name, content: transients.speciesInformation}"><i class="icon-info-sign"></i></a>
    </span>
</span>
</span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Treatment incentive method:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The incentive program applicable to this activity'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.treatmentIncentiveMethod,options:transients.treatmentIncentiveMethodConstraints,optionsCaption:"Please select"'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>No. of individuals killed / removed:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Number of target pest animals removed during this activity'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.pestAnimalsTreatedNo' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Area covered by treatment (Ha):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Area covered by treatment (Ha): *'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.areaTreatedHa' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Estimated pest density before treatment (No./Ha):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Estimated density of pest animals per hectare prior to treatment action'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.pestDensityPerHa' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></span></div></div><div class="span4">
<div class="row-fluid"><span class="span12">    <span  class="span4 checkbox-list-label  preLabel required"><label>Pest management method:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The method used in this activity to manage pests'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span>
            <ul class="checkbox-list" data-bind="foreach: transients.pestManagementMethodConstraints">
                <li>
                    <input type="checkbox" name="data.pestManagementMethod" data-bind="value:$data,checked:$root.data.pestManagementMethod"  data-validation-engine='validate[minCheckbox[1]]'/><span data-bind="text:$data"></span>
                </li>
            </ul>
        </span></div></div><div class="span4">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Pest management purpose:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The purpose for which this activity is being undertaken'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.pestManagementPurpose,options:transients.pestManagementPurposeConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Cost of treatment / Ha.:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Cost of this treatment on a per hectare basis'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.treatmentCostPerHa' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Activity duration (Hrs):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The duration in hours over which this activity was conducted'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.activityDuration' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div></div></div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>Comments / Notes</label></span><textarea  class="span12" data-bind='value:data.notes'></textarea></span></div>

        
    </div>

    
    
    
    <div class="output-block" id="koResearch_Information">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Research Information<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after output-section" >
<div class="span12">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Type of research being undertaken:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Category of research being undertaken'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.typeOfResearch,options:transients.typeOfResearchConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Name of the research project:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Name of the research project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input  class="span8 input-small" data-bind='value:data.nameOfResearchProject'  data-validation-engine='validate[required]' type='text' class='input-small'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Research objectives:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Description of the objectives of the research project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span8" data-bind='value:data.researchObjectives'></textarea></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>List the project collaborators:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='List of the collaborators involved in the research project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span8" data-bind='value:data.researchCollaborators'></textarea></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Comments / Notes:</label></span><textarea  class="span8" data-bind='value:data.notes'></textarea></span></div></div></div>

        
    </div>

    
    
    
    <div class="output-block" id="koWater_Management_Details">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Water Management Details<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after output-section" >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Type of water-body being managed:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The type of water body, waterway or wetland which is the subject of this management action'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.waterbodyType,options:transients.waterbodyTypeConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Hydrological regime changed from:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The hydrological regime which typified the flow characteristics of the subject water body prior to this management action'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.hydrologicalRegimeChangeFrom,options:transients.hydrologicalRegimeChangeFromConstraints,optionsCaption:"Please select"'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Hydrological regime changed to:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The hydrological regime which will typify the flow characteristics of the subject water body after implementation of this management action'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.hydrologicalRegimeChangeTo,options:transients.hydrologicalRegimeChangeToConstraints,optionsCaption:"Please select"'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Current flow regime of the subject water body?:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The naturalness of the hydrological regime of the subject water body immediately prior to undertaking this management action'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.isCurrentFlowNatural,options:transients.isCurrentFlowNaturalConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 checkbox-list-label  preLabel"><label>What structure(s) are in place to manage water at this site?:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Operationally functional water management structures installed on the site of the subject water body (both pre-existing and new)'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span>
            <ul class="checkbox-list" data-bind="foreach: transients.hydrologicalStructuresOnsiteConstraints">
                <li>
                    <input type="checkbox" name="data.hydrologicalStructuresOnsite" data-bind="value:$data,checked:$root.data.hydrologicalStructuresOnsite" /><span data-bind="text:$data"></span>
                </li>
            </ul>
        </span></div></div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>No. of new structures installed to manage the hydrological regime at this site:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of new hydrology management structures installed on the site of the subject water body resulting from this management action'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.hydrologicalStructuresInstalled' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Is the management action extracting water from / importing water to the site?:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The direction of &apos;managed&apos; water transportation in relation to the subject water body in respect to this management action'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.isWaterBeingTransported,options:transients.isWaterBeingTransportedConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Area of catchment being managed/treated by this activity (Ha):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The area of catchment in hectares being managed as a result of this management action'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.managedArea' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 checkbox-list-label  preLabel"><label>How is extracted / imported water being transported under this management action?:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The transport medium for &apos;managed&apos; water to/from the subject water body in respect to this management action'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span>
            <ul class="checkbox-list" data-bind="foreach: transients.waterTransportMethodConstraints">
                <li>
                    <input type="checkbox" name="data.waterTransportMethod" data-bind="value:$data,checked:$root.data.waterTransportMethod" /><span data-bind="text:$data"></span>
                </li>
            </ul>
        </span></div><div class="row-fluid"><span class="span12">    <span  class="span4 checkbox-list-label  preLabel required"><label>What is extracted / imported water being used for?:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The use(s) for which managed water under this management action will be applied'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span>
            <ul class="checkbox-list" data-bind="foreach: transients.transportedWaterUseConstraints">
                <li>
                    <input type="checkbox" name="data.transportedWaterUse" data-bind="value:$data,checked:$root.data.transportedWaterUse"  data-validation-engine='validate[minCheckbox[1]]'/><span data-bind="text:$data"></span>
                </li>
            </ul>
        </span></div><div class="row-fluid"><span class="span12">    <span  class="span4 checkbox-list-label  preLabel required"><label>What environmental benefits are expected to be gained by this water management action?:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The environmental benefits/outcomes expected to be realised as a result of this water management action'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span>
            <ul class="checkbox-list" data-bind="foreach: transients.waterMgtEnvironBenefitConstraints">
                <li>
                    <input type="checkbox" name="data.waterMgtEnvironBenefit" data-bind="value:$data,checked:$root.data.waterMgtEnvironBenefit"  data-validation-engine='validate[minCheckbox[1]]'/><span data-bind="text:$data"></span>
                </li>
            </ul>
        </span></div></div></div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>Comments / Notes:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='General comments and notes about this management action, the subject site, etc.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span12" data-bind='value:data.notes'></textarea></span></div>

        
    </div>

    
    
    
    <div class="output-block" id="koDebris_Removal_Details">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Debris Removal Details<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after output-section" >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Type of material removed:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Type(s) of debris removed during the activity'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.debrisType,options:transients.debrisTypeConstraints,optionsCaption:"Please select"'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 checkbox-list-label  preLabel"><label>Method(s) used to remove debris:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Method(s) used to remove debris during the activity'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span>
            <ul class="checkbox-list" data-bind="foreach: transients.debrisRemovalMethodConstraints">
                <li>
                    <input type="checkbox" name="data.debrisRemovalMethod" data-bind="value:$data,checked:$root.data.debrisRemovalMethod" /><span data-bind="text:$data"></span>
                </li>
            </ul>
        </span></div></div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Weight of debris removed (Tonnes):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Weight in tonnes of debris removed during the activity'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.debrisWeightTonnes' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Volume of debris removed (m3):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Volume in cubic metres of debris removed during the activity'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.debrisVolumeM3' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Comments / Notes:</label></span><textarea  class="span8" data-bind='value:data.debrisNotes'></textarea></span></div></div></div>

        
    </div>

    
    
    
    <div class="output-block" id="koAccess_Control_Details">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Access Control Details<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after output-section" >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 checkbox-list-label  preLabel"><label>Access control method used:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Generalised method employed to manage access on the subject area'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span>
            <ul class="checkbox-list" data-bind="foreach: transients.accessManagementMethodConstraints">
                <li>
                    <input type="checkbox" name="data.accessManagementMethod" data-bind="value:$data,checked:$root.data.accessManagementMethod" /><span data-bind="text:$data"></span>
                </li>
            </ul>
        </span></div><div class="row-fluid"><span class="span12">    <span  class="span4 checkbox-list-label  preLabel required"><label>Structure(s) installed:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Type of structure(s) installed to manage access on the subject area'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span>
            <ul class="checkbox-list" data-bind="foreach: transients.structuresInstalledConstraints">
                <li>
                    <input type="checkbox" name="data.structuresInstalled" data-bind="value:$data,checked:$root.data.structuresInstalled"  data-validation-engine='validate[minCheckbox[1]]'/><span data-bind="text:$data"></span>
                </li>
            </ul>
        </span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>No. of access management structures installed:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of access management structures installed during this activity'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.numberOfInstallations' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></span></div></div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 checkbox-list-label  preLabel"><label>Purpose of undertaking access management works:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Purpose for managing access on the subject area'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span>
            <ul class="checkbox-list" data-bind="foreach: transients.accessControlPurposeConstraints">
                <li>
                    <input type="checkbox" name="data.accessControlPurpose" data-bind="value:$data,checked:$root.data.accessControlPurpose" /><span data-bind="text:$data"></span>
                </li>
            </ul>
        </span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Length of fences and boardwalks installed (Km):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Length in kilometres of fences and boardwalks installed during this activity'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.lengthOfLinealStructures' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Description of issue(s) requiring access management:</label></span><textarea  class="span8" data-bind='value:data.accessControlIssues'></textarea></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>No. of visitors (people managed for access):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Total number of visitors managed for access during this activity'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.visitationNumber' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></span></div></div></div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>Comments / Notes</label></span><textarea  class="span12" data-bind='value:data.notes'></textarea></span></div>

        
    </div>

    
    
    
    <div class="output-block" id="koErosion_Management_Details">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Erosion Management Details<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after output-section" >
<span class="span3">    <span  class="preLabel"><label>Area of erosion on this site (Ha.):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Area in hectares affected by erosion'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.erosionAffectedArea' data-validation-engine='validate[digits,custom[number],min[0]]' type='number' class='input-mini'/></span><span class="span3">    <span  class="preLabel required"><label>Area of erosion being treated:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Area in hectares of erosion treated by this activity'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.erosionAreaTreated' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></span><span class="span3">    <span  class="preLabel required"><label>Length of stream/coastline treated (Km):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Length in lineal kilometres of the longest axis of the treatment area'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.erosionLength' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></span><span class="span3">    <span  class="preLabel required"><label>No. of erosion control structures installed:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of individual erosion management structures installed during this activity'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.erosionStructuresInstalled' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></span></div>
<div class="row-fluid space-after output-section" >
<span class="span4">    <span  class="checkbox-list-label  preLabel required"><label>Type(s) of erosion treated:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The type of erosion evident on the site'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span>
            <ul class="checkbox-list" data-bind="foreach: transients.erosionTypeConstraints">
                <li>
                    <input type="checkbox" name="data.erosionType" data-bind="value:$data,checked:$root.data.erosionType"  data-validation-engine='validate[minCheckbox[1]]'/><span data-bind="text:$data"></span>
                </li>
            </ul>
        </span><span class="span4">    <span  class="checkbox-list-label  preLabel required"><label>Erosion management method(s) used:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The type of method used in this management action to manage erosion on the subject area'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span>
            <ul class="checkbox-list" data-bind="foreach: transients.erosionTreatmentMethodConstraints">
                <li>
                    <input type="checkbox" name="data.erosionTreatmentMethod" data-bind="value:$data,checked:$root.data.erosionTreatmentMethod"  data-validation-engine='validate[minCheckbox[1]]'/><span data-bind="text:$data"></span>
                </li>
            </ul>
        </span><span class="span4">    <span  class="checkbox-list-label  preLabel"><label>Erosion control structure(s) installed:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The type(s) of structure installed during this activity to control erosion on the subject site'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span>
            <ul class="checkbox-list" data-bind="foreach: transients.erosionControlStructuresConstraints">
                <li>
                    <input type="checkbox" name="data.erosionControlStructures" data-bind="value:$data,checked:$root.data.erosionControlStructures" /><span data-bind="text:$data"></span>
                </li>
            </ul>
        </span></div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>Notes:</label></span><textarea  class="span12" data-bind='value:data.erosionNotes'></textarea></span></div>

        
    </div>

    
    
    <style type="text/css">
        table.practiceChange th {white-space:normal;}
        table.practiceChange td:nth-child(1) {width:25%;}
        table.practiceChange td:nth-child(1) select {width:100%;}
        table.practiceChange td:nth-child(4) {width:20%;}
        table.practiceChange td:nth-child(4) select {width:100%;}
        table.practiceChange td:nth-child(5) {width:10%;text-align:center;}
        table.practiceChange td:nth-child(5) select {width:100%;}
        table.practiceChange td:nth-child(6) {width:10%;text-align:center;}
        table.practiceChange td:nth-child(6) select {width:100%;}
        table.practiceChange td:last-child {width:4%;text-align:center;}
        table.practiceChange textarea {width:98%;}
    </style>
    <div class="output-block" id="koManagement_Practice_Change_Details">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Management Practice Change Details<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid output-section">
            <table class="table table-bordered practiceChange " >
                <thead><tr><th class="required">Reason for changing management practices:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The purpose for which changed practices are implemented'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th class="required">Industry:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The type of industry in which changed practices are implemented'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th class="required">Resource condition prior to action:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The condition of the resource at the time when changed practices are implemented'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th class="required">Practice change action:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The practice change action applied to address the resource condition issue.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th class="required">Area treated by practice change (Ha):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Area of land in hectares on which changed management practices are implemented'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th class="required">No. of farming entities adopting this practice change:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of farming entities adopting the specified changed management practices'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'practiceChangeviewTmpl', foreach: data.practiceChange}"></tbody>
                <script id="practiceChangeviewTmpl" type="text/html"><tr>
                    <td><select data-bind='value:changePurpose,options:transients.changePurposeConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></td>
                    <td><select data-bind='value:industryType,options:transients.industryTypeConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></td>
                    <td><select data-bind='value:resourceCondition,options:transients.resourceConditionConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></td>
                    <td><select data-bind='value:practiceChangeAction,options:transients.practiceChangeActionConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:changePracticeTreatedArea' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:entitiesAdoptingChange' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><i data-bind='click:$root.removepracticeChangeRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr>
                    <td colspan='2'><span ></span></td>
                    <td><span >Total area of adopted changed practices (Ha)</span></td>
                    <td><span  class="value" data-bind='text:data.totalChangePracticeTreatedArea'></span></td>
                    <td><span >Total No. of farming entities</span></td>
                    <td><span  class="value" data-bind='text:data.totalEntitiesAdoptingChange'></span></td>
                    <td></td>
                </tr>
                <tr><td colspan="7" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addpracticeChangeRow">
                        <i class="icon-plus"></i> Add a row</button>
                        <button type="button" class="btn btn-small" data-bind="click:showpracticeChangeTableDataUpload"><i class="icon-upload"></i> Upload data for this table</button>


                    </td></tr>
<tr data-bind="visible:practiceChangeTableDataUploadVisible"><td colspan="7">
                <div class="text-error text-left">
                    Note: Only valid exact scientific names will be matched and populated from the database (indicated by a green tick). Unmatched species will load, but will be indicated by a green <b>?</b>. Please check your uploaded data and correct as required.
                </div>
                <div class="text-left" style="margin:5px">
                    <a href="/fieldcapture/proxy/excelOutputTemplate?type=Management Practice Change Details&listName=practiceChange" target="practiceChangeTemplateDownload" class="btn">Step 1 - Download template (.xlsx)</a>
                </div>
                <div class="text-left" style="margin:5px;">
                    <input type="checkbox" data-bind="checked:appendTableRows" style="margin-right:5px">Append uploaded data to table (unticking this checkbox will result in all table rows being replaced)
                </div>

                <div class="btn fileinput-button" style="margin-left:5px">
                        <input id="practiceChangeTableDataUpload" type="file" name="data" data-bind="fileUploadNoImage:practiceChangeTableDataUploadOptions">
                        Step 2 - Upload populated template
                </div>

                    </td></tr> <script id="practiceChangetemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="practiceChangetemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>
<div class="row-fluid space-after output-section" >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Area of land directly benefiting from the practice change:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Area of land in hectares over which environmental benefits are attained from the changed management practices'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.benefitAreaHa' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Length of fence installed for managing stock access to water:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Length of fence in kilometres erected to control stock access to watering points'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.lengthOfFenceStockWatering' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div></div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 checkbox-list-label  preLabel"><label>Expected outcomes from changed practices:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Targeted outcomes to be attained from the changed management practices'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span>
            <ul class="checkbox-list" data-bind="foreach: transients.targetOutcomesConstraints">
                <li>
                    <input type="checkbox" name="data.targetOutcomes" data-bind="value:$data,checked:$root.data.targetOutcomes" /><span data-bind="text:$data"></span>
                </li>
            </ul>
        </span></div></div></div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>Comments / Notes</label></span><textarea  class="span12" data-bind='value:data.notes'></textarea></span></div>

        
    </div>

    
    
    <style type="text/css">
        table.conservationWorks td:nth-child(1) {width:80%;}
        table.conservationWorks td:nth-child(1) select {width:100%;}
        table.conservationWorks td:nth-child(2) {width:18%;text-align:center;}
        table.conservationWorks td:nth-child(2) select {width:100%;}
        table.conservationWorks td:last-child {width:4%;text-align:center;}
        table.conservationWorks textarea {width:98%;}
    </style><style type="text/css">
        table.protectionMechanisms td:nth-child(1) {width:65%;}
        table.protectionMechanisms td:nth-child(1) select {width:100%;}
        table.protectionMechanisms td:nth-child(2) {width:18%;text-align:center;}
        table.protectionMechanisms td:nth-child(2) select {width:100%;}
        table.protectionMechanisms td:nth-child(3) {width:18%;text-align:center;}
        table.protectionMechanisms td:nth-child(3) select {width:100%;}
        table.protectionMechanisms td:last-child {width:4%;text-align:center;}
        table.protectionMechanisms textarea {width:98%;}
    </style>
    <div class="output-block" id="koConservation_Works_Details">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Conservation Works Details<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after output-section" >
<span class="span4">    <span  class="preLabel required"><label>Species: *<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Species targeted for these conservation works / measures (start typing a  scientific or common name for a species)'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span>
<span class="input-prepend input-append" data-bind="with:data.targetSpecies">
    <span class="add-on" data-bind="visible:!transients.editing(), css:{'btn-success':name()}"><i class="icon-white" data-bind="css:{'icon-ok':listId()!='unmatched' && name(), 'icon-question-sign':listId()=='unmatched'}"></i></span><span class="add-on" data-bind="visible:transients.editing()"><img src="/fieldcapture/static/Xo2jbaJ5EFqa59u9g4c4ybpCpw3wFWKhQdzZwNmmktO.gif" alt="saving icon" /></span><input type="text" data-bind="value:transients.textFieldValue,event:{focusout:focusLost},autocomplete:{url:'/fieldcapture/search/species', render: renderItem, listId: list, result:speciesSelected, valueChangeCallback:textFieldChanged}"  data-validation-engine='validate[required]'/>
    <span class="add-on" data-bind="visible: !transients.editing() && name()">
        <a href="#" data-bind="popover: {title: name, content: transients.speciesInformation}"><i class="icon-info-sign"></i></a>
    </span>
</span>
</span><span class="span4">    <span  class="preLabel"><label>No. of animals in captive breeding programs:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of individual animals in a captive breeding program'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.animalBreedingNos' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span><span class="span4">    <span  class="preLabel"><label>No. of animals released back into the wild:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of individual animals released back into the wild'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.animalReleaseNumber' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div>
<div class="row-fluid output-section">
            <table class="table table-bordered conservationWorks " >
                <thead><tr><th>Conservation Action:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The type of conservation works implemented'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Area impacted by works (Ha):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Area in hectares impacted by the conservation works'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'conservationWorksviewTmpl', foreach: data.conservationWorks}"></tbody>
                <script id="conservationWorksviewTmpl" type="text/html"><tr>
                    <td><select data-bind='value:conservationActionType,options:transients.conservationActionTypeConstraints,optionsCaption:"Please select"'></select></td>
                    <td><input class="input-small" style="text-align:center" data-bind='value:areaImpactedByWorks' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></td>
                    <td><i data-bind='click:$root.removeconservationWorksRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr><td colspan="0" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addconservationWorksRow">
                        <i class="icon-plus"></i> Add a row</button>
                        <button type="button" class="btn btn-small" data-bind="click:showconservationWorksTableDataUpload"><i class="icon-upload"></i> Upload data for this table</button>


                    </td></tr>
<tr data-bind="visible:conservationWorksTableDataUploadVisible"><td colspan="0">
                <div class="text-error text-left">
                    Note: Only valid exact scientific names will be matched and populated from the database (indicated by a green tick). Unmatched species will load, but will be indicated by a green <b>?</b>. Please check your uploaded data and correct as required.
                </div>
                <div class="text-left" style="margin:5px">
                    <a href="/fieldcapture/proxy/excelOutputTemplate?type=Conservation Works Details&listName=conservationWorks" target="conservationWorksTemplateDownload" class="btn">Step 1 - Download template (.xlsx)</a>
                </div>
                <div class="text-left" style="margin:5px;">
                    <input type="checkbox" data-bind="checked:appendTableRows" style="margin-right:5px">Append uploaded data to table (unticking this checkbox will result in all table rows being replaced)
                </div>

                <div class="btn fileinput-button" style="margin-left:5px">
                        <input id="conservationWorksTableDataUpload" type="file" name="data" data-bind="fileUploadNoImage:conservationWorksTableDataUploadOptions">
                        Step 2 - Upload populated template
                </div>

                    </td></tr> <script id="conservationWorkstemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="conservationWorkstemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>
<div class="row-fluid output-section">
            <table class="table table-bordered protectionMechanisms " >
                <thead><tr><th class="required">Type of Agreement mechanism:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The type of agreement mechanism implemented to protect threatened species'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th class="required">No. of Agreement mechanisms:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of agreement mechanisms implemented as a result of the project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th class="required">Area under Agreement (Ha):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Area covered by conservation agreement (Ha): *'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'protectionMechanismsviewTmpl', foreach: data.protectionMechanisms}"></tbody>
                <script id="protectionMechanismsviewTmpl" type="text/html"><tr>
                    <td><select data-bind='value:protectionMechanism,options:transients.protectionMechanismConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></td>
                    <td><input class="input-small" style="text-align:center" data-bind='value:numberOfProtectionMechanisms' data-validation-engine='validate[required,min[0],custom[number]]' type='number' class='input-mini'/></td>
                    <td><input class="input-small" style="text-align:center" data-bind='value:areaUnderAgreement' data-validation-engine='validate[required,min[0],custom[number]]' type='number' class='input-mini'/></td>
                    <td><i data-bind='click:$root.removeprotectionMechanismsRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr><td colspan="0" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addprotectionMechanismsRow">
                        <i class="icon-plus"></i> Add a row</button>
                        <button type="button" class="btn btn-small" data-bind="click:showprotectionMechanismsTableDataUpload"><i class="icon-upload"></i> Upload data for this table</button>


                    </td></tr>
<tr data-bind="visible:protectionMechanismsTableDataUploadVisible"><td colspan="0">
                <div class="text-error text-left">
                    Note: Only valid exact scientific names will be matched and populated from the database (indicated by a green tick). Unmatched species will load, but will be indicated by a green <b>?</b>. Please check your uploaded data and correct as required.
                </div>
                <div class="text-left" style="margin:5px">
                    <a href="/fieldcapture/proxy/excelOutputTemplate?type=Conservation Works Details&listName=protectionMechanisms" target="protectionMechanismsTemplateDownload" class="btn">Step 1 - Download template (.xlsx)</a>
                </div>
                <div class="text-left" style="margin:5px;">
                    <input type="checkbox" data-bind="checked:appendTableRows" style="margin-right:5px">Append uploaded data to table (unticking this checkbox will result in all table rows being replaced)
                </div>

                <div class="btn fileinput-button" style="margin-left:5px">
                        <input id="protectionMechanismsTableDataUpload" type="file" name="data" data-bind="fileUploadNoImage:protectionMechanismsTableDataUploadOptions">
                        Step 2 - Upload populated template
                </div>

                    </td></tr> <script id="protectionMechanismstemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="protectionMechanismstemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>Comments / Notes:</label></span><textarea  class="span12" data-bind='value:data.notes'></textarea></span></div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="span12"><h4>Please attach applicable Plan documents via Admin tab</h4></span></span></div>

        
    </div>

    
    
    <style type="text/css">
        table.sustainableInitiatives td:nth-child(1) {width:25%;}
        table.sustainableInitiatives td:nth-child(1) select {width:100%;}
        table.sustainableInitiatives td:nth-child(3) {width:10%;text-align:center;}
        table.sustainableInitiatives td:nth-child(3) select {width:100%;}
        table.sustainableInitiatives td:last-child {width:4%;text-align:center;}
        table.sustainableInitiatives textarea {width:98%;}
    </style>
    <div class="output-block" id="koSustainable_Practice_Initiatives">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Sustainable Practice Initiatives<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after " >
<span class="span12">    <span  class="span12">Please list the different types of sustainable practice initiatives implemented and the numbers of people influenced by each type. (Note that individuals should be counted only once across all initiative types).</span></span></div>
<div class="row-fluid output-section">
            <table class="table table-bordered sustainableInitiatives " >
                <thead><tr><th>Type of initiative:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The type of sustainable practice initiative implemented.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Description of sustainable practice initiative:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Brief description of the initiative used to promote sustainable practices.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>No. of individuals influenced:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of unique individuals influenced by implementation of a particular sustainable practice initiative. (Note that individuals should be counted only once across all listed initiatives)'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'sustainableInitiativesviewTmpl', foreach: data.sustainableInitiatives}"></tbody>
                <script id="sustainableInitiativesviewTmpl" type="text/html"><tr>
                    <td><input  class="input-medium" data-bind='value:initiativeType'  type='text' class='input-small'/></td>
                    <td><textarea  data-bind='value:initiativeDescription'></textarea></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:noInfluenced' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><i data-bind='click:$root.removesustainableInitiativesRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr>
                    <td><span ></span></td>
                    <td><span >Total No. of individuals influenced:</span></td>
                    <td><span  class="value" data-bind='text:data.noInfluencedTotal'></span></td>
                    <td></td>
                </tr>
                <tr><td colspan="4" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addsustainableInitiativesRow">
                        <i class="icon-plus"></i> Add a row</button>
                        <button type="button" class="btn btn-small" data-bind="click:showsustainableInitiativesTableDataUpload"><i class="icon-upload"></i> Upload data for this table</button>


                    </td></tr>
<tr data-bind="visible:sustainableInitiativesTableDataUploadVisible"><td colspan="4">
                <div class="text-error text-left">
                    Note: Only valid exact scientific names will be matched and populated from the database (indicated by a green tick). Unmatched species will load, but will be indicated by a green <b>?</b>. Please check your uploaded data and correct as required.
                </div>
                <div class="text-left" style="margin:5px">
                    <a href="/fieldcapture/proxy/excelOutputTemplate?type=Sustainable Practice Initiatives&listName=sustainableInitiatives" target="sustainableInitiativesTemplateDownload" class="btn">Step 1 - Download template (.xlsx)</a>
                </div>
                <div class="text-left" style="margin:5px;">
                    <input type="checkbox" data-bind="checked:appendTableRows" style="margin-right:5px">Append uploaded data to table (unticking this checkbox will result in all table rows being replaced)
                </div>

                <div class="btn fileinput-button" style="margin-left:5px">
                        <input id="sustainableInitiativesTableDataUpload" type="file" name="data" data-bind="fileUploadNoImage:sustainableInitiativesTableDataUploadOptions">
                        Step 2 - Upload populated template
                </div>

                    </td></tr> <script id="sustainableInitiativestemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="sustainableInitiativestemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>

        
    </div>

    
    
    <style type="text/css">
        table.plantPropagation td:nth-child(1) {width:25%;}
        table.plantPropagation td:nth-child(1) select {width:100%;}
        table.plantPropagation td:nth-child(2) {width:10%;text-align:center;}
        table.plantPropagation td:nth-child(2) select {width:100%;}
        table.plantPropagation td:nth-child(3) {width:25%;}
        table.plantPropagation td:nth-child(3) select {width:100%;}
        table.plantPropagation td:nth-child(4) {width:15%;}
        table.plantPropagation td:nth-child(4) select {width:100%;}
        table.plantPropagation td:nth-child(5) {width:10%;text-align:center;}
        table.plantPropagation td:nth-child(5) select {width:100%;}
        table.plantPropagation td:nth-child(6) {width:15%;}
        table.plantPropagation td:nth-child(6) select {width:100%;}
        table.plantPropagation td:last-child {width:4%;text-align:center;}
        table.plantPropagation textarea {width:98%;}
    </style>
    <div class="output-block" id="koPlant_Propagation_Details">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Plant Propagation Details<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after " >
<span class="span12">    <span  class="span12">Please enter details of plants propagated for this activity.</span></span></div>
<div class="row-fluid output-section">
            <table class="table table-bordered plantPropagation " >
                <thead><tr><th class="required">Species:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Species propagated'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th class="required">Amount of seed (gms):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Weight in grams of seed propagated'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Germination method:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The main method used to germinate seed for each listed species'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th class="required">Finished type of plant stock:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The type of plant stock being supplied to the market for planting out'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th class="required">No. of plants:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of finished plant stock grown for shipment and planting out'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Date ready for planting out:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The approximate date that finished plant stock will be ready for planting out'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'plantPropagationviewTmpl', foreach: data.plantPropagation}"></tbody>
                <script id="plantPropagationviewTmpl" type="text/html"><tr>
                    <td>
<span class="input-prepend input-append" data-bind="with:species">
    <span class="add-on" data-bind="visible:!transients.editing(), css:{'btn-success':name()}"><i class="icon-white" data-bind="css:{'icon-ok':listId()!='unmatched' && name(), 'icon-question-sign':listId()=='unmatched'}"></i></span><span class="add-on" data-bind="visible:transients.editing()"><img src="/fieldcapture/static/Xo2jbaJ5EFqa59u9g4c4ybpCpw3wFWKhQdzZwNmmktO.gif" alt="saving icon" /></span><input type="text" data-bind="value:transients.textFieldValue,event:{focusout:focusLost},autocomplete:{url:'/fieldcapture/search/species', render: renderItem, listId: list, result:speciesSelected, valueChangeCallback:textFieldChanged}"  data-validation-engine='validate[required]'/>
    <span class="add-on" data-bind="visible: !transients.editing() && name()">
        <a href="#" data-bind="popover: {title: name, content: transients.speciesInformation}"><i class="icon-info-sign"></i></a>
    </span>
</span>
</td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:seedWeight' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><select data-bind='value:germinationMethod,options:transients.germinationMethodConstraints,optionsCaption:"Please select"'></select></td>
                    <td><select data-bind='value:finishedStockType,options:transients.finishedStockTypeConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:numberGrown' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><div class="input-append"><input data-bind="datepicker:propagationFinishDate.date" type="text" size="12"/><span class="add-on open-datepicker"><i class="icon-th"></i></span></div></td>
                    <td><i data-bind='click:$root.removeplantPropagationRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr>
                    <td><span >Total weight of seed (gms) used for propagation:</span></td>
                    <td><span  class="value" data-bind='text:data.totalSeedWeight'></span></td>
                    <td colspan='1'><span ></span></td>
                    <td><span >Total No. of plants grown:</span></td>
                    <td><span  class="value" data-bind='text:data.totalNumberGrown'></span></td>
                    <td colspan='1'><span ></span></td>
                    <td></td>
                </tr>
                <tr><td colspan="7" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addplantPropagationRow">
                        <i class="icon-plus"></i> Add a row</button>
                        <button type="button" class="btn btn-small" data-bind="click:showplantPropagationTableDataUpload"><i class="icon-upload"></i> Upload data for this table</button>


                    </td></tr>
<tr data-bind="visible:plantPropagationTableDataUploadVisible"><td colspan="7">
                <div class="text-error text-left">
                    Note: Only valid exact scientific names will be matched and populated from the database (indicated by a green tick). Unmatched species will load, but will be indicated by a green <b>?</b>. Please check your uploaded data and correct as required.
                </div>
                <div class="text-left" style="margin:5px">
                    <a href="/fieldcapture/proxy/excelOutputTemplate?type=Plant Propagation Details&listName=plantPropagation" target="plantPropagationTemplateDownload" class="btn">Step 1 - Download template (.xlsx)</a>
                </div>
                <div class="text-left" style="margin:5px;">
                    <input type="checkbox" data-bind="checked:appendTableRows" style="margin-right:5px">Append uploaded data to table (unticking this checkbox will result in all table rows being replaced)
                </div>

                <div class="btn fileinput-button" style="margin-left:5px">
                        <input id="plantPropagationTableDataUpload" type="file" name="data" data-bind="fileUploadNoImage:plantPropagationTableDataUploadOptions">
                        Step 2 - Upload populated template
                </div>

                    </td></tr> <script id="plantPropagationtemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="plantPropagationtemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>Comments / Notes:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='General notes about this activity'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span12" data-bind='value:data.notes'></textarea></span></div>

        
    </div>

    
    
    <style type="text/css">
        table.photoPoints td:nth-child(1) {width:25%;}
        table.photoPoints td:nth-child(1) select {width:100%;}
        table.photoPoints td:nth-child(2) {width:40%;}
        table.photoPoints td:nth-child(2) select {width:100%;}
        table.photoPoints td:nth-child(3) {width:20%;}
        table.photoPoints td:nth-child(3) select {width:100%;}
        table.photoPoints td:last-child {width:5%;min-width:70px;text-align:center;}
        table.photoPoints textarea {width:98%;}
    </style>
    <div class="output-block" id="koPhoto_Points">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Photo Points<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after " >
<span class="span12">    <span  class="span12"><strong>Note:</strong> Photo points are created and managed as a part of the site definition.  In order to record a photo point you first need to add a 'point of interest' to the site with a type of 'photo point'. When the site is selected for this activity, a row for each defined photo point will then appear in the table below, allowing you to upload your image taken at the time of the survey.</span></span></div>
<div class="row-fluid space-after " data-bind="visible:transients.site.siteId && !data.photoPoints().length">
<span class="span12">    <span  class="span12"><span><h4>Note: There are no photo points defined for this site.</h4></span></span></span></div>
<div class="row-fluid space-after " data-bind="visible:!transients.site.siteId">
<span class="span12">    <span  class="span12"><span><h4>Note: A site has not yet been selected for this activity. In order to upload a photo point image you must select the site at which this activity is being undertaken, and the site must have the photo point location recorded as a 'point of interest'.</h4></span></span></span></div>
<div class="row-fluid ">
            <table class="table table-bordered photoPoints " data-bind="independentlyValidated:data.photoPoints">
                <thead><tr><th>Photo point</th><th>Photo</th><th>Comment</th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:photoPointstemplateToUse, foreach: data.photoPoints}"></tbody>
                <script id="photoPointsviewTmpl" type="text/html"><tr>
                    <td>
        <div><b><span data-bind="text:name"/></b></div>
        <div>Lat:<span data-bind="text:lat"/></div>
        <div>Lon:<span data-bind="text:lon"/></div>
        <div>Bearing:<span data-bind="text:bearing"/></div>
        </td>
                    <td><ul class="imageList" data-bind="foreach: photo"><li><img data-bind="attr:{src: thumbnail_url}"></img></li></ul></td>
                    <td><span  data-bind='text:comment'></span></td>
                    <td>
                        <button class='btn btn-mini' data-bind='click:$root.editphotoPointsRow, enable:!$root.photoPointsEditing()' title='edit'><i class='icon-edit'></i> Edit</button>
                        <button class='btn btn-mini' data-bind='click:$root.removephotoPointsRow, enable:!$root.photoPointsEditing()' title='remove'><i class='icon-trash'></i> Remove</button>
                    </td>
                </tr></script>
                <script id="photoPointseditTmpl" type="text/html"><tr>
                    <td>
        <div><b><span data-bind="text:name"/></b></div>
        <div>Lat:<span data-bind="text:lat"/></div>
        <div>Lon:<span data-bind="text:lon"/></div>
        <div>Bearing:<span data-bind="text:bearing"/></div>
        </td>
                    <td><div id="fileupload" data-url="/fieldcapture/image/upload" data-bind="fileUpload:photo"
     class="fileupload-buttonbar">

    <table><tbody class="files"></tbody></table>
    <!-- The fileinput-button span is used to style the file input field as button -->
    <span class="btn fileinput-button">
        <i class="icon-plus"></i>
        <input type="file" name="files" multiple/>
        <span data-bind="visible:photo().length">Add more images</span>
        <span data-bind="visible:!photo().length">Add images</span>
    </span>

</div></td>
                    <td><input  class="input-small" data-bind='value:comment'  type='text' class='input-small'/></td>
                    <td>
                        <a class='btn btn-success btn-mini' data-bind='click:$root.acceptphotoPoints' href='#' title='save'>Update</a>
                        <a class='btn btn-mini' data-bind='click:$root.cancelphotoPoints' href='#' title='cancel'>Cancel</a>
                    </td>
                </tr></script>
                <tfoot>
                </tfoot>
            </table>
        </div>
<!-- The template to display files available for upload -->
<script id="template-upload" type="text/x-tmpl">
    {% for (var i=0, file; file=o.files[i]; i++) { %}
    <tr class="template-upload fade">
        <td class="preview"><span class="fade"></span></td>
        <td class="name"><span>{%=file.name%}</span></td>
        <td class="size"><span>{%=o.formatFileSize(file.size)%}</span></td>
        {% if (file.error) { %}
        <td class="error" colspan="2"><span class="label label-important">{%=locale.fileupload.error%}</span> {%=locale.fileupload.errors[file.error] || file.error%}</td>
        {% } else if (o.files.valid && !i) { %}
        <td>
            <div class="progress progress-success progress-striped active"><div class="bar" style="width:0%;"></div></div>
        </td>
        <td class="start">{% if (!o.options.autoUpload) { %}
            <button class="btn btn-primary">
                <i class="icon-upload icon-white"></i>
                <span>{%=locale.fileupload.start%}</span>
            </button>
            {% } %}</td>
        {% } else { %}
        <td colspan="2"></td>
        {% } %}
        <td class="cancel">{% if (!i) { %}
            <button class="btn btn-warning">
                <i class="icon-ban-circle icon-white"></i>
                <span>{%=locale.fileupload.cancel%}</span>
            </button>
            {% } %}</td>
    </tr>
    {% } %}
</script>
<!-- The template to display files available for download -->
<script id="template-download" type="text/x-tmpl">
    {% for (var i=0, file; file=o.files[i]; i++) { %}
    <tr class="template-download fade">
        {% if (file.error) { %}
        <td></td>
        <td><div class="name">{%=file.name%}</div><div class="size">{%=o.formatFileSize(file.size)%}</div></td>
        <td class="error" colspan="2"><span class="label label-important">{%=locale.fileupload.error%}</span> {%=locale.fileupload.errors[file.error] || file.error%}</td>
        {% } else { %}
        <td class="preview">{% if (file.thumbnail_url) { %}
            <a href="{%=file.url%}" title="{%=file.name%}" rel="gallery" download="{%=file.name%}"><img src="{%=file.thumbnail_url%}"></a>
            {% } %}</td>
        <td class="name" colspan="2">
            <a href="{%=file.url%}" title="{%=file.name%}" rel="{%=file.thumbnail_url&&'gallery'%}" download="{%=file.name%}">{%=file.name%}</a>
            <div class="size">{%=o.formatFileSize(file.size)%}</div>
        </td>

        {% } %}
        <td>
            <button class="delete-image delete btn btn-mini" data-type="DELETE" data-url="http://devt.ala.org.au:8087/fieldcapture/image/" data-filename="{%=file.name%}">
                <i class="icon-trash"></i>
                <span>{%=locale.fileupload.destroy%}</span>
            </button>
        </td>
    </tr>
    {% } %}
</script>
        
    </div>

<!-- /ko -->

</div>




</div>

<script src="fieldcapture/static/DzazZ2ePykd4QRUJlInoAO1LMvzeVxjM2JRcis2usBm.js" type="text/javascript" ></script>



<script src="fieldcapture/static/gfz9yoFSoT3bDIgFJCbjPP9WLeFgekRHSp7KxcpYrwj.js" type="text/javascript" ></script>
<script src="fieldcapture/static/HpQC03jqzgdovdmQNni1bswagCkkBPaWGDIzgICGcvq.js" type="text/javascript" ></script>









<!--[if gte IE 8]><script src="fieldcapture/static/knxjs4G9Cquc79O3iYW107XikPB1Z1ii8QWrtBpzlSP.js" type="text/javascript" ></script><![endif]-->
<script src="fieldcapture/static/kSJb30BxnBzyoP0WndxrtZbaNWzT8x6LP2Cp7xI9PH4.js" type="text/javascript" ></script>
<script src="fieldcapture/static/N1Pu1Yy1dAP26vjRfEw0sZtbZhL03ir303dL4C7EaVF.js" type="text/javascript" ></script>

<script src="fieldcapture/static/NbeGWZssK95I6Y1Oz4lzxzRtDzf9dyFLZiTstPEonQa.js" type="text/javascript" ></script>
<script src="fieldcapture/static/L85LaBY6yhQwMk24PuXWgqwvtkfvbmMZ3ExPR9xK96.js" type="text/javascript" ></script>
<script src="fieldcapture/static/MZjUSqmNLHqbPwhDcAMpejU18pr9ndMRCGKpPBHdSDL.js" type="text/javascript" ></script>
<script src="fieldcapture/static/1nCsTsYbdgqupwL47F4n7c98ss299Uck5fAVxaO9UuE.js" type="text/javascript" ></script>





<script src="fieldcapture/static/7l2mDQFFpMnG14cXQPTKd94AN71T8yUF6dHUA2LCJIo.js" type="text/javascript" ></script>
<script src="fieldcapture/static/ZbrF5cz3bJrkAqBXLrAlOmoaIYntVDIKpviQs5E8Rhy.js" type="text/javascript" ></script>
<script src="fieldcapture/static/yzVPTi9KJTOMgo1ytEFVw7JiBXXkkbj5dU3cYZoIuS.js" type="text/javascript" ></script>

<script src="fieldcapture/static/IZCc6ZgD3MepYbz4UqlDLzMDNNghSCivcfGebmF9V2d.js" type="text/javascript" ></script>
<script type="text/javascript">
        $(function(){

            var viewModelName = "Revegetation_DetailsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var PlantingRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.species =  new SpeciesViewModel(data['species'], speciesLists);
            this.numberPlanted = ko.observable(orZero(data['numberPlanted']));
            this.seedSownKg = ko.observable(orZero(data['seedSownKg']));
            this.stockType = ko.observable(orBlank(data['stockType']));
            self.transients.stockTypeConstraints = ["Seed","Tube","Advanced","Cutting","Other"];
            this.structuralLayer = ko.observable(orBlank(data['structuralLayer']));
            self.transients.structuralLayerConstraints = ["Overstory","Midstory","Understory","Ground stratum"];
            this.stockProvenance = ko.observable(orBlank(data['stockProvenance']));
            this.guardType = ko.observable(orBlank(data['guardType']));
            self.transients.guardTypeConstraints = ["None","Gro-guard","Carton","Other"];
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Revegetation Details";
                self.outputId = "";
                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
            
            self.data.revegetationMethod = ko.observable();
            self.transients.revegetationMethodConstraints = ["Direct drill seeding","Hand broardcast seeding","Hand planting","Machine planting"];

            self.data.vegDescriptionAtPlanting = ko.observable();
            self.transients.vegDescriptionAtPlantingConstraints = ["Bare substrate","Exotic grassland/pasture","Native grassland/pasture","Sparse/scattered shrubland","Open grassy woodland","Other (specify in notes)"];

            self.data.equipmentUsed = ko.observable();

            self.data.adjacentLanduse = ko.observable();
            self.transients.adjacentLanduseConstraints = ["Conservation","Livestock","Cropping","Recreational","Rural","Residential","Industrial","Commercial or Business"];

            self.data.connectivityIndex = ko.observable();
            self.transients.connectivityIndexConstraints = ["Connected to patch of more than 1000 ha","Connected to patch of 100 to 1000 ha","Connected to patch of 25 to 100 ha","Connected to patch of less than 25 ha","Patch linked to other vegetation via riparian link","Isolated forest or woodland remnant","Patch surrounded by native grasses","Isolated grassland","No vegetation within 1km","Only isolated Paddock trees within 1 km","Patch surrounded by grazing","Patch surrounded by cropping"];
                self.data.environmentalBenefits=ko.observableArray([]);
            self.transients.environmentalBenefitsConstraints = ["Groundwater recharge management","Groundwater discharge or salinity management","Habitat restoration - home range improvement","Habitat enhancement - improved migration paths","Soil stabilisation","Riparian rehabilitation","Streambank protection","Nutrient cycling"];
                
        self.loadenvironmentalBenefits = function (data) {
            if (data !== undefined) {
                $.each(data, function (i, obj) {
                    self.data.environmentalBenefits.push(obj);
                });
        }};
        
            self.data.areaRevegHa = ko.observable();

            self.data.planting = ko.observableArray([]);
            self.selectedplantingRow = ko.observable();
        

            self.loadplanting = function (data, append) {
                if (!append) {
                    self.data.planting([]);
                }
                if (data === undefined) {
                    self.addplantingRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.planting.push(new PlantingRow(obj));
                    });
                }
            };

            self.addplantingRow = function () {
                var newRow = new PlantingRow();
                self.data.planting.push(newRow);
                
            };
            self.removeplantingRow = function (row) {
                self.data.planting.remove(row);
                
            };
            self.plantingrowCount = function () {
                return self.data.planting().length;
            };

            self.plantingTableDataUploadVisible = ko.observable(false);
            self.showplantingTableDataUpload = function() {
                self.plantingTableDataUploadVisible(!self.plantingTableDataUploadVisible());
            };

            self.plantingTableDataUploadOptions = {
                    url:'/fieldcapture/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadplanting(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "plantingtemplate-upload",
                    downloadTemplateId: "plantingtemplate-download",
                    formData:{type:'Revegetation Details', listName:'planting'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.totalNumberPlanted = ko.computed(function () {
                var total = 0;
                for(var i = 0; i < self.data.planting().length; i++) {
                    var value = self.data.planting()[i].numberPlanted();
                        total = total + Number(value); 
                }
                return total;
            });

            self.data.totalSeedSownKg = ko.computed(function () {
                var total = 0;
                for(var i = 0; i < self.data.planting().length; i++) {
                    var value = self.data.planting()[i].seedSownKg();
                        total = total + Number(value); 
                }
                return total;
            });

            self.data.notes = ko.observable();
            self.transients.site = site;

            // this will be called when generating a savable model to remove transient properties
            self.removeBeforeSave = function (jsData) {
                // add code to remove any transients added by the dynamic tags
                            delete jsData.selectedplantingRow;
                delete jsData.plantingTableDataUploadOptions
                delete jsData.plantingTableDataUploadVisible

            delete jsData.activityType;
            delete jsData.transients;
            return jsData;
        };

        // this returns a JS object ready for saving
        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
            // get rid of any transient observables
            return self.removeBeforeSave(jsData);
        };

        // this is a version of toJSON that just returns the model as it will be saved
        // it is used for detecting when the model is modified (in a way that should invoke a save)
        // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.loadData = function (outputId, data) {
            self.outputId = outputId;
            // load dynamic data
                            self.data['revegetationMethod'](data['revegetationMethod']);
                self.data['vegDescriptionAtPlanting'](data['vegDescriptionAtPlanting']);
                self.data['equipmentUsed'](data['equipmentUsed']);
                self.data['adjacentLanduse'](data['adjacentLanduse']);
                self.data['connectivityIndex'](data['connectivityIndex']);
                self.loadenvironmentalBenefits(data['environmentalBenefits']);
                self.data['areaRevegHa'](orZero(data['areaRevegHa']));
                self.loadplanting(data.planting);
                self.data['notes'](data['notes']);


            // if there is no data in tables then add an empty row for the user to add data
            if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                self.addRow();
            }
            self.transients.dummy.notifySubscribers();
        };
    };

    window[viewModelInstance] = new this[viewModelName]();
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koRevegetation_Details"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
             window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);

            // Check for locally saved data for this output - this will happen in the event of a session timeout
            // for example.
            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            console.log(savedData);
            var savedOutput = null;
            var savedOutputId = null;
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Revegetation Details') {
                        if (tmpOutput.data) {
                            savedOutput = tmpOutput.data;

                        }
                    }
                });
            }
            if (savedOutput) {
                window[viewModelInstance].loadData(savedOutputId, savedOutput);
            }
        });

        
        $(function(){

            var viewModelName = "Seed_Collection_DetailsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var SeedsListRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.seedSourceSpecies =  new SpeciesViewModel(data['seedSourceSpecies'], speciesLists);
            this.seedCollectedKg = ko.observable(orZero(data['seedCollectedKg']));
            this.sourcePlantHealth = ko.observable(orBlank(data['sourcePlantHealth']));
            self.transients.sourcePlantHealthConstraints = ["Healthy young plant","Healthy mature plant","Healthy senescent plant","Environmentally stressed young plant","Environmentally stressed mature plant","Environmentally stressed senescent plant"];
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Seed Collection Details";
                self.outputId = "";
                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
            
            self.data.seedsList = ko.observableArray([]);
            self.selectedseedsListRow = ko.observable();
        

            self.loadseedsList = function (data, append) {
                if (!append) {
                    self.data.seedsList([]);
                }
                if (data === undefined) {
                    self.addseedsListRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.seedsList.push(new SeedsListRow(obj));
                    });
                }
            };

            self.addseedsListRow = function () {
                var newRow = new SeedsListRow();
                self.data.seedsList.push(newRow);
                
            };
            self.removeseedsListRow = function (row) {
                self.data.seedsList.remove(row);
                
            };
            self.seedsListrowCount = function () {
                return self.data.seedsList().length;
            };

            self.seedsListTableDataUploadVisible = ko.observable(false);
            self.showseedsListTableDataUpload = function() {
                self.seedsListTableDataUploadVisible(!self.seedsListTableDataUploadVisible());
            };

            self.seedsListTableDataUploadOptions = {
                    url:'/fieldcapture/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadseedsList(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "seedsListtemplate-upload",
                    downloadTemplateId: "seedsListtemplate-download",
                    formData:{type:'Seed Collection Details', listName:'seedsList'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.seedSourceProvenance = ko.observable();

            self.data.seedBankRepository = ko.observable();

            self.data.notes = ko.observable();

            self.data.totalSeedCollectedKg = ko.computed(function () {
                var total = 0;
                for(var i = 0; i < self.data.seedsList().length; i++) {
                    var value = self.data.seedsList()[i].seedCollectedKg();
                        total = total + Number(value); 
                }
                return total;
            });
            self.transients.site = site;

            // this will be called when generating a savable model to remove transient properties
            self.removeBeforeSave = function (jsData) {
                // add code to remove any transients added by the dynamic tags
                            delete jsData.selectedseedsListRow;
                delete jsData.seedsListTableDataUploadOptions
                delete jsData.seedsListTableDataUploadVisible

            delete jsData.activityType;
            delete jsData.transients;
            return jsData;
        };

        // this returns a JS object ready for saving
        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
            // get rid of any transient observables
            return self.removeBeforeSave(jsData);
        };

        // this is a version of toJSON that just returns the model as it will be saved
        // it is used for detecting when the model is modified (in a way that should invoke a save)
        // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.loadData = function (outputId, data) {
            self.outputId = outputId;
            // load dynamic data
                            self.loadseedsList(data.seedsList);
                self.data['seedSourceProvenance'](data['seedSourceProvenance']);
                self.data['seedBankRepository'](data['seedBankRepository']);
                self.data['notes'](data['notes']);


            // if there is no data in tables then add an empty row for the user to add data
            if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                self.addRow();
            }
            self.transients.dummy.notifySubscribers();
        };
    };

    window[viewModelInstance] = new this[viewModelName]();
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koSeed_Collection_Details"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
             window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);

            // Check for locally saved data for this output - this will happen in the event of a session timeout
            // for example.
            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            console.log(savedData);
            var savedOutput = null;
            var savedOutputId = null;
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Seed Collection Details') {
                        if (tmpOutput.data) {
                            savedOutput = tmpOutput.data;

                        }
                    }
                });
            }
            if (savedOutput) {
                window[viewModelInstance].loadData(savedOutputId, savedOutput);
            }
        });

        
        $(function(){

            var viewModelName = "Site_Preparation_ActionsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var ActionsListRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.groundPreparationWorks = ko.observable(orBlank(data['groundPreparationWorks']));
            self.transients.groundPreparationWorksConstraints = ["Herbicide only","Herbicide and rip","Mound and swale","No preparation","Physical clearing","Ring levy","Rip only","Scalping","Scarifying","Fire - remove overgrowth","Fire - prepare ash bed for regeneration","Other (specify in notes)"];
            this.preparationArea = ko.observable(orZero(data['preparationArea']));
            this.associatedActivity = ko.observable(orBlank(data['associatedActivity']));
            self.transients.associatedActivityConstraints = ["Conservation Grazing Management","Debris Removal","Erosion Management","Fencing","Infrastructure Establishment","Pest Management","Disease Management","Public Access Management","Revegetation"];
            this.notes = ko.observable(orBlank(data['notes']));
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Site Preparation Actions";
                self.outputId = "";
                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
            
            self.data.actionsList = ko.observableArray([]);
            self.selectedactionsListRow = ko.observable();
        

            self.loadactionsList = function (data, append) {
                if (!append) {
                    self.data.actionsList([]);
                }
                if (data === undefined) {
                    self.addactionsListRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.actionsList.push(new ActionsListRow(obj));
                    });
                }
            };

            self.addactionsListRow = function () {
                var newRow = new ActionsListRow();
                self.data.actionsList.push(newRow);
                
            };
            self.removeactionsListRow = function (row) {
                self.data.actionsList.remove(row);
                
            };
            self.actionsListrowCount = function () {
                return self.data.actionsList().length;
            };

            self.actionsListTableDataUploadVisible = ko.observable(false);
            self.showactionsListTableDataUpload = function() {
                self.actionsListTableDataUploadVisible(!self.actionsListTableDataUploadVisible());
            };

            self.actionsListTableDataUploadOptions = {
                    url:'/fieldcapture/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadactionsList(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "actionsListtemplate-upload",
                    downloadTemplateId: "actionsListtemplate-download",
                    formData:{type:'Site Preparation Actions', listName:'actionsList'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.preparationAreaTotal = ko.computed(function () {
                var total = 0;
                for(var i = 0; i < self.data.actionsList().length; i++) {
                    var value = self.data.actionsList()[i].preparationArea();
                        total = total + Number(value); 
                }
                return total;
            });
            self.transients.site = site;

            // this will be called when generating a savable model to remove transient properties
            self.removeBeforeSave = function (jsData) {
                // add code to remove any transients added by the dynamic tags
                            delete jsData.selectedactionsListRow;
                delete jsData.actionsListTableDataUploadOptions
                delete jsData.actionsListTableDataUploadVisible

            delete jsData.activityType;
            delete jsData.transients;
            return jsData;
        };

        // this returns a JS object ready for saving
        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
            // get rid of any transient observables
            return self.removeBeforeSave(jsData);
        };

        // this is a version of toJSON that just returns the model as it will be saved
        // it is used for detecting when the model is modified (in a way that should invoke a save)
        // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.loadData = function (outputId, data) {
            self.outputId = outputId;
            // load dynamic data
                            self.loadactionsList(data.actionsList);


            // if there is no data in tables then add an empty row for the user to add data
            if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                self.addRow();
            }
            self.transients.dummy.notifySubscribers();
        };
    };

    window[viewModelInstance] = new this[viewModelName]();
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koSite_Preparation_Actions"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
             window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);

            // Check for locally saved data for this output - this will happen in the event of a session timeout
            // for example.
            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            console.log(savedData);
            var savedOutput = null;
            var savedOutputId = null;
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Site Preparation Actions') {
                        if (tmpOutput.data) {
                            savedOutput = tmpOutput.data;

                        }
                    }
                });
            }
            if (savedOutput) {
                window[viewModelInstance].loadData(savedOutputId, savedOutput);
            }
        });

        
        $(function(){

            var viewModelName = "Fence_DetailsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Fence Details";
                self.outputId = "";
                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
            
            self.data.fenceType = ko.observable();
            self.transients.fenceTypeConstraints = ["Post & Wire (plain wire, barbed, or plain & barbed) - non-electrified","Post & Wire (plain wire, barbed, or plain & barbed) - electrified","Post & Netting (net or ringlock) - non-electified","Post & Netting (net or ringlock) - electified","Post & Rail","Cyclone","Solid Sheet (pailing, pickets, sheet metal, etc.)","Other (specify in notes)","None"];

            self.data.lengthOfFence = ko.observable();

            self.data.fenceCostPerKm = ko.observable();
                self.data.purposeOfFence=ko.observableArray([]);
            self.transients.purposeOfFenceConstraints = ["Cattle exclusion","Sheep or goat exclusion","Kangaroo and wallaby exclusion","Rabbit and hare exclusion","Wombat exclusion","Wild dog exclusion","Protection of sacred sites","Protection of ecologically sensitive areas","Other (specify in notes)"];
                
        self.loadpurposeOfFence = function (data) {
            if (data !== undefined) {
                $.each(data, function (i, obj) {
                    self.data.purposeOfFence.push(obj);
                });
        }};
        
            self.data.fenceNotes = ko.observable();
            self.transients.site = site;

            // this will be called when generating a savable model to remove transient properties
            self.removeBeforeSave = function (jsData) {
                // add code to remove any transients added by the dynamic tags
            
            delete jsData.activityType;
            delete jsData.transients;
            return jsData;
        };

        // this returns a JS object ready for saving
        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
            // get rid of any transient observables
            return self.removeBeforeSave(jsData);
        };

        // this is a version of toJSON that just returns the model as it will be saved
        // it is used for detecting when the model is modified (in a way that should invoke a save)
        // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.loadData = function (outputId, data) {
            self.outputId = outputId;
            // load dynamic data
                            self.data['fenceType'](data['fenceType']);
                self.data['lengthOfFence'](orZero(data['lengthOfFence']));
                self.data['fenceCostPerKm'](orZero(data['fenceCostPerKm']));
                self.loadpurposeOfFence(data['purposeOfFence']);
                self.data['fenceNotes'](data['fenceNotes']);


            // if there is no data in tables then add an empty row for the user to add data
            if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                self.addRow();
            }
            self.transients.dummy.notifySubscribers();
        };
    };

    window[viewModelInstance] = new this[viewModelName]();
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koFence_Details"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
             window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);

            // Check for locally saved data for this output - this will happen in the event of a session timeout
            // for example.
            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            console.log(savedData);
            var savedOutput = null;
            var savedOutputId = null;
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Fence Details') {
                        if (tmpOutput.data) {
                            savedOutput = tmpOutput.data;

                        }
                    }
                });
            }
            if (savedOutput) {
                window[viewModelInstance].loadData(savedOutputId, savedOutput);
            }
        });

        
        $(function(){

            var viewModelName = "Fire_InformationViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Fire Information";
                self.outputId = "";
                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
            
            self.data.fireIgnitionSource = ko.observable();
            self.transients.fireIgnitionSourceConstraints = ["Lightning","Drip torch","Aerial incendiary","Accidental human","Arson","Other (specify in notes)","Not applicable","Unknown"];

            self.data.fireEventType = ko.observable();
            self.transients.fireEventTypeConstraints = ["Managed controlled burn","Escaped controlled burn","Wildfire","Wildfire prevention works","Other (specify in notes)"];
                self.data.fireReason=ko.observableArray([]);
            self.transients.fireReasonConstraints = ["Fire fuel reduction","Asset protection","Weed management","Pest animal management","Ecology management","Unplanned fire event","Other (specify in notes)"];
                
        self.loadfireReason = function (data) {
            if (data !== undefined) {
                $.each(data, function (i, obj) {
                    self.data.fireReason.push(obj);
                });
        }};
        
            self.data.areaOfFireHa = ko.observable();

            self.data.areaBurntPercent = ko.observable();

            self.data.fireLastBurnDate = ko.observable().extend({simpleDate: false});

            self.data.fireTimeSinceLastBurn = ko.observable();
            self.transients.fireTimeSinceLastBurnConstraints = ["1-3 years","4-6 years","7-10 years","> 10 years"];
                self.data.firePreventionAction=ko.observableArray([]);
            self.transients.firePreventionActionConstraints = ["Fire trail construction","Fire break construction","Woody vegetation removal","Grass slashing","Water point construction","Airstrip / helipad construction","Other (specify in notes)"];
                
        self.loadfirePreventionAction = function (data) {
            if (data !== undefined) {
                $.each(data, function (i, obj) {
                    self.data.firePreventionAction.push(obj);
                });
        }};
        
            self.data.fireBurnTemp = ko.observable();
            self.transients.fireBurnTempConstraints = ["Cool","Moderately hot","Very hot","Extreme"];
                self.data.fireMachineryUsed=ko.observableArray([]);
            self.transients.fireMachineryUsedConstraints = ["Light tanker","Heavy tanker","Bulldozer / tractor / grader","Hand tools","Aircraft - fixed wing","Aircraft - helicopter"];
                
        self.loadfireMachineryUsed = function (data) {
            if (data !== undefined) {
                $.each(data, function (i, obj) {
                    self.data.fireMachineryUsed.push(obj);
                });
        }};
        
            self.data.totalMachineHours = ko.observable();

            self.data.controlLineKmMachine = ko.observable();

            self.data.controlLineKmHand = ko.observable();

            self.data.fireContainment = ko.observable();
            self.transients.fireContainmentConstraints = ["Yes","No","Uncertain"];

            self.data.notes = ko.observable();
            self.transients.site = site;

            // this will be called when generating a savable model to remove transient properties
            self.removeBeforeSave = function (jsData) {
                // add code to remove any transients added by the dynamic tags
            
            delete jsData.activityType;
            delete jsData.transients;
            return jsData;
        };

        // this returns a JS object ready for saving
        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
            // get rid of any transient observables
            return self.removeBeforeSave(jsData);
        };

        // this is a version of toJSON that just returns the model as it will be saved
        // it is used for detecting when the model is modified (in a way that should invoke a save)
        // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.loadData = function (outputId, data) {
            self.outputId = outputId;
            // load dynamic data
                            self.data['fireIgnitionSource'](data['fireIgnitionSource']);
                self.data['fireEventType'](data['fireEventType']);
                self.loadfireReason(data['fireReason']);
                self.data['areaOfFireHa'](orZero(data['areaOfFireHa']));
                self.data['areaBurntPercent'](orZero(data['areaBurntPercent']));
                self.data['fireLastBurnDate'](data['fireLastBurnDate']);
                self.data['fireTimeSinceLastBurn'](data['fireTimeSinceLastBurn']);
                self.loadfirePreventionAction(data['firePreventionAction']);
                self.data['fireBurnTemp'](data['fireBurnTemp']);
                self.loadfireMachineryUsed(data['fireMachineryUsed']);
                self.data['totalMachineHours'](orZero(data['totalMachineHours']));
                self.data['controlLineKmMachine'](orZero(data['controlLineKmMachine']));
                self.data['controlLineKmHand'](orZero(data['controlLineKmHand']));
                self.data['fireContainment'](data['fireContainment']);
                self.data['notes'](data['notes']);


            // if there is no data in tables then add an empty row for the user to add data
            if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                self.addRow();
            }
            self.transients.dummy.notifySubscribers();
        };
    };

    window[viewModelInstance] = new this[viewModelName]();
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koFire_Information"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
             window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);

            // Check for locally saved data for this output - this will happen in the event of a session timeout
            // for example.
            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            console.log(savedData);
            var savedOutput = null;
            var savedOutputId = null;
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Fire Information') {
                        if (tmpOutput.data) {
                            savedOutput = tmpOutput.data;

                        }
                    }
                });
            }
            if (savedOutput) {
                window[viewModelInstance].loadData(savedOutputId, savedOutput);
            }
        });

        
        $(function(){

            var viewModelName = "Weed_Treatment_DetailsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var WeedsTreatedRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.targetSpecies =  new SpeciesViewModel(data['targetSpecies'], speciesLists);
            this.reproductiveStatus = ko.observable(orBlank(data['reproductiveStatus']));
            self.transients.reproductiveStatusConstraints = ["Flowering (FLWG)","Seeding (SEDG)","Vegetative & Mature (VGTV)","Immature (IMTR)","Not recorded (NRRS)"];
            this.plantHealth = ko.observable(orBlank(data['plantHealth']));
            self.transients.plantHealthConstraints = ["Healthy","Stressed","Dead"];
            this.controlStatus = ko.observable(orBlank(data['controlStatus']));
            self.transients.controlStatusConstraints = ["New Infestation","Active Infestation","Under control","Under monitoring","Closed","Unknown"];
            this.treatmentMethod = ko.observable(orBlank(data['treatmentMethod']));
            self.transients.treatmentMethodConstraints = ["Environmental management - Fire","Environmental management - moisture & nutrient control","Environmental management - over-planting","Chemical control - Foliar spraying","Chemical control - Basal bark spraying","Chemical control - Stem injection","Chemical control - Cut stump","Chemical control - Cut and swab","Chemical control - Stem scraper","Chemical control - Wick applicators","Mechanical control - Slashing","Mechanical control - Mowing","Mechanical control - Dozing","Mechanical control - Pushing","Mechanical control - Felling","Manual control - Hand pulling","Manual control - Grubbing/chipping","Biological control - Biological agents (specify in notes)","Other (specify in notes)"];
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Weed Treatment Details";
                self.outputId = "";
                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
            
            self.data.weedsTreated = ko.observableArray([]);
            self.selectedweedsTreatedRow = ko.observable();
        

            self.loadweedsTreated = function (data, append) {
                if (!append) {
                    self.data.weedsTreated([]);
                }
                if (data === undefined) {
                    self.addweedsTreatedRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.weedsTreated.push(new WeedsTreatedRow(obj));
                    });
                }
            };

            self.addweedsTreatedRow = function () {
                var newRow = new WeedsTreatedRow();
                self.data.weedsTreated.push(newRow);
                
            };
            self.removeweedsTreatedRow = function (row) {
                self.data.weedsTreated.remove(row);
                
            };
            self.weedsTreatedrowCount = function () {
                return self.data.weedsTreated().length;
            };

            self.weedsTreatedTableDataUploadVisible = ko.observable(false);
            self.showweedsTreatedTableDataUpload = function() {
                self.weedsTreatedTableDataUploadVisible(!self.weedsTreatedTableDataUploadVisible());
            };

            self.weedsTreatedTableDataUploadOptions = {
                    url:'/fieldcapture/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadweedsTreated(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "weedsTreatedtemplate-upload",
                    downloadTemplateId: "weedsTreatedtemplate-download",
                    formData:{type:'Weed Treatment Details', listName:'weedsTreated'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.treatmentEventType = ko.observable();
            self.transients.treatmentEventTypeConstraints = ["Initial treatment","Follow-up treatment"];

            self.data.locality = ko.observable();

            self.data.areaTreatedHa = ko.observable();

            self.data.linearAreaTreated = ko.observable();

            self.data.chemicalDetails = ko.observable();

            self.data.treatmentCostPerHa = ko.observable();

            self.data.notes = ko.observable();
            self.transients.site = site;

            // this will be called when generating a savable model to remove transient properties
            self.removeBeforeSave = function (jsData) {
                // add code to remove any transients added by the dynamic tags
                            delete jsData.selectedweedsTreatedRow;
                delete jsData.weedsTreatedTableDataUploadOptions
                delete jsData.weedsTreatedTableDataUploadVisible

            delete jsData.activityType;
            delete jsData.transients;
            return jsData;
        };

        // this returns a JS object ready for saving
        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
            // get rid of any transient observables
            return self.removeBeforeSave(jsData);
        };

        // this is a version of toJSON that just returns the model as it will be saved
        // it is used for detecting when the model is modified (in a way that should invoke a save)
        // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.loadData = function (outputId, data) {
            self.outputId = outputId;
            // load dynamic data
                            self.loadweedsTreated(data.weedsTreated);
                self.data['treatmentEventType'](data['treatmentEventType']);
                self.data['locality'](data['locality']);
                self.data['areaTreatedHa'](orZero(data['areaTreatedHa']));
                self.data['linearAreaTreated'](orZero(data['linearAreaTreated']));
                self.data['chemicalDetails'](data['chemicalDetails']);
                self.data['treatmentCostPerHa'](orZero(data['treatmentCostPerHa']));
                self.data['notes'](data['notes']);


            // if there is no data in tables then add an empty row for the user to add data
            if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                self.addRow();
            }
            self.transients.dummy.notifySubscribers();
        };
    };

    window[viewModelInstance] = new this[viewModelName]();
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koWeed_Treatment_Details"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
             window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);

            // Check for locally saved data for this output - this will happen in the event of a session timeout
            // for example.
            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            console.log(savedData);
            var savedOutput = null;
            var savedOutputId = null;
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Weed Treatment Details') {
                        if (tmpOutput.data) {
                            savedOutput = tmpOutput.data;

                        }
                    }
                });
            }
            if (savedOutput) {
                window[viewModelInstance].loadData(savedOutputId, savedOutput);
            }
        });

        
        $(function(){

            var viewModelName = "Stock_Management_DetailsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var StockingDetailsRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.stockingManagementSpecies = ko.observable(orBlank(data['stockingManagementSpecies']));
            self.transients.stockingManagementSpeciesConstraints = ["Cattle","Sheep","Horses","Goats","Llama / Alpaca","Other (specify in notes)"];
            this.stockingDensity = ko.observable(orZero(data['stockingDensity']));
            this.notes = ko.observable(orBlank(data['notes']));
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Stock Management Details";
                self.outputId = "";
                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                            self.data.stockManagementReason=ko.observableArray([]);
            self.transients.stockManagementReasonConstraints = ["Reduce competition & shading for revegetation areas","Promote woody plant growth","Reduce wildfire risk & intensity","Other (describe in notes)"];
                
        self.loadstockManagementReason = function (data) {
            if (data !== undefined) {
                $.each(data, function (i, obj) {
                    self.data.stockManagementReason.push(obj);
                });
        }};
        
            self.data.areaOfStockManagementHa = ko.observable();

            self.data.stockingStrategy = ko.observable();

            self.data.stockingDetails = ko.observableArray([]);
            self.selectedstockingDetailsRow = ko.observable();
        

            self.loadstockingDetails = function (data, append) {
                if (!append) {
                    self.data.stockingDetails([]);
                }
                if (data === undefined) {
                    self.addstockingDetailsRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.stockingDetails.push(new StockingDetailsRow(obj));
                    });
                }
            };

            self.addstockingDetailsRow = function () {
                var newRow = new StockingDetailsRow();
                self.data.stockingDetails.push(newRow);
                
            };
            self.removestockingDetailsRow = function (row) {
                self.data.stockingDetails.remove(row);
                
            };
            self.stockingDetailsrowCount = function () {
                return self.data.stockingDetails().length;
            };

            self.stockingDetailsTableDataUploadVisible = ko.observable(false);
            self.showstockingDetailsTableDataUpload = function() {
                self.stockingDetailsTableDataUploadVisible(!self.stockingDetailsTableDataUploadVisible());
            };

            self.stockingDetailsTableDataUploadOptions = {
                    url:'/fieldcapture/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadstockingDetails(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "stockingDetailstemplate-upload",
                    downloadTemplateId: "stockingDetailstemplate-download",
                    formData:{type:'Stock Management Details', listName:'stockingDetails'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };
            self.transients.site = site;

            // this will be called when generating a savable model to remove transient properties
            self.removeBeforeSave = function (jsData) {
                // add code to remove any transients added by the dynamic tags
                            delete jsData.selectedstockingDetailsRow;
                delete jsData.stockingDetailsTableDataUploadOptions
                delete jsData.stockingDetailsTableDataUploadVisible

            delete jsData.activityType;
            delete jsData.transients;
            return jsData;
        };

        // this returns a JS object ready for saving
        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
            // get rid of any transient observables
            return self.removeBeforeSave(jsData);
        };

        // this is a version of toJSON that just returns the model as it will be saved
        // it is used for detecting when the model is modified (in a way that should invoke a save)
        // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.loadData = function (outputId, data) {
            self.outputId = outputId;
            // load dynamic data
                            self.loadstockManagementReason(data['stockManagementReason']);
                self.data['areaOfStockManagementHa'](orZero(data['areaOfStockManagementHa']));
                self.data['stockingStrategy'](data['stockingStrategy']);
                self.loadstockingDetails(data.stockingDetails);


            // if there is no data in tables then add an empty row for the user to add data
            if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                self.addRow();
            }
            self.transients.dummy.notifySubscribers();
        };
    };

    window[viewModelInstance] = new this[viewModelName]();
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koStock_Management_Details"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
             window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);

            // Check for locally saved data for this output - this will happen in the event of a session timeout
            // for example.
            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            console.log(savedData);
            var savedOutput = null;
            var savedOutputId = null;
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Stock Management Details') {
                        if (tmpOutput.data) {
                            savedOutput = tmpOutput.data;

                        }
                    }
                });
            }
            if (savedOutput) {
                window[viewModelInstance].loadData(savedOutputId, savedOutput);
            }
        });

        
        $(function(){

            var viewModelName = "Infrastructure_DetailsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var InfrastructureInstallationsRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.infrastructureType = ko.observable(orBlank(data['infrastructureType']));
            self.transients.infrastructureTypeConstraints = ["Native plant nursery","Injured fauna hospital","Injured fauna recovery facility","Visitor facilities (eg. toilets, bins, BBQ, tables & benches, etc.)","Other (specify in notes)"];
            this.infrastructureDescription = ko.observable(orBlank(data['infrastructureDescription']));
            this.noInstallations = ko.observable(orZero(data['noInstallations']));
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Infrastructure Details";
                self.outputId = "";
                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
            
            self.data.infrastructureInstallations = ko.observableArray([]);
            self.selectedinfrastructureInstallationsRow = ko.observable();
        

            self.loadinfrastructureInstallations = function (data, append) {
                if (!append) {
                    self.data.infrastructureInstallations([]);
                }
                if (data === undefined) {
                    self.addinfrastructureInstallationsRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.infrastructureInstallations.push(new InfrastructureInstallationsRow(obj));
                    });
                }
            };

            self.addinfrastructureInstallationsRow = function () {
                var newRow = new InfrastructureInstallationsRow();
                self.data.infrastructureInstallations.push(newRow);
                
            };
            self.removeinfrastructureInstallationsRow = function (row) {
                self.data.infrastructureInstallations.remove(row);
                
            };
            self.infrastructureInstallationsrowCount = function () {
                return self.data.infrastructureInstallations().length;
            };

            self.infrastructureInstallationsTableDataUploadVisible = ko.observable(false);
            self.showinfrastructureInstallationsTableDataUpload = function() {
                self.infrastructureInstallationsTableDataUploadVisible(!self.infrastructureInstallationsTableDataUploadVisible());
            };

            self.infrastructureInstallationsTableDataUploadOptions = {
                    url:'/fieldcapture/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadinfrastructureInstallations(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "infrastructureInstallationstemplate-upload",
                    downloadTemplateId: "infrastructureInstallationstemplate-download",
                    formData:{type:'Infrastructure Details', listName:'infrastructureInstallations'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.notes = ko.observable();

            self.data.noInstallationsTotal = ko.computed(function () {
                var total = 0;
                for(var i = 0; i < self.data.infrastructureInstallations().length; i++) {
                    var value = self.data.infrastructureInstallations()[i].noInstallations();
                        total = total + Number(value); 
                }
                return total;
            });
            self.transients.site = site;

            // this will be called when generating a savable model to remove transient properties
            self.removeBeforeSave = function (jsData) {
                // add code to remove any transients added by the dynamic tags
                            delete jsData.selectedinfrastructureInstallationsRow;
                delete jsData.infrastructureInstallationsTableDataUploadOptions
                delete jsData.infrastructureInstallationsTableDataUploadVisible

            delete jsData.activityType;
            delete jsData.transients;
            return jsData;
        };

        // this returns a JS object ready for saving
        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
            // get rid of any transient observables
            return self.removeBeforeSave(jsData);
        };

        // this is a version of toJSON that just returns the model as it will be saved
        // it is used for detecting when the model is modified (in a way that should invoke a save)
        // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.loadData = function (outputId, data) {
            self.outputId = outputId;
            // load dynamic data
                            self.loadinfrastructureInstallations(data.infrastructureInstallations);
                self.data['notes'](data['notes']);


            // if there is no data in tables then add an empty row for the user to add data
            if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                self.addRow();
            }
            self.transients.dummy.notifySubscribers();
        };
    };

    window[viewModelInstance] = new this[viewModelName]();
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koInfrastructure_Details"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
             window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);

            // Check for locally saved data for this output - this will happen in the event of a session timeout
            // for example.
            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            console.log(savedData);
            var savedOutput = null;
            var savedOutputId = null;
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Infrastructure Details') {
                        if (tmpOutput.data) {
                            savedOutput = tmpOutput.data;

                        }
                    }
                });
            }
            if (savedOutput) {
                window[viewModelInstance].loadData(savedOutputId, savedOutput);
            }
        });

        
        $(function(){

            var viewModelName = "Pest_Management_DetailsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Pest Management Details";
                self.outputId = "";
                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                            self.data.pestManagementMethod=ko.observableArray([]);
            self.transients.pestManagementMethodConstraints = ["Trap & remove","Trap & cull","Spotlight cull","Bait & trap","Bait only","Fumigation","Harbour destruction","Positive competition","Biological control agents","Exclusion fencing (please specify fence details)","Animal pest disease management - quarantine","Animal pest disease management - treatment","Plant disease management - quarantine","Plant disease management - treatment","Other (specify in notes)"];
                
        self.loadpestManagementMethod = function (data) {
            if (data !== undefined) {
                $.each(data, function (i, obj) {
                    self.data.pestManagementMethod.push(obj);
                });
        }};
        
            self.data.pestManagementPurpose = ko.observable();
            self.transients.pestManagementPurposeConstraints = ["Experimental","Management","Research","Other (specify in notes)"];

            self.data.treatmentIncentiveMethod = ko.observable();
            self.transients.treatmentIncentiveMethodConstraints = ["Bounty-based cull","Non-bounty-based cull","No incentive program applicable","Other (specify in notes)"];
            self.data.targetSpecies = new SpeciesViewModel({}, speciesLists);

            self.data.pestAnimalsTreatedNo = ko.observable();

            self.data.areaTreatedHa = ko.observable();

            self.data.treatmentCostPerHa = ko.observable();

            self.data.pestDensityPerHa = ko.observable();

            self.data.activityDuration = ko.observable();

            self.data.notes = ko.observable();
            self.transients.site = site;

            // this will be called when generating a savable model to remove transient properties
            self.removeBeforeSave = function (jsData) {
                // add code to remove any transients added by the dynamic tags
            
            delete jsData.activityType;
            delete jsData.transients;
            return jsData;
        };

        // this returns a JS object ready for saving
        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
            // get rid of any transient observables
            return self.removeBeforeSave(jsData);
        };

        // this is a version of toJSON that just returns the model as it will be saved
        // it is used for detecting when the model is modified (in a way that should invoke a save)
        // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.loadData = function (outputId, data) {
            self.outputId = outputId;
            // load dynamic data
                            self.loadpestManagementMethod(data['pestManagementMethod']);
                self.data['pestManagementPurpose'](data['pestManagementPurpose']);
                self.data['treatmentIncentiveMethod'](data['treatmentIncentiveMethod']);
                self.data['targetSpecies'].loadData(data['targetSpecies']);
                self.data['pestAnimalsTreatedNo'](orZero(data['pestAnimalsTreatedNo']));
                self.data['areaTreatedHa'](orZero(data['areaTreatedHa']));
                self.data['treatmentCostPerHa'](orZero(data['treatmentCostPerHa']));
                self.data['pestDensityPerHa'](orZero(data['pestDensityPerHa']));
                self.data['activityDuration'](orZero(data['activityDuration']));
                self.data['notes'](data['notes']);


            // if there is no data in tables then add an empty row for the user to add data
            if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                self.addRow();
            }
            self.transients.dummy.notifySubscribers();
        };
    };

    window[viewModelInstance] = new this[viewModelName]();
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koPest_Management_Details"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
             window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);

            // Check for locally saved data for this output - this will happen in the event of a session timeout
            // for example.
            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            console.log(savedData);
            var savedOutput = null;
            var savedOutputId = null;
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Pest Management Details') {
                        if (tmpOutput.data) {
                            savedOutput = tmpOutput.data;

                        }
                    }
                });
            }
            if (savedOutput) {
                window[viewModelInstance].loadData(savedOutputId, savedOutput);
            }
        });

        
        $(function(){

            var viewModelName = "Research_InformationViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Research Information";
                self.outputId = "";
                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
            
            self.data.typeOfResearch = ko.observable();
            self.transients.typeOfResearchConstraints = ["Environmental resilience","Species and population studies","Eco-economic studies","Socio-environmental studies","Soils studies","Fire management studies","Water management studies","Grazing regime impacts","Cropping regime impacts","Farm productivity","Research associated with project outcomes","Other (specify in notes)"];

            self.data.nameOfResearchProject = ko.observable();

            self.data.researchObjectives = ko.observable();

            self.data.researchCollaborators = ko.observable();

            self.data.notes = ko.observable();
            self.transients.site = site;

            // this will be called when generating a savable model to remove transient properties
            self.removeBeforeSave = function (jsData) {
                // add code to remove any transients added by the dynamic tags
            
            delete jsData.activityType;
            delete jsData.transients;
            return jsData;
        };

        // this returns a JS object ready for saving
        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
            // get rid of any transient observables
            return self.removeBeforeSave(jsData);
        };

        // this is a version of toJSON that just returns the model as it will be saved
        // it is used for detecting when the model is modified (in a way that should invoke a save)
        // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.loadData = function (outputId, data) {
            self.outputId = outputId;
            // load dynamic data
                            self.data['typeOfResearch'](data['typeOfResearch']);
                self.data['nameOfResearchProject'](data['nameOfResearchProject']);
                self.data['researchObjectives'](data['researchObjectives']);
                self.data['researchCollaborators'](data['researchCollaborators']);
                self.data['notes'](data['notes']);


            // if there is no data in tables then add an empty row for the user to add data
            if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                self.addRow();
            }
            self.transients.dummy.notifySubscribers();
        };
    };

    window[viewModelInstance] = new this[viewModelName]();
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koResearch_Information"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
             window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);

            // Check for locally saved data for this output - this will happen in the event of a session timeout
            // for example.
            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            console.log(savedData);
            var savedOutput = null;
            var savedOutputId = null;
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Research Information') {
                        if (tmpOutput.data) {
                            savedOutput = tmpOutput.data;

                        }
                    }
                });
            }
            if (savedOutput) {
                window[viewModelInstance].loadData(savedOutputId, savedOutput);
            }
        });

        
        $(function(){

            var viewModelName = "Water_Management_DetailsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Water Management Details";
                self.outputId = "";
                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
            
            self.data.waterbodyType = ko.observable();
            self.transients.waterbodyTypeConstraints = ["Natural channel / waterway / floodway","Natural riparian waterbody / wetland - connected to channel","Natural riparian waterbody / wetland - disconnected from channel","Natural off-stream waterbody / wetland - connected to channel","Natural off-stream waterbody / wetland - disconnected from channel","Modified natural channel / waterway","Modified natural riparian waterbody / wetland - connected to channel","Modified natural riparian waterbody / wetland - disconnected from channel","Modified natural off-stream waterbody / wetland - connected to channel","Modified natural off-stream waterbody / wetland - disconnected from channel","Constructed channel / waterway","Constructed riparian waterbody / wetland - connected to channel","Constructed riparian waterbody / wetland - disconnected from channel","Constructed off-stream waterbody / wetland - connected to channel","Constructed off-stream waterbody / wetland - disconnected from channel","Groundwater"];

            self.data.hydrologicalRegimeChangeFrom = ko.observable();
            self.transients.hydrologicalRegimeChangeFromConstraints = ["Perennial uniform flow","Perennial mid-late spring peak","Perennial late spring-early summer peak","Perennial extreme early summer peak","Perennial moderate early summer peak","Perennial mid-summer peak","Perennial extreme late summer peak","Perennial moderate late summer peak","Perennial early autumn peak","Perennial mid-autumn peak","Perennial moderate autumn peak","Perennial moderate winter peak","Perennial extreme winter peak","Perennial early spring peak","Perennial moderate spring peak","Ephemeral mid-late spring peak","Ephemeral late spring-early summer peak","Ephemeral extreme early summer peak","Ephemeral moderate early summer peak","Ephemeral mid-summer peak","Ephemeral extreme late summer peak","Ephemeral moderate late summer peak","Ephemeral early autumn peak","Ephemeral mid-autumn peak","Ephemeral moderate autumn peak","Ephemeral moderate winter peak","Ephemeral extreme winter peak","Ephemeral early spring peak","Ephemeral moderate spring peak","Groundwater"];

            self.data.hydrologicalRegimeChangeTo = ko.observable();
            self.transients.hydrologicalRegimeChangeToConstraints = ["Perennial uniform flow","Perennial mid-late spring peak","Perennial late spring-early summer peak","Perennial extreme early summer peak","Perennial moderate early summer peak","Perennial mid-summer peak","Perennial extreme late summer peak","Perennial moderate late summer peak","Perennial early autumn peak","Perennial mid-autumn peak","Perennial moderate autumn peak","Perennial moderate winter peak","Perennial extreme winter peak","Perennial early spring peak","Perennial moderate spring peak","Ephemeral mid-late spring peak","Ephemeral late spring-early summer peak","Ephemeral extreme early summer peak","Ephemeral moderate early summer peak","Ephemeral mid-summer peak","Ephemeral extreme late summer peak","Ephemeral moderate late summer peak","Ephemeral early autumn peak","Ephemeral mid-autumn peak","Ephemeral moderate autumn peak","Ephemeral moderate winter peak","Ephemeral extreme winter peak","Ephemeral early spring peak","Ephemeral moderate spring peak"];
                self.data.hydrologicalStructuresOnsite=ko.observableArray([]);
            self.transients.hydrologicalStructuresOnsiteConstraints = ["Barrage / Weir (with fish ladder)","Barrage / Weir (without fish ladder)","Hinged flap gates","Check valves","Dike / Flood levee","Stilling / Retarding structures","Flow interception structures (eg. contour banks)","Sluice gate","Tidal gate","Constructed channel","Natural channel","Pipes","Pump","Drip irrigation","Flow splitters","Water supply tank","Groundwater pump (wind, solar, other)","Flume","Dam","Retention ponds","Vanes","Head & cross regulators","Pollution trap","Water-sensitive urban design installation","Water treatment facility installation","Water treatment facility upgrade","Water recycling facility installation","Desalination plant installation","Other (specify in notes)"];
                
        self.loadhydrologicalStructuresOnsite = function (data) {
            if (data !== undefined) {
                $.each(data, function (i, obj) {
                    self.data.hydrologicalStructuresOnsite.push(obj);
                });
        }};
        
            self.data.hydrologicalStructuresInstalled = ko.observable();

            self.data.managedArea = ko.observable();

            self.data.isCurrentFlowNatural = ko.observable();
            self.transients.isCurrentFlowNaturalConstraints = ["Natural","Modified","Fully artificial"];

            self.data.isWaterBeingTransported = ko.observable();
            self.transients.isWaterBeingTransportedConstraints = ["Extracted from","Imported to","Passing through (non-resident)","No transport occurring"];
                self.data.waterTransportMethod=ko.observableArray([]);
            self.transients.waterTransportMethodConstraints = ["Open channel - lined","Open channel - unlined","Piped","Mole or similar subterranean drain","Gravity drainage","Pumped","Other (specify in notes)"];
                
        self.loadwaterTransportMethod = function (data) {
            if (data !== undefined) {
                $.each(data, function (i, obj) {
                    self.data.waterTransportMethod.push(obj);
                });
        }};
        
            self.data.waterUsePurpose = ko.observable();
            self.transients.waterUsePurposeConstraints = ["Water storage for later use","Water extraction for current use","Environmental outcomes on the current site"];
                self.data.transportedWaterUse=ko.observableArray([]);
            self.transients.transportedWaterUseConstraints = ["Stock & domestic","Irrigated cropping","Irrigated pasture","Irrigated horticulture","Industrial","Urban potable water","Environmental outcomes","Other (specify in notes)"];
                
        self.loadtransportedWaterUse = function (data) {
            if (data !== undefined) {
                $.each(data, function (i, obj) {
                    self.data.transportedWaterUse.push(obj);
                });
        }};
                        self.data.waterMgtEnvironBenefit=ko.observableArray([]);
            self.transients.waterMgtEnvironBenefitConstraints = ["Salinity management","Waterlogging management","Erosion management","Habitat management for enhancing species resilience & breeding","Flood mitigation - flow retention / buffering","Flood mitigation - enhanced drainage / increased flow rate","Other (specify in notes)"];
                
        self.loadwaterMgtEnvironBenefit = function (data) {
            if (data !== undefined) {
                $.each(data, function (i, obj) {
                    self.data.waterMgtEnvironBenefit.push(obj);
                });
        }};
        
            self.data.notes = ko.observable();
            self.transients.site = site;

            // this will be called when generating a savable model to remove transient properties
            self.removeBeforeSave = function (jsData) {
                // add code to remove any transients added by the dynamic tags
            
            delete jsData.activityType;
            delete jsData.transients;
            return jsData;
        };

        // this returns a JS object ready for saving
        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
            // get rid of any transient observables
            return self.removeBeforeSave(jsData);
        };

        // this is a version of toJSON that just returns the model as it will be saved
        // it is used for detecting when the model is modified (in a way that should invoke a save)
        // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.loadData = function (outputId, data) {
            self.outputId = outputId;
            // load dynamic data
                            self.data['waterbodyType'](data['waterbodyType']);
                self.data['hydrologicalRegimeChangeFrom'](data['hydrologicalRegimeChangeFrom']);
                self.data['hydrologicalRegimeChangeTo'](data['hydrologicalRegimeChangeTo']);
                self.loadhydrologicalStructuresOnsite(data['hydrologicalStructuresOnsite']);
                self.data['hydrologicalStructuresInstalled'](orZero(data['hydrologicalStructuresInstalled']));
                self.data['managedArea'](orZero(data['managedArea']));
                self.data['isCurrentFlowNatural'](data['isCurrentFlowNatural']);
                self.data['isWaterBeingTransported'](data['isWaterBeingTransported']);
                self.loadwaterTransportMethod(data['waterTransportMethod']);
                self.data['waterUsePurpose'](data['waterUsePurpose']);
                self.loadtransportedWaterUse(data['transportedWaterUse']);
                self.loadwaterMgtEnvironBenefit(data['waterMgtEnvironBenefit']);
                self.data['notes'](data['notes']);


            // if there is no data in tables then add an empty row for the user to add data
            if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                self.addRow();
            }
            self.transients.dummy.notifySubscribers();
        };
    };

    window[viewModelInstance] = new this[viewModelName]();
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koWater_Management_Details"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
             window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);

            // Check for locally saved data for this output - this will happen in the event of a session timeout
            // for example.
            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            console.log(savedData);
            var savedOutput = null;
            var savedOutputId = null;
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Water Management Details') {
                        if (tmpOutput.data) {
                            savedOutput = tmpOutput.data;

                        }
                    }
                });
            }
            if (savedOutput) {
                window[viewModelInstance].loadData(savedOutputId, savedOutput);
            }
        });

        
        $(function(){

            var viewModelName = "Debris_Removal_DetailsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Debris Removal Details";
                self.outputId = "";
                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
            
            self.data.debrisType = ko.observable();
            self.transients.debrisTypeConstraints = ["Building & industrial waste - Mixed organic & inorganic","Building & industrial waste - Organic only","Building & industrial waste - Inorganic only","Domestic waste - Mixed organic & inorganic","Domestic waste - Organic only","Domestic waste - Inorganic only","Other green waste (eg. plant & tree prunings)","Other (specify in notes)"];

            self.data.debrisWeightTonnes = ko.observable();

            self.data.debrisVolumeM3 = ko.observable();
                self.data.debrisRemovalMethod=ko.observableArray([]);
            self.transients.debrisRemovalMethodConstraints = ["Trap and screen","Trap and skim","Removal by mobile machinery","Hand removal","Other (specify in notes)"];
                
        self.loaddebrisRemovalMethod = function (data) {
            if (data !== undefined) {
                $.each(data, function (i, obj) {
                    self.data.debrisRemovalMethod.push(obj);
                });
        }};
        
            self.data.debrisNotes = ko.observable();
            self.transients.site = site;

            // this will be called when generating a savable model to remove transient properties
            self.removeBeforeSave = function (jsData) {
                // add code to remove any transients added by the dynamic tags
            
            delete jsData.activityType;
            delete jsData.transients;
            return jsData;
        };

        // this returns a JS object ready for saving
        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
            // get rid of any transient observables
            return self.removeBeforeSave(jsData);
        };

        // this is a version of toJSON that just returns the model as it will be saved
        // it is used for detecting when the model is modified (in a way that should invoke a save)
        // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.loadData = function (outputId, data) {
            self.outputId = outputId;
            // load dynamic data
                            self.data['debrisType'](data['debrisType']);
                self.data['debrisWeightTonnes'](orZero(data['debrisWeightTonnes']));
                self.data['debrisVolumeM3'](orZero(data['debrisVolumeM3']));
                self.loaddebrisRemovalMethod(data['debrisRemovalMethod']);
                self.data['debrisNotes'](data['debrisNotes']);


            // if there is no data in tables then add an empty row for the user to add data
            if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                self.addRow();
            }
            self.transients.dummy.notifySubscribers();
        };
    };

    window[viewModelInstance] = new this[viewModelName]();
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koDebris_Removal_Details"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
             window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);

            // Check for locally saved data for this output - this will happen in the event of a session timeout
            // for example.
            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            console.log(savedData);
            var savedOutput = null;
            var savedOutputId = null;
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Debris Removal Details') {
                        if (tmpOutput.data) {
                            savedOutput = tmpOutput.data;

                        }
                    }
                });
            }
            if (savedOutput) {
                window[viewModelInstance].loadData(savedOutputId, savedOutput);
            }
        });

        
        $(function(){

            var viewModelName = "Access_Control_DetailsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Access Control Details";
                self.outputId = "";
                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                            self.data.accessManagementMethod=ko.observableArray([]);
            self.transients.accessManagementMethodConstraints = ["Traffic exclusion","Traffic confinement / containment","Traffic flow management","Speed management","Other (specify in notes)"];
                
        self.loadaccessManagementMethod = function (data) {
            if (data !== undefined) {
                $.each(data, function (i, obj) {
                    self.data.accessManagementMethod.push(obj);
                });
        }};
                        self.data.structuresInstalled=ko.observableArray([]);
            self.transients.structuresInstalledConstraints = ["Bollards & barriers","Fencing, styles, gates & grids","Boardwalks","Formed trafficways","Constructed parking bays","Signage","Other (specify in notes)"];
                
        self.loadstructuresInstalled = function (data) {
            if (data !== undefined) {
                $.each(data, function (i, obj) {
                    self.data.structuresInstalled.push(obj);
                });
        }};
                        self.data.structuresInstalled=ko.observableArray([]);
            self.transients.structuresInstalledConstraints = ["Bollards & barriers","Fencing, styles, gates & grids","Boardwalks","Formed trafficways","Constructed parking bays","Signage","Other (specify in notes)"];
                
        self.loadstructuresInstalled = function (data) {
            if (data !== undefined) {
                $.each(data, function (i, obj) {
                    self.data.structuresInstalled.push(obj);
                });
        }};
        
            self.data.numberOfInstallations = ko.observable();
                self.data.accessControlPurpose=ko.observableArray([]);
            self.transients.accessControlPurposeConstraints = ["Manage public safety issues","Protect sensitive species / habitats","Contain vehicle traffic","Manage off-road vehicle damage","Manage pedestrian traffic damage","Public education","Other (specify in notes)"];
                
        self.loadaccessControlPurpose = function (data) {
            if (data !== undefined) {
                $.each(data, function (i, obj) {
                    self.data.accessControlPurpose.push(obj);
                });
        }};
        
            self.data.lengthOfLinealStructures = ko.observable();

            self.data.visitationNumber = ko.observable();

            self.data.notes = ko.observable();
            self.transients.site = site;

            // this will be called when generating a savable model to remove transient properties
            self.removeBeforeSave = function (jsData) {
                // add code to remove any transients added by the dynamic tags
            
            delete jsData.activityType;
            delete jsData.transients;
            return jsData;
        };

        // this returns a JS object ready for saving
        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
            // get rid of any transient observables
            return self.removeBeforeSave(jsData);
        };

        // this is a version of toJSON that just returns the model as it will be saved
        // it is used for detecting when the model is modified (in a way that should invoke a save)
        // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.loadData = function (outputId, data) {
            self.outputId = outputId;
            // load dynamic data
                            self.loadaccessManagementMethod(data['accessManagementMethod']);
                self.loadstructuresInstalled(data['structuresInstalled']);
                self.loadstructuresInstalled(data['structuresInstalled']);
                self.data['numberOfInstallations'](orZero(data['numberOfInstallations']));
                self.loadaccessControlPurpose(data['accessControlPurpose']);
                self.data['lengthOfLinealStructures'](orZero(data['lengthOfLinealStructures']));
                self.data['visitationNumber'](orZero(data['visitationNumber']));
                self.data['notes'](data['notes']);


            // if there is no data in tables then add an empty row for the user to add data
            if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                self.addRow();
            }
            self.transients.dummy.notifySubscribers();
        };
    };

    window[viewModelInstance] = new this[viewModelName]();
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koAccess_Control_Details"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
             window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);

            // Check for locally saved data for this output - this will happen in the event of a session timeout
            // for example.
            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            console.log(savedData);
            var savedOutput = null;
            var savedOutputId = null;
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Access Control Details') {
                        if (tmpOutput.data) {
                            savedOutput = tmpOutput.data;

                        }
                    }
                });
            }
            if (savedOutput) {
                window[viewModelInstance].loadData(savedOutputId, savedOutput);
            }
        });

        
        $(function(){

            var viewModelName = "Erosion_Management_DetailsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Erosion Management Details";
                self.outputId = "";
                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                            self.data.erosionTreatmentMethod=ko.observableArray([]);
            self.transients.erosionTreatmentMethodConstraints = ["Farming practice change - reduced stocking","Farming practice change - improved stock management (grazing regime)","Farming practice change - improved stock management (stock movement)","Farming practice change - improved stock management (stock watering)","Farming practice change - stock exclusion","Farming practice change - improved crop management (rotation)","Farming practice change - improved crop management (tillage systems)","Farming practice change - improved crop management (contour plowing/bunding)","Farming practice change - improved crop management (cover crops & mulching)","Farming practice change - improved crop management (perennial crops)","Farming practice change - strip farming","Farming practice change - riparian buffer strips","Vegetated waterway (bioswale)","Revegetation","Terracing","Windbreaks","Erosion control structures (engineering works - see structures installed)","Other (specify in notes)"];
                
        self.loaderosionTreatmentMethod = function (data) {
            if (data !== undefined) {
                $.each(data, function (i, obj) {
                    self.data.erosionTreatmentMethod.push(obj);
                });
        }};
                        self.data.erosionType=ko.observableArray([]);
            self.transients.erosionTypeConstraints = ["Dune erosion - direct human traffic","Dune erosion - wind blown movement","Gully erosion","Mass movement - earthfllow","Mass movement - landslide/landslip","Mass movement - slumping","Stream bank erosion","Stream bed erosion","Sheetwash & rill erosion","Tunnel erosion","Wind scalding","Wave action","Other (specify in notes)"];
                
        self.loaderosionType = function (data) {
            if (data !== undefined) {
                $.each(data, function (i, obj) {
                    self.data.erosionType.push(obj);
                });
        }};
                        self.data.erosionControlStructures=ko.observableArray([]);
            self.transients.erosionControlStructuresConstraints = ["Slope reduction - flow interception structures (eg. contour banks & swales)","Slope reduction - Weirs & connected weir pools","Stilling ponds & retention basins","Dams & spillways (flood mitigation)","Sediment traps & groynes","Flumes & Chutes","Reventment structures (bank protection)","Channel/bank lining - solid barrier","Channel/bank lining - cellular confinement systems","Gabions","Drift fence","Sea wall","Other (specify in notes)"];
                
        self.loaderosionControlStructures = function (data) {
            if (data !== undefined) {
                $.each(data, function (i, obj) {
                    self.data.erosionControlStructures.push(obj);
                });
        }};
        
            self.data.erosionAffectedArea = ko.observable();

            self.data.erosionAreaTreated = ko.observable();

            self.data.erosionLength = ko.observable();

            self.data.erosionStructuresInstalled = ko.observable();

            self.data.erosionNotes = ko.observable();
            self.transients.site = site;

            // this will be called when generating a savable model to remove transient properties
            self.removeBeforeSave = function (jsData) {
                // add code to remove any transients added by the dynamic tags
            
            delete jsData.activityType;
            delete jsData.transients;
            return jsData;
        };

        // this returns a JS object ready for saving
        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
            // get rid of any transient observables
            return self.removeBeforeSave(jsData);
        };

        // this is a version of toJSON that just returns the model as it will be saved
        // it is used for detecting when the model is modified (in a way that should invoke a save)
        // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.loadData = function (outputId, data) {
            self.outputId = outputId;
            // load dynamic data
                            self.loaderosionTreatmentMethod(data['erosionTreatmentMethod']);
                self.loaderosionType(data['erosionType']);
                self.loaderosionControlStructures(data['erosionControlStructures']);
                self.data['erosionAffectedArea'](orZero(data['erosionAffectedArea']));
                self.data['erosionAreaTreated'](orZero(data['erosionAreaTreated']));
                self.data['erosionLength'](orZero(data['erosionLength']));
                self.data['erosionStructuresInstalled'](orZero(data['erosionStructuresInstalled']));
                self.data['erosionNotes'](data['erosionNotes']);


            // if there is no data in tables then add an empty row for the user to add data
            if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                self.addRow();
            }
            self.transients.dummy.notifySubscribers();
        };
    };

    window[viewModelInstance] = new this[viewModelName]();
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koErosion_Management_Details"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
             window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);

            // Check for locally saved data for this output - this will happen in the event of a session timeout
            // for example.
            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            console.log(savedData);
            var savedOutput = null;
            var savedOutputId = null;
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Erosion Management Details') {
                        if (tmpOutput.data) {
                            savedOutput = tmpOutput.data;

                        }
                    }
                });
            }
            if (savedOutput) {
                window[viewModelInstance].loadData(savedOutputId, savedOutput);
            }
        });

        
        $(function(){

            var viewModelName = "Management_Practice_Change_DetailsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var PracticeChangeRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.changePurpose = ko.observable(orBlank(data['changePurpose']));
            self.transients.changePurposeConstraints = ["Sustainable farm practice","Sustainable fishing and aquaculture practice","Innovative farming and fishing practices","Reduce run-off into the Great Barrier Reef","Wetland, riparian and mangrove protection and restoration along the Great Barrier Reef","Other (specify in notes)"];
            this.industryType = ko.observable(orBlank(data['industryType']));
            self.transients.industryTypeConstraints = ["Sugarcane","Grazing","Grains","Grapes","Vegetables","Fruit trees","Berries","Dairy","Cotton","Forestry","Aquaculture","Fishing","Other (specify in notes)"];
            this.resourceCondition = ko.observable(orBlank(data['resourceCondition']));
            self.transients.resourceConditionConstraints = ["Lack of ground cover","Soil acidity","Soil erosion (wind)","Soil erosion (water)","Soil health (biology)","Soil health (other)","Quality of wastewater (aquaculture)","Marine quality (fishing)","Nutrient loads","Sediment loads","Pesticide loads","Vegetation condition","Other (specify in notes)"];
            this.practiceChangeAction = ko.observable(orBlank(data['practiceChangeAction']));
            self.transients.practiceChangeActionConstraints = ["Retaining ground cover","Soil testing","Minimum-to-no till farming","Composting/mulching","Planting cover crops","Farm planning","Soil conditioning","Managing soil nutrients","Establishing wind breaks","Planning","By-catch reduction","Industry environmental management plan","Industry codes of practice","Reduced stocking rates/selective grazing","Fence off stock to watering points","Consistent wheel tracks","Crop rotation improvements","Nitrogen budget developed","Chemical application considered with rain forecast","Revegetation","Restoration","Riparian fencing","Management of invasive species","Improved technologies in management","Other (specify in notes)"];
            this.changePracticeTreatedArea = ko.observable(orZero(data['changePracticeTreatedArea']));
            this.entitiesAdoptingChange = ko.observable(orZero(data['entitiesAdoptingChange']));
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Management Practice Change Details";
                self.outputId = "";
                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
            
            self.data.practiceChange = ko.observableArray([]);
            self.selectedpracticeChangeRow = ko.observable();
        

            self.loadpracticeChange = function (data, append) {
                if (!append) {
                    self.data.practiceChange([]);
                }
                if (data === undefined) {
                    self.addpracticeChangeRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.practiceChange.push(new PracticeChangeRow(obj));
                    });
                }
            };

            self.addpracticeChangeRow = function () {
                var newRow = new PracticeChangeRow();
                self.data.practiceChange.push(newRow);
                
            };
            self.removepracticeChangeRow = function (row) {
                self.data.practiceChange.remove(row);
                
            };
            self.practiceChangerowCount = function () {
                return self.data.practiceChange().length;
            };

            self.practiceChangeTableDataUploadVisible = ko.observable(false);
            self.showpracticeChangeTableDataUpload = function() {
                self.practiceChangeTableDataUploadVisible(!self.practiceChangeTableDataUploadVisible());
            };

            self.practiceChangeTableDataUploadOptions = {
                    url:'/fieldcapture/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadpracticeChange(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "practiceChangetemplate-upload",
                    downloadTemplateId: "practiceChangetemplate-download",
                    formData:{type:'Management Practice Change Details', listName:'practiceChange'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.benefitAreaHa = ko.observable();
                self.data.targetOutcomes=ko.observableArray([]);
            self.transients.targetOutcomesConstraints = ["Reduced transport of nutrients off-farm","Reduced transport of soils / sediment off-farm","Reduced transport of pesticides off-farm","Reduced transport of farm chemicals off-farm","Improved soil structure, health and fertility / productivity","Enhanced habitat for native flora and fauna","Other (specify in notes)"];
                
        self.loadtargetOutcomes = function (data) {
            if (data !== undefined) {
                $.each(data, function (i, obj) {
                    self.data.targetOutcomes.push(obj);
                });
        }};
        
            self.data.lengthOfFenceStockWatering = ko.observable();

            self.data.totalChangePracticeTreatedArea = ko.computed(function () {
                var total = 0;
                for(var i = 0; i < self.data.practiceChange().length; i++) {
                    var value = self.data.practiceChange()[i].changePracticeTreatedArea();
                        total = total + Number(value); 
                }
                return total;
            });

            self.data.totalEntitiesAdoptingChange = ko.computed(function () {
                var total = 0;
                for(var i = 0; i < self.data.practiceChange().length; i++) {
                    var value = self.data.practiceChange()[i].entitiesAdoptingChange();
                        total = total + Number(value); 
                }
                return total;
            });

            self.data.notes = ko.observable();
            self.transients.site = site;

            // this will be called when generating a savable model to remove transient properties
            self.removeBeforeSave = function (jsData) {
                // add code to remove any transients added by the dynamic tags
                            delete jsData.selectedpracticeChangeRow;
                delete jsData.practiceChangeTableDataUploadOptions
                delete jsData.practiceChangeTableDataUploadVisible

            delete jsData.activityType;
            delete jsData.transients;
            return jsData;
        };

        // this returns a JS object ready for saving
        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
            // get rid of any transient observables
            return self.removeBeforeSave(jsData);
        };

        // this is a version of toJSON that just returns the model as it will be saved
        // it is used for detecting when the model is modified (in a way that should invoke a save)
        // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.loadData = function (outputId, data) {
            self.outputId = outputId;
            // load dynamic data
                            self.loadpracticeChange(data.practiceChange);
                self.data['benefitAreaHa'](orZero(data['benefitAreaHa']));
                self.loadtargetOutcomes(data['targetOutcomes']);
                self.data['lengthOfFenceStockWatering'](orZero(data['lengthOfFenceStockWatering']));
                self.data['notes'](data['notes']);


            // if there is no data in tables then add an empty row for the user to add data
            if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                self.addRow();
            }
            self.transients.dummy.notifySubscribers();
        };
    };

    window[viewModelInstance] = new this[viewModelName]();
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koManagement_Practice_Change_Details"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
             window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);

            // Check for locally saved data for this output - this will happen in the event of a session timeout
            // for example.
            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            console.log(savedData);
            var savedOutput = null;
            var savedOutputId = null;
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Management Practice Change Details') {
                        if (tmpOutput.data) {
                            savedOutput = tmpOutput.data;

                        }
                    }
                });
            }
            if (savedOutput) {
                window[viewModelInstance].loadData(savedOutputId, savedOutput);
            }
        });

        
        $(function(){

            var viewModelName = "Conservation_Works_DetailsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var ConservationWorksRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.conservationActionType = ko.observable(orBlank(data['conservationActionType']));
            self.transients.conservationActionTypeConstraints = ["Ecological thinning","Installation of nest boxes or other breeding/refuge structures","Restoring niche habitats","Seed bank establishment","Ex-situ breeding program","Other (specify in notes)"];
            this.areaImpactedByWorks = ko.observable(orZero(data['areaImpactedByWorks']));
        };
        var ProtectionMechanismsRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.protectionMechanism = ko.observable(orBlank(data['protectionMechanism']));
            self.transients.protectionMechanismConstraints = ["On title in perpetuity (eg Covenant Agreement)","Binding agreement not on title in perpetuity (eg Property Vegetation Plan)","Termed agreement not on title binding (eg Land management agreement)","Not on title non-binding (eg Wildlife Refuge)","No protection mechanism applicable","Other (specify in notes)"];
            this.numberOfProtectionMechanisms = ko.observable(orZero(data['numberOfProtectionMechanisms']));
            this.areaUnderAgreement = ko.observable(orZero(data['areaUnderAgreement']));
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Conservation Works Details";
                self.outputId = "";
                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                        self.data.targetSpecies = new SpeciesViewModel({}, speciesLists);

            self.data.animalBreedingNos = ko.observable();

            self.data.animalReleaseNumber = ko.observable();

            self.data.conservationWorks = ko.observableArray([]);
            self.selectedconservationWorksRow = ko.observable();
        

            self.loadconservationWorks = function (data, append) {
                if (!append) {
                    self.data.conservationWorks([]);
                }
                if (data === undefined) {
                    self.addconservationWorksRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.conservationWorks.push(new ConservationWorksRow(obj));
                    });
                }
            };

            self.addconservationWorksRow = function () {
                var newRow = new ConservationWorksRow();
                self.data.conservationWorks.push(newRow);
                
            };
            self.removeconservationWorksRow = function (row) {
                self.data.conservationWorks.remove(row);
                
            };
            self.conservationWorksrowCount = function () {
                return self.data.conservationWorks().length;
            };

            self.conservationWorksTableDataUploadVisible = ko.observable(false);
            self.showconservationWorksTableDataUpload = function() {
                self.conservationWorksTableDataUploadVisible(!self.conservationWorksTableDataUploadVisible());
            };

            self.conservationWorksTableDataUploadOptions = {
                    url:'/fieldcapture/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadconservationWorks(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "conservationWorkstemplate-upload",
                    downloadTemplateId: "conservationWorkstemplate-download",
                    formData:{type:'Conservation Works Details', listName:'conservationWorks'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.protectionMechanisms = ko.observableArray([]);
            self.selectedprotectionMechanismsRow = ko.observable();
        

            self.loadprotectionMechanisms = function (data, append) {
                if (!append) {
                    self.data.protectionMechanisms([]);
                }
                if (data === undefined) {
                    self.addprotectionMechanismsRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.protectionMechanisms.push(new ProtectionMechanismsRow(obj));
                    });
                }
            };

            self.addprotectionMechanismsRow = function () {
                var newRow = new ProtectionMechanismsRow();
                self.data.protectionMechanisms.push(newRow);
                
            };
            self.removeprotectionMechanismsRow = function (row) {
                self.data.protectionMechanisms.remove(row);
                
            };
            self.protectionMechanismsrowCount = function () {
                return self.data.protectionMechanisms().length;
            };

            self.protectionMechanismsTableDataUploadVisible = ko.observable(false);
            self.showprotectionMechanismsTableDataUpload = function() {
                self.protectionMechanismsTableDataUploadVisible(!self.protectionMechanismsTableDataUploadVisible());
            };

            self.protectionMechanismsTableDataUploadOptions = {
                    url:'/fieldcapture/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadprotectionMechanisms(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "protectionMechanismstemplate-upload",
                    downloadTemplateId: "protectionMechanismstemplate-download",
                    formData:{type:'Conservation Works Details', listName:'protectionMechanisms'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.notes = ko.observable();
            self.transients.site = site;

            // this will be called when generating a savable model to remove transient properties
            self.removeBeforeSave = function (jsData) {
                // add code to remove any transients added by the dynamic tags
                            delete jsData.selectedconservationWorksRow;
                delete jsData.conservationWorksTableDataUploadOptions
                delete jsData.conservationWorksTableDataUploadVisible
                delete jsData.selectedprotectionMechanismsRow;
                delete jsData.protectionMechanismsTableDataUploadOptions
                delete jsData.protectionMechanismsTableDataUploadVisible

            delete jsData.activityType;
            delete jsData.transients;
            return jsData;
        };

        // this returns a JS object ready for saving
        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
            // get rid of any transient observables
            return self.removeBeforeSave(jsData);
        };

        // this is a version of toJSON that just returns the model as it will be saved
        // it is used for detecting when the model is modified (in a way that should invoke a save)
        // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.loadData = function (outputId, data) {
            self.outputId = outputId;
            // load dynamic data
                            self.data['targetSpecies'].loadData(data['targetSpecies']);
                self.data['animalBreedingNos'](orZero(data['animalBreedingNos']));
                self.data['animalReleaseNumber'](orZero(data['animalReleaseNumber']));
                self.loadconservationWorks(data.conservationWorks);
                self.loadprotectionMechanisms(data.protectionMechanisms);
                self.data['notes'](data['notes']);


            // if there is no data in tables then add an empty row for the user to add data
            if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                self.addRow();
            }
            self.transients.dummy.notifySubscribers();
        };
    };

    window[viewModelInstance] = new this[viewModelName]();
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koConservation_Works_Details"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
             window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);

            // Check for locally saved data for this output - this will happen in the event of a session timeout
            // for example.
            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            console.log(savedData);
            var savedOutput = null;
            var savedOutputId = null;
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Conservation Works Details') {
                        if (tmpOutput.data) {
                            savedOutput = tmpOutput.data;

                        }
                    }
                });
            }
            if (savedOutput) {
                window[viewModelInstance].loadData(savedOutputId, savedOutput);
            }
        });

        
        $(function(){

            var viewModelName = "Sustainable_Practice_InitiativesViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var SustainableInitiativesRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.initiativeType = ko.observable(orBlank(data['initiativeType']));
            this.initiativeDescription = ko.observable(orBlank(data['initiativeDescription']));
            this.noInfluenced = ko.observable(orZero(data['noInfluenced']));
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Sustainable Practice Initiatives";
                self.outputId = "";
                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
            
            self.data.sustainableInitiatives = ko.observableArray([]);
            self.selectedsustainableInitiativesRow = ko.observable();
        

            self.loadsustainableInitiatives = function (data, append) {
                if (!append) {
                    self.data.sustainableInitiatives([]);
                }
                if (data === undefined) {
                    self.addsustainableInitiativesRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.sustainableInitiatives.push(new SustainableInitiativesRow(obj));
                    });
                }
            };

            self.addsustainableInitiativesRow = function () {
                var newRow = new SustainableInitiativesRow();
                self.data.sustainableInitiatives.push(newRow);
                
            };
            self.removesustainableInitiativesRow = function (row) {
                self.data.sustainableInitiatives.remove(row);
                
            };
            self.sustainableInitiativesrowCount = function () {
                return self.data.sustainableInitiatives().length;
            };

            self.sustainableInitiativesTableDataUploadVisible = ko.observable(false);
            self.showsustainableInitiativesTableDataUpload = function() {
                self.sustainableInitiativesTableDataUploadVisible(!self.sustainableInitiativesTableDataUploadVisible());
            };

            self.sustainableInitiativesTableDataUploadOptions = {
                    url:'/fieldcapture/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadsustainableInitiatives(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "sustainableInitiativestemplate-upload",
                    downloadTemplateId: "sustainableInitiativestemplate-download",
                    formData:{type:'Sustainable Practice Initiatives', listName:'sustainableInitiatives'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.noInfluencedTotal = ko.computed(function () {
                var total = 0;
                for(var i = 0; i < self.data.sustainableInitiatives().length; i++) {
                    var value = self.data.sustainableInitiatives()[i].noInfluenced();
                        total = total + Number(value); 
                }
                return total;
            });
            self.transients.site = site;

            // this will be called when generating a savable model to remove transient properties
            self.removeBeforeSave = function (jsData) {
                // add code to remove any transients added by the dynamic tags
                            delete jsData.selectedsustainableInitiativesRow;
                delete jsData.sustainableInitiativesTableDataUploadOptions
                delete jsData.sustainableInitiativesTableDataUploadVisible

            delete jsData.activityType;
            delete jsData.transients;
            return jsData;
        };

        // this returns a JS object ready for saving
        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
            // get rid of any transient observables
            return self.removeBeforeSave(jsData);
        };

        // this is a version of toJSON that just returns the model as it will be saved
        // it is used for detecting when the model is modified (in a way that should invoke a save)
        // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.loadData = function (outputId, data) {
            self.outputId = outputId;
            // load dynamic data
                            self.loadsustainableInitiatives(data.sustainableInitiatives);


            // if there is no data in tables then add an empty row for the user to add data
            if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                self.addRow();
            }
            self.transients.dummy.notifySubscribers();
        };
    };

    window[viewModelInstance] = new this[viewModelName]();
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koSustainable_Practice_Initiatives"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
             window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);

            // Check for locally saved data for this output - this will happen in the event of a session timeout
            // for example.
            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            console.log(savedData);
            var savedOutput = null;
            var savedOutputId = null;
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Sustainable Practice Initiatives') {
                        if (tmpOutput.data) {
                            savedOutput = tmpOutput.data;

                        }
                    }
                });
            }
            if (savedOutput) {
                window[viewModelInstance].loadData(savedOutputId, savedOutput);
            }
        });

        
        $(function(){

            var viewModelName = "Plant_Propagation_DetailsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var PlantPropagationRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.species =  new SpeciesViewModel(data['species'], speciesLists);
            this.seedWeight = ko.observable(orZero(data['seedWeight']));
            this.germinationMethod = ko.observable(orBlank(data['germinationMethod']));
            self.transients.germinationMethodConstraints = ["Direct sowing - pre-treated (abrasion / scarification)","Direct sowing - pre-treated (cold stratification)","Direct sowing - pre-treated (moist stratification)","Direct sowing - pre-treated (cold moist stratification)","Direct sowing - pre-treated (freezing and thawing)","Direct sowing - pre-treated (light)","Direct sowing - pre-treated (Hot Water)","Direct sowing - pre-treated (fire)","Direct sowing - pre-treated (smoke)","Direct sowing - pre-treated (leaching)","Direct sowing - seeds untreated","vegetative - cuttings - direct striking","vegetative - cuttings - pre-rooting","vegetative - layering","vegetative - tissue culture","Other (specify in notes)"];
            this.finishedStockType = ko.observable(orBlank(data['finishedStockType']));
            self.transients.finishedStockTypeConstraints = ["Tube / tray - seedling","Growth container - seedling","Potted - seedling","Potted - advanced plant","Bare rooted","Other (specify in notes)"];
            this.numberGrown = ko.observable(orZero(data['numberGrown']));
            this.propagationFinishDate = ko.observable(orBlank(data['propagationFinishDate'])).extend({simpleDate: false});
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Plant Propagation Details";
                self.outputId = "";
                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
            
            self.data.plantPropagation = ko.observableArray([]);
            self.selectedplantPropagationRow = ko.observable();
        

            self.loadplantPropagation = function (data, append) {
                if (!append) {
                    self.data.plantPropagation([]);
                }
                if (data === undefined) {
                    self.addplantPropagationRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.plantPropagation.push(new PlantPropagationRow(obj));
                    });
                }
            };

            self.addplantPropagationRow = function () {
                var newRow = new PlantPropagationRow();
                self.data.plantPropagation.push(newRow);
                
            };
            self.removeplantPropagationRow = function (row) {
                self.data.plantPropagation.remove(row);
                
            };
            self.plantPropagationrowCount = function () {
                return self.data.plantPropagation().length;
            };

            self.plantPropagationTableDataUploadVisible = ko.observable(false);
            self.showplantPropagationTableDataUpload = function() {
                self.plantPropagationTableDataUploadVisible(!self.plantPropagationTableDataUploadVisible());
            };

            self.plantPropagationTableDataUploadOptions = {
                    url:'/fieldcapture/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadplantPropagation(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "plantPropagationtemplate-upload",
                    downloadTemplateId: "plantPropagationtemplate-download",
                    formData:{type:'Plant Propagation Details', listName:'plantPropagation'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.totalSeedWeight = ko.computed(function () {
                var total = 0;
                for(var i = 0; i < self.data.plantPropagation().length; i++) {
                    var value = self.data.plantPropagation()[i].seedWeight();
                        total = total + Number(value); 
                }
                return total;
            });

            self.data.totalNumberGrown = ko.computed(function () {
                var total = 0;
                for(var i = 0; i < self.data.plantPropagation().length; i++) {
                    var value = self.data.plantPropagation()[i].numberGrown();
                        total = total + Number(value); 
                }
                return total;
            });

            self.data.notes = ko.observable();
            self.transients.site = site;

            // this will be called when generating a savable model to remove transient properties
            self.removeBeforeSave = function (jsData) {
                // add code to remove any transients added by the dynamic tags
                            delete jsData.selectedplantPropagationRow;
                delete jsData.plantPropagationTableDataUploadOptions
                delete jsData.plantPropagationTableDataUploadVisible

            delete jsData.activityType;
            delete jsData.transients;
            return jsData;
        };

        // this returns a JS object ready for saving
        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
            // get rid of any transient observables
            return self.removeBeforeSave(jsData);
        };

        // this is a version of toJSON that just returns the model as it will be saved
        // it is used for detecting when the model is modified (in a way that should invoke a save)
        // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.loadData = function (outputId, data) {
            self.outputId = outputId;
            // load dynamic data
                            self.loadplantPropagation(data.plantPropagation);
                self.data['notes'](data['notes']);


            // if there is no data in tables then add an empty row for the user to add data
            if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                self.addRow();
            }
            self.transients.dummy.notifySubscribers();
        };
    };

    window[viewModelInstance] = new this[viewModelName]();
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koPlant_Propagation_Details"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
             window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);

            // Check for locally saved data for this output - this will happen in the event of a session timeout
            // for example.
            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            console.log(savedData);
            var savedOutput = null;
            var savedOutputId = null;
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Plant Propagation Details') {
                        if (tmpOutput.data) {
                            savedOutput = tmpOutput.data;

                        }
                    }
                });
            }
            if (savedOutput) {
                window[viewModelInstance].loadData(savedOutputId, savedOutput);
            }
        });

        
        $(function(){

            var viewModelName = "Photo_PointsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var PhotoPointsRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.isSelected = ko.observable(false);

            this.commit = function () {
                self.doAction('commit');
            };
            this.reset = function () {
                self.doAction('reset');
            };
            this.doAction = function (action) {
                var prop, item;
                for (prop in self) {
                    if (self.hasOwnProperty(prop)) {
                        item = self[prop];
                        if (ko.isObservable(item) && item[action]) {
                           item[action]();
                        }
                    }
                }
            };
            this.isNew = false;
            this.toJSON = function () {
                return ko.mapping.toJS(this, {'ignore':['transients', 'isNew', 'isSelected']});
            };
            this.name = ko.protectedObservable(orBlank(data['name']));
            this.photo = ko.observableArray();
            if (data['photo'] instanceof Array) {
                this.photo(data['photo']);
            } else if (data['photo']) {
                this.photo.push(data['photo']);
            }
            this.comment = ko.protectedObservable(orBlank(data['comment']));
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Photo Points";
                self.outputId = "";
                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
            
            self.data.photoPoints = ko.observableArray([]);
            self.selectedphotoPointsRow = ko.observable();
        
            self.addphotoPointsRow = function () {
                var newRow = new PhotoPointsRow();
                self.data.photoPoints.push(newRow);
                newRow.isNew = true; self.editphotoPointsRow(newRow);
            };
            self.removephotoPointsRow = function (row) {
                self.data.photoPoints.remove(row);
                self.selectedphotoPointsRow(null);
            };
            self.photoPointsrowCount = function () {
                return self.data.photoPoints().length;
            };

            self.photoPointsTableDataUploadVisible = ko.observable(false);
            self.showphotoPointsTableDataUpload = function() {
                self.photoPointsTableDataUploadVisible(!self.photoPointsTableDataUploadVisible());
            };

            self.photoPointsTableDataUploadOptions = {
                    url:'/fieldcapture/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadphotoPoints(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "photoPointstemplate-upload",
                    downloadTemplateId: "photoPointstemplate-download",
                    formData:{type:'Photo Points', listName:'photoPoints'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.photoPointstemplateToUse = function (row) {
                return self.selectedphotoPointsRow() === row ? 'photoPointseditTmpl' : 'photoPointsviewTmpl';
            };
            self.editphotoPointsRow = function (row) {
                self.selectedphotoPointsRow(row);
                row.isSelected(true);
            };
            self.acceptphotoPoints = function (row, event) {
            if($(event.currentTarget).closest('.validationEngineContainer').validationEngine('validate')) {
                // todo: validation
                row.commit();
                self.selectedphotoPointsRow(null);
                row.isSelected(false);
                row.isNew = false;
                };
            };
            self.cancelphotoPoints = function (row) {
                if (row.isNew) {
                    self.removephotoPointsRow(row);
                } else {
                    row.reset();
                    self.selectedphotoPointsRow(null);
                    row.isSelected(false);
                }
            };
            self.photoPointsEditing = function() {
                return self.selectedphotoPointsRow() != null;
            };
var PhotoPoint = function(data) {
    this.name = data.name;
    this.lat = data.geometry.decimalLatitude;
    this.lon = data.geometry.decimalLongitude;
    this.bearing = data.geometry.bearing;
    this.description = data.description;
};

self.loadphotoPoints = function(data) {
    var photoPointByName = function(name, data) {
        var photoPoint;
        if (data !== undefined) {
            $.each(data, function(index, obj) {
                if (obj.name === name) {
                    photoPoint = obj;
                    return false;
                }
            });
        }
        return photoPoint;
    };
    if (site !== undefined && site.poi !== undefined) {
        $.each(site.poi, function(index, obj) {
            var photoPoint = new PhotoPoint(obj);
            var photoPointData = photoPointByName(obj.name, data);
            if (photoPointData === undefined) {
                photoPointData = {comment:"", photo:[]};
            }
            var row = new PhotoPointsRow(photoPointData);
            $.extend(row, photoPoint);

            self.data.photoPoints.push(row);
        });
    }
};

self.removePhotoPoint = function(photoPoint) {
   self.data.photoPoints.remove(photoPoint);
};            self.transients.site = site;

            // this will be called when generating a savable model to remove transient properties
            self.removeBeforeSave = function (jsData) {
                // add code to remove any transients added by the dynamic tags
                            delete jsData.selectedphotoPointsRow;
                delete jsData.photoPointsTableDataUploadOptions
                delete jsData.photoPointsTableDataUploadVisible

            delete jsData.activityType;
            delete jsData.transients;
            return jsData;
        };

        // this returns a JS object ready for saving
        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
            // get rid of any transient observables
            return self.removeBeforeSave(jsData);
        };

        // this is a version of toJSON that just returns the model as it will be saved
        // it is used for detecting when the model is modified (in a way that should invoke a save)
        // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.loadData = function (outputId, data) {
            self.outputId = outputId;
            // load dynamic data
                            self.loadphotoPoints(data['photoPoints']);


            // if there is no data in tables then add an empty row for the user to add data
            if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                self.addRow();
            }
            self.transients.dummy.notifySubscribers();
        };
    };

    window[viewModelInstance] = new this[viewModelName]();
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koPhoto_Points"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
             window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);

            // Check for locally saved data for this output - this will happen in the event of a session timeout
            // for example.
            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            console.log(savedData);
            var savedOutput = null;
            var savedOutputId = null;
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Photo Points') {
                        if (tmpOutput.data) {
                            savedOutput = tmpOutput.data;

                        }
                    }
                });
            }
            if (savedOutput) {
                window[viewModelInstance].loadData(savedOutputId, savedOutput);
            }
        });

        


    /* Master controller for page. This handles saving each model as required. */
    var Master = function () {
        var self = this;
        this.subscribers = [];
        // client models register their name and methods to participate in saving
        self.register = function (modelInstanceName, getMethod, isDirtyMethod, resetMethod) {
            this.subscribers.push({
                model: modelInstanceName,
                get: getMethod,
                isDirty: isDirtyMethod,
                reset: resetMethod
            });
        };
        // master isDirty flag for the whole page - can control button enabling
        this.isDirty  = function () {
            var dirty = false;
            $.each(this.subscribers, function(i, obj) {
                dirty = dirty || obj.isDirty();
            });
            return dirty;
        };
        /**
         * Makes an ajax call to save any sections that have been modified. This includes the activity
         * itself and each output.
         *
         * Modified outputs are injected as a list into the activity object. If there is nothing to save
         * in the activity itself, then the root is an object that is empty except for the outputs list.
         *
         * NOTE that the model for each section must register itself to be included in this save.
         *
         * Validates the entire page before saving.
         */
        this.save = function () {

            var activityData, outputs = [];
            if ($('#validation-container').validationEngine('validate')) {
                $.each(this.subscribers, function(i, obj) {
                   // if (obj.isDirty()) {
                        if (obj.model === 'activityModel') {
                            activityData = obj.get();
                        } else {
                            outputs.push(obj.get());
                        }
                    //}
                });
                if (outputs.length === 0 && activityData === undefined) {
                    alert("Nothing to save.");
                    return;
                }
                if (activityData === undefined) { activityData = {}}
                activityData.outputs = outputs;

                var toSave = JSON.stringify(activityData);
                console.log("saving"+toSave);
                mobileBindings.saveActivity(toSave);

            }

        };

        this.reset = function () {
            $.each(this.subscribers, function(i, obj) {
                if (obj.isDirty()) {
                    obj.reset();
                }
            });
        };
    };

    if (mobileBindings == undefined) {
        var mobileBindings = {
        loadActivity:function(){return "{}"},
        saveActivity:function(){}
        };
    }
    var master = new Master();
    var activity = JSON.parse(mobileBindings.loadActivity());
    var themes = ['theme1', 'theme2'];

    var site = {};


    $(function(){

        console.log("Blah!");

        $('#validation-container').validationEngine('attach', {scroll: false});

        $('.helphover').popover({animation: true, trigger:'hover'});

        $('#reset').click(function () {
            master.reset();
        });


        ko.bindingHandlers.editOutput = {
            init: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
                var outputName = ko.utils.unwrapObservable(valueAccessor()),
                    activity = bindingContext.$root,
                    outputId;

                // search for corresponding outputs in the activity data
                $.each(activity.outputs, function (i,output) { // iterate output data in the activity to
                                                                  // find any matching the meta-model name
                    if (output.name === outputName) {
                        outputId = output.outputId;
                    }
                });
                if (outputId) {
                    // build edit link
                    $(element).html('Edit data');
                    $(element).attr('href', fcConfig.serverUrl + "/output/edit/" + outputId +
                        "?returnTo=" + here);
                } else {
                    // build create link
                    $(element).attr('href', fcConfig.serverUrl + '/output/create?activityId=' + activity.activityId +
                        '&outputName=' + encodeURIComponent(outputName) +
                        "&returnTo=" + here);
                }
            }
        };

        function ViewModel (act, site) {
            var self = this;
            self.activityId = act.activityId;
            self.description = ko.observable(act.description);
            self.notes = ko.observable(act.notes);
            self.startDate = ko.observable(act.startDate).extend({simpleDate: false});
            self.endDate = ko.observable(act.endDate || act.plannedEndDate).extend({simpleDate: false});
            self.plannedStartDate = ko.observable(act.plannedStartDate).extend({simpleDate: false});
            self.plannedEndDate = ko.observable(act.plannedEndDate).extend({simpleDate: false});
            self.eventPurpose = ko.observable(act.eventPurpose);
            self.fieldNotes = ko.observable(act.fieldNotes);
            self.associatedProgram = ko.observable(act.associatedProgram);
            self.associatedSubProgram = ko.observable(act.associatedSubProgram);
            self.progress = ko.observable(act.progress);
            self.mainTheme = ko.observable(act.mainTheme);
            self.type = ko.observable(act.type);
            self.siteId = ko.observable(act.siteId);
            self.projectId = act.projectId;
            self.transients = {};
            self.transients.site = site;
            self.transients.activityProgressValues = ['planned','started','finished'];
            self.transients.themes = themes;
            self.transients.markedAsFinished = ko.observable(act.progress === 'finished');
            self.transients.markedAsFinished.subscribe(function (finished) {
                self.progress(finished ? 'finished' : 'started');
            });

            self.modelForSaving = function () {
                // get model as a plain javascript object
                var jsData = ko.toJS(self);
                delete jsData.transients;
                return jsData;
            };
            self.modelAsJSON = function () {
                return JSON.stringify(self.modelForSaving());
            };

            self.save = function (callback, key) {
            };

            self.notImplemented = function () {
                alert("Not implemented yet.")
            };
            self.dirtyFlag = ko.dirtyFlag(self, false);

            // make sure progress moves to started if we save any data (unless already finished)
            // (do this here so the model becomes dirty)
            self.progress(self.transients.markedAsFinished() ? 'finished' : 'started');
        }


        var viewModel = new ViewModel(activity, site);

        ko.applyBindings(viewModel);

        master.register('activityModel', viewModel.modelForSaving, viewModel.dirtyFlag.isDirty, viewModel.dirtyFlag.reset);

        var mapFeatures = $.parseJSON('');
        if(mapFeatures !=null && mapFeatures.features !== undefined && mapFeatures.features.length >0){
            init_map_with_features({
                    mapContainer: "smallMap",
                    zoomToBounds:true,
                    zoomLimit:16,
                    featureService: "/fieldcapture/proxy/feature",
                    wmsServer: "http://spatial-dev.ala.org.au/geoserver"
                },
                mapFeatures
            );
        }
    });
</script>
</body>
</html>
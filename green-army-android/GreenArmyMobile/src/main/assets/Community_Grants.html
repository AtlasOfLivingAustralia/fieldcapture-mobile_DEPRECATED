

<!DOCTYPE html>
<head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    
    <script src="static/t5OGphSUjwdNOoxNKgdRTTh1RBtmzhMXxHDYYeR4lYj.js" type="text/javascript" ></script>
<link href="static/090onaZX1M508oSWqGmMeETZ9NkUA9p4CCTW3MUpRPc.css" type="text/css" rel="stylesheet" media="screen, projection" />

<link href="static/VySgOjkVOsD8Jt8ujXROVRjZeDLAAwVhMF5WqPZ8Ajf.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="http://www.ala.org.au/wp-content/themes/ala2011/images/favicon.ico" rel="shortcut icon" />
<!--[if lt IE 9]><script src="static/Yh1Txee3hFzExJ4P1str7tGV24zQMEYtxqtlYJ5ukR0.js" type="text/javascript" ></script><![endif]-->
<link href="static/Qwaw257M4sHcJuspEDRbeQoTceByqRmOCHNaZWpOxuc.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="static/AcXIjLTuc87n8sfxBjJRQSoBIUwP9RnCyK8Sv82i7eV.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="static/doSKUivnfI9gXmPKZ2XG4W5xIABYgKaf5Dwf3LtjNVr.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="static/fx5pGfEFSRJi6nyez3s8fUsjDL8WJ0IB04Njm7T2VAJ.css" type="text/css" rel="stylesheet" media="all" />
<link href="static/qBQAxqnczDqd7Bl7B2gXgLoB51xIPPVo3q06lXUPLcy.css" type="text/css" rel="stylesheet" media="screen,print" />




<link href="static/KYGDEVRRaKjNbTXJkHmicmzo9vFrnnzCnGLcxKjR04f.css" type="text/css" rel="stylesheet" media="screen,print" />

<link href="static/KtHosYDw6qHDklqhUqI9Y0lrV4QlbtokVSWtoN5CyvP.css" type="text/css" rel="stylesheet" media="screen,print" />
<link href="static/nq5UnIyX5LhMaOWVShAJhQHKHVGPAbNeKmoHiJNIGvz.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="/static/RrjzrZ0Ci0GPLETIr8x8KUMjfJtZKvifrUtMCedwKRB.png" rel="shortcut icon" />
<link href="static/4zsVqykqBON8U5Es5kfffXBSGJlbI8VrPDW4hSn1SWJ.css" type="text/css" rel="stylesheet" media="screen, projection" />


<link href="static/sCFm7bBsIMFGQHTSlBbhMHQCXWhOsbBr5z4bu1OueIE.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="http://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="static/tUELnv7Uvq6ppWNUWOlaow3JGSTTIf8hJ2VYvh7Oahj.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="/static/OKcRcjAeA1yuXD9r4fZA1Uw2HEwL7gYvjc6HdrZXIYP.png" rel="shortcut icon" />
<link href="/static/UxF0saaqmikaj74l2WFcCyPMm9hEEs8if7IBy0GNAnd.png" rel="shortcut icon" />
<link href="/static/zs4hrJqt7I802RlaZiXbmbDBarpNPZF8V8fCQJ2RVTM.png" rel="shortcut icon" />
<link href="/static/SvC1e8bSiCPFh8mObbEThgbJIaGZi72ATzqobK6QnnB.gif" rel="shortcut icon" />
<link href="/static/BA9MhIHZnH0zMcKJWIWsTurHhQTpDYE6akqM5excaZI.gif" rel="shortcut icon" />

<script type="text/javascript">
    var fcConfig = {
        bieUrl: "http://bie.ala.org.au",
        speciesProfileUrl: "https://fieldcapture.ala.org.au/proxy/speciesProfile",
        googleStaticUrl:"http://maps.googleapis.com/maps/api/staticmap?maptype=terrian&zoom=12&sensor=false&size=350x250&markers=color:red%7C"
        },
        here = document.location.href;
    </script>
    

    <meta name="layout" content="mobile"/>

    
    
    
</if>

    <style type="text/css">
        input[type=checkbox] {  -webkit-transform: scale(1.5); }
        .checkbox-list label { min-height: 40px; }
        .speciesAutocompleteRow {min-height:40px;}
        .datepicker td, .datepicker th {
            width:40px;
            height:40px;
            vertical-align: middle;
        }
    </style>
</head>

<body>

<div id="content" class="clearfix">
    
<div class="container-fluid validationEngineContainer" id="validation-container">
<div id="koActivityMainBlock">

    <div class="row-fluid">
        <div class="span12">
            <!-- Common activity fields -->

            <div class="row-fluid space-after">
                <div class="span4">

                    <label class="for-readonly">Type</label>
                    <span class="readonly-text" data-bind="text:type"></span>
                </div>
                <div class="span8">

                    <label class="for-readonly">Description</label>
                    <span class="readonly-text" data-bind="text:description"></span>
                </div>
            </div>


            <div class="row-fluid space-after">
                <div class="span4">
                    <label class="for-readonly inline">Planned start date</label>
                    <span class="readonly-text" data-bind="text:plannedStartDate.formattedDate"></span>
                </div>
                <div class="span8">
                    <label class="for-readonly inline">Planned end date</label>
                    <span class="readonly-text" data-bind="text:plannedEndDate.formattedDate"></span>
                </div>
            </div>

            <div class="well">
                <div class="row-fluid">

                    <span class="span8">
                    <div class="row-fluid space-after">

                        <div class="span6 required">
                            <label for="startDate"><b>Actual start date</b>
                                <a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Date the activity was started.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a>
                            </label>


                            <div class="input-append">
                                <input data-bind='datepicker:startDate.date' name='startDate' id='startDate' type='text' size='16' class='input-xlarge' readonly='readonly' targetField='startDate.date' data-validation-engine='validate[required]' />
<span class='add-on open-datepicker'>
  <i class='icon-th'>&nbsp;</i>
</span>
                            </div>

                        </div>
                        <div class="span6" data-bind="css:{required:transients.markedAsFinished}">
                            <label for="endDate"><b>Actual end date</b>
                                <a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Date the activity finished.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a>
                            </label>

                            <div class="input-append">
                                <input data-bind='datepicker:endDate.date' name='endDate' id='endDate' type='text' size='16' class='input-xlarge' readonly='readonly' targetField='endDate.date' data-validation-engine='validate[future[startDate]]' />
<span class='add-on open-datepicker'>
  <i class='icon-th'>&nbsp;</i>
</span>
                            </div>

                        </div>
                    </div>
                    <div class="row-fluid space-after">
                        <div class="span6">
                            <label for="theme"><b>Major theme</b></label>
                            <select id="theme" data-bind="value:mainTheme, options:transients.themes, optionsCaption:'Choose..'" class="input-xlarge" style="width:90%">
                            </select>
                        </div>

                        <div class="span6">
                            <label><b>Progress</b></label>
                            <label for="activityComplete"><input type="checkbox" id="activityComplete" data-bind="checked:transients.markedAsFinished" style="margin-right:1em;"><span>This activity is complete</span></label>

                        </div>

                    </div>
                    <div class="row-fluid">
                        <div class="span6">
                            <label for="site"><b>Site</b></label>
                            <select id='site' style='width:90%' data-bind='options:transients.sites,optionsText:"name",optionsValue:"siteId",value:siteId,optionsCaption:"Choose a site..."'>&nbsp;</select>

                        </div>

                        <div class="span3">

                            <button class="btn btn-info" style="margin-top:25px;" data-bind="visible:transients.newSiteSupported,click:createNewSite">Create new Site</button>
                        </div>
                    </div>

                    
                        
                            
                                
                            
                            
                                
                                    
                                    
                                    
                                    

                                
                            
                        

                    
                    </span>
                    <span class="span4">

                        <img id="siteLocationImage" width="100%" data-bind="event:{error:siteLoadError}, attr:{src:transients.siteImgUrl}, visible:transients.siteImgUrl()"/>


                    </span>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- ko stopBinding: true -->

    
    
    
    <style type="text/css">
        table.grantsAwardedByCategory th {white-space:normal;}
        table.grantsAwardedByCategory tbody td:nth-child(1) {width:20%;text-align:center;}
        table.grantsAwardedByCategory tbody td:nth-child(2) {width:60%;}
        table.grantsAwardedByCategory tbody td:nth-child(3) {width:20%;text-align:center;}
        table.grantsAwardedByCategory td:last-child {width:4%;text-align:center;}
        table.grantsAwardedByCategory textarea {width:100%; box-sizing:border-box; }
        table.grantsAwardedByCategory select {width:100%; box-sizing:border-box; }
    </style>
    <div class="output-block" id="ko1._Community_Grants_Administration">
            <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">1. Community Grants Administration</h3>
        <div data-bind="if:transients.optional">
            <label class="checkbox" ><input type="checkbox" data-bind="checked:outputNotCompleted"> <span data-bind="text:transients.questionText"></span> </label>
        </div>
        <div id="1._Community_Grants_Administration-content" data-bind="visible:!outputNotCompleted()">
        <!-- add the dynamic components -->
            <div class="row-fluid space-after " >
<span class="span12">    <span  class="span12">Is this the 1st use of the Community Grants form for this project? If not, ensure data provided has not been provided in earlier reporting periods.</span></span></div>
<div class="row-fluid space-after output-section" >
<div class="span12">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>In this reporting period, has there been an expression of interest process for awarding Community Grants? </label></span><select class="span8" data-bind='value:data.expressionOfInterestReceived,options:transients.expressionOfInterestReceivedConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>	 If yes, how many EOI were received</label></span><input class="input-small" style="text-align:center" data-bind='value:data.numberOfExpressionsOfInterestReceived' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div></div></div>
<div class="row-fluid space-after output-section" >
<div class="span12">
<div class="row-fluid"><span class="span12">    <span  class="span8">In this reporting period, how many Community Grants were awarded and what was the total value of the grants?</span></span></div><div class="row-fluid ">
            <table class="table table-bordered grantsAwardedByCategory " >
                <thead><tr><th>Number of grants awarded</th><th></th><th>Funded amount ($)</th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'grantsAwardedByCategoryviewTmpl', foreach: data.grantsAwardedByCategory}"></tbody>
                <script id="grantsAwardedByCategoryviewTmpl" type="text/html"><tr>
                    <td><input class="input-small" style="text-align:center" data-bind='value:numberOfGrantsAwarded' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><span  data-bind='text:granteeCategory'></span></td>
                    <td><input class="input-small" style="text-align:center" data-bind='value:totalFunding' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><i data-bind='click:$root.removegrantsAwardedByCategoryRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
<tr><td colspan="4">
            <div class="text-left" style="margin:5px">
                <a data-bind="click:downloadgrantsAwardedByCategoryTemplateWithData" class="btn"><i class="fa fa-download"></i> Download the data from this table (.xlsx)</a>
            </div>
            </tr>                </tfoot>
            </table>
        </div>
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Of these grantees, how many were identified as Indigenous?</label></span><input class="input-small" style="text-align:center" data-bind='value:data.numberOfIndigenousGrantees' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div></div></div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>Notes / Comments</label></span><textarea  class="span12" data-bind='value:data.notes'></textarea></span></div>

        </div>
        


        
    </div>
    

    
    
    
    <style type="text/css">
        table.pestManagement th {white-space:normal;}
        table.pestManagement td:last-child {width:4%;text-align:center;}
        table.pestManagement textarea {width:100%; box-sizing:border-box; }
        table.pestManagement select {width:100%; box-sizing:border-box; }
    </style><style type="text/css">
        table.weedManagement th {white-space:normal;}
        table.weedManagement td:last-child {width:4%;text-align:center;}
        table.weedManagement textarea {width:100%; box-sizing:border-box; }
        table.weedManagement select {width:100%; box-sizing:border-box; }
    </style>
    <div class="output-block" id="ko2._Community_Grants_Reporting">
            <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">2. Community Grants Reporting</h3>
        <div data-bind="if:transients.optional">
            <label class="checkbox" ><input type="checkbox" data-bind="checked:outputNotCompleted"> <span data-bind="text:transients.questionText"></span> </label>
        </div>
        <div id="2._Community_Grants_Reporting-content" data-bind="visible:!outputNotCompleted()">
        <!-- add the dynamic components -->
            <div class="row-fluid space-after " >
<span class="span12">    <span  class="span12"><h4>Total Output Details</h4></span></span></div>
<div class="row-fluid space-after " >
<span class="span12">    <span  class="span12">Complete only the outputs achieved by projects for this reporting period</span></span></div>
<div class="row-fluid space-after " >
<span class="span12">    <span  class="span12"><h5><strong>Community Participation</strong></h5></span></span></div>
<div class="row-fluid space-after output-section" >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Community participation and engagement (events):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Number of events held to increase community engagement, such as, training, workshops, planting days, field days, knowledge sharing.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.numberOfEvents' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Community participation and engagement (publications):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Number of different publications produced (NOT the number of copies of a publication produced).'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.numberOfPublications' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>No. of community groups that participated in delivery of the project:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of different community groups participating in the project.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.numberOfCommunityGroups' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Indigenous people engaged as volunteers [not employed] (no. of people):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of separate/unique Indigenous persons participating in delivery of the project in a voluntary, non-employed capacity.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.numberOfIndigenousParticipants' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div></div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>No. of Indigenous Land and Sea Plans completed:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The total number of Indigenous Land and Sea Plans developed by the project.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.indigenousPlansCompleted' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Indigenous knowledge transfer (no. of activities):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Number of discrete activities where Indigenous knowledge transfer occurs. E.g. Number of indigenous on-country visits, cultural training sessions. It excludes datasets collected or shared.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.indigenousKnowledgeTransferActionsNo' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Indigenous knowledge transfer (datasets shared/collected):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Number of Indigenous ecological knowledge datasets shared or collected.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.datasetsShared' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div></div></div>
<div class="row-fluid space-after " >
<span class="span12">    <span  class="span12"><h5><strong>Practice Change</strong></h5></span></span></div>
<div class="row-fluid space-after output-section" >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>No. of farming/fisher entities involved in delivery of project activities:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The total number of unique farming/fisher entities participating in the project.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.numberOfFarmingEntitiesNew' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>No. of farming/fisher entities implementing management practice change:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of farming/fisher entities that adopted management practice change during the project.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.entitiesAdoptingChange' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div></div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Management practice change (area implemented, Ha):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The  hectares of agricultural land where improved management practices have been adopted.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.totalChangePracticeTreatedArea' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Conservation grazing management (Ha.):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The hectare area over which the grazing management regime is changed to obtain primarily ecological benefits. E.g. crash grazing to reduce weeds, use of temporary/limiting grazing and/or a set level of ground cover/sward height to promote seeding/regeneration of native grass or other native species.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.conservationGrazingActionsArea' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Management plan development (No. of reports/plans):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of new management plan documents completed and/or the number of existing plans where revisions/updates have been completed. Names and types of plans can be included in your &apos;project summary&apos; or &apos;comments on outputs&apos;.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.managementPlansNo' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div></div></div>
<div class="row-fluid space-after " >
<span class="span12">    <span  class="span12"><h5><strong>Actual Achievements - Biophysical and Other Outputs</strong></h5></span></span></div>
<div class="row-fluid space-after output-section" >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Area of Revegetation (Ha):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Area revegetated, e.g. hectares of planting and direct seed sowing.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.areaRevegHa' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Plants planted (No.):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number plants planted, excludes direct seeding and natural regeneration.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.totalNumberPlanted' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Revegetation (seed sown Kg):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Weight (in kilograms) of seed sown in the project area. Species can be listed in the &apos;Comments field&apos;.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.totalSeedSownKg' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Seed collected	(Kg):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The kg weight of seed collected.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.totalSeedCollectedKg' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Plant propagation (No.):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Number of individual plants propagated.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.totalNumberGrown' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Pest management (area treated Ha):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The total area where all pest animal control has been undertaken. For some species (such as foxes and rabbits), it includes the area of influence around the actual bait location/line. Do not double count the same area for; (1) work on different species, e.g. 20ha of treatment that targeted foxes and rabbits at a single site is reported as 20ha, not 40ha, or (2)  for follow up treatment. If the initial 20ha is targeted with secondary rounds of treatment, the reported area treated remains 20ha, not the combination of 20ha initial treatment and the 20ha follow up treatment.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.totalAreaTreatedHa' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Total number of individuals/colonies treated:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The total number of all animals and/or insect colonies killed and/or removed from the project area.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.totalPestAnimalsTreatedNo' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div></div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Fire management (area Ha):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Area over which a controlled burn has been undertaken, e.g. Ecological burn, hazard reduction burn.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.areaOfFireHa' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Debris removal (volume m3):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Number of cubic metres of rubbish/debris removed from the project area.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.debrisVolumeM3' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Erosion management (Ha):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The area of erosion works undertaken.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.erosionAreaTreated' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Erosion management (length):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The km of stream/coastline over which erosion works have been undertaken.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.erosionLength' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Length of fence erected (Km):</label></span><input class="input-small" style="text-align:center" data-bind='value:data.lengthOfFence' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Weed treatment (total new area treated Ha):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The total area where weed control has been undertaken. Do not double count (1) the same area for different species or retreatment, e.g 20ha of treatment that targeted Lantana and Camphor laurel at a single site is be reported as 20ha, not 40ha. or (2) follow up treatment. Eg. If the initial 20ha site is targeted with secondary rounds of treatment, the reported area treated remains 20ha, not the combination of the 20ha initial treatment and the 20ha follow up treatment.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.areaTreatedHa' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div></div></div>
<div class="row-fluid output-section">
            <table class="table table-bordered pestManagement " >
                <thead><tr><th>Pest species managed	(name):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The pest species targeted for control. Start typing the scientific or common name and the autofill will complete the entry.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'pestManagementviewTmpl', foreach: data.pestManagement}"></tbody>
                <script id="pestManagementviewTmpl" type="text/html"><tr>
                    <td>
<span class="input-prepend input-append" data-bind="with:pestAnimalsTargetSpecies">
    <span class="add-on" data-bind="visible:!transients.editing(), css:{'btn-success':name()}"><i class="icon-white" data-bind="css:{'icon-ok':listId()!='unmatched' && name(), 'icon-question-sign':listId()=='unmatched' || listId() == 'error-unmatched'}"></i></span><span class="add-on" data-bind="visible:transients.editing()"><img src="static/Xo2jbaJ5EFqa59u9g4c4ybpCpw3wFWKhQdzZwNmmktO.gif" alt="saving icon" /></span><input type="text" data-bind="value:transients.textFieldValue,event:{focusout:focusLost},autocomplete:{url:'https://fieldcapture.ala.org.au/search/species', render: renderItem, listId: list, result:speciesSelected, valueChangeCallback:textFieldChanged}" />
    <span class="add-on" data-bind="visible: !transients.editing() && name()">
        <a href="#" data-bind="popover: {title: name, content: transients.speciesInformation}"><i class="icon-info-sign"></i></a>
    </span>
</span>
</td>
                    <td><i data-bind='click:$root.removepestManagementRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr><td colspan="2" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addpestManagementRow">
                        <i class="icon-plus"></i> Add a row</button></td></tr> <script id="pestManagementtemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="pestManagementtemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>
<div class="row-fluid output-section">
            <table class="table table-bordered weedManagement " >
                <thead><tr><th>Weed species managed	(name):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The species targeted for control. Start typing a scientific or a common name and autofill will complete the entry).'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'weedManagementviewTmpl', foreach: data.weedManagement}"></tbody>
                <script id="weedManagementviewTmpl" type="text/html"><tr>
                    <td>
<span class="input-prepend input-append" data-bind="with:weedsTargetSpecies">
    <span class="add-on" data-bind="visible:!transients.editing(), css:{'btn-success':name()}"><i class="icon-white" data-bind="css:{'icon-ok':listId()!='unmatched' && name(), 'icon-question-sign':listId()=='unmatched' || listId() == 'error-unmatched'}"></i></span><span class="add-on" data-bind="visible:transients.editing()"><img src="static/Xo2jbaJ5EFqa59u9g4c4ybpCpw3wFWKhQdzZwNmmktO.gif" alt="saving icon" /></span><input type="text" data-bind="value:transients.textFieldValue,event:{focusout:focusLost},autocomplete:{url:'https://fieldcapture.ala.org.au/search/species', render: renderItem, listId: list, result:speciesSelected, valueChangeCallback:textFieldChanged}" />
    <span class="add-on" data-bind="visible: !transients.editing() && name()">
        <a href="#" data-bind="popover: {title: name, content: transients.speciesInformation}"><i class="icon-info-sign"></i></a>
    </span>
</span>
</td>
                    <td><i data-bind='click:$root.removeweedManagementRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr><td colspan="2" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addweedManagementRow">
                        <i class="icon-plus"></i> Add a row</button></td></tr> <script id="weedManagementtemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="weedManagementtemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>Details of other outputs not listed:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Include here any additional comments you have on your Community Grant projects that do not sit more appropriately elsewhere.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span12" data-bind='value:data.otherOutputs'></textarea></span></div>

        </div>
        


        
    </div>
    

    
    
    
    
    <div class="output-block" id="koAttachments">
            <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Attachments</h3>
        <div data-bind="if:transients.optional">
            <label class="checkbox" ><input type="checkbox" data-bind="checked:outputNotCompleted"> <span data-bind="text:transients.questionText"></span> </label>
        </div>
        <div id="Attachments-content" data-bind="visible:!outputNotCompleted()">
        <!-- add the dynamic components -->
            <div class="row-fluid space-after " >
<span class="span12">    <span  class="span12">Supporting documents are required (where available) to support the statements you have made regarding your progress/achievement.</span></span></div>
<div class="row-fluid space-after output-section" >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span8"><h4>Supporting Documents</h4><i>Please attach relevant supporting documents (e.g. photos, media clips, survey data, information products/publications, etc.) that provide evidence of the project's progress and / or impacts.</i></span></span></div><div class="row-fluid"><span class="span12">    <div data-bind="if:(data.supportingDocs1())">    <div data-bind="editDocument:data.supportingDocs1"></div></div><div data-bind="ifnot:data.supportingDocs1()">    <button class="btn" id="doAttach" data-bind="click:function(target) {attachDocument(data.supportingDocs1)}">Attach Document</button></div></span></div><div class="row-fluid"><span class="span12">    <div data-bind="if:(data.supportingDocs2())">    <div data-bind="editDocument:data.supportingDocs2"></div></div><div data-bind="ifnot:data.supportingDocs2()">    <button class="btn" id="doAttach" data-bind="click:function(target) {attachDocument(data.supportingDocs2)}">Attach Document</button></div></span></div><div class="row-fluid"><span class="span12">    <div data-bind="if:(data.supportingDocs3())">    <div data-bind="editDocument:data.supportingDocs3"></div></div><div data-bind="ifnot:data.supportingDocs3()">    <button class="btn" id="doAttach" data-bind="click:function(target) {attachDocument(data.supportingDocs3)}">Attach Document</button></div></span></div></div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span8"><h4>Additional Information (optional)</h4><i>You may attach other documents relevant to your project for the Department's information.</i></span></span></div><div class="row-fluid"><span class="span12">    <div data-bind="if:(data.additionalInfo1())">    <div data-bind="editDocument:data.additionalInfo1"></div></div><div data-bind="ifnot:data.additionalInfo1()">    <button class="btn" id="doAttach" data-bind="click:function(target) {attachDocument(data.additionalInfo1)}">Attach Document</button></div></span></div><div class="row-fluid"><span class="span12">    <div data-bind="if:(data.additionalInfo2())">    <div data-bind="editDocument:data.additionalInfo2"></div></div><div data-bind="ifnot:data.additionalInfo2()">    <button class="btn" id="doAttach" data-bind="click:function(target) {attachDocument(data.additionalInfo2)}">Attach Document</button></div></span></div><div class="row-fluid"><span class="span12">    <div data-bind="if:(data.additionalInfo3())">    <div data-bind="editDocument:data.additionalInfo3"></div></div><div data-bind="ifnot:data.additionalInfo3()">    <button class="btn" id="doAttach" data-bind="click:function(target) {attachDocument(data.additionalInfo3)}">Attach Document</button></div></span></div></div></div>
<div class="row-fluid space-after " >
<span class="span12">    <span  class="span12">If you have additional documents, please add them via the <b>Admin > Documents</b> tab.</span></span></div>

        </div>
        


        
    </div>
    

<!-- /ko -->

</div>




</div>

<script src="static/jNGzWep9YTzJQCsSRDWGKonJ7ycvNMNQauAe6AcGX4T.js" type="text/javascript" ></script>





<script src="static/5zeDycYZFxJsfDd3W1kuhrN47XnIMrbhS6gdHDvcExv.js" type="text/javascript" ></script>

<script src="static/ulxBmo4RrKTNT3DuFHethb4EOZpwQfvefxNXivDIbzp.js" type="text/javascript" ></script>








<!--[if gte IE 8]><script src="static/knxjs4G9Cquc79O3iYW107XikPB1Z1ii8QWrtBpzlSP.js" type="text/javascript" ></script><![endif]-->
<script src="static/nRrltgvxdEHd5BqRR1v4XU3ZStOrhDScuH03g4r8E6O.js" type="text/javascript" ></script>

<script src="static/iRQrJhH2zDlUTI4nXr10v5JHksIJyPjoe8fHSE4QZcI.js" type="text/javascript" ></script>

<script src="static/NsIfUsVWId7YD36PcnVeycNW6GCdIRgD7cdnhiQldmM.js" type="text/javascript" ></script>









<script src="static/IZCc6ZgD3MepYbz4UqlDLzMDNNghSCivcfGebmF9V2d.js" type="text/javascript" ></script>
<script src="static/NwE7QStklZyP86Oe5o9TUAwbaHqgfflXARrIBoL6Q5s.js" type="text/javascript" ></script>




<script src="static/e9gGniNN5cG3OR4oPVWd5lYoxE5Xf282hFe7d4FTQbq.js" type="text/javascript" ></script>


<script src="static/CRNxISj7t7ZCV7B8M8dFtBK7x7R4tGVO36INoBz8gQX.js" type="text/javascript" ></script>

<script src="static/QhlSgFWjl35vcaCRa5cKxHZxRWSSluzptQUKz3PHr9s.js" type="text/javascript" ></script>


<script src="static/8WCQyXwicnBgTdLQ4F5jUFtmVXmqG9eUZKvo74wOnIT.js" type="text/javascript" ></script>
<script src="static/9HtLc6nfgO9H72LVVZxetW45ZR623Fx8EhEdydgOq2F.js" type="text/javascript" ></script>
<script src="static/wkrwT3eqoZlWXFPCQRTvkdsdvwzT5Lw2H89f9eTkQdb.js" type="text/javascript" ></script>


<script type="text/javascript">
    
    // load dynamic models - usually objects in a list
            var Output_CommunityGrantsAdministration_grantsAwardedByCategoryRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.numberOfGrantsAwarded = ko.observable(orZero(data['numberOfGrantsAwarded'])).extend({numericString:2});
            this.granteeCategory = ko.observable(orBlank(data['granteeCategory']));
            this.totalFunding = ko.observable(orZero(data['totalFunding'])).extend({numericString:2});
        };
        var speciesLists = [];
        var site = {};


    window["ViewModel"] = function (output, site, config) {
        var self = this;
        if (!output) {
            output = {};
        }
        var activityId = output.activityId || config.activityId || '';
        self.name = "";
        self.outputId = orBlank(output.outputId);

        self.data = {};
        self.transients = {};
        var notCompleted = output.outputNotCompleted;

        if (notCompleted === undefined) {
            notCompleted = config.collapsedByDefault;
        }

        self.transients.selectedSite = ko.observable(site);
        self.outputNotCompleted = ko.observable(notCompleted);
        self.transients.optional = config.optional || false;
        self.transients.questionText = config.optionalQuestionText || 'Not applicable';
        self.transients.dummy = ko.observable();

        self.downloadDataTemplate = function(listName) {
            var data = ko.mapping.toJS(self.data[listName](), {ignore:['transients']});
            var params = {
                listName:listName,
                type:self.name,
                data:JSON.stringify(data)
            };
            var url = '/activity/excelOutputTemplate';
            $.fileDownload(url, {
                httpMethod:'POST',
                data:params
            });

        };


        // add declarations for dynamic data
        
            self.data.expressionOfInterestReceived = ko.observable();
            self.transients.expressionOfInterestReceivedConstraints = ["Yes","No"];

            self.data.numberOfExpressionsOfInterestReceived = ko.observable().extend({numericString:2});

            self.data.grantsAwardedByCategory = ko.observableArray([]);
            self.selectedgrantsAwardedByCategoryRow = ko.observable();
        

            self.loadgrantsAwardedByCategory = function (data, append) {
                if (!append) {
                    self.data.grantsAwardedByCategory([]);
                }
                if (data === undefined) {
                                        self.data.grantsAwardedByCategory.push(new Output_CommunityGrantsAdministration_grantsAwardedByCategoryRow({"numberOfGrantsAwarded":"0","granteeCategory":"Community groups funded","totalFunding":"0"}));
                    self.data.grantsAwardedByCategory.push(new Output_CommunityGrantsAdministration_grantsAwardedByCategoryRow({"numberOfGrantsAwarded":"0","granteeCategory":"Farm/Fishing business funded","totalFunding":"0"}));
                    self.data.grantsAwardedByCategory.push(new Output_CommunityGrantsAdministration_grantsAwardedByCategoryRow({"numberOfGrantsAwarded":"0","granteeCategory":"Individual funded","totalFunding":"0"}));
                    self.data.grantsAwardedByCategory.push(new Output_CommunityGrantsAdministration_grantsAwardedByCategoryRow({"numberOfGrantsAwarded":"0","granteeCategory":"Schools funded","totalFunding":"0"}));
                } else {
                    $.each(data, function (i, obj) {
                        self.data.grantsAwardedByCategory.push(new Output_CommunityGrantsAdministration_grantsAwardedByCategoryRow(obj));
                    });
                }
            };
            self.downloadgrantsAwardedByCategoryTemplateWithData = function() {
                self.downloadDataTemplate('grantsAwardedByCategory');
            }

            self.addgrantsAwardedByCategoryRow = function () {
                var newRow = new Output_CommunityGrantsAdministration_grantsAwardedByCategoryRow();
                self.data.grantsAwardedByCategory.push(newRow);
                
            };
            self.removegrantsAwardedByCategoryRow = function (row) {
                self.data.grantsAwardedByCategory.remove(row);
                
            };
            self.grantsAwardedByCategoryrowCount = function () {
                return self.data.grantsAwardedByCategory().length;
            };

            self.grantsAwardedByCategoryTableDataUploadVisible = ko.observable(false);
            self.showgrantsAwardedByCategoryTableDataUpload = function() {
                self.grantsAwardedByCategoryTableDataUploadVisible(!self.grantsAwardedByCategoryTableDataUploadVisible());
            };

            self.templateDownloadUrl = function(type) {
                return '/proxy/excelOutputTemplate?listName=grantsAwardedByCategory&type=';
            }

            self.grantsAwardedByCategoryTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadgrantsAwardedByCategory(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "grantsAwardedByCategorytemplate-upload",
                    downloadTemplateId: "grantsAwardedByCategorytemplate-download",
                    formData:{type:'null', listName:'grantsAwardedByCategory'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.numberOfIndigenousGrantees = ko.observable().extend({numericString:2});

            self.data.notes = ko.observable();
            self.transients.site = site;

        // this will be called when generating a savable model to remove transient properties
        self.removeBeforeSave = function (jsData) {
            // add code to remove any transients added by the dynamic tags
            
            delete jsData.activityType;
            delete jsData.transients;
            return jsData;
        };

        // this returns a JS object ready for saving
        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
            if (self.outputNotCompleted()) {
                jsData.data = {};
            }

            // get rid of any transient observables
            return self.removeBeforeSave(jsData);
        };

        // this is a version of toJSON that just returns the model as it will be saved
        // it is used for detecting when the model is modified (in a way that should invoke a save)
        // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.loadData = function (data, documents) {
            // load dynamic data
                            self.data['expressionOfInterestReceived'](data['expressionOfInterestReceived']);
                self.data['numberOfExpressionsOfInterestReceived'](orZero(data['numberOfExpressionsOfInterestReceived']));
                self.loadgrantsAwardedByCategory(data.grantsAwardedByCategory);
                self.data['numberOfIndigenousGrantees'](orZero(data['numberOfIndigenousGrantees']));
                self.data['notes'](data['notes']);


            // if there is no data in tables then add an empty row for the user to add data
            if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                self.addRow();
            }
            self.transients.dummy.notifySubscribers();
        };

        self.attachDocument = function(target) {
            var url = config.documentUpdateUrl || fcConfig.documentUpdateUrl;
            showDocumentAttachInModal(url, new DocumentViewModel({role:'information', stage:config.stage},{activityId:activityId, projectId:config.projectId}), '#attachDocument')
                    .done(function(result) {
                        target(new DocumentViewModel(result))
                    });
        };
        self.editDocumentMetadata = function(document) {
            var url = (config.documentUpdateUrl || fcConfig.documentUpdateUrl) + "/" + document.documentId;
            showDocumentAttachInModal(url, document, '#attachDocument');
        };
        self.deleteDocument = function(document) {
            document.status('deleted');
            var url = (config.documentDeleteUrl || fcConfig.documentDeleteUrl)+'/'+document.documentId;
            $.post(url, {}, function() {});

        };
    };
</script><script type="text/javascript">
        $(function(){

            var viewModelName = "1._Community_Grants_AdministrationViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var Output_CommunityGrantsAdministration_grantsAwardedByCategoryRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.numberOfGrantsAwarded = ko.observable(orZero(data['numberOfGrantsAwarded'])).extend({numericString:2});
            this.granteeCategory = ko.observable(orBlank(data['granteeCategory']));
            this.totalFunding = ko.observable(orZero(data['totalFunding'])).extend({numericString:2});
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output, config) {
                var self = this;
                self.name = "1. Community Grants Administration";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                var notCompleted = output.outputNotCompleted;

                if (notCompleted === undefined) {
                    notCompleted = config.collapsedByDefault;
                }
                self.transients.selectedSite = ko.observable(site);
                self.outputNotCompleted = ko.observable(notCompleted);
                self.transients.optional = config.optional || false;
                self.transients.questionText = config.optionalQuestionText || 'Not applicable';
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.expressionOfInterestReceived = ko.observable();
            self.transients.expressionOfInterestReceivedConstraints = ["Yes","No"];

            self.data.numberOfExpressionsOfInterestReceived = ko.observable().extend({numericString:2});

            self.data.grantsAwardedByCategory = ko.observableArray([]);
            self.selectedgrantsAwardedByCategoryRow = ko.observable();
        

            self.loadgrantsAwardedByCategory = function (data, append) {
                if (!append) {
                    self.data.grantsAwardedByCategory([]);
                }
                if (data === undefined) {
                                        self.data.grantsAwardedByCategory.push(new Output_CommunityGrantsAdministration_grantsAwardedByCategoryRow({"numberOfGrantsAwarded":"0","granteeCategory":"Community groups funded","totalFunding":"0"}));
                    self.data.grantsAwardedByCategory.push(new Output_CommunityGrantsAdministration_grantsAwardedByCategoryRow({"numberOfGrantsAwarded":"0","granteeCategory":"Farm/Fishing business funded","totalFunding":"0"}));
                    self.data.grantsAwardedByCategory.push(new Output_CommunityGrantsAdministration_grantsAwardedByCategoryRow({"numberOfGrantsAwarded":"0","granteeCategory":"Individual funded","totalFunding":"0"}));
                    self.data.grantsAwardedByCategory.push(new Output_CommunityGrantsAdministration_grantsAwardedByCategoryRow({"numberOfGrantsAwarded":"0","granteeCategory":"Schools funded","totalFunding":"0"}));
                } else {
                    $.each(data, function (i, obj) {
                        self.data.grantsAwardedByCategory.push(new Output_CommunityGrantsAdministration_grantsAwardedByCategoryRow(obj));
                    });
                }
            };
            self.downloadgrantsAwardedByCategoryTemplateWithData = function() {
                self.downloadDataTemplate('grantsAwardedByCategory');
            }

            self.addgrantsAwardedByCategoryRow = function () {
                var newRow = new Output_CommunityGrantsAdministration_grantsAwardedByCategoryRow();
                self.data.grantsAwardedByCategory.push(newRow);
                
            };
            self.removegrantsAwardedByCategoryRow = function (row) {
                self.data.grantsAwardedByCategory.remove(row);
                
            };
            self.grantsAwardedByCategoryrowCount = function () {
                return self.data.grantsAwardedByCategory().length;
            };

            self.grantsAwardedByCategoryTableDataUploadVisible = ko.observable(false);
            self.showgrantsAwardedByCategoryTableDataUpload = function() {
                self.grantsAwardedByCategoryTableDataUploadVisible(!self.grantsAwardedByCategoryTableDataUploadVisible());
            };

            self.templateDownloadUrl = function(type) {
                return '/proxy/excelOutputTemplate?listName=grantsAwardedByCategory&type=1.+Community+Grants+Administration';
            }

            self.grantsAwardedByCategoryTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadgrantsAwardedByCategory(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "grantsAwardedByCategorytemplate-upload",
                    downloadTemplateId: "grantsAwardedByCategorytemplate-download",
                    formData:{type:'1. Community Grants Administration', listName:'grantsAwardedByCategory'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.numberOfIndigenousGrantees = ko.observable().extend({numericString:2});

            self.data.notes = ko.observable();
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                    
                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    if (self.outputNotCompleted()) {
                        jsData.data = {};
                    }
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.data['expressionOfInterestReceived'](data['expressionOfInterestReceived']);
                self.data['numberOfExpressionsOfInterestReceived'](orZero(data['numberOfExpressionsOfInterestReceived']));
                self.loadgrantsAwardedByCategory(data.grantsAwardedByCategory);
                self.data['numberOfIndigenousGrantees'](orZero(data['numberOfIndigenousGrantees']));
                self.data['notes'](data['notes']);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === '1. Community Grants Administration') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            var config = JSON.parse('\u007b\u0022outputName\u0022:\u00221. Community Grants Administration\u0022\u002c\u0022optional\u0022:true\u002c\u0022collapsedByDefault\u0022:false\u007d');
            window[viewModelInstance] = new this[viewModelName](savedOutput, config);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("ko1._Community_Grants_Administration"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(window[viewModelInstance], window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        </script><script type="text/javascript">
    
    // load dynamic models - usually objects in a list
            var Output_CommunityGrantsReporting_pestManagementRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.pestAnimalsTargetSpecies =  new SpeciesViewModel(data['pestAnimalsTargetSpecies'], speciesLists, {printable:''});
        };
        var Output_CommunityGrantsReporting_weedManagementRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.weedsTargetSpecies =  new SpeciesViewModel(data['weedsTargetSpecies'], speciesLists, {printable:''});
        };
        var speciesLists = [];
        var site = {};


    window["ViewModel"] = function (output, site, config) {
        var self = this;
        if (!output) {
            output = {};
        }
        var activityId = output.activityId || config.activityId || '';
        self.name = "";
        self.outputId = orBlank(output.outputId);

        self.data = {};
        self.transients = {};
        var notCompleted = output.outputNotCompleted;

        if (notCompleted === undefined) {
            notCompleted = config.collapsedByDefault;
        }

        self.transients.selectedSite = ko.observable(site);
        self.outputNotCompleted = ko.observable(notCompleted);
        self.transients.optional = config.optional || false;
        self.transients.questionText = config.optionalQuestionText || 'Not applicable';
        self.transients.dummy = ko.observable();

        self.downloadDataTemplate = function(listName) {
            var data = ko.mapping.toJS(self.data[listName](), {ignore:['transients']});
            var params = {
                listName:listName,
                type:self.name,
                data:JSON.stringify(data)
            };
            var url = '/activity/excelOutputTemplate';
            $.fileDownload(url, {
                httpMethod:'POST',
                data:params
            });

        };


        // add declarations for dynamic data
        
            self.data.areaRevegHa = ko.observable().extend({numericString:2});

            self.data.totalNumberPlanted = ko.observable().extend({numericString:2});

            self.data.totalSeedCollectedKg = ko.observable().extend({numericString:2});

            self.data.totalNumberGrown = ko.observable().extend({numericString:2});

            self.data.erosionAreaTreated = ko.observable().extend({numericString:2});

            self.data.erosionLength = ko.observable().extend({numericString:2});

            self.data.areaOfFireHa = ko.observable().extend({numericString:2});

            self.data.debrisVolumeM3 = ko.observable().extend({numericString:2});

            self.data.totalSeedSownKg = ko.observable().extend({numericString:2});

            self.data.totalAreaTreatedHa = ko.observable().extend({numericString:2});

            self.data.totalPestAnimalsTreatedNo = ko.observable().extend({numericString:2});

            self.data.pestManagement = ko.observableArray([]);
            self.selectedpestManagementRow = ko.observable();
        

            self.loadpestManagement = function (data, append) {
                if (!append) {
                    self.data.pestManagement([]);
                }
                if (data === undefined) {
                    self.addpestManagementRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.pestManagement.push(new Output_CommunityGrantsReporting_pestManagementRow(obj));
                    });
                }
            };
            self.downloadpestManagementTemplateWithData = function() {
                self.downloadDataTemplate('pestManagement');
            }

            self.addpestManagementRow = function () {
                var newRow = new Output_CommunityGrantsReporting_pestManagementRow();
                self.data.pestManagement.push(newRow);
                
            };
            self.removepestManagementRow = function (row) {
                self.data.pestManagement.remove(row);
                
            };
            self.pestManagementrowCount = function () {
                return self.data.pestManagement().length;
            };

            self.pestManagementTableDataUploadVisible = ko.observable(false);
            self.showpestManagementTableDataUpload = function() {
                self.pestManagementTableDataUploadVisible(!self.pestManagementTableDataUploadVisible());
            };

            self.templateDownloadUrl = function(type) {
                return '/proxy/excelOutputTemplate?listName=pestManagement&type=';
            }

            self.pestManagementTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadpestManagement(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "pestManagementtemplate-upload",
                    downloadTemplateId: "pestManagementtemplate-download",
                    formData:{type:'null', listName:'pestManagement'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.areaTreatedHa = ko.observable().extend({numericString:2});

            self.data.weedManagement = ko.observableArray([]);
            self.selectedweedManagementRow = ko.observable();
        

            self.loadweedManagement = function (data, append) {
                if (!append) {
                    self.data.weedManagement([]);
                }
                if (data === undefined) {
                    self.addweedManagementRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.weedManagement.push(new Output_CommunityGrantsReporting_weedManagementRow(obj));
                    });
                }
            };
            self.downloadweedManagementTemplateWithData = function() {
                self.downloadDataTemplate('weedManagement');
            }

            self.addweedManagementRow = function () {
                var newRow = new Output_CommunityGrantsReporting_weedManagementRow();
                self.data.weedManagement.push(newRow);
                
            };
            self.removeweedManagementRow = function (row) {
                self.data.weedManagement.remove(row);
                
            };
            self.weedManagementrowCount = function () {
                return self.data.weedManagement().length;
            };

            self.weedManagementTableDataUploadVisible = ko.observable(false);
            self.showweedManagementTableDataUpload = function() {
                self.weedManagementTableDataUploadVisible(!self.weedManagementTableDataUploadVisible());
            };

            self.templateDownloadUrl = function(type) {
                return '/proxy/excelOutputTemplate?listName=weedManagement&type=';
            }

            self.weedManagementTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadweedManagement(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "weedManagementtemplate-upload",
                    downloadTemplateId: "weedManagementtemplate-download",
                    formData:{type:'null', listName:'weedManagement'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.totalChangePracticeTreatedArea = ko.observable().extend({numericString:2});

            self.data.numberOfEvents = ko.observable().extend({numericString:2});

            self.data.numberOfPublications = ko.observable().extend({numericString:2});

            self.data.numberOfCommunityGroups = ko.observable().extend({numericString:2});

            self.data.entitiesAdoptingChange = ko.observable().extend({numericString:2});

            self.data.numberOfFarmingEntitiesNew = ko.observable().extend({numericString:2});

            self.data.numberOfIndigenousParticipants = ko.observable().extend({numericString:2});

            self.data.totalEmployees = ko.observable().extend({numericString:2});

            self.data.indigenousPlansCompleted = ko.observable().extend({numericString:2});

            self.data.indigenousProductsDeveloped = ko.observable().extend({numericString:2});

            self.data.datasetsShared = ko.observable().extend({numericString:2});

            self.data.indigenousKnowledgeTransferActionsNo = ko.observable().extend({numericString:2});

            self.data.conservationGrazingActionsArea = ko.observable().extend({numericString:2});

            self.data.managementPlansNo = ko.observable().extend({numericString:2});

            self.data.lengthOfFence = ko.observable().extend({numericString:2});

            self.data.otherOutputs = ko.observable();
            self.transients.site = site;

        // this will be called when generating a savable model to remove transient properties
        self.removeBeforeSave = function (jsData) {
            // add code to remove any transients added by the dynamic tags
                            delete jsData.selectedpestManagementRow;
                delete jsData.pestManagementTableDataUploadOptions
                delete jsData.pestManagementTableDataUploadVisible
                delete jsData.selectedweedManagementRow;
                delete jsData.weedManagementTableDataUploadOptions
                delete jsData.weedManagementTableDataUploadVisible

            delete jsData.activityType;
            delete jsData.transients;
            return jsData;
        };

        // this returns a JS object ready for saving
        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
            if (self.outputNotCompleted()) {
                jsData.data = {};
            }

            // get rid of any transient observables
            return self.removeBeforeSave(jsData);
        };

        // this is a version of toJSON that just returns the model as it will be saved
        // it is used for detecting when the model is modified (in a way that should invoke a save)
        // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.loadData = function (data, documents) {
            // load dynamic data
                            self.data['areaRevegHa'](orZero(data['areaRevegHa']));
                self.data['totalNumberPlanted'](orZero(data['totalNumberPlanted']));
                self.data['totalSeedCollectedKg'](orZero(data['totalSeedCollectedKg']));
                self.data['totalNumberGrown'](orZero(data['totalNumberGrown']));
                self.data['erosionAreaTreated'](orZero(data['erosionAreaTreated']));
                self.data['erosionLength'](orZero(data['erosionLength']));
                self.data['areaOfFireHa'](orZero(data['areaOfFireHa']));
                self.data['debrisVolumeM3'](orZero(data['debrisVolumeM3']));
                self.data['totalSeedSownKg'](orZero(data['totalSeedSownKg']));
                self.data['totalAreaTreatedHa'](orZero(data['totalAreaTreatedHa']));
                self.data['totalPestAnimalsTreatedNo'](orZero(data['totalPestAnimalsTreatedNo']));
                self.loadpestManagement(data.pestManagement);
                self.data['areaTreatedHa'](orZero(data['areaTreatedHa']));
                self.loadweedManagement(data.weedManagement);
                self.data['totalChangePracticeTreatedArea'](orZero(data['totalChangePracticeTreatedArea']));
                self.data['numberOfEvents'](orZero(data['numberOfEvents']));
                self.data['numberOfPublications'](orZero(data['numberOfPublications']));
                self.data['numberOfCommunityGroups'](orZero(data['numberOfCommunityGroups']));
                self.data['entitiesAdoptingChange'](orZero(data['entitiesAdoptingChange']));
                self.data['numberOfFarmingEntitiesNew'](orZero(data['numberOfFarmingEntitiesNew']));
                self.data['numberOfIndigenousParticipants'](orZero(data['numberOfIndigenousParticipants']));
                self.data['totalEmployees'](orZero(data['totalEmployees']));
                self.data['indigenousPlansCompleted'](orZero(data['indigenousPlansCompleted']));
                self.data['indigenousProductsDeveloped'](orZero(data['indigenousProductsDeveloped']));
                self.data['datasetsShared'](orZero(data['datasetsShared']));
                self.data['indigenousKnowledgeTransferActionsNo'](orZero(data['indigenousKnowledgeTransferActionsNo']));
                self.data['conservationGrazingActionsArea'](orZero(data['conservationGrazingActionsArea']));
                self.data['managementPlansNo'](orZero(data['managementPlansNo']));
                self.data['lengthOfFence'](orZero(data['lengthOfFence']));
                self.data['otherOutputs'](data['otherOutputs']);


            // if there is no data in tables then add an empty row for the user to add data
            if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                self.addRow();
            }
            self.transients.dummy.notifySubscribers();
        };

        self.attachDocument = function(target) {
            var url = config.documentUpdateUrl || fcConfig.documentUpdateUrl;
            showDocumentAttachInModal(url, new DocumentViewModel({role:'information', stage:config.stage},{activityId:activityId, projectId:config.projectId}), '#attachDocument')
                    .done(function(result) {
                        target(new DocumentViewModel(result))
                    });
        };
        self.editDocumentMetadata = function(document) {
            var url = (config.documentUpdateUrl || fcConfig.documentUpdateUrl) + "/" + document.documentId;
            showDocumentAttachInModal(url, document, '#attachDocument');
        };
        self.deleteDocument = function(document) {
            document.status('deleted');
            var url = (config.documentDeleteUrl || fcConfig.documentDeleteUrl)+'/'+document.documentId;
            $.post(url, {}, function() {});

        };
    };
</script><script type="text/javascript">
        $(function(){

            var viewModelName = "2._Community_Grants_ReportingViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var Output_CommunityGrantsReporting_pestManagementRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.pestAnimalsTargetSpecies =  new SpeciesViewModel(data['pestAnimalsTargetSpecies'], speciesLists, {printable:''});
        };
        var Output_CommunityGrantsReporting_weedManagementRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.weedsTargetSpecies =  new SpeciesViewModel(data['weedsTargetSpecies'], speciesLists, {printable:''});
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output, config) {
                var self = this;
                self.name = "2. Community Grants Reporting";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                var notCompleted = output.outputNotCompleted;

                if (notCompleted === undefined) {
                    notCompleted = config.collapsedByDefault;
                }
                self.transients.selectedSite = ko.observable(site);
                self.outputNotCompleted = ko.observable(notCompleted);
                self.transients.optional = config.optional || false;
                self.transients.questionText = config.optionalQuestionText || 'Not applicable';
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.areaRevegHa = ko.observable().extend({numericString:2});

            self.data.totalNumberPlanted = ko.observable().extend({numericString:2});

            self.data.totalSeedCollectedKg = ko.observable().extend({numericString:2});

            self.data.totalNumberGrown = ko.observable().extend({numericString:2});

            self.data.erosionAreaTreated = ko.observable().extend({numericString:2});

            self.data.erosionLength = ko.observable().extend({numericString:2});

            self.data.areaOfFireHa = ko.observable().extend({numericString:2});

            self.data.debrisVolumeM3 = ko.observable().extend({numericString:2});

            self.data.totalSeedSownKg = ko.observable().extend({numericString:2});

            self.data.totalAreaTreatedHa = ko.observable().extend({numericString:2});

            self.data.totalPestAnimalsTreatedNo = ko.observable().extend({numericString:2});

            self.data.pestManagement = ko.observableArray([]);
            self.selectedpestManagementRow = ko.observable();
        

            self.loadpestManagement = function (data, append) {
                if (!append) {
                    self.data.pestManagement([]);
                }
                if (data === undefined) {
                    self.addpestManagementRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.pestManagement.push(new Output_CommunityGrantsReporting_pestManagementRow(obj));
                    });
                }
            };
            self.downloadpestManagementTemplateWithData = function() {
                self.downloadDataTemplate('pestManagement');
            }

            self.addpestManagementRow = function () {
                var newRow = new Output_CommunityGrantsReporting_pestManagementRow();
                self.data.pestManagement.push(newRow);
                
            };
            self.removepestManagementRow = function (row) {
                self.data.pestManagement.remove(row);
                
            };
            self.pestManagementrowCount = function () {
                return self.data.pestManagement().length;
            };

            self.pestManagementTableDataUploadVisible = ko.observable(false);
            self.showpestManagementTableDataUpload = function() {
                self.pestManagementTableDataUploadVisible(!self.pestManagementTableDataUploadVisible());
            };

            self.templateDownloadUrl = function(type) {
                return '/proxy/excelOutputTemplate?listName=pestManagement&type=2.+Community+Grants+Reporting';
            }

            self.pestManagementTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadpestManagement(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "pestManagementtemplate-upload",
                    downloadTemplateId: "pestManagementtemplate-download",
                    formData:{type:'2. Community Grants Reporting', listName:'pestManagement'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.areaTreatedHa = ko.observable().extend({numericString:2});

            self.data.weedManagement = ko.observableArray([]);
            self.selectedweedManagementRow = ko.observable();
        

            self.loadweedManagement = function (data, append) {
                if (!append) {
                    self.data.weedManagement([]);
                }
                if (data === undefined) {
                    self.addweedManagementRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.weedManagement.push(new Output_CommunityGrantsReporting_weedManagementRow(obj));
                    });
                }
            };
            self.downloadweedManagementTemplateWithData = function() {
                self.downloadDataTemplate('weedManagement');
            }

            self.addweedManagementRow = function () {
                var newRow = new Output_CommunityGrantsReporting_weedManagementRow();
                self.data.weedManagement.push(newRow);
                
            };
            self.removeweedManagementRow = function (row) {
                self.data.weedManagement.remove(row);
                
            };
            self.weedManagementrowCount = function () {
                return self.data.weedManagement().length;
            };

            self.weedManagementTableDataUploadVisible = ko.observable(false);
            self.showweedManagementTableDataUpload = function() {
                self.weedManagementTableDataUploadVisible(!self.weedManagementTableDataUploadVisible());
            };

            self.templateDownloadUrl = function(type) {
                return '/proxy/excelOutputTemplate?listName=weedManagement&type=2.+Community+Grants+Reporting';
            }

            self.weedManagementTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadweedManagement(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "weedManagementtemplate-upload",
                    downloadTemplateId: "weedManagementtemplate-download",
                    formData:{type:'2. Community Grants Reporting', listName:'weedManagement'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.totalChangePracticeTreatedArea = ko.observable().extend({numericString:2});

            self.data.numberOfEvents = ko.observable().extend({numericString:2});

            self.data.numberOfPublications = ko.observable().extend({numericString:2});

            self.data.numberOfCommunityGroups = ko.observable().extend({numericString:2});

            self.data.entitiesAdoptingChange = ko.observable().extend({numericString:2});

            self.data.numberOfFarmingEntitiesNew = ko.observable().extend({numericString:2});

            self.data.numberOfIndigenousParticipants = ko.observable().extend({numericString:2});

            self.data.totalEmployees = ko.observable().extend({numericString:2});

            self.data.indigenousPlansCompleted = ko.observable().extend({numericString:2});

            self.data.indigenousProductsDeveloped = ko.observable().extend({numericString:2});

            self.data.datasetsShared = ko.observable().extend({numericString:2});

            self.data.indigenousKnowledgeTransferActionsNo = ko.observable().extend({numericString:2});

            self.data.conservationGrazingActionsArea = ko.observable().extend({numericString:2});

            self.data.managementPlansNo = ko.observable().extend({numericString:2});

            self.data.lengthOfFence = ko.observable().extend({numericString:2});

            self.data.otherOutputs = ko.observable();
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                                    delete jsData.selectedpestManagementRow;
                delete jsData.pestManagementTableDataUploadOptions
                delete jsData.pestManagementTableDataUploadVisible
                delete jsData.selectedweedManagementRow;
                delete jsData.weedManagementTableDataUploadOptions
                delete jsData.weedManagementTableDataUploadVisible

                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    if (self.outputNotCompleted()) {
                        jsData.data = {};
                    }
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.data['areaRevegHa'](orZero(data['areaRevegHa']));
                self.data['totalNumberPlanted'](orZero(data['totalNumberPlanted']));
                self.data['totalSeedCollectedKg'](orZero(data['totalSeedCollectedKg']));
                self.data['totalNumberGrown'](orZero(data['totalNumberGrown']));
                self.data['erosionAreaTreated'](orZero(data['erosionAreaTreated']));
                self.data['erosionLength'](orZero(data['erosionLength']));
                self.data['areaOfFireHa'](orZero(data['areaOfFireHa']));
                self.data['debrisVolumeM3'](orZero(data['debrisVolumeM3']));
                self.data['totalSeedSownKg'](orZero(data['totalSeedSownKg']));
                self.data['totalAreaTreatedHa'](orZero(data['totalAreaTreatedHa']));
                self.data['totalPestAnimalsTreatedNo'](orZero(data['totalPestAnimalsTreatedNo']));
                self.loadpestManagement(data.pestManagement);
                self.data['areaTreatedHa'](orZero(data['areaTreatedHa']));
                self.loadweedManagement(data.weedManagement);
                self.data['totalChangePracticeTreatedArea'](orZero(data['totalChangePracticeTreatedArea']));
                self.data['numberOfEvents'](orZero(data['numberOfEvents']));
                self.data['numberOfPublications'](orZero(data['numberOfPublications']));
                self.data['numberOfCommunityGroups'](orZero(data['numberOfCommunityGroups']));
                self.data['entitiesAdoptingChange'](orZero(data['entitiesAdoptingChange']));
                self.data['numberOfFarmingEntitiesNew'](orZero(data['numberOfFarmingEntitiesNew']));
                self.data['numberOfIndigenousParticipants'](orZero(data['numberOfIndigenousParticipants']));
                self.data['totalEmployees'](orZero(data['totalEmployees']));
                self.data['indigenousPlansCompleted'](orZero(data['indigenousPlansCompleted']));
                self.data['indigenousProductsDeveloped'](orZero(data['indigenousProductsDeveloped']));
                self.data['datasetsShared'](orZero(data['datasetsShared']));
                self.data['indigenousKnowledgeTransferActionsNo'](orZero(data['indigenousKnowledgeTransferActionsNo']));
                self.data['conservationGrazingActionsArea'](orZero(data['conservationGrazingActionsArea']));
                self.data['managementPlansNo'](orZero(data['managementPlansNo']));
                self.data['lengthOfFence'](orZero(data['lengthOfFence']));
                self.data['otherOutputs'](data['otherOutputs']);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === '2. Community Grants Reporting') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            var config = JSON.parse('\u007b\u0022outputName\u0022:\u00222. Community Grants Reporting\u0022\u002c\u0022optional\u0022:true\u002c\u0022collapsedByDefault\u0022:false\u007d');
            window[viewModelInstance] = new this[viewModelName](savedOutput, config);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("ko2._Community_Grants_Reporting"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(window[viewModelInstance], window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        </script><script type="text/javascript">
    
    // load dynamic models - usually objects in a list
            var speciesLists = [];
        var site = {};


    window["ViewModel"] = function (output, site, config) {
        var self = this;
        if (!output) {
            output = {};
        }
        var activityId = output.activityId || config.activityId || '';
        self.name = "";
        self.outputId = orBlank(output.outputId);

        self.data = {};
        self.transients = {};
        var notCompleted = output.outputNotCompleted;

        if (notCompleted === undefined) {
            notCompleted = config.collapsedByDefault;
        }

        self.transients.selectedSite = ko.observable(site);
        self.outputNotCompleted = ko.observable(notCompleted);
        self.transients.optional = config.optional || false;
        self.transients.questionText = config.optionalQuestionText || 'Not applicable';
        self.transients.dummy = ko.observable();

        self.downloadDataTemplate = function(listName) {
            var data = ko.mapping.toJS(self.data[listName](), {ignore:['transients']});
            var params = {
                listName:listName,
                type:self.name,
                data:JSON.stringify(data)
            };
            var url = '/activity/excelOutputTemplate';
            $.fileDownload(url, {
                httpMethod:'POST',
                data:params
            });

        };


        // add declarations for dynamic data
        
            self.data.supportingDocs1 = ko.observable();

            self.data.supportingDocs2 = ko.observable();

            self.data.supportingDocs3 = ko.observable();

            self.data.additionalInfo1 = ko.observable();

            self.data.additionalInfo2 = ko.observable();

            self.data.additionalInfo3 = ko.observable();
            self.transients.site = site;

        // this will be called when generating a savable model to remove transient properties
        self.removeBeforeSave = function (jsData) {
            // add code to remove any transients added by the dynamic tags
                            if (jsData.data && jsData.data.supportingDocs1) { jsData.data.supportingDocs1 = jsData.data.supportingDocs1.documentId; }                if (jsData.data && jsData.data.supportingDocs2) { jsData.data.supportingDocs2 = jsData.data.supportingDocs2.documentId; }                if (jsData.data && jsData.data.supportingDocs3) { jsData.data.supportingDocs3 = jsData.data.supportingDocs3.documentId; }                if (jsData.data && jsData.data.additionalInfo1) { jsData.data.additionalInfo1 = jsData.data.additionalInfo1.documentId; }                if (jsData.data && jsData.data.additionalInfo2) { jsData.data.additionalInfo2 = jsData.data.additionalInfo2.documentId; }                if (jsData.data && jsData.data.additionalInfo3) { jsData.data.additionalInfo3 = jsData.data.additionalInfo3.documentId; }
            delete jsData.activityType;
            delete jsData.transients;
            return jsData;
        };

        // this returns a JS object ready for saving
        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
            if (self.outputNotCompleted()) {
                jsData.data = {};
            }

            // get rid of any transient observables
            return self.removeBeforeSave(jsData);
        };

        // this is a version of toJSON that just returns the model as it will be saved
        // it is used for detecting when the model is modified (in a way that should invoke a save)
        // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.loadData = function (data, documents) {
            // load dynamic data
                            var doc = findDocumentById(documents, data['supportingDocs1']);
                if (doc) {
                                self.data['supportingDocs1'](new DocumentViewModel(doc));
                }
                var doc = findDocumentById(documents, data['supportingDocs2']);
                if (doc) {
                                self.data['supportingDocs2'](new DocumentViewModel(doc));
                }
                var doc = findDocumentById(documents, data['supportingDocs3']);
                if (doc) {
                                self.data['supportingDocs3'](new DocumentViewModel(doc));
                }
                var doc = findDocumentById(documents, data['additionalInfo1']);
                if (doc) {
                                self.data['additionalInfo1'](new DocumentViewModel(doc));
                }
                var doc = findDocumentById(documents, data['additionalInfo2']);
                if (doc) {
                                self.data['additionalInfo2'](new DocumentViewModel(doc));
                }
                var doc = findDocumentById(documents, data['additionalInfo3']);
                if (doc) {
                                self.data['additionalInfo3'](new DocumentViewModel(doc));
                }


            // if there is no data in tables then add an empty row for the user to add data
            if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                self.addRow();
            }
            self.transients.dummy.notifySubscribers();
        };

        self.attachDocument = function(target) {
            var url = config.documentUpdateUrl || fcConfig.documentUpdateUrl;
            showDocumentAttachInModal(url, new DocumentViewModel({role:'information', stage:config.stage},{activityId:activityId, projectId:config.projectId}), '#attachDocument')
                    .done(function(result) {
                        target(new DocumentViewModel(result))
                    });
        };
        self.editDocumentMetadata = function(document) {
            var url = (config.documentUpdateUrl || fcConfig.documentUpdateUrl) + "/" + document.documentId;
            showDocumentAttachInModal(url, document, '#attachDocument');
        };
        self.deleteDocument = function(document) {
            document.status('deleted');
            var url = (config.documentDeleteUrl || fcConfig.documentDeleteUrl)+'/'+document.documentId;
            $.post(url, {}, function() {});

        };
    };
</script><script type="text/javascript">
        $(function(){

            var viewModelName = "AttachmentsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output, config) {
                var self = this;
                self.name = "Attachments";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                var notCompleted = output.outputNotCompleted;

                if (notCompleted === undefined) {
                    notCompleted = config.collapsedByDefault;
                }
                self.transients.selectedSite = ko.observable(site);
                self.outputNotCompleted = ko.observable(notCompleted);
                self.transients.optional = config.optional || false;
                self.transients.questionText = config.optionalQuestionText || 'Not applicable';
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.supportingDocs1 = ko.observable();

            self.data.supportingDocs2 = ko.observable();

            self.data.supportingDocs3 = ko.observable();

            self.data.additionalInfo1 = ko.observable();

            self.data.additionalInfo2 = ko.observable();

            self.data.additionalInfo3 = ko.observable();
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                                    if (jsData.data && jsData.data.supportingDocs1) { jsData.data.supportingDocs1 = jsData.data.supportingDocs1.documentId; }                if (jsData.data && jsData.data.supportingDocs2) { jsData.data.supportingDocs2 = jsData.data.supportingDocs2.documentId; }                if (jsData.data && jsData.data.supportingDocs3) { jsData.data.supportingDocs3 = jsData.data.supportingDocs3.documentId; }                if (jsData.data && jsData.data.additionalInfo1) { jsData.data.additionalInfo1 = jsData.data.additionalInfo1.documentId; }                if (jsData.data && jsData.data.additionalInfo2) { jsData.data.additionalInfo2 = jsData.data.additionalInfo2.documentId; }                if (jsData.data && jsData.data.additionalInfo3) { jsData.data.additionalInfo3 = jsData.data.additionalInfo3.documentId; }
                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    if (self.outputNotCompleted()) {
                        jsData.data = {};
                    }
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    var doc = findDocumentById(documents, data['supportingDocs1']);
                if (doc) {
                                self.data['supportingDocs1'](new DocumentViewModel(doc));
                }
                var doc = findDocumentById(documents, data['supportingDocs2']);
                if (doc) {
                                self.data['supportingDocs2'](new DocumentViewModel(doc));
                }
                var doc = findDocumentById(documents, data['supportingDocs3']);
                if (doc) {
                                self.data['supportingDocs3'](new DocumentViewModel(doc));
                }
                var doc = findDocumentById(documents, data['additionalInfo1']);
                if (doc) {
                                self.data['additionalInfo1'](new DocumentViewModel(doc));
                }
                var doc = findDocumentById(documents, data['additionalInfo2']);
                if (doc) {
                                self.data['additionalInfo2'](new DocumentViewModel(doc));
                }
                var doc = findDocumentById(documents, data['additionalInfo3']);
                if (doc) {
                                self.data['additionalInfo3'](new DocumentViewModel(doc));
                }


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Attachments') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            var config = JSON.parse('\u007b\u0022outputName\u0022:\u0022Attachments\u0022\u002c\u0022optional\u0022:false\u002c\u0022collapsedByDefault\u0022:false\u007d');
            window[viewModelInstance] = new this[viewModelName](savedOutput, config);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koAttachments"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(window[viewModelInstance], window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        </script><script type="text/javascript">


    /* Master controller for page. This handles saving each model as required. */
    var Master = function () {
        var self = this;
        this.subscribers = [];
        // client models register their name and methods to participate in saving
        self.register = function (modelInstanceName, getMethod, isDirtyMethod, resetMethod) {
            this.subscribers.push({
                model: modelInstanceName,
                get: getMethod,
                isDirty: isDirtyMethod,
                reset: resetMethod
            });
        };
        // master isDirty flag for the whole page - can control button enabling
        this.isDirty  = function () {
            var dirty = false;
            $.each(this.subscribers, function(i, obj) {
                dirty = dirty || obj.isDirty();
            });
            return dirty;
        };

        this.validate = function() {
            var valid = $('#validation-container').validationEngine('validate');
            if (valid) {
                // Check that forms with multiple optional sections have at least one of those sections completed.
                var optionalCount = 0;
                var notCompletedCount = 0;
                $.each(self.subscribers, function(i, obj) {
                    if (obj.model !== 'activityModel' && obj.model !== 'photoPoints') {
                        if (obj.model.transients.optional) {
                            optionalCount++;
                            if (obj.model.outputNotCompleted()) {
                                notCompletedCount++;
                            }
                        }
                    }
                });
                if (optionalCount > 1 && notCompletedCount == optionalCount) {
                   valid = false;
                   bootbox.alert("<p>To 'Save changes', the mandatory fields of at least one section of this form must be completed.</p>"+
                        "<p>If all sections are 'Not applicable' please contact your grant manager to discuss alternate form options</p>");
                }
            }

            return valid;
        };
        /**
         * Makes an ajax call to save any sections that have been modified. This includes the activity
         * itself and each output.
         *
         * Modified outputs are injected as a list into the activity object. If there is nothing to save
         * in the activity itself, then the root is an object that is empty except for the outputs list.
         *
         * NOTE that the model for each section must register itself to be included in this save.
         *
         * Validates the entire page before saving.
         * @return -1 if the page was not modified, 0 if validation failed, 1 if validation succeeded (or was not requested).
         */
        this.save = function (validate) {
            // Ensure any active change is committed - the knockout binding typically fires on blur.
            $( document.activeElement ).blur();

            if (validate === undefined) {
                validate = true;
            }
            var activityData, outputs = [];

            var success = true;
            if (validate) {
                success = self.validate();
            }
            if (!self.isDirty()) {
                mobileBindings.onSaveActivity(-1, null);
                return -1;
            }
            if (success) {
                $.each(this.subscribers, function(i, obj) {
                    if (obj.model === 'activityModel') {
                        activityData = obj.get();
                    } else {
                        outputs.push(obj.get());
                    }
                });

                if (activityData === undefined) { activityData = {}}
                activityData.outputs = outputs;

                var toSave = JSON.stringify(activityData);
                mobileBindings.onSaveActivity(1, toSave);

            }
            else {
                mobileBindings.onSaveActivity(0, null);
            }
            return success?1:0;
        };

        this.reset = function () {
            $.each(this.subscribers, function(i, obj) {
                if (obj.isDirty()) {
                    obj.reset();
                }
            });
        };

        this.addSite = function(site) {
            var viewModel = ko.dataFor(document.getElementById('site'));
            viewModel.transients.sites.push(site);
            viewModel.siteId(site.siteId);
        }
    };

    if (mobileBindings == undefined) {
        var mobileBindings = {
        
            loadActivity:function(){return "{}"},
        
        
            loadSites:function(){return "[]"},
        
        
            loadThemes:function(){return "[]"},
        

        supportsNewSite:function() { return true; },
        onSaveActivity:function(){},
        createNewSite:function(){}
    };
}
var master = new Master();
var activity = JSON.parse(mobileBindings.loadActivity());
var sites = JSON.parse(mobileBindings.loadSites());
var themes = JSON.parse(mobileBindings.loadThemes());

$(function(){

var scroll = false;

    scroll = true;

$('#validation-container').validationEngine('attach', {scroll: scroll});

$('.helphover').popover({animation: true, trigger:'hover'});

$('#reset').click(function () {
master.reset();
});

function ViewModel (act, sites, themes) {
var self = this;
var today = new Date().toISOStringNoMillis();

self.activityId = act.activityId;
self.description = ko.observable(act.description);
self.notes = ko.observable(act.notes);
self.startDate = ko.observable(act.startDate || today).extend({simpleDate: false});
self.endDate = ko.observable(act.endDate).extend({simpleDate: false});
self.plannedStartDate = ko.observable(act.plannedStartDate).extend({simpleDate: false});
self.plannedEndDate = ko.observable(act.plannedEndDate).extend({simpleDate: false});
self.eventPurpose = ko.observable(act.eventPurpose);
self.fieldNotes = ko.observable(act.fieldNotes);
self.associatedProgram = ko.observable(act.associatedProgram);
self.associatedSubProgram = ko.observable(act.associatedSubProgram);
self.progress = ko.observable(act.progress);
self.mainTheme = ko.observable(act.mainTheme);
self.type = ko.observable(act.type);
self.siteId = ko.observable(act.siteId);
self.projectId = act.projectId;
self.transients = {};
self.transients.sites = ko.observableArray(sites);
self.transients.photoPoints = ko.computed(function() {
    var site = $.grep(self.transients.sites(), function(site, index) { return site.siteId == self.siteId(); })[0];
     if (site) {
         return site.photoPoints ? site.photoPoints : site.poi;
     }
     return [];
});
self.transients.activityProgressValues = ['planned','started','finished'];
self.transients.themes = themes?themes:[];
self.transients.markedAsFinished = ko.observable(act.progress === 'finished');
self.transients.markedAsFinished.subscribe(function (finished) {
    self.progress(finished ? 'finished' : 'started');
    if (finished || !self.endDate()) {
        self.endDate(today);
    }
});
self.transients.siteImgUrl = ko.computed(function() {
    if (self.siteId()) {
         var site = $.grep(self.transients.sites(), function(site, index) { return site.siteId == self.siteId(); })[0];
         if (site) {
            var lat,lon;
            if (site.centroidLat !== undefined && site.centroidLon !== undefined) {
                lat = site.centroidLat;
                lon = site.centroidLon;
            }
            else if (site.extent && site.extent.geometry && site.extent.geometry.centre) {
                lat = site.extent.geometry.centre[1];
                lon = site.extent.geometry.centre[0];
            }
            if (lat !== undefined && lon !== undefined) {
                $('#siteLocationImage').show();
                return fcConfig.googleStaticUrl+lat+","+lon;
            }
         }
    }
    return "";
});
self.siteLoadError = function(data, event) {
    $('#siteLocationImage').hide();
};

self.transients.newSiteSupported = ko.observable( mobileBindings.supportsNewSite());

self.modelForSaving = function () {
    // get model as a plain javascript object
    var jsData = ko.toJS(self);
    delete jsData.transients;
    return jsData;
};
self.modelAsJSON = function () {
    return JSON.stringify(self.modelForSaving());
};

self.save = function (callback, key) {
};

self.createNewSite = function() {
    mobileBindings.createNewSite();
}

self.notImplemented = function () {
    alert("Not implemented yet.")
};

self.attachPhotoPoint = function(e) {
    console.log(e);
};
self.dirtyFlag = ko.dirtyFlag(self, false);

// make sure progress moves to started if we save any data (unless already finished)
// (do this here so the model becomes dirty)
self.progress(self.transients.markedAsFinished() ? 'finished' : 'started');
}


var viewModel = new ViewModel(activity, sites, themes);

ko.applyBindings(viewModel);

master.register('activityModel', viewModel.modelForSaving, viewModel.dirtyFlag.isDirty, viewModel.dirtyFlag.reset);


// Workaround for Android bug 6721 - prevents components under the datepicker from receiving clicks on the datepicker.
var disabled = null;
$('[data-bind^=datepicker]').datepicker().on('show', function() {
    if (disabled == null) {
        disabled = $("input:enabled, select:enabled, button:enabled");
        disabled.prop('disabled', true);
    }
});
$('[data-bind^=datepicker]').datepicker().on('hide', function() {
    if (disabled !== null) {
        disabled.prop('disabled', false);
        disabled = null;
    }
});

});


</script>
</body>
</html>
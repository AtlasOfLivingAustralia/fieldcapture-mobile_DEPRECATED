

<!DOCTYPE html>
<head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <style type="text/css">
        input[type=checkbox] {
            -webkit-transform: scale(1.5); margin:50px;
        }
    </style>
    
    <script src="static/UGoJGyG3j2UCffTg3vnOdi0FsnS2OvrmrsZD6WxaXGy.js" type="text/javascript" ></script>
<link href="static/Eu8FNKwJJQI8mVJO3VIshatRN1bunflYHvvdqk06tbf.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="static/090onaZX1M508oSWqGmMeETZ9NkUA9p4CCTW3MUpRPc.css" type="text/css" rel="stylesheet" media="screen, projection" />

<link href="static/CidRUyEAqkZsnDRPRiaGZBy7vd4DOlnRqweu4CsVcIG.css" type="text/css" rel="stylesheet" media="screen" />
<link href="static/tDKPE9VWZfBnSnxBkPC52ml2dXticvlQDl9aR8VpM2o.css" type="text/css" rel="stylesheet" media="screen, projection" />
<!--[if lt IE 7]><link href="static/v1vjA9BeNpSU8cuoTuVhTEUm6boSzwYQcgfPKKMkqgv.css" type="text/css" rel="stylesheet" media="screen, projection" /><![endif]-->

<link href="http://www.ala.org.au/wp-content/themes/ala2011/images/favicon.ico" rel="shortcut icon" />
<!--[if lt IE 9]><script src="static/Yh1Txee3hFzExJ4P1str7tGV24zQMEYtxqtlYJ5ukR0.js" type="text/javascript" ></script><![endif]-->
<link href="static/6tuLClj7N5eYCZpx7vLn8juIbQUXBkCnWRUJFY7UDCz.css" type="text/css" rel="stylesheet" media="screen,print" />
<link href="/static/7ARiB2rJgSkfi68hxnSlcG9Ot0gQ863DYxkCmSHQweE.png" rel="shortcut icon" />
<link href="/static/14SWTr4VqVh6tnlUlgBtue6IJZ7gwE1y42RT7ya5GGW.png" rel="shortcut icon" />

<link href="static/KYGDEVRRaKjNbTXJkHmicmzo9vFrnnzCnGLcxKjR04f.css" type="text/css" rel="stylesheet" media="screen,print" />

<link href="static/uUQBvO5ITMKwLfoRb2u62GbHXEzxtsbrSWq8MBAOrbX.css" type="text/css" rel="stylesheet" media="screen,print" />
<link href="static/2OXdKoom668LE7PLl0qjJCaLG7Pu7Jv869tAsS4e1oT.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="static/AcXIjLTuc87n8sfxBjJRQSoBIUwP9RnCyK8Sv82i7eV.css" type="text/css" rel="stylesheet" media="screen, projection" />
<script type="text/javascript">
    var fcConfig = {
        serverUrl: "https://fieldcapture-test.ala.org.au",
        activityUpdateUrl: "/activity/ajaxUpdate",
        activityDeleteUrl: "/activity/ajaxDelete",
        projectViewUrl: "/project/index/",
        siteViewUrl: "/site/index/",
        bieUrl: "http://bie.ala.org.au",
        speciesProfileUrl: "/proxy/speciesProfile"
        },
        here = document.location.href;
    </script>
    

    <meta name="layout" content="mobile"/>

    
    

</head>

<body>

<div id="content" class="clearfix">
    
<div class="container-fluid validationEngineContainer" id="validation-container">
<div id="koActivityMainBlock">

    <div class="row-fluid">
        <div class="span12">
            <!-- Common activity fields -->

            <div class="row-fluid space-after">
                <div class="span4">

                    <label class="for-readonly">Type</label>
                    <span class="readonly-text" data-bind="text:type"></span>
                </div>
                <div class="span8">

                    <label class="for-readonly">Description</label>
                    <span class="readonly-text" data-bind="text:description"></span>
                </div>
            </div>


            <div class="row-fluid space-after">
                <div class="span4">
                    <label class="for-readonly inline">Planned start date</label>
                    <span class="readonly-text" data-bind="text:plannedStartDate.formattedDate"></span>
                </div>
                <div class="span8">
                    <label class="for-readonly inline">Planned end date</label>
                    <span class="readonly-text" data-bind="text:plannedEndDate.formattedDate"></span>
                </div>
            </div>

            <div class="well">

            <div class="row-fluid space-after">
                <div class="span4 required">
                    <label for="startDate"><b>Actual start date</b>
                        <a href='#' class='helphover' data-original-title='Start date' data-placement='top' data-content='Date the activity was started.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a>
                    </label>


                    <div class="input-append">
                        <input data-bind='datepicker:startDate.date' name='startDate' id='startDate' type='text' size='16' class='input-xlarge' targetField='startDate.date' data-validation-engine='validate[required]' />
<span class='add-on open-datepicker'>
  <i class='icon-th'>&nbsp;</i>
</span>
                    </div>

                </div>
                <div class="span8 required">
                    <label for="endDate"><b>Actual end date</b>
                        <a href='#' class='helphover' data-original-title='End date' data-placement='top' data-content='Date the activity finished.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a>
                    </label>

                    <div class="input-append">
                        <input data-bind='datepicker:endDate.date' name='endDate' id='endDate' type='text' size='16' class='input-xlarge' targetField='endDate.date' data-validation-engine='validate[future[startDate]]' />
<span class='add-on open-datepicker'>
  <i class='icon-th'>&nbsp;</i>
</span>
                    </div>

                </div>
            </div>
            <div class="row-fluid space-after">
                <div class="span6">
                    <label for="theme"><b>Major theme</b></label>
                    <select id="theme" data-bind="value:mainTheme, options:transients.themes, optionsCaption:'Choose..'" class="input-xlarge">
                    </select>
                </div>

            </div>
            <div class="row-fluid">
                <div class="span4">
                    <label for="site"><b>Site</b></label>
                    <select id='site' width='100%' data-bind='options:transients.sites,optionsText:"name",optionsValue:"siteId",value:siteId,optionsCaption:"Choose a site..."'>&nbsp;</select>

                    <br/>Leave blank if this activity is not associated with a specific site.

                </div>

                <div class="span2">
                    <button class="btn btn-info" data-bind="click:createNewSite">Create new Site</button>
                </div>

                <div class="span6">
                    <img width="250" height="200" data-bind="attr:{src:transients.siteImgUrl}"/>
                </div>


            </div>
            </div>
        </div>
    </div>

</div>

<!-- ko stopBinding: true -->

    
    
    
    <div class="output-block" id="koLessons_Learned">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Lessons Learned<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after output-section" >
<div class="span12">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Describe the effectiveness of the project and whether it delivered what was intended:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Discussion of the assumptions and project design. Did the project implementation happen as it was planned/envisaged?'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span8" data-bind='value:data.assumptions'></textarea></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Discuss the effectiveness of your approach to managing project risks:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Discussion on whether the project risks impacted the project outcomes, or whether the controls to mitigate them were acceptable.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span8" data-bind='value:data.projectRiskManagement'></textarea></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>What other lessons did you or your organisation learn while undertaking this project?:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Description of other lessons learnt from the project and how they may be applied to other projects in the future.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span8" data-bind='value:data.projectLessons'></textarea></span></div></div></div>

        
    </div>

    
    
    <style type="text/css">
        table.themeOne td:last-child {width:4%;text-align:center;}
        table.themeOne textarea {width:98%;}
    </style><style type="text/css">
        table.themeTwo td:last-child {width:4%;text-align:center;}
        table.themeTwo textarea {width:98%;}
    </style>
    <div class="output-block" id="koBiodiversity_Fund_Outcomes_&_Monitoring_Methodology">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Biodiversity Fund Outcomes & Monitoring Methodology<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after " >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span8"><h4>Theme 1 - Establish new areas of native vegetation</h4></span></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Output target for Theme 1 area to be established:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Output target for Theme 1 area to be revegetated in hectares'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.targetT1Area' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div></div><div class="row-fluid output-section">
            <table class="table table-bordered themeOne " >
                <thead><tr><th>Site Name:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Name of the site being monitored'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Vegetation Description:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Description of the vegetation on the site being monitored'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Vegetation Current Condition:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Description of the current condition of vegetation on the site being monitored'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Vegetation Intended Condition:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Description of the intended condition of vegetation on the site being monitored'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Assessment Methodology:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Methodology being used to assess condition change on the site being monitored'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'themeOneviewTmpl', foreach: data.themeOne}"></tbody>
                <script id="themeOneviewTmpl" type="text/html"><tr>
                    <td><input  class="input-small" data-bind='value:siteName1'  type='text' class='input-small'/></td>
                    <td><textarea  data-bind='value:vegetationDescription1'></textarea></td>
                    <td><textarea  data-bind='value:vegetationCurrentCondition1'></textarea></td>
                    <td><textarea  data-bind='value:vegetationIntendedCondition1'></textarea></td>
                    <td><select data-bind='value:assessmentMethodology1,options:transients.assessmentMethodology1Constraints,optionsCaption:"Please select"'></select></td>
                    <td><i data-bind='click:$root.removethemeOneRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr><td colspan="0" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addthemeOneRow">
                        <i class="icon-plus"></i> Add a row</button>
                        <button type="button" class="btn btn-small" data-bind="click:showthemeOneTableDataUpload"><i class="icon-upload"></i> Upload data for this table</button>


                    </td></tr>
<tr data-bind="visible:themeOneTableDataUploadVisible"><td colspan="0">
                <div class="text-error text-left">
                    Note: Only valid exact scientific names will be matched and populated from the database (indicated by a green tick). Unmatched species will load, but will be indicated by a green <b>?</b>. Please check your uploaded data and correct as required.
                </div>
                <div class="text-left" style="margin:5px">
                    <a href="/proxy/excelOutputTemplate?type=Biodiversity Fund Outcomes & Monitoring Methodology&listName=themeOne" target="themeOneTemplateDownload" class="btn">Step 1 - Download template (.xlsx)</a>
                </div>
                <div class="text-left" style="margin:5px;">
                    <input type="checkbox" data-bind="checked:appendTableRows" style="margin-right:5px">Append uploaded data to table (unticking this checkbox will result in all table rows being replaced)
                </div>

                <div class="btn fileinput-button" style="margin-left:5px">
                        <input id="themeOneTableDataUpload" type="file" name="data" data-bind="fileUploadNoImage:themeOneTableDataUploadOptions">
                        Step 2 - Upload populated template
                </div>

                    </td></tr> <script id="themeOnetemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="themeOnetemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>
</div>
<div class="row-fluid space-after " >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span8"><h4>Theme 2 - Enhance existing areas of native vegetation</h4></span></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Output target for Theme 2 area to be enhanced:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Output target for Theme 2 area to be revegetated in hectares'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.targetT2Area' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div></div><div class="row-fluid output-section">
            <table class="table table-bordered themeTwo " >
                <thead><tr><th>Site Name:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Name of the site being monitored'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Vegetation Description:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Description of the vegetation on the site being monitored'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Vegetation Current Condition:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Description of the current condition of vegetation on the site being monitored'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Vegetation Intended Condition:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Description of the intended condition of vegetation on the site being monitored'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Assessment Methodology:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Methodology being used to assess condition change on the site being monitored'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'themeTwoviewTmpl', foreach: data.themeTwo}"></tbody>
                <script id="themeTwoviewTmpl" type="text/html"><tr>
                    <td><input  class="input-small" data-bind='value:siteName2'  type='text' class='input-small'/></td>
                    <td><textarea  data-bind='value:vegetationDescription2'></textarea></td>
                    <td><textarea  data-bind='value:vegetationCurrentCondition2'></textarea></td>
                    <td><textarea  data-bind='value:vegetationIntendedCondition2'></textarea></td>
                    <td><select data-bind='value:assessmentMethodology2,options:transients.assessmentMethodology2Constraints,optionsCaption:"Please select"'></select></td>
                    <td><i data-bind='click:$root.removethemeTwoRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr><td colspan="0" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addthemeTwoRow">
                        <i class="icon-plus"></i> Add a row</button>
                        <button type="button" class="btn btn-small" data-bind="click:showthemeTwoTableDataUpload"><i class="icon-upload"></i> Upload data for this table</button>


                    </td></tr>
<tr data-bind="visible:themeTwoTableDataUploadVisible"><td colspan="0">
                <div class="text-error text-left">
                    Note: Only valid exact scientific names will be matched and populated from the database (indicated by a green tick). Unmatched species will load, but will be indicated by a green <b>?</b>. Please check your uploaded data and correct as required.
                </div>
                <div class="text-left" style="margin:5px">
                    <a href="/proxy/excelOutputTemplate?type=Biodiversity Fund Outcomes & Monitoring Methodology&listName=themeTwo" target="themeTwoTemplateDownload" class="btn">Step 1 - Download template (.xlsx)</a>
                </div>
                <div class="text-left" style="margin:5px;">
                    <input type="checkbox" data-bind="checked:appendTableRows" style="margin-right:5px">Append uploaded data to table (unticking this checkbox will result in all table rows being replaced)
                </div>

                <div class="btn fileinput-button" style="margin-left:5px">
                        <input id="themeTwoTableDataUpload" type="file" name="data" data-bind="fileUploadNoImage:themeTwoTableDataUploadOptions">
                        Step 2 - Upload populated template
                </div>

                    </td></tr> <script id="themeTwotemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="themeTwotemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>
</div>
<div class="row-fluid space-after output-section" >
<div class="span12">
<div class="row-fluid"><span class="span12">    <span  class="span8"><h4>Output Targets for Theme 3 - Managing Invasive Species</h4></span></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Area to be managed for invasive species (Ha):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Output target for Theme 3 area to be managed for invasive species in hectares'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.targetT3Area' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Weed and nvasive pest species being managed:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='List of Invasive species being targeted for management in the project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span8" data-bind='value:data.targetT3Species'></textarea></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Expected outcomes from weed and invasive pest management activities:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Outcomes expected to be achieved through treatment of weeds and invasive species'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span8" data-bind='value:data.targetT3Outcomes'></textarea></span></div></div></div>
<div class="row-fluid space-after output-section" >
<div class="span12">
<div class="row-fluid"><span class="span12">    <span  class="span8"><h4>Output Targets for items which cannot be placed into one of the above Themes</h4></span></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Total No. of Plants to be Planted:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Output target for the total number of plants to be planted for the whole project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.targetT4TotalPlants' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Total Seed to be Sown (Kg):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Output target for the total kilograms of seed to be sown for the whole project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.targetT4TotalSeed' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Target ave. Survival Rate for Plantings:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Output target for the average percentage survival rate for plants planted for the whole project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.targetT4PlantSurvival' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Canopy layer species to be planted:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='List of canopy species to be planted for the whole project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span8" data-bind='value:data.targetT4CanopySpecies'></textarea></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Understorey species to be planted:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='List of understorey species to be planted for the whole project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span8" data-bind='value:data.targetT4UnderstoreySpecies'></textarea></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Ground layer species to be planted:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='List of ground layer species to be planted for the whole project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span8" data-bind='value:data.targetT4GroundSpecies'></textarea></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Length of fence to be erected (Km):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Output target for the length of fence to be erected for the whole project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.targetT4TotalFenceKm' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>General Outcomes:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Description of general outcomes expected to be achieved across the whole project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span8" data-bind='value:data.targetT3GeneralOutcomes1'></textarea></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>More General Outcomes:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Description of general outcomes expected to be achieved across the whole project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span8" data-bind='value:data.targetT3GeneralOutcomes2'></textarea></span></div></div></div>

        
    </div>

    
    
    
    <div class="output-block" id="koEvaluation">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Evaluation<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after output-section" >
<div class="span12">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Describe the effectiveness of the project and whether it delivered what was intended:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Description of the effectiveness of the project. Did it deliver what was intended to be delivered? Did it meet, exceed or fall short of expectations? Definition: A measure of the extent to which a program, project or initiative has attained, or is expected to attain, its relevant objectives efficiently and in a sustainable way.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span8" data-bind='value:data.projectEffectiveness'></textarea></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Describe the impact of the project:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Description of the impacts of the project. Definition: A change in the condition of biophysical, social or economic and/or institutional assets. An impact may be positive or negative, primary or secondary, short term or long term, direct or indirect, and/or intended or unintended. Impacts are sometime realised after the formal project is completed. '>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span8" data-bind='value:data.projectImpact'></textarea></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Describe the efficiency of the delivery mechanism(s) for the project the project:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Description of how efficient the project was in terms of cost vs. outcomes, time vs. outcomes, etc. Definition: The notion of getting the highest value out of program or project resources.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span8" data-bind='value:data.projectEfficiency'></textarea></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Describe the appropriateness of the methodology(s) used.<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Description of the appropriateness of the methodology used for the project. Was it the right methodology? In hindsight, was there a better methodology available that wasn&apos;t used for some reason - explain? Definition: A determination made through comparing the program with the needs of the intended beneficiaries using any of the techniques of needs analysis. Alternatively, the program could be evaluated in terms of its compliance with process.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span8" data-bind='value:data.methodologyAppropriateness'></textarea></span></div></div></div>

        
    </div>

    
    
    <style type="text/css">
        table.adminActions td:nth-child(1) {width:25%;}
        table.adminActions td:nth-child(1) select {width:100%;}
        table.adminActions td:nth-child(2) {width:10%;text-align:center;}
        table.adminActions td:nth-child(2) select {width:100%;}
        table.adminActions td:nth-child(3) {width:10%;text-align:center;}
        table.adminActions td:nth-child(3) select {width:100%;}
        table.adminActions td:nth-child(4) {width:10%;text-align:center;}
        table.adminActions td:nth-child(4) select {width:100%;}
        table.adminActions td:last-child {width:4%;text-align:center;}
        table.adminActions textarea {width:98%;}
    </style>
    <div class="output-block" id="koAdministration_Activities">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Administration Activities<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after " >
<span class="span12">    <span  class="span12">Please list the numbers of people involved in undertaking each relevant type of administration activity and the average time spent per person:</span></span></div>
<div class="row-fluid output-section">
            <table class="table table-bordered adminActions " >
                <thead><tr><th class="required">Type of administration activity:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The type of administration activity undertaken. Add more rows for different admin activities as required.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th class="required">No. of people:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Number of people involved in the administration activity. An individual can be involved in more than one activity.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th class="required">Ave. time per person (Hrs):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The average number of hours per person spent on each administration activity'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Ave. total time spent (Hrs):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The total estimated person hours spent on each administration activity.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'adminActionsviewTmpl', foreach: data.adminActions}"></tbody>
                <script id="adminActionsviewTmpl" type="text/html"><tr>
                    <td><select data-bind='value:adminActionType,options:transients.adminActionTypeConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:numberInvolved' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:hoursPerPerson' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><span  data-bind='text:hoursActionTotal'></span></td>
                    <td><i data-bind='click:$root.removeadminActionsRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr>
                    <td colspan='2'><span ></span></td>
                    <td><span >Total time spent undertaking project administration activities (Hrs)</span></td>
                    <td><span  class="value" data-bind='text:data.hoursAdminTotal'></span></td>
                    <td></td>
                </tr>
                <tr><td colspan="5" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addadminActionsRow">
                        <i class="icon-plus"></i> Add a row</button>
                        <button type="button" class="btn btn-small" data-bind="click:showadminActionsTableDataUpload"><i class="icon-upload"></i> Upload data for this table</button>


                    </td></tr>
<tr data-bind="visible:adminActionsTableDataUploadVisible"><td colspan="5">
                <div class="text-error text-left">
                    Note: Only valid exact scientific names will be matched and populated from the database (indicated by a green tick). Unmatched species will load, but will be indicated by a green <b>?</b>. Please check your uploaded data and correct as required.
                </div>
                <div class="text-left" style="margin:5px">
                    <a href="/proxy/excelOutputTemplate?type=Administration Activities&listName=adminActions" target="adminActionsTemplateDownload" class="btn">Step 1 - Download template (.xlsx)</a>
                </div>
                <div class="text-left" style="margin:5px;">
                    <input type="checkbox" data-bind="checked:appendTableRows" style="margin-right:5px">Append uploaded data to table (unticking this checkbox will result in all table rows being replaced)
                </div>

                <div class="btn fileinput-button" style="margin-left:5px">
                        <input id="adminActionsTableDataUpload" type="file" name="data" data-bind="fileUploadNoImage:adminActionsTableDataUploadOptions">
                        Step 2 - Upload populated template
                </div>

                    </td></tr> <script id="adminActionstemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="adminActionstemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>Comments / Notes:</label></span><textarea  class="span12" data-bind='value:data.notes'></textarea></span></div>

        
    </div>

<!-- /ko -->

</div>




</div>

<script src="static/DzazZ2ePykd4QRUJlInoAO1LMvzeVxjM2JRcis2usBm.js" type="text/javascript" ></script>



<script src="static/N1Pu1Yy1dAP26vjRfEw0sZtbZhL03ir303dL4C7EaVF.js" type="text/javascript" ></script>

<script src="static/gfz9yoFSoT3bDIgFJCbjPP9WLeFgekRHSp7KxcpYrwj.js" type="text/javascript" ></script>
<script src="static/HpQC03jqzgdovdmQNni1bswagCkkBPaWGDIzgICGcvq.js" type="text/javascript" ></script>









<!--[if gte IE 8]><script src="static/knxjs4G9Cquc79O3iYW107XikPB1Z1ii8QWrtBpzlSP.js" type="text/javascript" ></script><![endif]-->
<script src="static/kSJb30BxnBzyoP0WndxrtZbaNWzT8x6LP2Cp7xI9PH4.js" type="text/javascript" ></script>
<script src="static/NbeGWZssK95I6Y1Oz4lzxzRtDzf9dyFLZiTstPEonQa.js" type="text/javascript" ></script>
<script src="static/L85LaBY6yhQwMk24PuXWgqwvtkfvbmMZ3ExPR9xK96.js" type="text/javascript" ></script>
<script src="static/MZjUSqmNLHqbPwhDcAMpejU18pr9ndMRCGKpPBHdSDL.js" type="text/javascript" ></script>
<script src="static/w51VyweI3KQvr6P2DTUzBcR9OpWeX0ktL7UktpeA1k.js" type="text/javascript" ></script>





<script src="static/7l2mDQFFpMnG14cXQPTKd94AN71T8yUF6dHUA2LCJIo.js" type="text/javascript" ></script>
<script src="static/ZbrF5cz3bJrkAqBXLrAlOmoaIYntVDIKpviQs5E8Rhy.js" type="text/javascript" ></script>
<script src="static/yzVPTi9KJTOMgo1ytEFVw7JiBXXkkbj5dU3cYZoIuS.js" type="text/javascript" ></script>

<script src="static/IZCc6ZgD3MepYbz4UqlDLzMDNNghSCivcfGebmF9V2d.js" type="text/javascript" ></script>
<script type="text/javascript">
        $(function(){

            var viewModelName = "Lessons_LearnedViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Lessons Learned";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.assumptions = ko.observable();

            self.data.projectRiskManagement = ko.observable();

            self.data.projectLessons = ko.observable();
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                    
                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.data['assumptions'](data['assumptions']);
                self.data['projectRiskManagement'](data['projectRiskManagement']);
                self.data['projectLessons'](data['projectLessons']);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Lessons Learned') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koLessons_Learned"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        
        $(function(){

            var viewModelName = "Biodiversity_Fund_Outcomes_&_Monitoring_MethodologyViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var ThemeOneRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.siteName1 = ko.observable(orBlank(data['siteName1']));
            this.vegetationDescription1 = ko.observable(orBlank(data['vegetationDescription1']));
            this.vegetationCurrentCondition1 = ko.observable(orBlank(data['vegetationCurrentCondition1']));
            this.vegetationIntendedCondition1 = ko.observable(orBlank(data['vegetationIntendedCondition1']));
            this.assessmentMethodology1 = ko.observable(orBlank(data['assessmentMethodology1']));
            self.transients.assessmentMethodology1Constraints = ["Biodiversity Fund (DoE)","Habitat Hectares (VIC)","TasVeg (TAS)","BioMetric (NSW)","Bushland Condition Monitoring (SA)","Native Vegetation Condition Assessment and Monitoring (WA)","BioCondition (QLD)"];
        };
        var ThemeTwoRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.siteName2 = ko.observable(orBlank(data['siteName2']));
            this.vegetationDescription2 = ko.observable(orBlank(data['vegetationDescription2']));
            this.vegetationCurrentCondition2 = ko.observable(orBlank(data['vegetationCurrentCondition2']));
            this.vegetationIntendedCondition2 = ko.observable(orBlank(data['vegetationIntendedCondition2']));
            this.assessmentMethodology2 = ko.observable(orBlank(data['assessmentMethodology2']));
            self.transients.assessmentMethodology2Constraints = ["Biodiversity Fund (DoE)","Habitat Hectares (VIC)","TasVeg (TAS)","BioMetric (NSW)","Bushland Condition Monitoring (SA)","Native Vegetation Condition Assessment and Monitoring (WA)","BioCondition (QLD)"];
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Biodiversity Fund Outcomes & Monitoring Methodology";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.targetT1Area = ko.observable();

            self.data.themeOne = ko.observableArray([]);
            self.selectedthemeOneRow = ko.observable();
        

            self.loadthemeOne = function (data, append) {
                if (!append) {
                    self.data.themeOne([]);
                }
                if (data === undefined) {
                    self.addthemeOneRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.themeOne.push(new ThemeOneRow(obj));
                    });
                }
            };

            self.addthemeOneRow = function () {
                var newRow = new ThemeOneRow();
                self.data.themeOne.push(newRow);
                
            };
            self.removethemeOneRow = function (row) {
                self.data.themeOne.remove(row);
                
            };
            self.themeOnerowCount = function () {
                return self.data.themeOne().length;
            };

            self.themeOneTableDataUploadVisible = ko.observable(false);
            self.showthemeOneTableDataUpload = function() {
                self.themeOneTableDataUploadVisible(!self.themeOneTableDataUploadVisible());
            };

            self.themeOneTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadthemeOne(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "themeOnetemplate-upload",
                    downloadTemplateId: "themeOnetemplate-download",
                    formData:{type:'Biodiversity Fund Outcomes & Monitoring Methodology', listName:'themeOne'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.targetT2Area = ko.observable();

            self.data.themeTwo = ko.observableArray([]);
            self.selectedthemeTwoRow = ko.observable();
        

            self.loadthemeTwo = function (data, append) {
                if (!append) {
                    self.data.themeTwo([]);
                }
                if (data === undefined) {
                    self.addthemeTwoRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.themeTwo.push(new ThemeTwoRow(obj));
                    });
                }
            };

            self.addthemeTwoRow = function () {
                var newRow = new ThemeTwoRow();
                self.data.themeTwo.push(newRow);
                
            };
            self.removethemeTwoRow = function (row) {
                self.data.themeTwo.remove(row);
                
            };
            self.themeTworowCount = function () {
                return self.data.themeTwo().length;
            };

            self.themeTwoTableDataUploadVisible = ko.observable(false);
            self.showthemeTwoTableDataUpload = function() {
                self.themeTwoTableDataUploadVisible(!self.themeTwoTableDataUploadVisible());
            };

            self.themeTwoTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadthemeTwo(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "themeTwotemplate-upload",
                    downloadTemplateId: "themeTwotemplate-download",
                    formData:{type:'Biodiversity Fund Outcomes & Monitoring Methodology', listName:'themeTwo'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.targetT3Area = ko.observable();

            self.data.targetT3Species = ko.observable();

            self.data.targetT3Outcomes = ko.observable();

            self.data.targetT4TotalPlants = ko.observable();

            self.data.targetT4TotalSeed = ko.observable();

            self.data.targetT4PlantSurvival = ko.observable();

            self.data.targetT4CanopySpecies = ko.observable();

            self.data.targetT4UnderstoreySpecies = ko.observable();

            self.data.targetT4GroundSpecies = ko.observable();

            self.data.targetT4TotalFenceKm = ko.observable();

            self.data.targetT3GeneralOutcomes1 = ko.observable();

            self.data.targetT3GeneralOutcomes2 = ko.observable();

            self.data.notes = ko.observable();
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                    
                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.data['targetT1Area'](orZero(data['targetT1Area']));
                self.loadthemeOne(data.themeOne);
                self.data['targetT2Area'](orZero(data['targetT2Area']));
                self.loadthemeTwo(data.themeTwo);
                self.data['targetT3Area'](orZero(data['targetT3Area']));
                self.data['targetT3Species'](data['targetT3Species']);
                self.data['targetT3Outcomes'](data['targetT3Outcomes']);
                self.data['targetT4TotalPlants'](orZero(data['targetT4TotalPlants']));
                self.data['targetT4TotalSeed'](orZero(data['targetT4TotalSeed']));
                self.data['targetT4PlantSurvival'](orZero(data['targetT4PlantSurvival']));
                self.data['targetT4CanopySpecies'](data['targetT4CanopySpecies']);
                self.data['targetT4UnderstoreySpecies'](data['targetT4UnderstoreySpecies']);
                self.data['targetT4GroundSpecies'](data['targetT4GroundSpecies']);
                self.data['targetT4TotalFenceKm'](orZero(data['targetT4TotalFenceKm']));
                self.data['targetT3GeneralOutcomes1'](data['targetT3GeneralOutcomes1']);
                self.data['targetT3GeneralOutcomes2'](data['targetT3GeneralOutcomes2']);
                self.data['notes'](data['notes']);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Biodiversity Fund Outcomes & Monitoring Methodology') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koBiodiversity_Fund_Outcomes_&_Monitoring_Methodology"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        
        $(function(){

            var viewModelName = "EvaluationViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Evaluation";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.projectEffectiveness = ko.observable();

            self.data.projectImpact = ko.observable();

            self.data.projectEfficiency = ko.observable();

            self.data.methodologyAppropriateness = ko.observable();
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                    
                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.data['projectEffectiveness'](data['projectEffectiveness']);
                self.data['projectImpact'](data['projectImpact']);
                self.data['projectEfficiency'](data['projectEfficiency']);
                self.data['methodologyAppropriateness'](data['methodologyAppropriateness']);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Evaluation') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koEvaluation"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        
        $(function(){

            var viewModelName = "Administration_ActivitiesViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var AdminActionsRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.adminActionType = ko.observable(orBlank(data['adminActionType']));
            self.transients.adminActionTypeConstraints = ["Steering group/working group established","Meeting/meeting administration","Development/call for applications","Desktop information gathering","Develop monitoring protocols","Modelling","Data analysis","Report review","GIS/spatial data","Site selection","Establish landholder agreements","Establish contractor agreements","Order/purchase equipment, plants, seed, wire, posts etc","Submit project progress/annual/final report","Update/submit Project MERI Plan","Prepare EOI process/criteria","Assess EOI applications and EOI site visits","Record Keeping","Financial audits","Works approvals","Other (specify in notes)"];
            this.numberInvolved = ko.observable(orZero(data['numberInvolved']));
            this.hoursPerPerson = ko.observable(orZero(data['hoursPerPerson']));
                    self.hoursActionTotal = ko.computed(function () {
                        if (isNaN(Number(self.numberInvolved())) || isNaN(Number(self.hoursPerPerson()))) { return 0; }
                        return Number(self.numberInvolved()) * Number(self.hoursPerPerson());
                    });
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Administration Activities";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.adminActions = ko.observableArray([]);
            self.selectedadminActionsRow = ko.observable();
        

            self.loadadminActions = function (data, append) {
                if (!append) {
                    self.data.adminActions([]);
                }
                if (data === undefined) {
                    self.addadminActionsRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.adminActions.push(new AdminActionsRow(obj));
                    });
                }
            };

            self.addadminActionsRow = function () {
                var newRow = new AdminActionsRow();
                self.data.adminActions.push(newRow);
                
            };
            self.removeadminActionsRow = function (row) {
                self.data.adminActions.remove(row);
                
            };
            self.adminActionsrowCount = function () {
                return self.data.adminActions().length;
            };

            self.adminActionsTableDataUploadVisible = ko.observable(false);
            self.showadminActionsTableDataUpload = function() {
                self.adminActionsTableDataUploadVisible(!self.adminActionsTableDataUploadVisible());
            };

            self.adminActionsTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadadminActions(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "adminActionstemplate-upload",
                    downloadTemplateId: "adminActionstemplate-download",
                    formData:{type:'Administration Activities', listName:'adminActions'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.hoursAdminTotal = ko.computed(function () {
                var total = 0;
                for(var i = 0; i < self.data.adminActions().length; i++) {
                    var value = self.data.adminActions()[i].hoursActionTotal();
                        total = total + Number(value); 
                }
                return total;
            });

            self.data.notes = ko.observable();
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                                    delete jsData.selectedadminActionsRow;
                delete jsData.adminActionsTableDataUploadOptions
                delete jsData.adminActionsTableDataUploadVisible

                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.loadadminActions(data.adminActions);
                self.data['notes'](data['notes']);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Administration Activities') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koAdministration_Activities"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        


    /* Master controller for page. This handles saving each model as required. */
    var Master = function () {
        var self = this;
        this.subscribers = [];
        // client models register their name and methods to participate in saving
        self.register = function (modelInstanceName, getMethod, isDirtyMethod, resetMethod) {
            this.subscribers.push({
                model: modelInstanceName,
                get: getMethod,
                isDirty: isDirtyMethod,
                reset: resetMethod
            });
        };
        // master isDirty flag for the whole page - can control button enabling
        this.isDirty  = function () {
            var dirty = false;
            $.each(this.subscribers, function(i, obj) {
                dirty = dirty || obj.isDirty();
            });
            return dirty;
        };
        /**
         * Makes an ajax call to save any sections that have been modified. This includes the activity
         * itself and each output.
         *
         * Modified outputs are injected as a list into the activity object. If there is nothing to save
         * in the activity itself, then the root is an object that is empty except for the outputs list.
         *
         * NOTE that the model for each section must register itself to be included in this save.
         *
         * Validates the entire page before saving.
         */
        this.save = function () {

            var activityData, outputs = [];
            if ($('#validation-container').validationEngine('validate')) {
                $.each(this.subscribers, function(i, obj) {
                   // if (obj.isDirty()) {
                        if (obj.model === 'activityModel') {
                            activityData = obj.get();
                        } else {
                            outputs.push(obj.get());
                        }
                    //}
                });
                if (outputs.length === 0 && activityData === undefined) {
                    alert("Nothing to save.");
                    return;
                }
                if (activityData === undefined) { activityData = {}}
                activityData.outputs = outputs;

                var toSave = JSON.stringify(activityData);
                console.log("saving"+toSave);
                mobileBindings.saveActivity(toSave);

            }

        };

        this.reset = function () {
            $.each(this.subscribers, function(i, obj) {
                if (obj.isDirty()) {
                    obj.reset();
                }
            });
        };
    };

    if (mobileBindings == undefined) {
        var mobileBindings = {
        
            loadActivity:function(){return "{}"},
        
        
            loadSites:function(){return "[]"},
        

        saveActivity:function(){},
        createNewSite:function(){}
    };
}
var master = new Master();
var activity = JSON.parse(mobileBindings.loadActivity());
var themes = ['theme1', 'theme2'];

var sites = JSON.parse(mobileBindings.loadSites());


$(function(){

    $('#validation-container').validationEngine('attach', {scroll: false});

    $('.helphover').popover({animation: true, trigger:'hover'});

    $('#reset').click(function () {
        master.reset();
    });


    ko.bindingHandlers.editOutput = {
        init: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
            var outputName = ko.utils.unwrapObservable(valueAccessor()),
                activity = bindingContext.$root,
                outputId;

            // search for corresponding outputs in the activity data
            $.each(activity.outputs, function (i,output) { // iterate output data in the activity to
                                                              // find any matching the meta-model name
                if (output.name === outputName) {
                    outputId = output.outputId;
                }
            });
            if (outputId) {
                // build edit link
                $(element).html('Edit data');
                $(element).attr('href', fcConfig.serverUrl + "/output/edit/" + outputId +
                    "?returnTo=" + here);
            } else {
                // build create link
                $(element).attr('href', fcConfig.serverUrl + '/output/create?activityId=' + activity.activityId +
                    '&outputName=' + encodeURIComponent(outputName) +
                    "&returnTo=" + here);
            }
        }
    };

    function ViewModel (act, sites) {
        var self = this;
        self.activityId = act.activityId;
        self.description = ko.observable(act.description);
        self.notes = ko.observable(act.notes);
        self.startDate = ko.observable(act.startDate).extend({simpleDate: false});
        self.endDate = ko.observable(act.endDate || act.plannedEndDate).extend({simpleDate: false});
        self.plannedStartDate = ko.observable(act.plannedStartDate).extend({simpleDate: false});
        self.plannedEndDate = ko.observable(act.plannedEndDate).extend({simpleDate: false});
        self.eventPurpose = ko.observable(act.eventPurpose);
        self.fieldNotes = ko.observable(act.fieldNotes);
        self.associatedProgram = ko.observable(act.associatedProgram);
        self.associatedSubProgram = ko.observable(act.associatedSubProgram);
        self.progress = ko.observable(act.progress);
        self.mainTheme = ko.observable(act.mainTheme);
        self.type = ko.observable(act.type);
        self.siteId = ko.observable(act.siteId);
        self.projectId = act.projectId;
        self.transients = {};
        self.transients.sites = sites;
        self.transients.activityProgressValues = ['planned','started','finished'];
        self.transients.themes = themes;
        self.transients.markedAsFinished = ko.observable(act.progress === 'finished');
        self.transients.markedAsFinished.subscribe(function (finished) {
            self.progress(finished ? 'finished' : 'started');
        });
        self.transients.siteImgUrl = ko.computed(function() {
            if (self.siteId()) {
                 var site = $.grep(self.transients.sites, function(site, index) { return site.siteId == self.siteId(); })[0];
                 if (site && site.extent && site.extent.geometry && site.extent.geometry.centre) {
                    return  "http://maps.googleapis.com/maps/api/staticmap?maptype=terrian&zoom=12&sensor=false&size=250x200&markers=color:red%7C"+site.extent.geometry.centre[1]+","+site.extent.geometry.centre[0]+"&centre=false";
                 }
            }
            return "";
        });

        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.toJS(self);
            delete jsData.transients;
            return jsData;
        };
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.save = function (callback, key) {
        };

        self.createNewSite = function() {
            mobileBindings.createNewSite();
        }

        self.notImplemented = function () {
            alert("Not implemented yet.")
        };
        self.dirtyFlag = ko.dirtyFlag(self, false);

        // make sure progress moves to started if we save any data (unless already finished)
        // (do this here so the model becomes dirty)
        self.progress(self.transients.markedAsFinished() ? 'finished' : 'started');
    }


    var viewModel = new ViewModel(activity, sites);

    ko.applyBindings(viewModel);

    master.register('activityModel', viewModel.modelForSaving, viewModel.dirtyFlag.isDirty, viewModel.dirtyFlag.reset);
});
</script>
</body>
</html>
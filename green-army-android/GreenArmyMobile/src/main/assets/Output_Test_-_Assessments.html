

<!DOCTYPE html>
<head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <style type="text/css">
        input[type=checkbox] {
            -webkit-transform: scale(1.5); margin:50px;
        }
    </style>
    
    <script src="fieldcapture/static/UGoJGyG3j2UCffTg3vnOdi0FsnS2OvrmrsZD6WxaXGy.js" type="text/javascript" ></script>
<link href="fieldcapture/static/Eu8FNKwJJQI8mVJO3VIshatRN1bunflYHvvdqk06tbf.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="fieldcapture/static/090onaZX1M508oSWqGmMeETZ9NkUA9p4CCTW3MUpRPc.css" type="text/css" rel="stylesheet" media="screen, projection" />

<link href="fieldcapture/static/CidRUyEAqkZsnDRPRiaGZBy7vd4DOlnRqweu4CsVcIG.css" type="text/css" rel="stylesheet" media="screen" />
<link href="fieldcapture/static/tDKPE9VWZfBnSnxBkPC52ml2dXticvlQDl9aR8VpM2o.css" type="text/css" rel="stylesheet" media="screen, projection" />
<!--[if lt IE 7]><link href="fieldcapture/static/v1vjA9BeNpSU8cuoTuVhTEUm6boSzwYQcgfPKKMkqgv.css" type="text/css" rel="stylesheet" media="screen, projection" /><![endif]-->

<link href="http://www.ala.org.au/wp-content/themes/ala2011/images/favicon.ico" rel="shortcut icon" />
<!--[if lt IE 9]><script src="fieldcapture/static/Yh1Txee3hFzExJ4P1str7tGV24zQMEYtxqtlYJ5ukR0.js" type="text/javascript" ></script><![endif]-->
<link href="fieldcapture/static/6tuLClj7N5eYCZpx7vLn8juIbQUXBkCnWRUJFY7UDCz.css" type="text/css" rel="stylesheet" media="screen,print" />
<link href="/fieldcapture/static/7ARiB2rJgSkfi68hxnSlcG9Ot0gQ863DYxkCmSHQweE.png" rel="shortcut icon" />
<link href="/fieldcapture/static/14SWTr4VqVh6tnlUlgBtue6IJZ7gwE1y42RT7ya5GGW.png" rel="shortcut icon" />

<link href="fieldcapture/static/KYGDEVRRaKjNbTXJkHmicmzo9vFrnnzCnGLcxKjR04f.css" type="text/css" rel="stylesheet" media="screen,print" />

<link href="fieldcapture/static/uUQBvO5ITMKwLfoRb2u62GbHXEzxtsbrSWq8MBAOrbX.css" type="text/css" rel="stylesheet" media="screen,print" />
<link href="fieldcapture/static/2OXdKoom668LE7PLl0qjJCaLG7Pu7Jv869tAsS4e1oT.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="fieldcapture/static/AcXIjLTuc87n8sfxBjJRQSoBIUwP9RnCyK8Sv82i7eV.css" type="text/css" rel="stylesheet" media="screen, projection" />
<script type="text/javascript">
    var fcConfig = {
        serverUrl: "http://devt.ala.org.au:8087/fieldcapture",
        activityUpdateUrl: "/fieldcapture/activity/ajaxUpdate",
        activityDeleteUrl: "/fieldcapture/activity/ajaxDelete",
        projectViewUrl: "/fieldcapture/project/index/",
        siteViewUrl: "/fieldcapture/site/index/",
        bieUrl: "http://bie.ala.org.au",
        speciesProfileUrl: "/fieldcapture/proxy/speciesProfile"
        },
        here = document.location.href;
    </script>
    

    <meta name="layout" content="mobile"/>

    
    

</head>

<body>

<div id="content" class="clearfix">
    
<div class="container-fluid validationEngineContainer" id="validation-container">
<div id="koActivityMainBlock">

    <div class="row-fluid">
        <div class="span12">
            <!-- Common activity fields -->

            <div class="row-fluid space-after">
                <div class="span4">

                    <label class="for-readonly">Type</label>
                    <span class="readonly-text" data-bind="text:type"></span>
                </div>
                <div class="span8">

                    <label class="for-readonly">Description</label>
                    <span class="readonly-text" data-bind="text:description"></span>
                </div>
            </div>


            <div class="row-fluid space-after">
                <div class="span4">
                    <label class="for-readonly inline">Planned start date</label>
                    <span class="readonly-text" data-bind="text:plannedStartDate.formattedDate"></span>
                </div>
                <div class="span8">
                    <label class="for-readonly inline">Planned end date</label>
                    <span class="readonly-text" data-bind="text:plannedEndDate.formattedDate"></span>
                </div>
            </div>

            <div class="well">

            <div class="row-fluid space-after">
                <div class="span4 required">
                    <label for="startDate"><b>Actual start date</b>
                        <a href='#' class='helphover' data-original-title='Start date' data-placement='top' data-content='Date the activity was started.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a>
                    </label>


                    <div class="input-append">
                        <input data-bind='datepicker:startDate.date' name='startDate' id='startDate' type='text' size='16' class='input-xlarge' targetField='startDate.date' data-validation-engine='validate[required]' />
<span class='add-on open-datepicker'>
  <i class='icon-th'>&nbsp;</i>
</span>
                    </div>

                </div>
                <div class="span8 required">
                    <label for="endDate"><b>Actual end date</b>
                        <a href='#' class='helphover' data-original-title='End date' data-placement='top' data-content='Date the activity finished.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a>
                    </label>

                    <div class="input-append">
                        <input data-bind='datepicker:endDate.date' name='endDate' id='endDate' type='text' size='16' class='input-xlarge' targetField='endDate.date' data-validation-engine='validate[future[startDate]]' />
<span class='add-on open-datepicker'>
  <i class='icon-th'>&nbsp;</i>
</span>
                    </div>

                </div>
            </div>
            <div class="row-fluid space-after">
                <div class="span6">
                    <label for="theme"><b>Major theme</b></label>
                    <select id="theme" data-bind="value:mainTheme, options:transients.themes, optionsCaption:'Choose..'" class="input-xlarge">
                    </select>
                </div>

            </div>
            <div class="row-fluid">
                <div class="span4">
                    <label for="site"><b>Site</b></label>
                    <select id='site' width='100%' data-bind='options:transients.sites,optionsText:"name",optionsValue:"siteId",value:siteId,optionsCaption:"Choose a site..."'>&nbsp;</select>

                    <br/>Leave blank if this activity is not associated with a specific site.

                </div>

                <div class="span8">
                    <img width="250" height="200" data-bind="attr:{src:transients.siteImgUrl}"/>
                </div>


            </div>
            </div>
        </div>
    </div>

</div>

<!-- ko stopBinding: true -->

    
    
    
    <div class="output-block" id="koEvidence_of_Weed_Treatment">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Evidence of Weed Treatment<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after output-section" >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 checkbox-list-label  preLabel required"><label>Evidence of Previous Treatment:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Type of evidence visible on treated target plants'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span>
            <ul class="checkbox-list" data-bind="foreach: transients.evidenceOfPreviousWeedTreatmentConstraints">
                <li>
                    <label data-bind="attr:{for: 'evidenceOfPreviousWeedTreatment'+$index()}"><input type="checkbox" name="data.evidenceOfPreviousWeedTreatment" data-bind="value:$data,checked:$root.data.evidenceOfPreviousWeedTreatment,attr:{id: 'evidenceOfPreviousWeedTreatment'+$index()}"  data-validation-engine='validate[minCheckbox[1]]'/><span data-bind="text:$data"/></label></span>
                </li>
            </ul>
        </span></div></div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Effectiveness of Previous Treatment (% killed):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The effectiveness of the last treatment activity as a proportion of the area and density of the infestation that existed before the previous treatment activity, expressed as the percentage killed'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.effectivenessOfPreviousWeedTreatment' data-validation-engine='validate[required,min[0],max[100],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Recommended treatment:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The type of treatment method recommended for follow up treatment'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.recommendedWeedTreatment,options:transients.recommendedWeedTreatmentConstraints,optionsCaption:"Please select"'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Notes:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='General observational notes applicable to the site, treatment, conditions, etc.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span8" data-bind='value:data.notes'></textarea></span></div></div></div>

        
    </div>

    
    
    <style type="text/css">
        table.weedObservationMonitoringDetails td:nth-child(2) {text-align:center;}
        table.weedObservationMonitoringDetails td:last-child {width:4%;text-align:center;}
        table.weedObservationMonitoringDetails textarea {width:98%;}
    </style>
    <div class="output-block" id="koWeed_Observation_/_Monitoring_Details">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Weed Observation / Monitoring Details<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid ">
            <table class="table table-bordered weedObservationMonitoringDetails " >
                <thead><tr><th class="required">Weed species:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Name(s) of the weed species observed on the subject site (may be entered as scientific or common names)'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th class="required">Weed cover (Ha):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Area in hectares of coverage of particular weed species'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Infestation Density:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Density class for particular weed species over the assessed area'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Health<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Observed health status of particular weed species as an average across the assessed area'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Reproductive status:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Observed reproductive status of particular weed species as an average across the assessed area'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Weed Status<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Status of the infestation area for particular weed species'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Notes:</th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'weedObservationMonitoringDetailsviewTmpl', foreach: data.weedObservationMonitoringDetails}"></tbody>
                <script id="weedObservationMonitoringDetailsviewTmpl" type="text/html"><tr>
                    <td>
<span class="input-prepend input-append" data-bind="with:weedSpecies">
    <span class="add-on" data-bind="visible:!transients.editing(), css:{'btn-success':name()}"><i class="icon-white" data-bind="css:{'icon-ok':listId()!='unmatched' && name(), 'icon-question-sign':listId()=='unmatched'}"></i></span><span class="add-on" data-bind="visible:transients.editing()"><img src="/fieldcapture/static/Xo2jbaJ5EFqa59u9g4c4ybpCpw3wFWKhQdzZwNmmktO.gif" alt="saving icon" /></span><input type="text" data-bind="value:transients.textFieldValue,event:{focusout:focusLost},autocomplete:{url:'/fieldcapture/search/species', render: renderItem, listId: list, result:speciesSelected, valueChangeCallback:textFieldChanged}"  data-validation-engine='validate[required]'/>
    <span class="add-on" data-bind="visible: !transients.editing() && name()">
        <a href="#" data-bind="popover: {title: name, content: transients.speciesInformation}"><i class="icon-info-sign"></i></a>
    </span>
</span>
</td>
                    <td><input class="input-small" style="text-align:center" data-bind='value:weedCoverHa' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><select data-bind='value:weedInfestationDensity,options:transients.weedInfestationDensityConstraints,optionsCaption:"Please select"'></select></td>
                    <td><select data-bind='value:weedHealth,options:transients.weedHealthConstraints,optionsCaption:"Please select"'></select></td>
                    <td><select data-bind='value:weedReproductiveStatus,options:transients.weedReproductiveStatusConstraints,optionsCaption:"Please select"'></select></td>
                    <td><select data-bind='value:weedStatus,options:transients.weedStatusConstraints,optionsCaption:"Please select"'></select></td>
                    <td><textarea  data-bind='value:weedInspectionNotes'></textarea></td>
                    <td><i data-bind='click:$root.removeweedObservationMonitoringDetailsRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr><td colspan="0" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addweedObservationMonitoringDetailsRow">
                        <i class="icon-plus"></i> Add a row</button>
                        <button type="button" class="btn btn-small" data-bind="click:showweedObservationMonitoringDetailsTableDataUpload"><i class="icon-upload"></i> Upload data for this table</button>


                    </td></tr>
<tr data-bind="visible:weedObservationMonitoringDetailsTableDataUploadVisible"><td colspan="0">
                <div class="text-error text-left">
                    Note: Only valid exact scientific names will be matched and populated from the database (indicated by a green tick). Unmatched species will load, but will be indicated by a green <b>?</b>. Please check your uploaded data and correct as required.
                </div>
                <div class="text-left" style="margin:5px">
                    <a href="/fieldcapture/proxy/excelOutputTemplate?type=Weed Observation / Monitoring Details&listName=weedObservationMonitoringDetails" target="weedObservationMonitoringDetailsTemplateDownload" class="btn">Step 1 - Download template (.xlsx)</a>
                </div>
                <div class="text-left" style="margin:5px;">
                    <input type="checkbox" data-bind="checked:appendTableRows" style="margin-right:5px">Append uploaded data to table (unticking this checkbox will result in all table rows being replaced)
                </div>

                <div class="btn fileinput-button" style="margin-left:5px">
                        <input id="weedObservationMonitoringDetailsTableDataUpload" type="file" name="data" data-bind="fileUploadNoImage:weedObservationMonitoringDetailsTableDataUploadOptions">
                        Step 2 - Upload populated template
                </div>

                    </td></tr> <script id="weedObservationMonitoringDetailstemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="weedObservationMonitoringDetailstemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>

        
    </div>

    
    
    
    <div class="output-block" id="koGeneral_information_&_Participants">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">General information & Participants<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after output-section" >
<div class="span4">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Sampler name:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The name of the person or group undertaking the sampling event'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input  class="span8 input-small" data-bind='value:data.samplerName'  type='text' class='input-small'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Type of water body:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Broad class of water body being sampled'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.waterType,options:transients.waterTypeConstraints,optionsCaption:"Please select"'></select></span></div></div><div class="span4">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Number in sampler group:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The total number of people participating in the sampling event'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.totalParticipants' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>No. of volunteer participants:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of volunteers participating in the sampling event'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.numberOfVolunteerParticipants' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div></div><div class="span4">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Survey time:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The time of the day that the survey was undertaken'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.surveyTime' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Survey duration (hrs):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The duration of the sampling event in hours'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.surveyDuration' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div></div></div>

        
    </div>

    
    
    
    <div class="output-block" id="koEnvironmental_Information_at_the_Time_of_Sampling">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Environmental Information at the Time of Sampling<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after output-section" >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Rainfall in last 7 days:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='General character of rainfall received at the sampling site over the 7 days prior to sampling.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.rainfall7Days,options:transients.rainfall7DaysConstraints,optionsCaption:"Please select"'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Rainfall (mm):</label></span><input class="input-small" style="text-align:center" data-bind='value:data.surfaceWaterTemperature' type='number' class='input-mini'/></span></div></div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Water level or flow:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='General level of the water surface at the time of sampling, relative to it&apos;s normal level.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.waterLevel,options:transients.waterLevelConstraints,optionsCaption:"Please select"'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Rate of Flow:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Description of the rate of flow of the water at the time of sampling.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input  class="span8 input-small" data-bind='value:data.waterFlowRate'  type='text' class='input-small'/></span></div></div></div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>Site observations:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='General comments and notes about the site conditions at the time of the water quality monitoring event.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span12" data-bind='value:data.notes'></textarea></span></div>

        
    </div>

    
    
    
    <div class="output-block" id="koWater_Quality_Measurements">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Water Quality Measurements<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after output-section" >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Air Temperature (deg C):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The temperature of the air (in degrees Celsius) at 1.2 metres above the surface of the water at the time of sampling.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.airTemperature' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Water Temperature (deg C):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The average temperature (in degrees Celsius) of the top few centimetres of water at the sampling site'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.surfaceWaterTemperature' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>pH (pH units):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The average pH of the top few centimetres of water at the sampling site'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.surfaceWaterPh' data-validation-engine='validate[min[0],max[14],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Electrical Conductivity (ÂµS/cm):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The average electrical conductivity (in microsiemens per centimetre) of the top few centimetres of water at the sampling site'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.surfaceWaterEc' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Turbidity (NTUs):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The average turbidity (in nephelometric turbidity units (NTUs)) of the water column at the sampling site'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.waterTurbidity' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Nitrates (mg/L as N):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Measure of the amount of nitrogen dissolved in a water sample as nitrate in milligrams per litre'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.surfaceWaterNitrates' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Did you calibrate your EC meter?:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Indicator as to whether the electrical conductivity meter used had been calibrated prior to sampling'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.instrumentCalibration,options:transients.instrumentCalibrationConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></span></div></div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Total Nitrogen (mg/L as N):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Measure of the total amount of nitrogen dissolved in a water sample in milligrams per litre'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.surfaceWaterTotalN' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Available Phosphate (mg/L):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Measure of the amount of available (soluble reactive component) phosphate in milligrams per litre of the water at the sampling site'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.surfaceWaterAvailableP' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Total Phosphate (mg/L):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Measure of the total amount of phosphate (reactive and unreactive components) in milligrams per litre of the water at the sampling site'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.surfaceWaterTotalP' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Dissolved Oxygen (mg/L):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Measure of the amount of oxygen dissolved in a water sample in milligrams per litre'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.surfaceWaterDoMgl' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Dissolved Oxygen (% sat):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Measure of the amount of oxygen dissolved in a water sample expressed as a percentage of the oxygen holding capacity of the water at it&apos;s current temperature'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.surfaceWaterDoPcSat' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Faecal Coliforms (CFU/100mL):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Measure of the density of faecal coliforms in a 100 millilitre sample of water'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.surfaceWaterColiforms' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>E. coli (CFU/100mL):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Measure of the density of the bacteria E. coli in a 100 millilitre sample of water'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.surfaceWaterEcoli' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div></div></div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>Water Testing Notes/Issues:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='General comments and notes about this water quality monitoring event.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span12" data-bind='value:data.notes'></textarea></span></div>

        
    </div>

    
    
    
    <div class="output-block" id="koSurvey_Information">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Survey Information<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after " >
<span class="span12">    <span  class="span12">This is a generalised form for recording biological survey data and should cover the basic structured data gathering requirements of most surveys. If additional structured data is required, please contact <a href='mailto: MERIT@environment.gov.au'>MERIT@environment.gov.au</a>.</span></span></div>
<div class="row-fluid space-after output-section" >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Survey Id / Reference No.:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='An identifier or reference number that may be applicable to the survey event.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input  class="span8 input-small" data-bind='value:data.surveyId'  type='text' class='input-small'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Survey title:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Short descriptive title of the survey. This provides context for the survey event and enables you to search for it easily.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input  class="span8 input-small" data-bind='value:data.surveyTitle'  data-validation-engine='validate[required]' type='text' class='input-small'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Survey objectives:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Description of the objectives of the survey event'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span8" data-bind='value:data.surveyObjectives'></textarea></span></div></div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Survey leader:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The name of the person leading the survey event'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input  class="span8 input-small" data-bind='value:data.surveyLeader'  data-validation-engine='validate[required]' type='text' class='input-small'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Survey participants:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='List of people people participating in the survey event.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span8" data-bind='value:data.surveyParticipants'></textarea></span></div></div></div>
<div class="row-fluid space-after output-section" >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Survey area (Ha):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The area in hectares over which the survey is being conducted'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.surveyArea' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Survey methodology used:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The name of the methodology used. Note this should be the short-form name by which a standard methodology is commonly referred to (eg. 2 Ha 20 min Bird Survey). If it is not a common or standard methodology, please create a short-form name for it.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input  class="span8 input-small" data-bind='value:data.surveyMethodologyName'  data-validation-engine='validate[required]' type='text' class='input-small'/></span></div></div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Description of survey methodology:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Long description of the methodology used for the survey event'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span8" data-bind='value:data.surveyMethodologyDescription'></textarea></span></div></div></div>

        
    </div>

    
    
    <style type="text/css">
        table.surveyResults th {white-space:normal;}
        table.surveyResults td:nth-child(1) {width:7%;}
        table.surveyResults td:nth-child(1) select {width:100%;}
        table.surveyResults td:nth-child(2) {width:8%;}
        table.surveyResults td:nth-child(2) select {width:100%;}
        table.surveyResults td:nth-child(3) {width:12%;}
        table.surveyResults td:nth-child(3) select {width:100%;}
        table.surveyResults td:nth-child(4) {width:8%;text-align:center;}
        table.surveyResults td:nth-child(4) select {width:100%;}
        table.surveyResults td:nth-child(5) {width:10%;}
        table.surveyResults td:nth-child(5) select {width:100%;}
        table.surveyResults td:nth-child(6) {width:10%;}
        table.surveyResults td:nth-child(6) select {width:100%;}
        table.surveyResults td:nth-child(7) {width:10%;}
        table.surveyResults td:nth-child(7) select {width:100%;}
        table.surveyResults td:nth-child(8) {width:10%;}
        table.surveyResults td:nth-child(8) select {width:100%;}
        table.surveyResults td:nth-child(9) {width:7%;}
        table.surveyResults td:nth-child(9) select {width:100%;}
        table.surveyResults td:nth-child(10) {width:15%;}
        table.surveyResults td:nth-child(10) select {width:100%;}
        table.surveyResults td:last-child {width:4%;text-align:center;}
        table.surveyResults textarea {width:98%;}
    </style>
    <div class="output-block" id="koFauna_Survey_Details">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Fauna Survey Details<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after " >
<span class="span12">    <span  class="span12">Please list the details of animals observed or collected in each transect/plot and sampling/trap site during this survey event:</span></span></div>
<div class="row-fluid output-section">
            <table class="table table-bordered surveyResults " >
                <thead><tr><th>Transect / plot Id:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The identifier of the transect or plot in which sampling is being done.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Trap / Sample Site Id:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The identifier of the point at which the observational record was made'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Species:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='All species recorded at the sample site'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>No. of individuals:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of organisms in the survey at the sample site which share the same set of record attributes.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Nature of evidence:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Nature of the evidence for the basis of the record'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Sex:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The sex of the organism recorded'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Life stage:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Life stage of the organism recorded'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Organism health:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The health or condition of the organism recorded'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Biological material taken:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Indicator as to whether biological material (either as a sample or whole organism) was taken.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Notes:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Any notes or comments applicable to a record (eg. health/condition indicators, nature of biological material taken, unlisted variants on select lists, other measurements, general observations, etc.).'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'surveyResultsviewTmpl', foreach: data.surveyResults}"></tbody>
                <script id="surveyResultsviewTmpl" type="text/html"><tr>
                    <td><input  class="input-mini" data-bind='value:plotId'  type='text' class='input-small'/></td>
                    <td><input  class="input-mini" data-bind='value:sampleSiteId'  type='text' class='input-small'/></td>
                    <td>
<span class="input-prepend input-append" data-bind="with:species">
    <span class="add-on" data-bind="visible:!transients.editing(), css:{'btn-success':name()}"><i class="icon-white" data-bind="css:{'icon-ok':listId()!='unmatched' && name(), 'icon-question-sign':listId()=='unmatched'}"></i></span><span class="add-on" data-bind="visible:transients.editing()"><img src="/fieldcapture/static/Xo2jbaJ5EFqa59u9g4c4ybpCpw3wFWKhQdzZwNmmktO.gif" alt="saving icon" /></span><input type="text" data-bind="value:transients.textFieldValue,event:{focusout:focusLost},autocomplete:{url:'/fieldcapture/search/species', render: renderItem, listId: list, result:speciesSelected, valueChangeCallback:textFieldChanged}" />
    <span class="add-on" data-bind="visible: !transients.editing() && name()">
        <a href="#" data-bind="popover: {title: name, content: transients.speciesInformation}"><i class="icon-info-sign"></i></a>
    </span>
</span>
</td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:numberOfOrganisms' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><select data-bind='value:evidence,options:transients.evidenceConstraints,optionsCaption:"Please select"'></select></td>
                    <td><select data-bind='value:sex,options:transients.sexConstraints,optionsCaption:"Please select"'></select></td>
                    <td><select data-bind='value:lifeStage,options:transients.lifeStageConstraints,optionsCaption:"Please select"'></select></td>
                    <td><input  class="input-mini" data-bind='value:health'  type='text' class='input-small'/></td>
                    <td><select data-bind='value:biologicalMaterialTaken,options:transients.biologicalMaterialTakenConstraints,optionsCaption:"Please select"'></select></td>
                    <td><textarea  data-bind='value:speciesNotes'></textarea></td>
                    <td><i data-bind='click:$root.removesurveyResultsRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr>
                    <td colspan='3'><span >Total No. of individual organisms recorded in this survey event:</span></td>
                    <td><span  class="value" data-bind='text:data.totalNumberOfOrganisms'></span></td>
                    <td colspan='6'><span ></span></td>
                    <td></td>
                </tr>
                <tr><td colspan="11" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addsurveyResultsRow">
                        <i class="icon-plus"></i> Add a row</button>
                        <button type="button" class="btn btn-small" data-bind="click:showsurveyResultsTableDataUpload"><i class="icon-upload"></i> Upload data for this table</button>


                    </td></tr>
<tr data-bind="visible:surveyResultsTableDataUploadVisible"><td colspan="11">
                <div class="text-error text-left">
                    Note: Only valid exact scientific names will be matched and populated from the database (indicated by a green tick). Unmatched species will load, but will be indicated by a green <b>?</b>. Please check your uploaded data and correct as required.
                </div>
                <div class="text-left" style="margin:5px">
                    <a href="/fieldcapture/proxy/excelOutputTemplate?type=Fauna Survey Details&listName=surveyResults" target="surveyResultsTemplateDownload" class="btn">Step 1 - Download template (.xlsx)</a>
                </div>
                <div class="text-left" style="margin:5px;">
                    <input type="checkbox" data-bind="checked:appendTableRows" style="margin-right:5px">Append uploaded data to table (unticking this checkbox will result in all table rows being replaced)
                </div>

                <div class="btn fileinput-button" style="margin-left:5px">
                        <input id="surveyResultsTableDataUpload" type="file" name="data" data-bind="fileUploadNoImage:surveyResultsTableDataUploadOptions">
                        Step 2 - Upload populated template
                </div>

                    </td></tr> <script id="surveyResultstemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="surveyResultstemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>Comments / Notes</label></span><textarea  class="span12" data-bind='value:data.notes'></textarea></span></div>

        
    </div>

    
    
    <style type="text/css">
        table.surveyResultsFlora th {white-space:normal;}
        table.surveyResultsFlora td:nth-child(1) {width:7%;}
        table.surveyResultsFlora td:nth-child(1) select {width:100%;}
        table.surveyResultsFlora td:nth-child(2) {width:7%;}
        table.surveyResultsFlora td:nth-child(2) select {width:100%;}
        table.surveyResultsFlora td:nth-child(3) {width:15%;}
        table.surveyResultsFlora td:nth-child(3) select {width:100%;}
        table.surveyResultsFlora td:nth-child(4) {width:8%;text-align:center;}
        table.surveyResultsFlora td:nth-child(4) select {width:100%;}
        table.surveyResultsFlora td:nth-child(5) {width:10%;}
        table.surveyResultsFlora td:nth-child(5) select {width:100%;}
        table.surveyResultsFlora td:nth-child(6) {width:7%;text-align:center;}
        table.surveyResultsFlora td:nth-child(6) select {width:100%;}
        table.surveyResultsFlora td:nth-child(7) {width:7%;text-align:center;}
        table.surveyResultsFlora td:nth-child(7) select {width:100%;}
        table.surveyResultsFlora td:nth-child(8) {width:10%;}
        table.surveyResultsFlora td:nth-child(8) select {width:100%;}
        table.surveyResultsFlora td:nth-child(9) {width:7%;}
        table.surveyResultsFlora td:nth-child(9) select {width:100%;}
        table.surveyResultsFlora td:nth-child(10) {width:15%;}
        table.surveyResultsFlora td:nth-child(10) select {width:100%;}
        table.surveyResultsFlora td:last-child {width:4%;text-align:center;}
        table.surveyResultsFlora textarea {width:98%;}
    </style>
    <div class="output-block" id="koFlora_Survey_Details">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Flora Survey Details<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after " >
<span class="span12">    <span  class="span12">Please list the details of plants observed or collected in each transect/plot and sampling site during this survey event:</span></span></div>
<div class="row-fluid output-section">
            <table class="table table-bordered surveyResultsFlora " >
                <thead><tr><th>Transect / plot Id:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The identifier of the transect or plot in which sampling is being done.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Sample Site Id:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The identifier of the point at which the observational record was made'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Species:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Species recorded at the sample site'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>No. of individuals:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of plants in the survey at the sample site which share the same set of record attributes.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Structural layer:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The structural layer occupied by the species'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Ave. Height (m):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The average height of the species in the sample area'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Tree DBH (cm) if applicable:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The diameter in centimetres at breast height (1.2m above ground level) of sampled trees.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Plant health:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The health or condition of the Plant(s) recorded'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Biological material taken:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Indicator as to whether biological material (either as a sample or whole organism) was taken.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Notes:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Any notes or comments applicable to a record (eg. health/condition indicators, nature of biological material taken, unlisted variants on select lists, other measurements, general observations, etc.).'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'surveyResultsFloraviewTmpl', foreach: data.surveyResultsFlora}"></tbody>
                <script id="surveyResultsFloraviewTmpl" type="text/html"><tr>
                    <td><input  class="input-mini" data-bind='value:plotId'  type='text' class='input-small'/></td>
                    <td><input  class="input-mini" data-bind='value:sampleSiteId'  type='text' class='input-small'/></td>
                    <td>
<span class="input-prepend input-append" data-bind="with:species">
    <span class="add-on" data-bind="visible:!transients.editing(), css:{'btn-success':name()}"><i class="icon-white" data-bind="css:{'icon-ok':listId()!='unmatched' && name(), 'icon-question-sign':listId()=='unmatched'}"></i></span><span class="add-on" data-bind="visible:transients.editing()"><img src="/fieldcapture/static/Xo2jbaJ5EFqa59u9g4c4ybpCpw3wFWKhQdzZwNmmktO.gif" alt="saving icon" /></span><input type="text" data-bind="value:transients.textFieldValue,event:{focusout:focusLost},autocomplete:{url:'/fieldcapture/search/species', render: renderItem, listId: list, result:speciesSelected, valueChangeCallback:textFieldChanged}" />
    <span class="add-on" data-bind="visible: !transients.editing() && name()">
        <a href="#" data-bind="popover: {title: name, content: transients.speciesInformation}"><i class="icon-info-sign"></i></a>
    </span>
</span>
</td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:numberOfOrganisms' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><select data-bind='value:stratum,options:transients.stratumConstraints,optionsCaption:"Please select"'></select></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:aveHeight' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:dbh' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><input  class="input-mini" data-bind='value:health'  type='text' class='input-small'/></td>
                    <td><select data-bind='value:biologicalMaterialTaken,options:transients.biologicalMaterialTakenConstraints,optionsCaption:"Please select"'></select></td>
                    <td><textarea  data-bind='value:speciesNotes'></textarea></td>
                    <td><i data-bind='click:$root.removesurveyResultsFloraRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr>
                    <td colspan='3'><span >Total No. of individual organisms recorded in this survey event:</span></td>
                    <td><span  class="value" data-bind='text:data.totalNumberOfOrganisms'></span></td>
                    <td colspan='6'><span ></span></td>
                    <td></td>
                </tr>
                <tr><td colspan="11" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addsurveyResultsFloraRow">
                        <i class="icon-plus"></i> Add a row</button>
                        <button type="button" class="btn btn-small" data-bind="click:showsurveyResultsFloraTableDataUpload"><i class="icon-upload"></i> Upload data for this table</button>


                    </td></tr>
<tr data-bind="visible:surveyResultsFloraTableDataUploadVisible"><td colspan="11">
                <div class="text-error text-left">
                    Note: Only valid exact scientific names will be matched and populated from the database (indicated by a green tick). Unmatched species will load, but will be indicated by a green <b>?</b>. Please check your uploaded data and correct as required.
                </div>
                <div class="text-left" style="margin:5px">
                    <a href="/fieldcapture/proxy/excelOutputTemplate?type=Flora Survey Details&listName=surveyResultsFlora" target="surveyResultsFloraTemplateDownload" class="btn">Step 1 - Download template (.xlsx)</a>
                </div>
                <div class="text-left" style="margin:5px;">
                    <input type="checkbox" data-bind="checked:appendTableRows" style="margin-right:5px">Append uploaded data to table (unticking this checkbox will result in all table rows being replaced)
                </div>

                <div class="btn fileinput-button" style="margin-left:5px">
                        <input id="surveyResultsFloraTableDataUpload" type="file" name="data" data-bind="fileUploadNoImage:surveyResultsFloraTableDataUploadOptions">
                        Step 2 - Upload populated template
                </div>

                    </td></tr> <script id="surveyResultsFloratemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="surveyResultsFloratemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>If a soil sample was collected as part of this survey event, please indicate the sample Id:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The identifier of a soil sample collected in association with this survey event'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input  class="span12 input-mini" data-bind='value:data.soilSampleCollected'  type='text' class='input-small'/></span></div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>Comments / Notes</label></span><textarea  class="span12" data-bind='value:data.notes'></textarea></span></div>

        
    </div>

    
    
    <style type="text/css">
        table.revegetationMonitoring td:nth-child(1) {width:25%;}
        table.revegetationMonitoring td:nth-child(1) select {width:100%;}
        table.revegetationMonitoring td:nth-child(2) {width:10%;text-align:center;}
        table.revegetationMonitoring td:nth-child(2) select {width:100%;}
        table.revegetationMonitoring td:nth-child(3) {width:10%;text-align:center;}
        table.revegetationMonitoring td:nth-child(3) select {width:100%;}
        table.revegetationMonitoring td:nth-child(4) {width:10%;text-align:center;}
        table.revegetationMonitoring td:nth-child(4) select {width:100%;}
        table.revegetationMonitoring td:nth-child(5) {width:10%;text-align:center;}
        table.revegetationMonitoring td:nth-child(5) select {width:100%;}
        table.revegetationMonitoring td:nth-child(6) {width:35%;}
        table.revegetationMonitoring td:nth-child(6) select {width:100%;}
        table.revegetationMonitoring td:last-child {width:4%;text-align:center;}
        table.revegetationMonitoring textarea {width:98%;}
    </style>
    <div class="output-block" id="koRevegetation_Monitoring_Results">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Revegetation Monitoring Results<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after output-section" >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Type of revegetation method:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The type of revegetation method used'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.revegetationType,options:transients.revegetationTypeConstraints,optionsCaption:"Please select"'></select></span></div></div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Counting Method:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The method used to determine the number of surviving plants'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.countingMethod,options:transients.countingMethodConstraints,optionsCaption:"Please select"'></select></span></div></div></div>
<div class="row-fluid output-section">
            <table class="table table-bordered revegetationMonitoring " >
                <thead><tr><th>Species<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Species planted on the revegetation site and/or represented in the survival count'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>No. Planted<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of individual plants planted on the site during the revegetation works activity'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Seed Sown (Kg)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The quantity in kilograms of seed sown on the site during the revegetation works activity'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>No. Surviving<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of individual seedlings surviving at the time of this survey'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Survival rate (%)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The percentage of individual seedlings surviving at the time of this survey as a proportion of numbers planted'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Notes / Comments</th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'revegetationMonitoringviewTmpl', foreach: data.revegetationMonitoring}"></tbody>
                <script id="revegetationMonitoringviewTmpl" type="text/html"><tr>
                    <td>
<span class="input-prepend input-append" data-bind="with:species">
    <span class="add-on" data-bind="visible:!transients.editing(), css:{'btn-success':name()}"><i class="icon-white" data-bind="css:{'icon-ok':listId()!='unmatched' && name(), 'icon-question-sign':listId()=='unmatched'}"></i></span><span class="add-on" data-bind="visible:transients.editing()"><img src="/fieldcapture/static/Xo2jbaJ5EFqa59u9g4c4ybpCpw3wFWKhQdzZwNmmktO.gif" alt="saving icon" /></span><input type="text" data-bind="value:transients.textFieldValue,event:{focusout:focusLost},autocomplete:{url:'/fieldcapture/search/species', render: renderItem, listId: list, result:speciesSelected, valueChangeCallback:textFieldChanged}" />
    <span class="add-on" data-bind="visible: !transients.editing() && name()">
        <a href="#" data-bind="popover: {title: name, content: transients.speciesInformation}"><i class="icon-info-sign"></i></a>
    </span>
</span>
</td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:numberPlanted' data-validation-engine='validate[min[1],custom[number]]' type='number' class='input-mini'/></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:seedSown' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:numberSurviving' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:survivalRate' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><textarea  data-bind='value:notes'></textarea></td>
                    <td><i data-bind='click:$root.removerevegetationMonitoringRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr>
                    <td><span >Total number planted</span></td>
                    <td><span  class="value" data-bind='text:data.totalNumberPlanted'></span></td>
                    <td><span >Total number surviving</span></td>
                    <td><span  class="value" data-bind='text:data.totalNumberSurviving'></span></td>
                    <td><input class="input-small" style="text-align:center" data-bind='value:data.' type='number' class='input-mini'/></td>
                    <td><span >Average survival rate (%)</span></td>
                    <td></td>
                </tr>
                <tr><td colspan="7" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addrevegetationMonitoringRow">
                        <i class="icon-plus"></i> Add a row</button>
                        <button type="button" class="btn btn-small" data-bind="click:showrevegetationMonitoringTableDataUpload"><i class="icon-upload"></i> Upload data for this table</button>


                    </td></tr>
<tr data-bind="visible:revegetationMonitoringTableDataUploadVisible"><td colspan="7">
                <div class="text-error text-left">
                    Note: Only valid exact scientific names will be matched and populated from the database (indicated by a green tick). Unmatched species will load, but will be indicated by a green <b>?</b>. Please check your uploaded data and correct as required.
                </div>
                <div class="text-left" style="margin:5px">
                    <a href="/fieldcapture/proxy/excelOutputTemplate?type=Revegetation Monitoring Results&listName=revegetationMonitoring" target="revegetationMonitoringTemplateDownload" class="btn">Step 1 - Download template (.xlsx)</a>
                </div>
                <div class="text-left" style="margin:5px;">
                    <input type="checkbox" data-bind="checked:appendTableRows" style="margin-right:5px">Append uploaded data to table (unticking this checkbox will result in all table rows being replaced)
                </div>

                <div class="btn fileinput-button" style="margin-left:5px">
                        <input id="revegetationMonitoringTableDataUpload" type="file" name="data" data-bind="fileUploadNoImage:revegetationMonitoringTableDataUploadOptions">
                        Step 2 - Upload populated template
                </div>

                    </td></tr> <script id="revegetationMonitoringtemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="revegetationMonitoringtemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>

        
    </div>

<!-- /ko -->

</div>




</div>

<script src="fieldcapture/static/DzazZ2ePykd4QRUJlInoAO1LMvzeVxjM2JRcis2usBm.js" type="text/javascript" ></script>



<script src="fieldcapture/static/N1Pu1Yy1dAP26vjRfEw0sZtbZhL03ir303dL4C7EaVF.js" type="text/javascript" ></script>

<script src="fieldcapture/static/gfz9yoFSoT3bDIgFJCbjPP9WLeFgekRHSp7KxcpYrwj.js" type="text/javascript" ></script>
<script src="fieldcapture/static/HpQC03jqzgdovdmQNni1bswagCkkBPaWGDIzgICGcvq.js" type="text/javascript" ></script>









<!--[if gte IE 8]><script src="fieldcapture/static/knxjs4G9Cquc79O3iYW107XikPB1Z1ii8QWrtBpzlSP.js" type="text/javascript" ></script><![endif]-->
<script src="fieldcapture/static/kSJb30BxnBzyoP0WndxrtZbaNWzT8x6LP2Cp7xI9PH4.js" type="text/javascript" ></script>
<script src="fieldcapture/static/NbeGWZssK95I6Y1Oz4lzxzRtDzf9dyFLZiTstPEonQa.js" type="text/javascript" ></script>
<script src="fieldcapture/static/L85LaBY6yhQwMk24PuXWgqwvtkfvbmMZ3ExPR9xK96.js" type="text/javascript" ></script>
<script src="fieldcapture/static/MZjUSqmNLHqbPwhDcAMpejU18pr9ndMRCGKpPBHdSDL.js" type="text/javascript" ></script>
<script src="fieldcapture/static/w51VyweI3KQvr6P2DTUzBcR9OpWeX0ktL7UktpeA1k.js" type="text/javascript" ></script>





<script src="fieldcapture/static/7l2mDQFFpMnG14cXQPTKd94AN71T8yUF6dHUA2LCJIo.js" type="text/javascript" ></script>
<script src="fieldcapture/static/ZbrF5cz3bJrkAqBXLrAlOmoaIYntVDIKpviQs5E8Rhy.js" type="text/javascript" ></script>
<script src="fieldcapture/static/yzVPTi9KJTOMgo1ytEFVw7JiBXXkkbj5dU3cYZoIuS.js" type="text/javascript" ></script>

<script src="fieldcapture/static/IZCc6ZgD3MepYbz4UqlDLzMDNNghSCivcfGebmF9V2d.js" type="text/javascript" ></script>
<script type="text/javascript">
        $(function(){

            var viewModelName = "Evidence_of_Weed_TreatmentViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Evidence of Weed Treatment";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                                self.data.evidenceOfPreviousWeedTreatment=ko.observableArray([]);
            self.transients.evidenceOfPreviousWeedTreatmentConstraints = ["Bio-control agents active","Dead plants","Foliar reduction","Death of growing tips","Leaf yellowing","Reduced seed production","Root/stem rot present","No evidence","Other (specify in notes)"];
                
        self.loadevidenceOfPreviousWeedTreatment = function (data) {
            if (data !== undefined) {
                $.each(data, function (i, obj) {
                    self.data.evidenceOfPreviousWeedTreatment.push(obj);
                });
        }};
        
            self.data.effectivenessOfPreviousWeedTreatment = ko.observable();

            self.data.recommendedWeedTreatment = ko.observable();
            self.transients.recommendedWeedTreatmentConstraints = ["Environmental management - Fire","Environmental management - moisture & nutrient control","Environmental management - over-planting","Chemical control - Foliar spraying","Chemical control - Basal bark spraying","Chemical control - Stem injection","Chemical control - Cut stump","Chemical control - Cut and swab","Chemical control - Stem scraper","Chemical control - Wick applicators","Mechanical control - Slashing","Mechanical control - Mowing","Mechanical control - Dozing","Mechanical control - Pushing","Mechanical control - Felling","Manual control - Hand pulling","Manual control - Grubbing/chipping","Biological control - Biological agents (indicate in notes)","Other (specify in notes)"];

            self.data.notes = ko.observable();
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                    
                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.loadevidenceOfPreviousWeedTreatment(data['evidenceOfPreviousWeedTreatment']);
                self.data['effectivenessOfPreviousWeedTreatment'](orZero(data['effectivenessOfPreviousWeedTreatment']));
                self.data['recommendedWeedTreatment'](data['recommendedWeedTreatment']);
                self.data['notes'](data['notes']);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Evidence of Weed Treatment') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koEvidence_of_Weed_Treatment"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        
        $(function(){

            var viewModelName = "Weed_Observation_/_Monitoring_DetailsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var WeedObservationMonitoringDetailsRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.weedSpecies =  new SpeciesViewModel(data['weedSpecies'], speciesLists);
            this.weedCoverHa = ko.observable(orZero(data['weedCoverHa']));
            this.weedInfestationDensity = ko.observable(orBlank(data['weedInfestationDensity']));
            self.transients.weedInfestationDensityConstraints = ["Few scattered plants","Sparse scattered patches","Sparse general cover","Moderately dense scattered patches","Moderately dense general cover","Dense patches","Dense general cover"];
            this.weedHealth = ko.observable(orBlank(data['weedHealth']));
            self.transients.weedHealthConstraints = ["Healthy","Stressed","Dead"];
            this.weedReproductiveStatus = ko.observable(orBlank(data['weedReproductiveStatus']));
            self.transients.weedReproductiveStatusConstraints = ["Flowering (FLWG)","Seeding (SEDG)","Vegetative & Mature (VGTV)","Immature (IMTR)","Not recorded (NRRS)"];
            this.weedStatus = ko.observable(orBlank(data['weedStatus']));
            self.transients.weedStatusConstraints = ["New Infestation","Active Infestation","Under control","Under monitoring","Closed","Unknown"];
            this.weedInspectionNotes = ko.observable(orBlank(data['weedInspectionNotes']));
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Weed Observation / Monitoring Details";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.weedObservationMonitoringDetails = ko.observableArray([]);
            self.selectedweedObservationMonitoringDetailsRow = ko.observable();
        

            self.loadweedObservationMonitoringDetails = function (data, append) {
                if (!append) {
                    self.data.weedObservationMonitoringDetails([]);
                }
                if (data === undefined) {
                    self.addweedObservationMonitoringDetailsRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.weedObservationMonitoringDetails.push(new WeedObservationMonitoringDetailsRow(obj));
                    });
                }
            };

            self.addweedObservationMonitoringDetailsRow = function () {
                var newRow = new WeedObservationMonitoringDetailsRow();
                self.data.weedObservationMonitoringDetails.push(newRow);
                
            };
            self.removeweedObservationMonitoringDetailsRow = function (row) {
                self.data.weedObservationMonitoringDetails.remove(row);
                
            };
            self.weedObservationMonitoringDetailsrowCount = function () {
                return self.data.weedObservationMonitoringDetails().length;
            };

            self.weedObservationMonitoringDetailsTableDataUploadVisible = ko.observable(false);
            self.showweedObservationMonitoringDetailsTableDataUpload = function() {
                self.weedObservationMonitoringDetailsTableDataUploadVisible(!self.weedObservationMonitoringDetailsTableDataUploadVisible());
            };

            self.weedObservationMonitoringDetailsTableDataUploadOptions = {
                    url:'/fieldcapture/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadweedObservationMonitoringDetails(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "weedObservationMonitoringDetailstemplate-upload",
                    downloadTemplateId: "weedObservationMonitoringDetailstemplate-download",
                    formData:{type:'Weed Observation / Monitoring Details', listName:'weedObservationMonitoringDetails'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                                    delete jsData.selectedweedObservationMonitoringDetailsRow;
                delete jsData.weedObservationMonitoringDetailsTableDataUploadOptions
                delete jsData.weedObservationMonitoringDetailsTableDataUploadVisible

                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.loadweedObservationMonitoringDetails(data.weedObservationMonitoringDetails);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Weed Observation / Monitoring Details') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koWeed_Observation_/_Monitoring_Details"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        
        $(function(){

            var viewModelName = "General_information_&_ParticipantsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "General information & Participants";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.surveyTime = ko.observable();

            self.data.surveyDuration = ko.observable();

            self.data.totalParticipants = ko.observable();

            self.data.samplerName = ko.observable();

            self.data.numberOfVolunteerParticipants = ko.observable();

            self.data.waterType = ko.observable();
            self.transients.waterTypeConstraints = ["Estuary","Freshwater stream / channel","Freshwater lake / dam","Saline stream / channel","Saline lake / dam"];
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                    
                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.data['surveyTime'](orZero(data['surveyTime']));
                self.data['surveyDuration'](orZero(data['surveyDuration']));
                self.data['totalParticipants'](orZero(data['totalParticipants']));
                self.data['samplerName'](data['samplerName']);
                self.data['numberOfVolunteerParticipants'](orZero(data['numberOfVolunteerParticipants']));
                self.data['waterType'](data['waterType']);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'General information & Participants') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koGeneral_information_&_Participants"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        
        $(function(){

            var viewModelName = "Environmental_Information_at_the_Time_of_SamplingViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Environmental Information at the Time of Sampling";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.rainfall7Days = ko.observable();
            self.transients.rainfall7DaysConstraints = ["Heavy","Moderate","Light","Nil"];

            self.data.rainfallMm = ko.observable();

            self.data.waterLevel = ko.observable();
            self.transients.waterLevelConstraints = ["Low","Medium","High","Flood","No flow","Dry / Isolated pool"];

            self.data.waterFlowRate = ko.observable();

            self.data.notes = ko.observable();
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                    
                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.data['rainfall7Days'](data['rainfall7Days']);
                self.data['rainfallMm'](orZero(data['rainfallMm']));
                self.data['waterLevel'](data['waterLevel']);
                self.data['waterFlowRate'](data['waterFlowRate']);
                self.data['notes'](data['notes']);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Environmental Information at the Time of Sampling') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koEnvironmental_Information_at_the_Time_of_Sampling"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        
        $(function(){

            var viewModelName = "Water_Quality_MeasurementsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Water Quality Measurements";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.airTemperature = ko.observable();

            self.data.surfaceWaterTemperature = ko.observable();

            self.data.surfaceWaterPh = ko.observable();

            self.data.surfaceWaterEc = ko.observable();

            self.data.waterTurbidity = ko.observable();

            self.data.surfaceWaterAvailableP = ko.observable();

            self.data.surfaceWaterTotalP = ko.observable();

            self.data.surfaceWaterDoMgl = ko.observable();

            self.data.surfaceWaterDoPcSat = ko.observable();

            self.data.surfaceWaterColiforms = ko.observable();

            self.data.surfaceWaterEcoli = ko.observable();

            self.data.surfaceWaterNitrates = ko.observable();

            self.data.surfaceWaterTotalN = ko.observable();

            self.data.instrumentCalibration = ko.observable();
            self.transients.instrumentCalibrationConstraints = ["Yes","No","Not applicable"];

            self.data.notes = ko.observable();
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                    
                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.data['airTemperature'](orZero(data['airTemperature']));
                self.data['surfaceWaterTemperature'](orZero(data['surfaceWaterTemperature']));
                self.data['surfaceWaterPh'](orZero(data['surfaceWaterPh']));
                self.data['surfaceWaterEc'](orZero(data['surfaceWaterEc']));
                self.data['waterTurbidity'](orZero(data['waterTurbidity']));
                self.data['surfaceWaterAvailableP'](orZero(data['surfaceWaterAvailableP']));
                self.data['surfaceWaterTotalP'](orZero(data['surfaceWaterTotalP']));
                self.data['surfaceWaterDoMgl'](orZero(data['surfaceWaterDoMgl']));
                self.data['surfaceWaterDoPcSat'](orZero(data['surfaceWaterDoPcSat']));
                self.data['surfaceWaterColiforms'](orZero(data['surfaceWaterColiforms']));
                self.data['surfaceWaterEcoli'](orZero(data['surfaceWaterEcoli']));
                self.data['surfaceWaterNitrates'](orZero(data['surfaceWaterNitrates']));
                self.data['surfaceWaterTotalN'](orZero(data['surfaceWaterTotalN']));
                self.data['instrumentCalibration'](data['instrumentCalibration']);
                self.data['notes'](data['notes']);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Water Quality Measurements') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koWater_Quality_Measurements"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        
        $(function(){

            var viewModelName = "Survey_InformationViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Survey Information";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.surveyId = ko.observable();

            self.data.surveyTitle = ko.observable();

            self.data.surveyObjectives = ko.observable();

            self.data.surveyLeader = ko.observable();

            self.data.surveyParticipants = ko.observable();

            self.data.surveyArea = ko.observable();

            self.data.surveyMethodologyName = ko.observable();

            self.data.surveyMethodologyDescription = ko.observable();
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                    
                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.data['surveyId'](data['surveyId']);
                self.data['surveyTitle'](data['surveyTitle']);
                self.data['surveyObjectives'](data['surveyObjectives']);
                self.data['surveyLeader'](data['surveyLeader']);
                self.data['surveyParticipants'](data['surveyParticipants']);
                self.data['surveyArea'](orZero(data['surveyArea']));
                self.data['surveyMethodologyName'](data['surveyMethodologyName']);
                self.data['surveyMethodologyDescription'](data['surveyMethodologyDescription']);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Survey Information') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koSurvey_Information"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        
        $(function(){

            var viewModelName = "Fauna_Survey_DetailsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var SurveyResultsRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.plotId = ko.observable(orBlank(data['plotId']));
            this.sampleSiteId = ko.observable(orBlank(data['sampleSiteId']));
            this.species =  new SpeciesViewModel(data['species'], speciesLists);
            this.numberOfOrganisms = ko.observable(orZero(data['numberOfOrganisms']));
            this.evidence = ko.observable(orBlank(data['evidence']));
            self.transients.evidenceConstraints = ["Living organism","Dead organism","Tracks","Scats","Debris from molting","Scratchings","Nest / burrow / lodgings","Other (specify in notes)"];
            this.sex = ko.observable(orBlank(data['sex']));
            self.transients.sexConstraints = ["Male","Female","Hermaphrodite","Undetermined","Other (specify in notes)"];
            this.lifeStage = ko.observable(orBlank(data['lifeStage']));
            self.transients.lifeStageConstraints = ["Juvenile","Adolescent","Pre-metamorphic","metamorphic juvenile","Larva","Nymph","Pupa","Adult - non reproductive","Adult - reproductive","Other (specify in notes)"];
            this.health = ko.observable(orBlank(data['health']));
            this.biologicalMaterialTaken = ko.observable(orBlank(data['biologicalMaterialTaken']));
            self.transients.biologicalMaterialTakenConstraints = ["Yes","No"];
            this.speciesNotes = ko.observable(orBlank(data['speciesNotes']));
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Fauna Survey Details";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.surveyResults = ko.observableArray([]);
            self.selectedsurveyResultsRow = ko.observable();
        

            self.loadsurveyResults = function (data, append) {
                if (!append) {
                    self.data.surveyResults([]);
                }
                if (data === undefined) {
                    self.addsurveyResultsRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.surveyResults.push(new SurveyResultsRow(obj));
                    });
                }
            };

            self.addsurveyResultsRow = function () {
                var newRow = new SurveyResultsRow();
                self.data.surveyResults.push(newRow);
                
            };
            self.removesurveyResultsRow = function (row) {
                self.data.surveyResults.remove(row);
                
            };
            self.surveyResultsrowCount = function () {
                return self.data.surveyResults().length;
            };

            self.surveyResultsTableDataUploadVisible = ko.observable(false);
            self.showsurveyResultsTableDataUpload = function() {
                self.surveyResultsTableDataUploadVisible(!self.surveyResultsTableDataUploadVisible());
            };

            self.surveyResultsTableDataUploadOptions = {
                    url:'/fieldcapture/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadsurveyResults(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "surveyResultstemplate-upload",
                    downloadTemplateId: "surveyResultstemplate-download",
                    formData:{type:'Fauna Survey Details', listName:'surveyResults'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.totalNumberOfOrganisms = ko.computed(function () {
                var total = 0;
                for(var i = 0; i < self.data.surveyResults().length; i++) {
                    var value = self.data.surveyResults()[i].numberOfOrganisms();
                        total = total + Number(value); 
                }
                return total;
            });

            self.data.notes = ko.observable();
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                                    delete jsData.selectedsurveyResultsRow;
                delete jsData.surveyResultsTableDataUploadOptions
                delete jsData.surveyResultsTableDataUploadVisible

                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.loadsurveyResults(data.surveyResults);
                self.data['notes'](data['notes']);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Fauna Survey Details') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koFauna_Survey_Details"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        
        $(function(){

            var viewModelName = "Flora_Survey_DetailsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var SurveyResultsFloraRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.plotId = ko.observable(orBlank(data['plotId']));
            this.sampleSiteId = ko.observable(orBlank(data['sampleSiteId']));
            this.species =  new SpeciesViewModel(data['species'], speciesLists);
            this.numberOfOrganisms = ko.observable(orZero(data['numberOfOrganisms']));
            this.stratum = ko.observable(orBlank(data['stratum']));
            self.transients.stratumConstraints = ["Canopy","Sub-canopy","Mid-stratum","Shrub layer","Ground stratum"];
            this.aveHeight = ko.observable(orZero(data['aveHeight']));
            this.dbh = ko.observable(orZero(data['dbh']));
            this.health = ko.observable(orBlank(data['health']));
            this.biologicalMaterialTaken = ko.observable(orBlank(data['biologicalMaterialTaken']));
            self.transients.biologicalMaterialTakenConstraints = ["Yes","No"];
            this.speciesNotes = ko.observable(orBlank(data['speciesNotes']));
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Flora Survey Details";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.surveyResultsFlora = ko.observableArray([]);
            self.selectedsurveyResultsFloraRow = ko.observable();
        

            self.loadsurveyResultsFlora = function (data, append) {
                if (!append) {
                    self.data.surveyResultsFlora([]);
                }
                if (data === undefined) {
                    self.addsurveyResultsFloraRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.surveyResultsFlora.push(new SurveyResultsFloraRow(obj));
                    });
                }
            };

            self.addsurveyResultsFloraRow = function () {
                var newRow = new SurveyResultsFloraRow();
                self.data.surveyResultsFlora.push(newRow);
                
            };
            self.removesurveyResultsFloraRow = function (row) {
                self.data.surveyResultsFlora.remove(row);
                
            };
            self.surveyResultsFlorarowCount = function () {
                return self.data.surveyResultsFlora().length;
            };

            self.surveyResultsFloraTableDataUploadVisible = ko.observable(false);
            self.showsurveyResultsFloraTableDataUpload = function() {
                self.surveyResultsFloraTableDataUploadVisible(!self.surveyResultsFloraTableDataUploadVisible());
            };

            self.surveyResultsFloraTableDataUploadOptions = {
                    url:'/fieldcapture/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadsurveyResultsFlora(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "surveyResultsFloratemplate-upload",
                    downloadTemplateId: "surveyResultsFloratemplate-download",
                    formData:{type:'Flora Survey Details', listName:'surveyResultsFlora'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.totalNumberOfOrganisms = ko.computed(function () {
                var total = 0;
                for(var i = 0; i < self.data.surveyResultsFlora().length; i++) {
                    var value = self.data.surveyResultsFlora()[i].numberOfOrganisms();
                        total = total + Number(value); 
                }
                return total;
            });

            self.data.soilSampleCollected = ko.observable();

            self.data.notes = ko.observable();
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                                    delete jsData.selectedsurveyResultsFloraRow;
                delete jsData.surveyResultsFloraTableDataUploadOptions
                delete jsData.surveyResultsFloraTableDataUploadVisible

                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.loadsurveyResultsFlora(data.surveyResultsFlora);
                self.data['soilSampleCollected'](data['soilSampleCollected']);
                self.data['notes'](data['notes']);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Flora Survey Details') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koFlora_Survey_Details"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        
        $(function(){

            var viewModelName = "Revegetation_Monitoring_ResultsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var RevegetationMonitoringRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.species =  new SpeciesViewModel(data['species'], speciesLists);
            this.numberPlanted = ko.observable(orZero(data['numberPlanted']));
            this.seedSown = ko.observable(orZero(data['seedSown']));
            this.numberSurviving = ko.observable(orZero(data['numberSurviving']));
            this.survivalRate = ko.observable(orZero(data['survivalRate']));
            this.notes = ko.observable(orBlank(data['notes']));
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Revegetation Monitoring Results";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.revegetationType = ko.observable();
            self.transients.revegetationTypeConstraints = ["Direct drill seeding","Hand broardcast seeding","Hand planting","Machine planting","Natural regeneration from threat exclusion / removal"];

            self.data.countingMethod = ko.observable();
            self.transients.countingMethodConstraints = ["Direct count","Calculated estimate - stratified sample (plot-based)","Calculated estimate - stratified sample (transect-based)","Extrapolated estimate - non-stratified sample","Remote sensing estimate"];

            self.data.revegetationMonitoring = ko.observableArray([]);
            self.selectedrevegetationMonitoringRow = ko.observable();
        

            self.loadrevegetationMonitoring = function (data, append) {
                if (!append) {
                    self.data.revegetationMonitoring([]);
                }
                if (data === undefined) {
                    self.addrevegetationMonitoringRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.revegetationMonitoring.push(new RevegetationMonitoringRow(obj));
                    });
                }
            };

            self.addrevegetationMonitoringRow = function () {
                var newRow = new RevegetationMonitoringRow();
                self.data.revegetationMonitoring.push(newRow);
                
            };
            self.removerevegetationMonitoringRow = function (row) {
                self.data.revegetationMonitoring.remove(row);
                
            };
            self.revegetationMonitoringrowCount = function () {
                return self.data.revegetationMonitoring().length;
            };

            self.revegetationMonitoringTableDataUploadVisible = ko.observable(false);
            self.showrevegetationMonitoringTableDataUpload = function() {
                self.revegetationMonitoringTableDataUploadVisible(!self.revegetationMonitoringTableDataUploadVisible());
            };

            self.revegetationMonitoringTableDataUploadOptions = {
                    url:'/fieldcapture/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadrevegetationMonitoring(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "revegetationMonitoringtemplate-upload",
                    downloadTemplateId: "revegetationMonitoringtemplate-download",
                    formData:{type:'Revegetation Monitoring Results', listName:'revegetationMonitoring'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.totalNumberPlanted = ko.computed(function () {
                var total = 0;
                for(var i = 0; i < self.data.revegetationMonitoring().length; i++) {
                    var value = self.data.revegetationMonitoring()[i].numberPlanted();
                        total = total + Number(value); 
                }
                return total;
            });

            self.data.totalNumberSurviving = ko.computed(function () {
                var total = 0;
                for(var i = 0; i < self.data.revegetationMonitoring().length; i++) {
                    var value = self.data.revegetationMonitoring()[i].numberSurviving();
                        total = total + Number(value); 
                }
                return total;
            });
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                                    delete jsData.selectedrevegetationMonitoringRow;
                delete jsData.revegetationMonitoringTableDataUploadOptions
                delete jsData.revegetationMonitoringTableDataUploadVisible

                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.data['revegetationType'](data['revegetationType']);
                self.data['countingMethod'](data['countingMethod']);
                self.loadrevegetationMonitoring(data.revegetationMonitoring);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Revegetation Monitoring Results') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koRevegetation_Monitoring_Results"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        


    /* Master controller for page. This handles saving each model as required. */
    var Master = function () {
        var self = this;
        this.subscribers = [];
        // client models register their name and methods to participate in saving
        self.register = function (modelInstanceName, getMethod, isDirtyMethod, resetMethod) {
            this.subscribers.push({
                model: modelInstanceName,
                get: getMethod,
                isDirty: isDirtyMethod,
                reset: resetMethod
            });
        };
        // master isDirty flag for the whole page - can control button enabling
        this.isDirty  = function () {
            var dirty = false;
            $.each(this.subscribers, function(i, obj) {
                dirty = dirty || obj.isDirty();
            });
            return dirty;
        };
        /**
         * Makes an ajax call to save any sections that have been modified. This includes the activity
         * itself and each output.
         *
         * Modified outputs are injected as a list into the activity object. If there is nothing to save
         * in the activity itself, then the root is an object that is empty except for the outputs list.
         *
         * NOTE that the model for each section must register itself to be included in this save.
         *
         * Validates the entire page before saving.
         */
        this.save = function () {

            var activityData, outputs = [];
            if ($('#validation-container').validationEngine('validate')) {
                $.each(this.subscribers, function(i, obj) {
                   // if (obj.isDirty()) {
                        if (obj.model === 'activityModel') {
                            activityData = obj.get();
                        } else {
                            outputs.push(obj.get());
                        }
                    //}
                });
                if (outputs.length === 0 && activityData === undefined) {
                    alert("Nothing to save.");
                    return;
                }
                if (activityData === undefined) { activityData = {}}
                activityData.outputs = outputs;

                var toSave = JSON.stringify(activityData);
                console.log("saving"+toSave);
                mobileBindings.saveActivity(toSave);

            }

        };

        this.reset = function () {
            $.each(this.subscribers, function(i, obj) {
                if (obj.isDirty()) {
                    obj.reset();
                }
            });
        };
    };

    if (mobileBindings == undefined) {
        var mobileBindings = {
        
            loadActivity:function(){return "{}"},
        
        
            loadSites:function(){return "[]"},
        

        saveActivity:function(){}
    };
}
var master = new Master();
var activity = JSON.parse(mobileBindings.loadActivity());
var themes = ['theme1', 'theme2'];

var sites = JSON.parse(mobileBindings.loadSites());


$(function(){

    $('#validation-container').validationEngine('attach', {scroll: false});

    $('.helphover').popover({animation: true, trigger:'hover'});

    $('#reset').click(function () {
        master.reset();
    });


    ko.bindingHandlers.editOutput = {
        init: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
            var outputName = ko.utils.unwrapObservable(valueAccessor()),
                activity = bindingContext.$root,
                outputId;

            // search for corresponding outputs in the activity data
            $.each(activity.outputs, function (i,output) { // iterate output data in the activity to
                                                              // find any matching the meta-model name
                if (output.name === outputName) {
                    outputId = output.outputId;
                }
            });
            if (outputId) {
                // build edit link
                $(element).html('Edit data');
                $(element).attr('href', fcConfig.serverUrl + "/output/edit/" + outputId +
                    "?returnTo=" + here);
            } else {
                // build create link
                $(element).attr('href', fcConfig.serverUrl + '/output/create?activityId=' + activity.activityId +
                    '&outputName=' + encodeURIComponent(outputName) +
                    "&returnTo=" + here);
            }
        }
    };

    function ViewModel (act, sites) {
        var self = this;
        self.activityId = act.activityId;
        self.description = ko.observable(act.description);
        self.notes = ko.observable(act.notes);
        self.startDate = ko.observable(act.startDate).extend({simpleDate: false});
        self.endDate = ko.observable(act.endDate || act.plannedEndDate).extend({simpleDate: false});
        self.plannedStartDate = ko.observable(act.plannedStartDate).extend({simpleDate: false});
        self.plannedEndDate = ko.observable(act.plannedEndDate).extend({simpleDate: false});
        self.eventPurpose = ko.observable(act.eventPurpose);
        self.fieldNotes = ko.observable(act.fieldNotes);
        self.associatedProgram = ko.observable(act.associatedProgram);
        self.associatedSubProgram = ko.observable(act.associatedSubProgram);
        self.progress = ko.observable(act.progress);
        self.mainTheme = ko.observable(act.mainTheme);
        self.type = ko.observable(act.type);
        self.siteId = ko.observable(act.siteId);
        self.projectId = act.projectId;
        self.transients = {};
        self.transients.sites = sites;
        self.transients.activityProgressValues = ['planned','started','finished'];
        self.transients.themes = themes;
        self.transients.markedAsFinished = ko.observable(act.progress === 'finished');
        self.transients.markedAsFinished.subscribe(function (finished) {
            self.progress(finished ? 'finished' : 'started');
        });
        self.transients.siteImgUrl = ko.computed(function() {
            if (self.siteId()) {
                 var site = $.grep(self.transients.sites, function(site, index) { return site.siteId == self.siteId(); })[0];
                 if (site && site.extent && site.extent.geometry && site.extent.geometry.centre) {
                    return  "http://maps.googleapis.com/maps/api/staticmap?maptype=terrian&zoom=12&sensor=false&size=250x200&markers=color:red%7C"+site.extent.geometry.centre[1]+","+site.extent.geometry.centre[0]+"&centre=false";
                 }
            }
            return "";
        });

        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.toJS(self);
            delete jsData.transients;
            return jsData;
        };
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.save = function (callback, key) {
        };

        self.notImplemented = function () {
            alert("Not implemented yet.")
        };
        self.dirtyFlag = ko.dirtyFlag(self, false);

        // make sure progress moves to started if we save any data (unless already finished)
        // (do this here so the model becomes dirty)
        self.progress(self.transients.markedAsFinished() ? 'finished' : 'started');
    }


    var viewModel = new ViewModel(activity, sites);

    ko.applyBindings(viewModel);

    master.register('activityModel', viewModel.modelForSaving, viewModel.dirtyFlag.isDirty, viewModel.dirtyFlag.reset);
});
</script>
</body>
</html>
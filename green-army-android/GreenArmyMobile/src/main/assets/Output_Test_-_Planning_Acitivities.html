

<!DOCTYPE html>
<head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <style type="text/css">
        input[type=checkbox] {
            -webkit-transform: scale(1.5); margin:50px;
        }
    </style>
    
    <script src="static/UGoJGyG3j2UCffTg3vnOdi0FsnS2OvrmrsZD6WxaXGy.js" type="text/javascript" ></script>
<link href="static/Eu8FNKwJJQI8mVJO3VIshatRN1bunflYHvvdqk06tbf.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="static/090onaZX1M508oSWqGmMeETZ9NkUA9p4CCTW3MUpRPc.css" type="text/css" rel="stylesheet" media="screen, projection" />

<link href="static/CidRUyEAqkZsnDRPRiaGZBy7vd4DOlnRqweu4CsVcIG.css" type="text/css" rel="stylesheet" media="screen" />
<link href="static/tDKPE9VWZfBnSnxBkPC52ml2dXticvlQDl9aR8VpM2o.css" type="text/css" rel="stylesheet" media="screen, projection" />
<!--[if lt IE 7]><link href="static/v1vjA9BeNpSU8cuoTuVhTEUm6boSzwYQcgfPKKMkqgv.css" type="text/css" rel="stylesheet" media="screen, projection" /><![endif]-->

<link href="http://www.ala.org.au/wp-content/themes/ala2011/images/favicon.ico" rel="shortcut icon" />
<!--[if lt IE 9]><script src="static/Yh1Txee3hFzExJ4P1str7tGV24zQMEYtxqtlYJ5ukR0.js" type="text/javascript" ></script><![endif]-->
<link href="static/6tuLClj7N5eYCZpx7vLn8juIbQUXBkCnWRUJFY7UDCz.css" type="text/css" rel="stylesheet" media="screen,print" />
<link href="/static/7ARiB2rJgSkfi68hxnSlcG9Ot0gQ863DYxkCmSHQweE.png" rel="shortcut icon" />
<link href="/static/14SWTr4VqVh6tnlUlgBtue6IJZ7gwE1y42RT7ya5GGW.png" rel="shortcut icon" />

<link href="static/KYGDEVRRaKjNbTXJkHmicmzo9vFrnnzCnGLcxKjR04f.css" type="text/css" rel="stylesheet" media="screen,print" />

<link href="static/uUQBvO5ITMKwLfoRb2u62GbHXEzxtsbrSWq8MBAOrbX.css" type="text/css" rel="stylesheet" media="screen,print" />
<link href="static/2OXdKoom668LE7PLl0qjJCaLG7Pu7Jv869tAsS4e1oT.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="static/AcXIjLTuc87n8sfxBjJRQSoBIUwP9RnCyK8Sv82i7eV.css" type="text/css" rel="stylesheet" media="screen, projection" />
<script type="text/javascript">
    var fcConfig = {
        serverUrl: "https://fieldcapture-test.ala.org.au",
        activityUpdateUrl: "/activity/ajaxUpdate",
        activityDeleteUrl: "/activity/ajaxDelete",
        projectViewUrl: "/project/index/",
        siteViewUrl: "/site/index/",
        bieUrl: "http://bie.ala.org.au",
        speciesProfileUrl: "/proxy/speciesProfile"
        },
        here = document.location.href;
    </script>
    

    <meta name="layout" content="mobile"/>

    
    

</head>

<body>

<div id="content" class="clearfix">
    
<div class="container-fluid validationEngineContainer" id="validation-container">
<div id="koActivityMainBlock">

    <div class="row-fluid">
        <div class="span12">
            <!-- Common activity fields -->

            <div class="row-fluid space-after">
                <div class="span4">

                    <label class="for-readonly">Type</label>
                    <span class="readonly-text" data-bind="text:type"></span>
                </div>
                <div class="span8">

                    <label class="for-readonly">Description</label>
                    <span class="readonly-text" data-bind="text:description"></span>
                </div>
            </div>


            <div class="row-fluid space-after">
                <div class="span4">
                    <label class="for-readonly inline">Planned start date</label>
                    <span class="readonly-text" data-bind="text:plannedStartDate.formattedDate"></span>
                </div>
                <div class="span8">
                    <label class="for-readonly inline">Planned end date</label>
                    <span class="readonly-text" data-bind="text:plannedEndDate.formattedDate"></span>
                </div>
            </div>

            <div class="well">

            <div class="row-fluid space-after">
                <div class="span4 required">
                    <label for="startDate"><b>Actual start date</b>
                        <a href='#' class='helphover' data-original-title='Start date' data-placement='top' data-content='Date the activity was started.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a>
                    </label>


                    <div class="input-append">
                        <input data-bind='datepicker:startDate.date' name='startDate' id='startDate' type='text' size='16' class='input-xlarge' targetField='startDate.date' data-validation-engine='validate[required]' />
<span class='add-on open-datepicker'>
  <i class='icon-th'>&nbsp;</i>
</span>
                    </div>

                </div>
                <div class="span8 required">
                    <label for="endDate"><b>Actual end date</b>
                        <a href='#' class='helphover' data-original-title='End date' data-placement='top' data-content='Date the activity finished.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a>
                    </label>

                    <div class="input-append">
                        <input data-bind='datepicker:endDate.date' name='endDate' id='endDate' type='text' size='16' class='input-xlarge' targetField='endDate.date' data-validation-engine='validate[future[startDate]]' />
<span class='add-on open-datepicker'>
  <i class='icon-th'>&nbsp;</i>
</span>
                    </div>

                </div>
            </div>
            <div class="row-fluid space-after">
                <div class="span6">
                    <label for="theme"><b>Major theme</b></label>
                    <select id="theme" data-bind="value:mainTheme, options:transients.themes, optionsCaption:'Choose..'" class="input-xlarge">
                    </select>
                </div>

            </div>
            <div class="row-fluid">
                <div class="span4">
                    <label for="site"><b>Site</b></label>
                    <select id='site' width='100%' data-bind='options:transients.sites,optionsText:"name",optionsValue:"siteId",value:siteId,optionsCaption:"Choose a site..."'>&nbsp;</select>

                    <br/>Leave blank if this activity is not associated with a specific site.

                </div>

                <div class="span2">
                    <button class="btn btn-info" data-bind="click:createNewSite">Create new Site</button>
                </div>

                <div class="span6">
                    <img width="250" height="200" data-bind="attr:{src:transients.siteImgUrl}"/>
                </div>


            </div>
            </div>
        </div>
    </div>

</div>

<!-- ko stopBinding: true -->

    
    
    
    <div class="output-block" id="koPlan_Development_Details">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Plan Development Details<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after output-section" >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Type of planning being undertaken:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Categorisation of the type of plan developed'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.typeOfPlan,options:transients.typeOfPlanConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Name of the plan being developed:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The title of the product of the planning process'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input  class="span8 input-small" data-bind='value:data.nameOfPlan'  data-validation-engine='validate[required]' type='text' class='input-small'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Is this a new Plan or a revision of an existing Plan?:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Version of plan being developed'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.versionOfPlan,options:transients.versionOfPlanConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Version number of the plan being developed:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Revision number of the version of plan being developed'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input  class="span8 input-small" data-bind='value:data.versionRevisionNo'  type='text' class='input-small'/></span></div></div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Area of plan coverage (km2):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The area in square kilometres that the plan covers'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.planCoverageArea' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Date that the plan was completed:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The date that the plan was completed or authorised (not implemented)'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><div class="input-append"><input data-bind="datepicker:data.planCompletionDate.date" type="text" size="12"/><span class="add-on open-datepicker"><i class="icon-th"></i></span></div></span></div><div class="row-fluid"><span class="span12">    <span  class="span8"><h4>Please attach a copy of the Plan document via the Admin tab</h4></span></span></div></div></div>
<div class="row-fluid space-after output-section" >
<span class="span6">    <span  class="preLabel"><label>Describe what you are doing in this planning activity:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Brief description of the planning process, outputs from it, and objectives of the plan'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span12" data-bind='value:data.activityOutline'></textarea></span><span class="span6">    <span  class="preLabel"><label>Comments / Notes:</label></span><textarea  class="span12" data-bind='value:data.notes'></textarea></span></div>

        
    </div>

    
    
    <style type="text/css">
        table.riskTable td:nth-child(1) {width:30%;}
        table.riskTable td:nth-child(1) select {width:100%;}
        table.riskTable td:nth-child(2) {width:40%;}
        table.riskTable td:nth-child(2) select {width:100%;}
        table.riskTable td:nth-child(3) {width:10%;}
        table.riskTable td:nth-child(3) select {width:100%;}
        table.riskTable td:nth-child(4) {width:10%;}
        table.riskTable td:nth-child(4) select {width:100%;}
        table.riskTable td:nth-child(5) {width:10%;}
        table.riskTable td:nth-child(5) select {width:100%;}
        table.riskTable td:last-child {width:4%;text-align:center;}
        table.riskTable textarea {width:98%;}
    </style>
    <div class="output-block" id="koThreatening_Processes_&_Site_Condition_Risks">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Threatening Processes & Site Condition Risks<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid output-section">
            <table class="table table-bordered riskTable " >
                <thead><tr><th>Type of threat/risk</th><th>Description</th><th>Likelihood</th><th>Consequence</th><th>Risk rating</th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'riskTableviewTmpl', foreach: data.riskTable}"></tbody>
                <script id="riskTableviewTmpl" type="text/html"><tr>
                    <td><select data-bind='value:riskType,options:transients.riskTypeConstraints,optionsCaption:"Please select"'></select></td>
                    <td><textarea  data-bind='value:riskDescription'></textarea></td>
                    <td><select data-bind='value:riskLikelihood,options:transients.riskLikelihoodConstraints,optionsCaption:"Please select"'></select></td>
                    <td><select data-bind='value:riskConsequence,options:transients.riskConsequenceConstraints,optionsCaption:"Please select"'></select></td>
                    <td><select data-bind='value:riskRating,options:transients.riskRatingConstraints,optionsCaption:"Please select"'></select></td>
                    <td><i data-bind='click:$root.removeriskTableRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr><td colspan="0" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addriskTableRow">
                        <i class="icon-plus"></i> Add a row</button>
                        <button type="button" class="btn btn-small" data-bind="click:showriskTableTableDataUpload"><i class="icon-upload"></i> Upload data for this table</button>


                    </td></tr>
<tr data-bind="visible:riskTableTableDataUploadVisible"><td colspan="0">
                <div class="text-error text-left">
                    Note: Only valid exact scientific names will be matched and populated from the database (indicated by a green tick). Unmatched species will load, but will be indicated by a green <b>?</b>. Please check your uploaded data and correct as required.
                </div>
                <div class="text-left" style="margin:5px">
                    <a href="/proxy/excelOutputTemplate?type=Threatening Processes & Site Condition Risks&listName=riskTable" target="riskTableTemplateDownload" class="btn">Step 1 - Download template (.xlsx)</a>
                </div>
                <div class="text-left" style="margin:5px;">
                    <input type="checkbox" data-bind="checked:appendTableRows" style="margin-right:5px">Append uploaded data to table (unticking this checkbox will result in all table rows being replaced)
                </div>

                <div class="btn fileinput-button" style="margin-left:5px">
                        <input id="riskTableTableDataUpload" type="file" name="data" data-bind="fileUploadNoImage:riskTableTableDataUploadOptions">
                        Step 2 - Upload populated template
                </div>

                    </td></tr> <script id="riskTabletemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="riskTabletemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>

        
    </div>

    
    
    <style type="text/css">
        table.plannedActions td:nth-child(1) {width:35%;}
        table.plannedActions td:nth-child(1) select {width:100%;}
        table.plannedActions td:nth-child(2) {width:50%;}
        table.plannedActions td:nth-child(2) select {width:100%;}
        table.plannedActions td:nth-child(3) {width:15%;text-align:center;}
        table.plannedActions td:nth-child(3) select {width:100%;}
        table.plannedActions td:last-child {width:4%;text-align:center;}
        table.plannedActions textarea {width:98%;}
    </style>
    <div class="output-block" id="koPlanned_Monitoring_Approach">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Planned Monitoring Approach<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after " >
<span class="span12">    <span  class="span12">Please indicate what assessment / monitoring methodology(s) you are planning to use on each of the areas which you are intending to monitor.</span></span></div>
<div class="row-fluid output-section">
            <table class="table table-bordered plannedActions " >
                <thead><tr><th>Type of monitoring activity planned:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The type of monitoring activity(s) to be undertaken on this site.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Monitoring approach:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Brief description of how the type of monitoring activity will be undertaken on the site.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th class="required">No. of monitoring areas of type within the site:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of individual monitoring points/ares (points of interest) within the specified site for each type of monitoring activity.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'plannedActionsviewTmpl', foreach: data.plannedActions}"></tbody>
                <script id="plannedActionsviewTmpl" type="text/html"><tr>
                    <td><select data-bind='value:plannedActivityType,options:transients.plannedActivityTypeConstraints,optionsCaption:"Please select"'></select></td>
                    <td><textarea  data-bind='value:plannedActivityDescription'></textarea></td>
                    <td><input class="input-small" style="text-align:center" data-bind='value:noOfMonitoringAreas' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><i data-bind='click:$root.removeplannedActionsRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr><td colspan="0" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addplannedActionsRow">
                        <i class="icon-plus"></i> Add a row</button>
                        <button type="button" class="btn btn-small" data-bind="click:showplannedActionsTableDataUpload"><i class="icon-upload"></i> Upload data for this table</button>


                    </td></tr>
<tr data-bind="visible:plannedActionsTableDataUploadVisible"><td colspan="0">
                <div class="text-error text-left">
                    Note: Only valid exact scientific names will be matched and populated from the database (indicated by a green tick). Unmatched species will load, but will be indicated by a green <b>?</b>. Please check your uploaded data and correct as required.
                </div>
                <div class="text-left" style="margin:5px">
                    <a href="/proxy/excelOutputTemplate?type=Planned Monitoring Approach&listName=plannedActions" target="plannedActionsTemplateDownload" class="btn">Step 1 - Download template (.xlsx)</a>
                </div>
                <div class="text-left" style="margin:5px;">
                    <input type="checkbox" data-bind="checked:appendTableRows" style="margin-right:5px">Append uploaded data to table (unticking this checkbox will result in all table rows being replaced)
                </div>

                <div class="btn fileinput-button" style="margin-left:5px">
                        <input id="plannedActionsTableDataUpload" type="file" name="data" data-bind="fileUploadNoImage:plannedActionsTableDataUploadOptions">
                        Step 2 - Upload populated template
                </div>

                    </td></tr> <script id="plannedActionstemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="plannedActionstemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>Notes</label></span><textarea  class="span12" data-bind='value:data.notes'></textarea></span></div>

        
    </div>

    
    
    <style type="text/css">
        table.plannedActions td:nth-child(1) {width:25%;}
        table.plannedActions td:nth-child(1) select {width:100%;}
        table.plannedActions td:nth-child(2) {width:25%;}
        table.plannedActions td:nth-child(2) select {width:100%;}
        table.plannedActions td:nth-child(3) {width:35%;}
        table.plannedActions td:nth-child(3) select {width:100%;}
        table.plannedActions td:nth-child(4) {width:15%;text-align:center;}
        table.plannedActions td:nth-child(4) select {width:100%;}
        table.plannedActions td:last-child {width:4%;text-align:center;}
        table.plannedActions textarea {width:98%;}
    </style>
    <div class="output-block" id="koSite_Planning_Details">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Site Planning Details<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after " >
<span class="span12">    <span  class="span12">Please indicate what you are planning to do on each works area within your selected site.</span></span></div>
<div class="row-fluid output-section">
            <table class="table table-bordered plannedActions " >
                <thead><tr><th class="required">Name of works area:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Short title for the works/activity area (point of interest) to enable it to be easily identified and referred to.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Type of activity planned:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The type of activity(s) to be undertaken on this site.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Description of planned activities:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Brief description of the activity / works to be implemented.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th class="required">No. of works areas within the site:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of individual works and/or activity ares (points of interest) within the specified site for each selected activity type.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'plannedActionsviewTmpl', foreach: data.plannedActions}"></tbody>
                <script id="plannedActionsviewTmpl" type="text/html"><tr>
                    <td><input  class="input-medium" data-bind='value:worksAreaTitle'  data-validation-engine='validate[required]' type='text' class='input-small'/></td>
                    <td><select data-bind='value:plannedActivityType,options:transients.plannedActivityTypeConstraints,optionsCaption:"Please select"'></select></td>
                    <td><textarea  data-bind='value:plannedActivityDescription'></textarea></td>
                    <td><input class="input-small" style="text-align:center" data-bind='value:noOfWorksAreas' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><i data-bind='click:$root.removeplannedActionsRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr>
                    <td colspan='2'><span ></span></td>
                    <td><span >Total No. of activity areas:</span></td>
                    <td><span  class="value" data-bind='text:data.noOfWorksAreasTotal'></span></td>
                    <td></td>
                </tr>
                <tr><td colspan="5" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addplannedActionsRow">
                        <i class="icon-plus"></i> Add a row</button>
                        <button type="button" class="btn btn-small" data-bind="click:showplannedActionsTableDataUpload"><i class="icon-upload"></i> Upload data for this table</button>


                    </td></tr>
<tr data-bind="visible:plannedActionsTableDataUploadVisible"><td colspan="5">
                <div class="text-error text-left">
                    Note: Only valid exact scientific names will be matched and populated from the database (indicated by a green tick). Unmatched species will load, but will be indicated by a green <b>?</b>. Please check your uploaded data and correct as required.
                </div>
                <div class="text-left" style="margin:5px">
                    <a href="/proxy/excelOutputTemplate?type=Site Planning Details&listName=plannedActions" target="plannedActionsTemplateDownload" class="btn">Step 1 - Download template (.xlsx)</a>
                </div>
                <div class="text-left" style="margin:5px;">
                    <input type="checkbox" data-bind="checked:appendTableRows" style="margin-right:5px">Append uploaded data to table (unticking this checkbox will result in all table rows being replaced)
                </div>

                <div class="btn fileinput-button" style="margin-left:5px">
                        <input id="plannedActionsTableDataUpload" type="file" name="data" data-bind="fileUploadNoImage:plannedActionsTableDataUploadOptions">
                        Step 2 - Upload populated template
                </div>

                    </td></tr> <script id="plannedActionstemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="plannedActionstemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>Comments / Notes</label></span><textarea  class="span12" data-bind='value:data.notes'></textarea></span></div>

        
    </div>

<!-- /ko -->

</div>




</div>

<script src="static/DzazZ2ePykd4QRUJlInoAO1LMvzeVxjM2JRcis2usBm.js" type="text/javascript" ></script>



<script src="static/N1Pu1Yy1dAP26vjRfEw0sZtbZhL03ir303dL4C7EaVF.js" type="text/javascript" ></script>

<script src="static/gfz9yoFSoT3bDIgFJCbjPP9WLeFgekRHSp7KxcpYrwj.js" type="text/javascript" ></script>
<script src="static/HpQC03jqzgdovdmQNni1bswagCkkBPaWGDIzgICGcvq.js" type="text/javascript" ></script>









<!--[if gte IE 8]><script src="static/knxjs4G9Cquc79O3iYW107XikPB1Z1ii8QWrtBpzlSP.js" type="text/javascript" ></script><![endif]-->
<script src="static/kSJb30BxnBzyoP0WndxrtZbaNWzT8x6LP2Cp7xI9PH4.js" type="text/javascript" ></script>
<script src="static/NbeGWZssK95I6Y1Oz4lzxzRtDzf9dyFLZiTstPEonQa.js" type="text/javascript" ></script>
<script src="static/L85LaBY6yhQwMk24PuXWgqwvtkfvbmMZ3ExPR9xK96.js" type="text/javascript" ></script>
<script src="static/MZjUSqmNLHqbPwhDcAMpejU18pr9ndMRCGKpPBHdSDL.js" type="text/javascript" ></script>
<script src="static/w51VyweI3KQvr6P2DTUzBcR9OpWeX0ktL7UktpeA1k.js" type="text/javascript" ></script>





<script src="static/7l2mDQFFpMnG14cXQPTKd94AN71T8yUF6dHUA2LCJIo.js" type="text/javascript" ></script>
<script src="static/ZbrF5cz3bJrkAqBXLrAlOmoaIYntVDIKpviQs5E8Rhy.js" type="text/javascript" ></script>
<script src="static/yzVPTi9KJTOMgo1ytEFVw7JiBXXkkbj5dU3cYZoIuS.js" type="text/javascript" ></script>

<script src="static/IZCc6ZgD3MepYbz4UqlDLzMDNNghSCivcfGebmF9V2d.js" type="text/javascript" ></script>
<script type="text/javascript">
        $(function(){

            var viewModelName = "Plan_Development_DetailsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Plan Development Details";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.typeOfPlan = ko.observable();
            self.transients.typeOfPlanConstraints = ["Implementation works design","Project arrangements and governance","Regional plan","Catchment plan","Resource management plan","Marine protection plan","Property or Reserve plan","Recovery plan","Burn plan (fire management)","Other (specify in notes)"];

            self.data.nameOfPlan = ko.observable();

            self.data.versionOfPlan = ko.observable();
            self.transients.versionOfPlanConstraints = ["New plan","Revision of an existing plan"];

            self.data.versionRevisionNo = ko.observable();

            self.data.planCoverageArea = ko.observable();

            self.data.planCompletionDate = ko.observable().extend({simpleDate: false});

            self.data.activityOutline = ko.observable();

            self.data.notes = ko.observable();
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                    
                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.data['typeOfPlan'](data['typeOfPlan']);
                self.data['nameOfPlan'](data['nameOfPlan']);
                self.data['versionOfPlan'](data['versionOfPlan']);
                self.data['versionRevisionNo'](data['versionRevisionNo']);
                self.data['planCoverageArea'](orZero(data['planCoverageArea']));
                self.data['planCompletionDate'](data['planCompletionDate']);
                self.data['activityOutline'](data['activityOutline']);
                self.data['notes'](data['notes']);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Plan Development Details') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koPlan_Development_Details"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        
        $(function(){

            var viewModelName = "Threatening_Processes_&_Site_Condition_RisksViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var RiskTableRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.riskType = ko.observable(orBlank(data['riskType']));
            self.transients.riskTypeConstraints = ["Climate change","Cropping & root zone disturbance","Defoliation - birds","Defoliation - insects","Defoliation - other","Disease - animals","Disease - plants","Drainage - prolonged soil profile drying","Fishing / aquaculture impacts - commercial over-fishing","Fishing / aquaculture impacts - recreational over-fishing","Fishing / aquaculture impacts - fishing bycatch","Fishing / aquaculture impacts - drifting ghost nets","Fishing / aquaculture impacts - escaped stock","Fishing / aquaculture impacts - nutrification","Fire - managed fire frequency","Fire - managed fire intensity","Fire - wildfire","Flood - frequency","Flood - intensity","Flood - prolonged inundation","Grazing pressure - domestic stock","Grazing pressure - pest animals","Grazing pressure - native wildlife","Impacts from public access / visitation - pedestrian","Impacts from public access / visitation - vehicular","Invasive and pest animals","Invasive weeds","Mistletoe or other parasite/fungal infestations","Soil acidification or acid-sulphate soils","Soil compaction - animal/human/machinery","Soil nutrient enrichment/eutrophication","Soil salinity","Urbanisation / subdivision","Weedicides/pesticides or chemical contamination","Other (specify in notes)"];
            this.riskDescription = ko.observable(orBlank(data['riskDescription']));
            this.riskLikelihood = ko.observable(orBlank(data['riskLikelihood']));
            self.transients.riskLikelihoodConstraints = ["Almost certain","Likely","Possible","Unlikely","Remote"];
            this.riskConsequence = ko.observable(orBlank(data['riskConsequence']));
            self.transients.riskConsequenceConstraints = ["Insignificant","Minor","Moderate","Major","Extreme"];
            this.riskRating = ko.observable(orBlank(data['riskRating']));
            self.transients.riskRatingConstraints = ["High","Significant","Medium","Low"];
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Threatening Processes & Site Condition Risks";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.riskTable = ko.observableArray([]);
            self.selectedriskTableRow = ko.observable();
        

            self.loadriskTable = function (data, append) {
                if (!append) {
                    self.data.riskTable([]);
                }
                if (data === undefined) {
                    self.addriskTableRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.riskTable.push(new RiskTableRow(obj));
                    });
                }
            };

            self.addriskTableRow = function () {
                var newRow = new RiskTableRow();
                self.data.riskTable.push(newRow);
                
            };
            self.removeriskTableRow = function (row) {
                self.data.riskTable.remove(row);
                
            };
            self.riskTablerowCount = function () {
                return self.data.riskTable().length;
            };

            self.riskTableTableDataUploadVisible = ko.observable(false);
            self.showriskTableTableDataUpload = function() {
                self.riskTableTableDataUploadVisible(!self.riskTableTableDataUploadVisible());
            };

            self.riskTableTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadriskTable(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "riskTabletemplate-upload",
                    downloadTemplateId: "riskTabletemplate-download",
                    formData:{type:'Threatening Processes & Site Condition Risks', listName:'riskTable'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                                    delete jsData.selectedriskTableRow;
                delete jsData.riskTableTableDataUploadOptions
                delete jsData.riskTableTableDataUploadVisible

                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.loadriskTable(data.riskTable);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Threatening Processes & Site Condition Risks') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koThreatening_Processes_&_Site_Condition_Risks"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        
        $(function(){

            var viewModelName = "Planned_Monitoring_ApproachViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var PlannedActionsRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.plannedActivityType = ko.observable(orBlank(data['plannedActivityType']));
            self.transients.plannedActivityTypeConstraints = ["Fauna survey (biological)","Flora survey (biological)","Pest animal assessment & monitoring","Vegetation condition assessment - BioCondition (QLD)","Vegetation condition assessment - Biodiversity Fund (DoE)","Vegetation condition assessment - BioMetric (NSW)","Vegetation condition assessment - Bushland Condition Monitoring (SA)","Vegetation condition assessment - Habitat Hectares (VIC)","Vegetation condition assessment - Native Vegetation Condition Assessment and Monitoring (WA)","Vegetation condition assessment - TasVeg (TAS)","Weed mapping & monitoring","Other (specify in notes)"];
            this.plannedActivityDescription = ko.observable(orBlank(data['plannedActivityDescription']));
            this.noOfMonitoringAreas = ko.observable(orZero(data['noOfMonitoringAreas']));
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Planned Monitoring Approach";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.sitePlanningTimeSpent = ko.observable();

            self.data.plannedActions = ko.observableArray([]);
            self.selectedplannedActionsRow = ko.observable();
        

            self.loadplannedActions = function (data, append) {
                if (!append) {
                    self.data.plannedActions([]);
                }
                if (data === undefined) {
                    self.addplannedActionsRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.plannedActions.push(new PlannedActionsRow(obj));
                    });
                }
            };

            self.addplannedActionsRow = function () {
                var newRow = new PlannedActionsRow();
                self.data.plannedActions.push(newRow);
                
            };
            self.removeplannedActionsRow = function (row) {
                self.data.plannedActions.remove(row);
                
            };
            self.plannedActionsrowCount = function () {
                return self.data.plannedActions().length;
            };

            self.plannedActionsTableDataUploadVisible = ko.observable(false);
            self.showplannedActionsTableDataUpload = function() {
                self.plannedActionsTableDataUploadVisible(!self.plannedActionsTableDataUploadVisible());
            };

            self.plannedActionsTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadplannedActions(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "plannedActionstemplate-upload",
                    downloadTemplateId: "plannedActionstemplate-download",
                    formData:{type:'Planned Monitoring Approach', listName:'plannedActions'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.notes = ko.observable();
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                                    delete jsData.selectedplannedActionsRow;
                delete jsData.plannedActionsTableDataUploadOptions
                delete jsData.plannedActionsTableDataUploadVisible

                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.data['sitePlanningTimeSpent'](orZero(data['sitePlanningTimeSpent']));
                self.loadplannedActions(data.plannedActions);
                self.data['notes'](data['notes']);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Planned Monitoring Approach') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koPlanned_Monitoring_Approach"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        
        $(function(){

            var viewModelName = "Site_Planning_DetailsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var PlannedActionsRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.worksAreaTitle = ko.observable(orBlank(data['worksAreaTitle']));
            this.plannedActivityType = ko.observable(orBlank(data['plannedActivityType']));
            self.transients.plannedActivityTypeConstraints = ["Community Participation and Engagement","Conservation Grazing Management","Debris Removal","Erosion Management","Fencing","Fire Management","Indigenous Employment & Enterprise","Infrastructure Establishment","Knowledge Integration and Transfer","Management Plan Development","Management Practice Change","Other Conservation Works for Threatened Species","Outcomes, Evaluation and Learning","Pest and Disease Management","Project Administration","Public Access Management","Research","Revegetation","Seed Collection","Site Monitoring Planning","Site Preparation","Training and Skills Development","Water Management","Weed Treatment","Works Implementation Planning","Biodiversity Fund - Outcomes and Monitoring","Fauna (biological) survey","Flora (biological) survey","Pest animal assessment","Site Assessment","Weed Mapping & Monitoring"];
            this.plannedActivityDescription = ko.observable(orBlank(data['plannedActivityDescription']));
            this.noOfWorksAreas = ko.observable(orZero(data['noOfWorksAreas']));
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Site Planning Details";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.sitePlanningTimeSpent = ko.observable();

            self.data.plannedActions = ko.observableArray([]);
            self.selectedplannedActionsRow = ko.observable();
        

            self.loadplannedActions = function (data, append) {
                if (!append) {
                    self.data.plannedActions([]);
                }
                if (data === undefined) {
                    self.addplannedActionsRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.plannedActions.push(new PlannedActionsRow(obj));
                    });
                }
            };

            self.addplannedActionsRow = function () {
                var newRow = new PlannedActionsRow();
                self.data.plannedActions.push(newRow);
                
            };
            self.removeplannedActionsRow = function (row) {
                self.data.plannedActions.remove(row);
                
            };
            self.plannedActionsrowCount = function () {
                return self.data.plannedActions().length;
            };

            self.plannedActionsTableDataUploadVisible = ko.observable(false);
            self.showplannedActionsTableDataUpload = function() {
                self.plannedActionsTableDataUploadVisible(!self.plannedActionsTableDataUploadVisible());
            };

            self.plannedActionsTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadplannedActions(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "plannedActionstemplate-upload",
                    downloadTemplateId: "plannedActionstemplate-download",
                    formData:{type:'Site Planning Details', listName:'plannedActions'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.notes = ko.observable();

            self.data.noOfWorksAreasTotal = ko.computed(function () {
                var total = 0;
                for(var i = 0; i < self.data.plannedActions().length; i++) {
                    var value = self.data.plannedActions()[i].noOfWorksAreas();
                        total = total + Number(value); 
                }
                return total;
            });
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                                    delete jsData.selectedplannedActionsRow;
                delete jsData.plannedActionsTableDataUploadOptions
                delete jsData.plannedActionsTableDataUploadVisible

                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.data['sitePlanningTimeSpent'](orZero(data['sitePlanningTimeSpent']));
                self.loadplannedActions(data.plannedActions);
                self.data['notes'](data['notes']);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Site Planning Details') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koSite_Planning_Details"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        


    /* Master controller for page. This handles saving each model as required. */
    var Master = function () {
        var self = this;
        this.subscribers = [];
        // client models register their name and methods to participate in saving
        self.register = function (modelInstanceName, getMethod, isDirtyMethod, resetMethod) {
            this.subscribers.push({
                model: modelInstanceName,
                get: getMethod,
                isDirty: isDirtyMethod,
                reset: resetMethod
            });
        };
        // master isDirty flag for the whole page - can control button enabling
        this.isDirty  = function () {
            var dirty = false;
            $.each(this.subscribers, function(i, obj) {
                dirty = dirty || obj.isDirty();
            });
            return dirty;
        };
        /**
         * Makes an ajax call to save any sections that have been modified. This includes the activity
         * itself and each output.
         *
         * Modified outputs are injected as a list into the activity object. If there is nothing to save
         * in the activity itself, then the root is an object that is empty except for the outputs list.
         *
         * NOTE that the model for each section must register itself to be included in this save.
         *
         * Validates the entire page before saving.
         */
        this.save = function () {

            var activityData, outputs = [];
            if ($('#validation-container').validationEngine('validate')) {
                $.each(this.subscribers, function(i, obj) {
                   // if (obj.isDirty()) {
                        if (obj.model === 'activityModel') {
                            activityData = obj.get();
                        } else {
                            outputs.push(obj.get());
                        }
                    //}
                });
                if (outputs.length === 0 && activityData === undefined) {
                    alert("Nothing to save.");
                    return;
                }
                if (activityData === undefined) { activityData = {}}
                activityData.outputs = outputs;

                var toSave = JSON.stringify(activityData);
                console.log("saving"+toSave);
                mobileBindings.saveActivity(toSave);

            }

        };

        this.reset = function () {
            $.each(this.subscribers, function(i, obj) {
                if (obj.isDirty()) {
                    obj.reset();
                }
            });
        };
    };

    if (mobileBindings == undefined) {
        var mobileBindings = {
        
            loadActivity:function(){return "{}"},
        
        
            loadSites:function(){return "[]"},
        

        saveActivity:function(){},
        createNewSite:function(){}
    };
}
var master = new Master();
var activity = JSON.parse(mobileBindings.loadActivity());
var themes = ['theme1', 'theme2'];

var sites = JSON.parse(mobileBindings.loadSites());


$(function(){

    $('#validation-container').validationEngine('attach', {scroll: false});

    $('.helphover').popover({animation: true, trigger:'hover'});

    $('#reset').click(function () {
        master.reset();
    });


    ko.bindingHandlers.editOutput = {
        init: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
            var outputName = ko.utils.unwrapObservable(valueAccessor()),
                activity = bindingContext.$root,
                outputId;

            // search for corresponding outputs in the activity data
            $.each(activity.outputs, function (i,output) { // iterate output data in the activity to
                                                              // find any matching the meta-model name
                if (output.name === outputName) {
                    outputId = output.outputId;
                }
            });
            if (outputId) {
                // build edit link
                $(element).html('Edit data');
                $(element).attr('href', fcConfig.serverUrl + "/output/edit/" + outputId +
                    "?returnTo=" + here);
            } else {
                // build create link
                $(element).attr('href', fcConfig.serverUrl + '/output/create?activityId=' + activity.activityId +
                    '&outputName=' + encodeURIComponent(outputName) +
                    "&returnTo=" + here);
            }
        }
    };

    function ViewModel (act, sites) {
        var self = this;
        self.activityId = act.activityId;
        self.description = ko.observable(act.description);
        self.notes = ko.observable(act.notes);
        self.startDate = ko.observable(act.startDate).extend({simpleDate: false});
        self.endDate = ko.observable(act.endDate || act.plannedEndDate).extend({simpleDate: false});
        self.plannedStartDate = ko.observable(act.plannedStartDate).extend({simpleDate: false});
        self.plannedEndDate = ko.observable(act.plannedEndDate).extend({simpleDate: false});
        self.eventPurpose = ko.observable(act.eventPurpose);
        self.fieldNotes = ko.observable(act.fieldNotes);
        self.associatedProgram = ko.observable(act.associatedProgram);
        self.associatedSubProgram = ko.observable(act.associatedSubProgram);
        self.progress = ko.observable(act.progress);
        self.mainTheme = ko.observable(act.mainTheme);
        self.type = ko.observable(act.type);
        self.siteId = ko.observable(act.siteId);
        self.projectId = act.projectId;
        self.transients = {};
        self.transients.sites = sites;
        self.transients.activityProgressValues = ['planned','started','finished'];
        self.transients.themes = themes;
        self.transients.markedAsFinished = ko.observable(act.progress === 'finished');
        self.transients.markedAsFinished.subscribe(function (finished) {
            self.progress(finished ? 'finished' : 'started');
        });
        self.transients.siteImgUrl = ko.computed(function() {
            if (self.siteId()) {
                 var site = $.grep(self.transients.sites, function(site, index) { return site.siteId == self.siteId(); })[0];
                 if (site && site.extent && site.extent.geometry && site.extent.geometry.centre) {
                    return  "http://maps.googleapis.com/maps/api/staticmap?maptype=terrian&zoom=12&sensor=false&size=250x200&markers=color:red%7C"+site.extent.geometry.centre[1]+","+site.extent.geometry.centre[0]+"&centre=false";
                 }
            }
            return "";
        });

        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.toJS(self);
            delete jsData.transients;
            return jsData;
        };
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.save = function (callback, key) {
        };

        self.createNewSite = function() {
            mobileBindings.createNewSite();
        }

        self.notImplemented = function () {
            alert("Not implemented yet.")
        };
        self.dirtyFlag = ko.dirtyFlag(self, false);

        // make sure progress moves to started if we save any data (unless already finished)
        // (do this here so the model becomes dirty)
        self.progress(self.transients.markedAsFinished() ? 'finished' : 'started');
    }


    var viewModel = new ViewModel(activity, sites);

    ko.applyBindings(viewModel);

    master.register('activityModel', viewModel.modelForSaving, viewModel.dirtyFlag.isDirty, viewModel.dirtyFlag.reset);
});
</script>
</body>
</html>
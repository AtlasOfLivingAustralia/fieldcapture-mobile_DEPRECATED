

<!DOCTYPE html>
<head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    
    <script src="static/t5OGphSUjwdNOoxNKgdRTTh1RBtmzhMXxHDYYeR4lYj.js" type="text/javascript" ></script>
<link href="static/090onaZX1M508oSWqGmMeETZ9NkUA9p4CCTW3MUpRPc.css" type="text/css" rel="stylesheet" media="screen, projection" />

<link href="static/VySgOjkVOsD8Jt8ujXROVRjZeDLAAwVhMF5WqPZ8Ajf.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="http://www.ala.org.au/wp-content/themes/ala2011/images/favicon.ico" rel="shortcut icon" />
<!--[if lt IE 9]><script src="static/Yh1Txee3hFzExJ4P1str7tGV24zQMEYtxqtlYJ5ukR0.js" type="text/javascript" ></script><![endif]-->
<link href="static/Qwaw257M4sHcJuspEDRbeQoTceByqRmOCHNaZWpOxuc.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="static/AcXIjLTuc87n8sfxBjJRQSoBIUwP9RnCyK8Sv82i7eV.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="static/doSKUivnfI9gXmPKZ2XG4W5xIABYgKaf5Dwf3LtjNVr.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="static/fx5pGfEFSRJi6nyez3s8fUsjDL8WJ0IB04Njm7T2VAJ.css" type="text/css" rel="stylesheet" media="all" />
<link href="static/qBQAxqnczDqd7Bl7B2gXgLoB51xIPPVo3q06lXUPLcy.css" type="text/css" rel="stylesheet" media="screen,print" />




<link href="static/KYGDEVRRaKjNbTXJkHmicmzo9vFrnnzCnGLcxKjR04f.css" type="text/css" rel="stylesheet" media="screen,print" />

<link href="static/KtHosYDw6qHDklqhUqI9Y0lrV4QlbtokVSWtoN5CyvP.css" type="text/css" rel="stylesheet" media="screen,print" />
<link href="static/nq5UnIyX5LhMaOWVShAJhQHKHVGPAbNeKmoHiJNIGvz.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="/static/RrjzrZ0Ci0GPLETIr8x8KUMjfJtZKvifrUtMCedwKRB.png" rel="shortcut icon" />
<link href="static/4zsVqykqBON8U5Es5kfffXBSGJlbI8VrPDW4hSn1SWJ.css" type="text/css" rel="stylesheet" media="screen, projection" />


<link href="static/sCFm7bBsIMFGQHTSlBbhMHQCXWhOsbBr5z4bu1OueIE.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="http://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="static/tUELnv7Uvq6ppWNUWOlaow3JGSTTIf8hJ2VYvh7Oahj.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="/static/OKcRcjAeA1yuXD9r4fZA1Uw2HEwL7gYvjc6HdrZXIYP.png" rel="shortcut icon" />
<link href="/static/UxF0saaqmikaj74l2WFcCyPMm9hEEs8if7IBy0GNAnd.png" rel="shortcut icon" />
<link href="/static/zs4hrJqt7I802RlaZiXbmbDBarpNPZF8V8fCQJ2RVTM.png" rel="shortcut icon" />
<link href="/static/SvC1e8bSiCPFh8mObbEThgbJIaGZi72ATzqobK6QnnB.gif" rel="shortcut icon" />
<link href="/static/BA9MhIHZnH0zMcKJWIWsTurHhQTpDYE6akqM5excaZI.gif" rel="shortcut icon" />

<script type="text/javascript">
    var fcConfig = {
        bieUrl: "http://bie.ala.org.au",
        speciesProfileUrl: "https://fieldcapture.ala.org.au/proxy/speciesProfile",
        googleStaticUrl:"http://maps.googleapis.com/maps/api/staticmap?maptype=terrian&zoom=12&sensor=false&size=350x250&markers=color:red%7C"
        },
        here = document.location.href;
    </script>
    

    <meta name="layout" content="mobile"/>

    
    
    
</if>

    <style type="text/css">
        input[type=checkbox] {  -webkit-transform: scale(1.5); }
        .checkbox-list label { min-height: 40px; }
        .speciesAutocompleteRow {min-height:40px;}
        .datepicker td, .datepicker th {
            width:40px;
            height:40px;
            vertical-align: middle;
        }
    </style>
</head>

<body>

<div id="content" class="clearfix">
    
<div class="container-fluid validationEngineContainer" id="validation-container">
<div id="koActivityMainBlock">

    <div class="row-fluid">
        <div class="span12">
            <!-- Common activity fields -->

            <div class="row-fluid space-after">
                <div class="span4">

                    <label class="for-readonly">Type</label>
                    <span class="readonly-text" data-bind="text:type"></span>
                </div>
                <div class="span8">

                    <label class="for-readonly">Description</label>
                    <span class="readonly-text" data-bind="text:description"></span>
                </div>
            </div>


            <div class="row-fluid space-after">
                <div class="span4">
                    <label class="for-readonly inline">Planned start date</label>
                    <span class="readonly-text" data-bind="text:plannedStartDate.formattedDate"></span>
                </div>
                <div class="span8">
                    <label class="for-readonly inline">Planned end date</label>
                    <span class="readonly-text" data-bind="text:plannedEndDate.formattedDate"></span>
                </div>
            </div>

            <div class="well">
                <div class="row-fluid">

                    <span class="span8">
                    <div class="row-fluid space-after">

                        <div class="span6 required">
                            <label for="startDate"><b>Actual start date</b>
                                <a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Date the activity was started.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a>
                            </label>


                            <div class="input-append">
                                <input data-bind='datepicker:startDate.date' name='startDate' id='startDate' type='text' size='16' class='input-xlarge' readonly='readonly' targetField='startDate.date' data-validation-engine='validate[required]' />
<span class='add-on open-datepicker'>
  <i class='icon-th'>&nbsp;</i>
</span>
                            </div>

                        </div>
                        <div class="span6" data-bind="css:{required:transients.markedAsFinished}">
                            <label for="endDate"><b>Actual end date</b>
                                <a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Date the activity finished.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a>
                            </label>

                            <div class="input-append">
                                <input data-bind='datepicker:endDate.date' name='endDate' id='endDate' type='text' size='16' class='input-xlarge' readonly='readonly' targetField='endDate.date' data-validation-engine='validate[future[startDate]]' />
<span class='add-on open-datepicker'>
  <i class='icon-th'>&nbsp;</i>
</span>
                            </div>

                        </div>
                    </div>
                    <div class="row-fluid space-after">
                        <div class="span6">
                            <label for="theme"><b>Major theme</b></label>
                            <select id="theme" data-bind="value:mainTheme, options:transients.themes, optionsCaption:'Choose..'" class="input-xlarge" style="width:90%">
                            </select>
                        </div>

                        <div class="span6">
                            <label><b>Progress</b></label>
                            <label for="activityComplete"><input type="checkbox" id="activityComplete" data-bind="checked:transients.markedAsFinished" style="margin-right:1em;"><span>This activity is complete</span></label>

                        </div>

                    </div>
                    <div class="row-fluid">
                        <div class="span6">
                            <label for="site"><b>Site</b></label>
                            <select id='site' style='width:90%' data-bind='options:transients.sites,optionsText:"name",optionsValue:"siteId",value:siteId,optionsCaption:"Choose a site..."'>&nbsp;</select>

                        </div>

                        <div class="span3">

                            <button class="btn btn-info" style="margin-top:25px;" data-bind="visible:transients.newSiteSupported,click:createNewSite">Create new Site</button>
                        </div>
                    </div>

                    
                        
                            
                                
                            
                            
                                
                                    
                                    
                                    
                                    

                                
                            
                        

                    
                    </span>
                    <span class="span4">

                        <img id="siteLocationImage" width="100%" data-bind="event:{error:siteLoadError}, attr:{src:transients.siteImgUrl}, visible:transients.siteImgUrl()"/>


                    </span>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- ko stopBinding: true -->

    
    
    
    
    <div class="output-block" id="koSingle_Sighting_-_Advanced">
            <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Single Sighting - Advanced</h3>
        <div data-bind="if:transients.optional">
            <label class="checkbox" ><input type="checkbox" data-bind="checked:outputNotCompleted"> <span data-bind="text:transients.questionText"></span> </label>
        </div>
        <div id="Single_Sighting_-_Advanced-content" data-bind="visible:!outputNotCompleted()">
        <!-- add the dynamic components -->
            <div class="row-fluid space-after " >
<span class="span12">    <span  class="span12"><h4 class='text-default text-center'><b>Record your individual sightings of species in the project region.</b><h4></br></span></span></div>
<div class="row-fluid space-after output-section" >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span8"><h4 class='text-default text-left'><b>A. Sightings Information: </b></h4></br></span></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Survey date<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The date on which the sighting was made.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><div class="input-append"><input data-bind="datepicker:data.surveyDate.date" type="text" size="12" data-validation-engine='validate[required]'/><span class="add-on open-datepicker"><i class="icon-th"></i></span></div></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Survey start time<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The time at which the sighting was made.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Notes<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='General remarks about the survey event, including any characteristic site features, conditions, etc.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span8" data-bind='value:data.notes'></textarea></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Recorded by<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The name of the person who is attributed with making the sighting.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input  class="span8 input-small" data-bind='value:data.recordedBy'  type='text' class='input-small'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span8"><hr><h4 class='text-default text-left'><b>B. Species Information: </b></h4></br></span></span></div><div class="row-fluid"><span class="span12">    <span  class="span8"><small>Start typing a common or scientific name.</small></span></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Species name<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The species name of the plant, animal or fungus observed. Click on the &apos;i&apos; for information about the selected species.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span>
<span class="input-prepend input-append" data-bind="with:data.species">
    <span class="add-on" data-bind="visible:!transients.editing(), css:{'btn-success':name()}"><i class="icon-white" data-bind="css:{'icon-ok':listId()!='unmatched' && name(), 'icon-question-sign':listId()=='unmatched' || listId() == 'error-unmatched'}"></i></span><span class="add-on" data-bind="visible:transients.editing()"><img src="static/Xo2jbaJ5EFqa59u9g4c4ybpCpw3wFWKhQdzZwNmmktO.gif" alt="saving icon" /></span><input type="text" data-bind="value:transients.textFieldValue,event:{focusout:focusLost},autocomplete:{url:'https://fieldcapture.ala.org.au/search/species', render: renderItem, listId: list, result:speciesSelected, valueChangeCallback:textFieldChanged}"  data-validation-engine='validate[required]'/>
    <span class="add-on" data-bind="visible: !transients.editing() && name()">
        <a href="#" data-bind="popover: {title: name, content: transients.speciesInformation}"><i class="icon-info-sign"></i></a>
    </span>
</span>
</span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Are you confident of the species identification?<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='How certain are you that you have correctly identified your sighting? Only choose &apos;certain&apos; if you are 100% sure.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.identificationConfidence,options:transients.identificationConfidenceConstraints,optionsCaption:"Please select"'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Identification tags<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Tag this sighting with species group and/or sub-group'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span></span></div><div class="row-fluid"><span class="span12">    <span  class="span8"></br></span></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Comments<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Observation notes about the record.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span8" data-bind='value:data.comments'></textarea></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>How many individuals did you see?<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of individuals or colonies (for certain insects).'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.individualCount' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span8"></br></span></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Sighting photo<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Upload a photo taken of the species at the time of the record. This is essential for verification of the record.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><div id="fileupload" data-url="/image/upload" data-bind="imageUpload:{target:data.sightingPhoto, config:{}}"
     class="fileupload-buttonbar">

    <table><tbody class="files"></tbody></table>
    <!-- The fileinput-button span is used to style the file input field as button -->
    <span class="btn fileinput-button">
        <i class="icon-plus"></i>
        <input type="file" name="files" multiple/>
        <span data-bind="visible:data.sightingPhoto().length">Add more images</span>
        <span data-bind="visible:!data.sightingPhoto().length">Add images</span>
    </span>

</div></span></div></div><div class="span6">
<div class="row-fluid"><span class="span12">    </span></div></div></div>
<!-- The template to display files available for upload -->
<script id="template-upload" type="text/x-tmpl">
    {% for (var i=0, file; file=o.files[i]; i++) { %}
    <tr class="template-upload fade">
        <td class="preview"><span class="fade"></span></td>
        <td class="name"><span>{%=file.name%}</span></td>
        <td class="size"><span>{%=o.formatFileSize(file.size)%}</span></td>
        {% if (file.error) { %}
        <td class="error" colspan="2"><span class="label label-important">{%=locale.fileupload.error%}</span> {%=locale.fileupload.errors[file.error] || file.error%}</td>
        {% } else if (o.files.valid && !i) { %}
        <td>
            <div class="progress progress-success progress-striped active"><div class="bar" style="width:0%;"></div></div>
        </td>
        <td class="start">{% if (!o.options.autoUpload) { %}
            <button class="btn btn-primary">
                <i class="icon-upload icon-white"></i>
                <span>{%=locale.fileupload.start%}</span>
            </button>
            {% } %}</td>
        {% } else { %}
        <td colspan="2"></td>
        {% } %}
        <td class="cancel">{% if (!i) { %}
            <button class="btn btn-warning">
                <i class="icon-ban-circle icon-white"></i>
                <span>{%=locale.fileupload.cancel%}</span>
            </button>
            {% } %}</td>
    </tr>
    {% } %}
</script>
<!-- The template to display files available for download -->
<script id="template-download" type="text/x-tmpl">
    {% for (var i=0, file; file=o.files[i]; i++) { %}
    <tr class="template-download fade">
        {% if (file.error) { %}
        <td></td>
        <td><div class="name">{%=file.name%}</div><div class="size">{%=o.formatFileSize(file.size)%}</div></td>
        <td class="error" colspan="2"><span class="label label-important">{%=locale.fileupload.error%}</span> {%=locale.fileupload.errors[file.error] || file.error%}</td>
        {% } else { %}
        <td class="preview">{% if (file.thumbnail_url) { %}
            <a href="{%=file.url%}" title="{%=file.name%}" rel="gallery" download="{%=file.name%}"><img src="{%=file.thumbnail_url%}"></a>
            {% } %}</td>
        <td class="name" colspan="2">
            <a href="{%=file.url%}" title="{%=file.name%}" rel="{%=file.thumbnail_url&&'gallery'%}" download="{%=file.name%}">{%=file.name%}</a>
            <div class="size">{%=o.formatFileSize(file.size)%}</div>
        </td>

        {% } %}
        <td>
            <button class="delete-image delete btn btn-mini" data-type="DELETE" data-url="https://fieldcapture.ala.org.au/image?id=" data-filename="{%=file.name%}">
                <i class="icon-trash"></i>
                <span>{%=locale.fileupload.destroy%}</span>
            </button>
        </td>
    </tr>
    {% } %}
</script>
        </div>
        


        
    </div>
    

<!-- /ko -->

</div>




</div>

<script src="static/jNGzWep9YTzJQCsSRDWGKonJ7ycvNMNQauAe6AcGX4T.js" type="text/javascript" ></script>





<script src="static/5zeDycYZFxJsfDd3W1kuhrN47XnIMrbhS6gdHDvcExv.js" type="text/javascript" ></script>

<script src="static/ulxBmo4RrKTNT3DuFHethb4EOZpwQfvefxNXivDIbzp.js" type="text/javascript" ></script>








<!--[if gte IE 8]><script src="static/knxjs4G9Cquc79O3iYW107XikPB1Z1ii8QWrtBpzlSP.js" type="text/javascript" ></script><![endif]-->
<script src="static/nRrltgvxdEHd5BqRR1v4XU3ZStOrhDScuH03g4r8E6O.js" type="text/javascript" ></script>

<script src="static/iRQrJhH2zDlUTI4nXr10v5JHksIJyPjoe8fHSE4QZcI.js" type="text/javascript" ></script>

<script src="static/NsIfUsVWId7YD36PcnVeycNW6GCdIRgD7cdnhiQldmM.js" type="text/javascript" ></script>









<script src="static/IZCc6ZgD3MepYbz4UqlDLzMDNNghSCivcfGebmF9V2d.js" type="text/javascript" ></script>
<script src="static/NwE7QStklZyP86Oe5o9TUAwbaHqgfflXARrIBoL6Q5s.js" type="text/javascript" ></script>




<script src="static/e9gGniNN5cG3OR4oPVWd5lYoxE5Xf282hFe7d4FTQbq.js" type="text/javascript" ></script>


<script src="static/CRNxISj7t7ZCV7B8M8dFtBK7x7R4tGVO36INoBz8gQX.js" type="text/javascript" ></script>

<script src="static/QhlSgFWjl35vcaCRa5cKxHZxRWSSluzptQUKz3PHr9s.js" type="text/javascript" ></script>


<script src="static/8WCQyXwicnBgTdLQ4F5jUFtmVXmqG9eUZKvo74wOnIT.js" type="text/javascript" ></script>
<script src="static/9HtLc6nfgO9H72LVVZxetW45ZR623Fx8EhEdydgOq2F.js" type="text/javascript" ></script>
<script src="static/wkrwT3eqoZlWXFPCQRTvkdsdvwzT5Lw2H89f9eTkQdb.js" type="text/javascript" ></script>


<script type="text/javascript">
    
    // load dynamic models - usually objects in a list
            var speciesLists = [];
        var site = {};


    window["ViewModel"] = function (output, site, config) {
        var self = this;
        if (!output) {
            output = {};
        }
        var activityId = output.activityId || config.activityId || '';
        self.name = "";
        self.outputId = orBlank(output.outputId);

        self.data = {};
        self.transients = {};
        var notCompleted = output.outputNotCompleted;

        if (notCompleted === undefined) {
            notCompleted = config.collapsedByDefault;
        }

        self.transients.selectedSite = ko.observable(site);
        self.outputNotCompleted = ko.observable(notCompleted);
        self.transients.optional = config.optional || false;
        self.transients.questionText = config.optionalQuestionText || 'Not applicable';
        self.transients.dummy = ko.observable();

        self.downloadDataTemplate = function(listName) {
            var data = ko.mapping.toJS(self.data[listName](), {ignore:['transients']});
            var params = {
                listName:listName,
                type:self.name,
                data:JSON.stringify(data)
            };
            var url = '/activity/excelOutputTemplate';
            $.fileDownload(url, {
                httpMethod:'POST',
                data:params
            });

        };


        // add declarations for dynamic data
        
            self.data.surveyDate = ko.observable().extend({simpleDate: false});

            self.data.notes = ko.observable();

            self.data.recordedBy = ko.observable();
            self.data.species = new SpeciesViewModel({}, speciesLists, {printable:''});

            self.data.individualCount = ko.observable().extend({numericString:2});

            self.data.identificationConfidence = ko.observable();
            self.transients.identificationConfidenceConstraints = ["Certain","Uncertain"];

            self.data.comments = ko.observable();
                self.data.sightingPhoto=ko.observableArray([]);
                
        self.loadsightingPhoto = function (data) {
            if (data !== undefined) {
                $.each(data, function (i, obj) {
                    self.data.sightingPhoto.push(image(obj));
                });
        }};
                        self.data.tags=ko.observableArray([]);
            self.transients.tagsConstraints = ["Amphibians","Amphibians, Australian Ground Frogs","Amphibians, Narrow-Mouthed Frogs","Amphibians, Tree Frogs","Amphibians, True Frogs","Amphibians, True Toads","Birds","Birds, Bitterns, Ibises","Birds, Buttonquails","Birds, Cranes","Birds, Cuckoos","Birds, Doves","Birds, Ducks, Geese, Swans","Birds, Falcons","Birds, Flamingos","Birds, Fowls","Birds, Grebes","Birds, Hummingbirds, Swifts","Birds, Kingfishers","Birds, Large waterbirds","Birds, Nightjars, Frogmouths, Potoos","Birds, Ostriches","Birds, Owls","Birds, Parrots","Birds, Penguins","Birds, Perching Birds","Birds, Petrels, Fulmars","Birds, Waders, Gulls, Auks","Crustaceans","Crustaceans, Barnacles, Copepods","Crustaceans, Crabs, Lobsters","Crustaceans, Fairy shrimp, Clam shrimp","Crustaceans, Seed shrimp","Fish","Fish, Anchovies ","Fish, Angel Sharks","Fish, Anglerfishes","Fish, Baldfishes,Tubeshoulders","Fish, Batoids","Fish, Batrachoidiforms","Fish, Beardfishes","Fish, Boarfishes","Fish, Bonefishes","Fish, Bonytongues","Fish, Bullhead Sharks","Fish, Carpet Sharks","Fish, Catfishes","Fish, Chimaeras","Fish, Cods","Fish, Cow Sharks","Fish, Cowfishes","Fish, Deep-sea ray-finned fishes","Fish, Deep-sea ray-finned fishes","Fish, Dogfish Sharks","Fish, Dragonfishes","Fish, Eels","Fish, Electric Rays","Fish, Flatfishes","Fish, Ground Sharks","Fish, Guitarfish","Fish, Hagfishes","Fish, Halfbeeks","Fish, Jellynose Fishes","Fish, Killifishes","Fish, Latern Fishes, Neoscopelids","Fish, Lungfish","Fish, Mackerel Sharks","Fish, Marine ray-finned fish","Fish, Milkfishes","Fish, Minnows","Fish, Mullet fish","Fish, Opahs","Fish, Ophidiiforms","Fish, Perch-like Fishes","Fish, Rainbow Fishes","Fish, Ray-finned fishes","Fish, Sackpharynx Fishes","Fish, Salmons","Fish, Saw Sharks","Fish, Sawfish","Fish, Scorpion Fishes, Sculpins","Fish, Softnose Skates","Fish, Spiny Eels","Fish, Swamp Eels","Fish, Tarpons","Fungi","Fungi, Asco's","Fungi, Basidio's","Fungi, Chytrids","Fungi, Glomeromycota","Fungi, Zygomycetes","Insects and Spiders","Insects and Spiders, Alderflies, Dobsonflies, Fishflies","Insects and Spiders, Beetles","Insects and Spiders, Booklice, Barklice, Barkflies","Insects and Spiders, Bristletails","Insects and Spiders, Butterflies, Moths","Insects and Spiders, Caddisflies, Sedge-flies or Rail-flies","Insects and Spiders, Cicadas, Aphids, Planthoppers, Leafhoppers, Shield Bugs","Insects and Spiders, Cockroaches, Termites","Insects and Spiders, Dragonflies, Damselflies","Insects and Spiders, Earwigs","Insects and Spiders, Fleas","Insects and Spiders, Flies, Mosquitoes","Insects and Spiders, Grasshoppers, Crickets, Locusts, Katydids, Weta, Lubber","Insects and Spiders, Lacewings, Mantidflies, Antlions","Insects and Spiders, Lice","Insects and Spiders, Mantises","Insects and Spiders, Mayflies, Shadlfies","Insects and Spiders, Scorpionflies, Hangingflies","Insects and Spiders, Silverfish","Insects and Spiders, Spiders","Insects and Spiders, Stick Insects, Phasmids","Insects and Spiders, Stoneflies","Insects and Spiders, Thrips","Insects and Spiders, Twisted-Wing Parasites","Insects and Spiders, Wasps, Ants, Bees, Sawflies","Insects and Spiders, Webspinners","Insects and Spiders, Zorapterans","Mammals","Mammals, Bandicoots, Bilbies","Mammals, Bats","Mammals, Carnivores","Mammals, Carnivorous Marsupials","Mammals, Dolphins, Porpoises, Whales","Mammals, Dugongs, Manatees, Sea Cows","Mammals, Even-toed hoofed","Mammals, Hares, Pikas, Rabbits","Mammals, Herbivorous Marsupials","Mammals, Marsupial Moles","Mammals, Monotremes","Mammals, Odd-toed hoofed","Mammals, Rodents","Mammals, Shrews, Hedgehogs","Molluscs","Molluscs, Chitons","Molluscs, Cuttlefish","Molluscs, Gastropods, Slugs, Snails","Molluscs, Mussels, Clams","Molluscs, Solenogasters","Molluscs, Tooth Shells","Plants","Plants, Conifers, Cycads","Plants, Dicots","Plants, Ferns and Allies","Plants, Flowering plants","Plants, Monocots","Reptiles","Reptiles, Crocodiles","Reptiles, Lizards, Snakes","Reptiles, Tortoises, Turtles, Terrapins"];
                
        self.loadtags = function (data) {
            if (data !== undefined) {
                $.each(data, function (i, obj) {
                    self.data.tags.push(obj);
                });
        }};
                    self.transients.site = site;

        // this will be called when generating a savable model to remove transient properties
        self.removeBeforeSave = function (jsData) {
            // add code to remove any transients added by the dynamic tags
            
            delete jsData.activityType;
            delete jsData.transients;
            return jsData;
        };

        // this returns a JS object ready for saving
        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
            if (self.outputNotCompleted()) {
                jsData.data = {};
            }

            // get rid of any transient observables
            return self.removeBeforeSave(jsData);
        };

        // this is a version of toJSON that just returns the model as it will be saved
        // it is used for detecting when the model is modified (in a way that should invoke a save)
        // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.loadData = function (data, documents) {
            // load dynamic data
                            self.data['surveyDate'](data['surveyDate']);
                self.data['notes'](data['notes']);
                self.data['recordedBy'](data['recordedBy']);
                self.data['species'].loadData(data['species']);
                self.data['individualCount'](orZero(data['individualCount']));
                self.data['identificationConfidence'](data['identificationConfidence']);
                self.data['comments'](data['comments']);
                self.loadsightingPhoto(data['sightingPhoto']);
                self.loadtags(data['tags']);


            // if there is no data in tables then add an empty row for the user to add data
            if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                self.addRow();
            }
            self.transients.dummy.notifySubscribers();
        };

        self.attachDocument = function(target) {
            var url = config.documentUpdateUrl || fcConfig.documentUpdateUrl;
            showDocumentAttachInModal(url, new DocumentViewModel({role:'information', stage:config.stage},{activityId:activityId, projectId:config.projectId}), '#attachDocument')
                    .done(function(result) {
                        target(new DocumentViewModel(result))
                    });
        };
        self.editDocumentMetadata = function(document) {
            var url = (config.documentUpdateUrl || fcConfig.documentUpdateUrl) + "/" + document.documentId;
            showDocumentAttachInModal(url, document, '#attachDocument');
        };
        self.deleteDocument = function(document) {
            document.status('deleted');
            var url = (config.documentDeleteUrl || fcConfig.documentDeleteUrl)+'/'+document.documentId;
            $.post(url, {}, function() {});

        };
    };
</script><script type="text/javascript">
        $(function(){

            var viewModelName = "Single_Sighting_-_AdvancedViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output, config) {
                var self = this;
                self.name = "Single Sighting - Advanced";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                var notCompleted = output.outputNotCompleted;

                if (notCompleted === undefined) {
                    notCompleted = config.collapsedByDefault;
                }
                self.transients.selectedSite = ko.observable(site);
                self.outputNotCompleted = ko.observable(notCompleted);
                self.transients.optional = config.optional || false;
                self.transients.questionText = config.optionalQuestionText || 'Not applicable';
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.surveyDate = ko.observable().extend({simpleDate: false});

            self.data.notes = ko.observable();

            self.data.recordedBy = ko.observable();
            self.data.species = new SpeciesViewModel({}, speciesLists, {printable:''});

            self.data.individualCount = ko.observable().extend({numericString:2});

            self.data.identificationConfidence = ko.observable();
            self.transients.identificationConfidenceConstraints = ["Certain","Uncertain"];

            self.data.comments = ko.observable();
                self.data.sightingPhoto=ko.observableArray([]);
                
        self.loadsightingPhoto = function (data) {
            if (data !== undefined) {
                $.each(data, function (i, obj) {
                    self.data.sightingPhoto.push(image(obj));
                });
        }};
                        self.data.tags=ko.observableArray([]);
            self.transients.tagsConstraints = ["Amphibians","Amphibians, Australian Ground Frogs","Amphibians, Narrow-Mouthed Frogs","Amphibians, Tree Frogs","Amphibians, True Frogs","Amphibians, True Toads","Birds","Birds, Bitterns, Ibises","Birds, Buttonquails","Birds, Cranes","Birds, Cuckoos","Birds, Doves","Birds, Ducks, Geese, Swans","Birds, Falcons","Birds, Flamingos","Birds, Fowls","Birds, Grebes","Birds, Hummingbirds, Swifts","Birds, Kingfishers","Birds, Large waterbirds","Birds, Nightjars, Frogmouths, Potoos","Birds, Ostriches","Birds, Owls","Birds, Parrots","Birds, Penguins","Birds, Perching Birds","Birds, Petrels, Fulmars","Birds, Waders, Gulls, Auks","Crustaceans","Crustaceans, Barnacles, Copepods","Crustaceans, Crabs, Lobsters","Crustaceans, Fairy shrimp, Clam shrimp","Crustaceans, Seed shrimp","Fish","Fish, Anchovies ","Fish, Angel Sharks","Fish, Anglerfishes","Fish, Baldfishes,Tubeshoulders","Fish, Batoids","Fish, Batrachoidiforms","Fish, Beardfishes","Fish, Boarfishes","Fish, Bonefishes","Fish, Bonytongues","Fish, Bullhead Sharks","Fish, Carpet Sharks","Fish, Catfishes","Fish, Chimaeras","Fish, Cods","Fish, Cow Sharks","Fish, Cowfishes","Fish, Deep-sea ray-finned fishes","Fish, Deep-sea ray-finned fishes","Fish, Dogfish Sharks","Fish, Dragonfishes","Fish, Eels","Fish, Electric Rays","Fish, Flatfishes","Fish, Ground Sharks","Fish, Guitarfish","Fish, Hagfishes","Fish, Halfbeeks","Fish, Jellynose Fishes","Fish, Killifishes","Fish, Latern Fishes, Neoscopelids","Fish, Lungfish","Fish, Mackerel Sharks","Fish, Marine ray-finned fish","Fish, Milkfishes","Fish, Minnows","Fish, Mullet fish","Fish, Opahs","Fish, Ophidiiforms","Fish, Perch-like Fishes","Fish, Rainbow Fishes","Fish, Ray-finned fishes","Fish, Sackpharynx Fishes","Fish, Salmons","Fish, Saw Sharks","Fish, Sawfish","Fish, Scorpion Fishes, Sculpins","Fish, Softnose Skates","Fish, Spiny Eels","Fish, Swamp Eels","Fish, Tarpons","Fungi","Fungi, Asco's","Fungi, Basidio's","Fungi, Chytrids","Fungi, Glomeromycota","Fungi, Zygomycetes","Insects and Spiders","Insects and Spiders, Alderflies, Dobsonflies, Fishflies","Insects and Spiders, Beetles","Insects and Spiders, Booklice, Barklice, Barkflies","Insects and Spiders, Bristletails","Insects and Spiders, Butterflies, Moths","Insects and Spiders, Caddisflies, Sedge-flies or Rail-flies","Insects and Spiders, Cicadas, Aphids, Planthoppers, Leafhoppers, Shield Bugs","Insects and Spiders, Cockroaches, Termites","Insects and Spiders, Dragonflies, Damselflies","Insects and Spiders, Earwigs","Insects and Spiders, Fleas","Insects and Spiders, Flies, Mosquitoes","Insects and Spiders, Grasshoppers, Crickets, Locusts, Katydids, Weta, Lubber","Insects and Spiders, Lacewings, Mantidflies, Antlions","Insects and Spiders, Lice","Insects and Spiders, Mantises","Insects and Spiders, Mayflies, Shadlfies","Insects and Spiders, Scorpionflies, Hangingflies","Insects and Spiders, Silverfish","Insects and Spiders, Spiders","Insects and Spiders, Stick Insects, Phasmids","Insects and Spiders, Stoneflies","Insects and Spiders, Thrips","Insects and Spiders, Twisted-Wing Parasites","Insects and Spiders, Wasps, Ants, Bees, Sawflies","Insects and Spiders, Webspinners","Insects and Spiders, Zorapterans","Mammals","Mammals, Bandicoots, Bilbies","Mammals, Bats","Mammals, Carnivores","Mammals, Carnivorous Marsupials","Mammals, Dolphins, Porpoises, Whales","Mammals, Dugongs, Manatees, Sea Cows","Mammals, Even-toed hoofed","Mammals, Hares, Pikas, Rabbits","Mammals, Herbivorous Marsupials","Mammals, Marsupial Moles","Mammals, Monotremes","Mammals, Odd-toed hoofed","Mammals, Rodents","Mammals, Shrews, Hedgehogs","Molluscs","Molluscs, Chitons","Molluscs, Cuttlefish","Molluscs, Gastropods, Slugs, Snails","Molluscs, Mussels, Clams","Molluscs, Solenogasters","Molluscs, Tooth Shells","Plants","Plants, Conifers, Cycads","Plants, Dicots","Plants, Ferns and Allies","Plants, Flowering plants","Plants, Monocots","Reptiles","Reptiles, Crocodiles","Reptiles, Lizards, Snakes","Reptiles, Tortoises, Turtles, Terrapins"];
                
        self.loadtags = function (data) {
            if (data !== undefined) {
                $.each(data, function (i, obj) {
                    self.data.tags.push(obj);
                });
        }};
                    self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                    
                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    if (self.outputNotCompleted()) {
                        jsData.data = {};
                    }
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.data['surveyDate'](data['surveyDate']);
                self.data['notes'](data['notes']);
                self.data['recordedBy'](data['recordedBy']);
                self.data['species'].loadData(data['species']);
                self.data['individualCount'](orZero(data['individualCount']));
                self.data['identificationConfidence'](data['identificationConfidence']);
                self.data['comments'](data['comments']);
                self.loadsightingPhoto(data['sightingPhoto']);
                self.loadtags(data['tags']);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Single Sighting - Advanced') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            var config = JSON.parse('\u007b\u0022outputName\u0022:\u0022Single Sighting - Advanced\u0022\u002c\u0022optional\u0022:false\u002c\u0022collapsedByDefault\u0022:false\u007d');
            window[viewModelInstance] = new this[viewModelName](savedOutput, config);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koSingle_Sighting_-_Advanced"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(window[viewModelInstance], window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        </script><script type="text/javascript">


    /* Master controller for page. This handles saving each model as required. */
    var Master = function () {
        var self = this;
        this.subscribers = [];
        // client models register their name and methods to participate in saving
        self.register = function (modelInstanceName, getMethod, isDirtyMethod, resetMethod) {
            this.subscribers.push({
                model: modelInstanceName,
                get: getMethod,
                isDirty: isDirtyMethod,
                reset: resetMethod
            });
        };
        // master isDirty flag for the whole page - can control button enabling
        this.isDirty  = function () {
            var dirty = false;
            $.each(this.subscribers, function(i, obj) {
                dirty = dirty || obj.isDirty();
            });
            return dirty;
        };

        this.validate = function() {
            var valid = $('#validation-container').validationEngine('validate');
            if (valid) {
                // Check that forms with multiple optional sections have at least one of those sections completed.
                var optionalCount = 0;
                var notCompletedCount = 0;
                $.each(self.subscribers, function(i, obj) {
                    if (obj.model !== 'activityModel' && obj.model !== 'photoPoints') {
                        if (obj.model.transients.optional) {
                            optionalCount++;
                            if (obj.model.outputNotCompleted()) {
                                notCompletedCount++;
                            }
                        }
                    }
                });
                if (optionalCount > 1 && notCompletedCount == optionalCount) {
                   valid = false;
                   bootbox.alert("<p>To 'Save changes', the mandatory fields of at least one section of this form must be completed.</p>"+
                        "<p>If all sections are 'Not applicable' please contact your grant manager to discuss alternate form options</p>");
                }
            }

            return valid;
        };
        /**
         * Makes an ajax call to save any sections that have been modified. This includes the activity
         * itself and each output.
         *
         * Modified outputs are injected as a list into the activity object. If there is nothing to save
         * in the activity itself, then the root is an object that is empty except for the outputs list.
         *
         * NOTE that the model for each section must register itself to be included in this save.
         *
         * Validates the entire page before saving.
         * @return -1 if the page was not modified, 0 if validation failed, 1 if validation succeeded (or was not requested).
         */
        this.save = function (validate) {
            // Ensure any active change is committed - the knockout binding typically fires on blur.
            $( document.activeElement ).blur();

            if (validate === undefined) {
                validate = true;
            }
            var activityData, outputs = [];

            var success = true;
            if (validate) {
                success = self.validate();
            }
            if (!self.isDirty()) {
                mobileBindings.onSaveActivity(-1, null);
                return -1;
            }
            if (success) {
                $.each(this.subscribers, function(i, obj) {
                    if (obj.model === 'activityModel') {
                        activityData = obj.get();
                    } else {
                        outputs.push(obj.get());
                    }
                });

                if (activityData === undefined) { activityData = {}}
                activityData.outputs = outputs;

                var toSave = JSON.stringify(activityData);
                mobileBindings.onSaveActivity(1, toSave);

            }
            else {
                mobileBindings.onSaveActivity(0, null);
            }
            return success?1:0;
        };

        this.reset = function () {
            $.each(this.subscribers, function(i, obj) {
                if (obj.isDirty()) {
                    obj.reset();
                }
            });
        };

        this.addSite = function(site) {
            var viewModel = ko.dataFor(document.getElementById('site'));
            viewModel.transients.sites.push(site);
            viewModel.siteId(site.siteId);
        }
    };

    if (mobileBindings == undefined) {
        var mobileBindings = {
        
            loadActivity:function(){return "{}"},
        
        
            loadSites:function(){return "[]"},
        
        
            loadThemes:function(){return "[]"},
        

        supportsNewSite:function() { return true; },
        onSaveActivity:function(){},
        createNewSite:function(){}
    };
}
var master = new Master();
var activity = JSON.parse(mobileBindings.loadActivity());
var sites = JSON.parse(mobileBindings.loadSites());
var themes = JSON.parse(mobileBindings.loadThemes());

$(function(){

var scroll = false;

    scroll = true;

$('#validation-container').validationEngine('attach', {scroll: scroll});

$('.helphover').popover({animation: true, trigger:'hover'});

$('#reset').click(function () {
master.reset();
});

function ViewModel (act, sites, themes) {
var self = this;
var today = new Date().toISOStringNoMillis();

self.activityId = act.activityId;
self.description = ko.observable(act.description);
self.notes = ko.observable(act.notes);
self.startDate = ko.observable(act.startDate || today).extend({simpleDate: false});
self.endDate = ko.observable(act.endDate).extend({simpleDate: false});
self.plannedStartDate = ko.observable(act.plannedStartDate).extend({simpleDate: false});
self.plannedEndDate = ko.observable(act.plannedEndDate).extend({simpleDate: false});
self.eventPurpose = ko.observable(act.eventPurpose);
self.fieldNotes = ko.observable(act.fieldNotes);
self.associatedProgram = ko.observable(act.associatedProgram);
self.associatedSubProgram = ko.observable(act.associatedSubProgram);
self.progress = ko.observable(act.progress);
self.mainTheme = ko.observable(act.mainTheme);
self.type = ko.observable(act.type);
self.siteId = ko.observable(act.siteId);
self.projectId = act.projectId;
self.transients = {};
self.transients.sites = ko.observableArray(sites);
self.transients.photoPoints = ko.computed(function() {
    var site = $.grep(self.transients.sites(), function(site, index) { return site.siteId == self.siteId(); })[0];
     if (site) {
         return site.photoPoints ? site.photoPoints : site.poi;
     }
     return [];
});
self.transients.activityProgressValues = ['planned','started','finished'];
self.transients.themes = themes?themes:[];
self.transients.markedAsFinished = ko.observable(act.progress === 'finished');
self.transients.markedAsFinished.subscribe(function (finished) {
    self.progress(finished ? 'finished' : 'started');
    if (finished || !self.endDate()) {
        self.endDate(today);
    }
});
self.transients.siteImgUrl = ko.computed(function() {
    if (self.siteId()) {
         var site = $.grep(self.transients.sites(), function(site, index) { return site.siteId == self.siteId(); })[0];
         if (site) {
            var lat,lon;
            if (site.centroidLat !== undefined && site.centroidLon !== undefined) {
                lat = site.centroidLat;
                lon = site.centroidLon;
            }
            else if (site.extent && site.extent.geometry && site.extent.geometry.centre) {
                lat = site.extent.geometry.centre[1];
                lon = site.extent.geometry.centre[0];
            }
            if (lat !== undefined && lon !== undefined) {
                $('#siteLocationImage').show();
                return fcConfig.googleStaticUrl+lat+","+lon;
            }
         }
    }
    return "";
});
self.siteLoadError = function(data, event) {
    $('#siteLocationImage').hide();
};

self.transients.newSiteSupported = ko.observable( mobileBindings.supportsNewSite());

self.modelForSaving = function () {
    // get model as a plain javascript object
    var jsData = ko.toJS(self);
    delete jsData.transients;
    return jsData;
};
self.modelAsJSON = function () {
    return JSON.stringify(self.modelForSaving());
};

self.save = function (callback, key) {
};

self.createNewSite = function() {
    mobileBindings.createNewSite();
}

self.notImplemented = function () {
    alert("Not implemented yet.")
};

self.attachPhotoPoint = function(e) {
    console.log(e);
};
self.dirtyFlag = ko.dirtyFlag(self, false);

// make sure progress moves to started if we save any data (unless already finished)
// (do this here so the model becomes dirty)
self.progress(self.transients.markedAsFinished() ? 'finished' : 'started');
}


var viewModel = new ViewModel(activity, sites, themes);

ko.applyBindings(viewModel);

master.register('activityModel', viewModel.modelForSaving, viewModel.dirtyFlag.isDirty, viewModel.dirtyFlag.reset);


// Workaround for Android bug 6721 - prevents components under the datepicker from receiving clicks on the datepicker.
var disabled = null;
$('[data-bind^=datepicker]').datepicker().on('show', function() {
    if (disabled == null) {
        disabled = $("input:enabled, select:enabled, button:enabled");
        disabled.prop('disabled', true);
    }
});
$('[data-bind^=datepicker]').datepicker().on('hide', function() {
    if (disabled !== null) {
        disabled.prop('disabled', false);
        disabled = null;
    }
});

});


</script>
</body>
</html>


<!DOCTYPE html>
<head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    
    <script src="static/t5OGphSUjwdNOoxNKgdRTTh1RBtmzhMXxHDYYeR4lYj.js" type="text/javascript" ></script>
<link href="static/090onaZX1M508oSWqGmMeETZ9NkUA9p4CCTW3MUpRPc.css" type="text/css" rel="stylesheet" media="screen, projection" />

<link href="static/VySgOjkVOsD8Jt8ujXROVRjZeDLAAwVhMF5WqPZ8Ajf.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="http://www.ala.org.au/wp-content/themes/ala2011/images/favicon.ico" rel="shortcut icon" />
<!--[if lt IE 9]><script src="static/Yh1Txee3hFzExJ4P1str7tGV24zQMEYtxqtlYJ5ukR0.js" type="text/javascript" ></script><![endif]-->
<link href="static/Qwaw257M4sHcJuspEDRbeQoTceByqRmOCHNaZWpOxuc.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="static/AcXIjLTuc87n8sfxBjJRQSoBIUwP9RnCyK8Sv82i7eV.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="static/doSKUivnfI9gXmPKZ2XG4W5xIABYgKaf5Dwf3LtjNVr.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="static/fx5pGfEFSRJi6nyez3s8fUsjDL8WJ0IB04Njm7T2VAJ.css" type="text/css" rel="stylesheet" media="all" />
<link href="static/qBQAxqnczDqd7Bl7B2gXgLoB51xIPPVo3q06lXUPLcy.css" type="text/css" rel="stylesheet" media="screen,print" />




<link href="static/KYGDEVRRaKjNbTXJkHmicmzo9vFrnnzCnGLcxKjR04f.css" type="text/css" rel="stylesheet" media="screen,print" />

<link href="static/KtHosYDw6qHDklqhUqI9Y0lrV4QlbtokVSWtoN5CyvP.css" type="text/css" rel="stylesheet" media="screen,print" />
<link href="static/nq5UnIyX5LhMaOWVShAJhQHKHVGPAbNeKmoHiJNIGvz.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="/static/RrjzrZ0Ci0GPLETIr8x8KUMjfJtZKvifrUtMCedwKRB.png" rel="shortcut icon" />
<link href="static/4zsVqykqBON8U5Es5kfffXBSGJlbI8VrPDW4hSn1SWJ.css" type="text/css" rel="stylesheet" media="screen, projection" />


<link href="static/sCFm7bBsIMFGQHTSlBbhMHQCXWhOsbBr5z4bu1OueIE.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="http://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="static/tUELnv7Uvq6ppWNUWOlaow3JGSTTIf8hJ2VYvh7Oahj.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="/static/OKcRcjAeA1yuXD9r4fZA1Uw2HEwL7gYvjc6HdrZXIYP.png" rel="shortcut icon" />
<link href="/static/UxF0saaqmikaj74l2WFcCyPMm9hEEs8if7IBy0GNAnd.png" rel="shortcut icon" />
<link href="/static/zs4hrJqt7I802RlaZiXbmbDBarpNPZF8V8fCQJ2RVTM.png" rel="shortcut icon" />
<link href="/static/SvC1e8bSiCPFh8mObbEThgbJIaGZi72ATzqobK6QnnB.gif" rel="shortcut icon" />
<link href="/static/BA9MhIHZnH0zMcKJWIWsTurHhQTpDYE6akqM5excaZI.gif" rel="shortcut icon" />

<script type="text/javascript">
    var fcConfig = {
        bieUrl: "http://bie.ala.org.au",
        speciesProfileUrl: "https://fieldcapture.ala.org.au/proxy/speciesProfile",
        googleStaticUrl:"http://maps.googleapis.com/maps/api/staticmap?maptype=terrian&zoom=12&sensor=false&size=350x250&markers=color:red%7C"
        },
        here = document.location.href;
    </script>
    

    <meta name="layout" content="mobile"/>

    
    
    
</if>

    <style type="text/css">
        input[type=checkbox] {  -webkit-transform: scale(1.5); }
        .checkbox-list label { min-height: 40px; }
        .speciesAutocompleteRow {min-height:40px;}
        .datepicker td, .datepicker th {
            width:40px;
            height:40px;
            vertical-align: middle;
        }
    </style>
</head>

<body>

<div id="content" class="clearfix">
    
<div class="container-fluid validationEngineContainer" id="validation-container">
<div id="koActivityMainBlock">

    <div class="row-fluid">
        <div class="span12">
            <!-- Common activity fields -->

            <div class="row-fluid space-after">
                <div class="span4">

                    <label class="for-readonly">Type</label>
                    <span class="readonly-text" data-bind="text:type"></span>
                </div>
                <div class="span8">

                    <label class="for-readonly">Description</label>
                    <span class="readonly-text" data-bind="text:description"></span>
                </div>
            </div>


            <div class="row-fluid space-after">
                <div class="span4">
                    <label class="for-readonly inline">Planned start date</label>
                    <span class="readonly-text" data-bind="text:plannedStartDate.formattedDate"></span>
                </div>
                <div class="span8">
                    <label class="for-readonly inline">Planned end date</label>
                    <span class="readonly-text" data-bind="text:plannedEndDate.formattedDate"></span>
                </div>
            </div>

            <div class="well">
                <div class="row-fluid">

                    <span class="span8">
                    <div class="row-fluid space-after">

                        <div class="span6 required">
                            <label for="startDate"><b>Actual start date</b>
                                <a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Date the activity was started.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a>
                            </label>


                            <div class="input-append">
                                <input data-bind='datepicker:startDate.date' name='startDate' id='startDate' type='text' size='16' class='input-xlarge' readonly='readonly' targetField='startDate.date' data-validation-engine='validate[required]' />
<span class='add-on open-datepicker'>
  <i class='icon-th'>&nbsp;</i>
</span>
                            </div>

                        </div>
                        <div class="span6" data-bind="css:{required:transients.markedAsFinished}">
                            <label for="endDate"><b>Actual end date</b>
                                <a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Date the activity finished.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a>
                            </label>

                            <div class="input-append">
                                <input data-bind='datepicker:endDate.date' name='endDate' id='endDate' type='text' size='16' class='input-xlarge' readonly='readonly' targetField='endDate.date' data-validation-engine='validate[future[startDate]]' />
<span class='add-on open-datepicker'>
  <i class='icon-th'>&nbsp;</i>
</span>
                            </div>

                        </div>
                    </div>
                    <div class="row-fluid space-after">
                        <div class="span6">
                            <label for="theme"><b>Major theme</b></label>
                            <select id="theme" data-bind="value:mainTheme, options:transients.themes, optionsCaption:'Choose..'" class="input-xlarge" style="width:90%">
                            </select>
                        </div>

                        <div class="span6">
                            <label><b>Progress</b></label>
                            <label for="activityComplete"><input type="checkbox" id="activityComplete" data-bind="checked:transients.markedAsFinished" style="margin-right:1em;"><span>This activity is complete</span></label>

                        </div>

                    </div>
                    <div class="row-fluid">
                        <div class="span6">
                            <label for="site"><b>Site</b></label>
                            <select id='site' style='width:90%' data-bind='options:transients.sites,optionsText:"name",optionsValue:"siteId",value:siteId,optionsCaption:"Choose a site..."'>&nbsp;</select>

                        </div>

                        <div class="span3">

                            <button class="btn btn-info" style="margin-top:25px;" data-bind="visible:transients.newSiteSupported,click:createNewSite">Create new Site</button>
                        </div>
                    </div>

                    
                        
                            
                                
                            
                            
                                
                                    
                                    
                                    
                                    

                                
                            
                        

                    
                    </span>
                    <span class="span4">

                        <img id="siteLocationImage" width="100%" data-bind="event:{error:siteLoadError}, attr:{src:transients.siteImgUrl}, visible:transients.siteImgUrl()"/>


                    </span>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- ko stopBinding: true -->

    
    
    
    <style type="text/css">
        table.rapidMethods th {white-space:normal;}
        table.rapidMethods tbody td:nth-child(1) {width:4%;text-align:center;}
        table.rapidMethods tbody td:nth-child(2) {width:10%;}
        table.rapidMethods tbody td:nth-child(3) {width:15%;}
        table.rapidMethods tbody td:nth-child(4) {width:7%;text-align:center;}
        table.rapidMethods tbody td:nth-child(5) {width:7%;text-align:center;}
        table.rapidMethods tbody td:nth-child(6) {width:7%;text-align:center;}
        table.rapidMethods tbody td:nth-child(7) {width:15%;}
        table.rapidMethods tbody td:nth-child(8) {width:7%;text-align:center;}
        table.rapidMethods tbody td:nth-child(9) {width:7%;text-align:center;}
        table.rapidMethods tbody td:nth-child(10) {width:7%;text-align:center;}
        table.rapidMethods tbody td:nth-child(11) {width:7%;text-align:center;}
        table.rapidMethods tbody td:nth-child(12) {width:7%;text-align:center;}
        table.rapidMethods td:last-child {width:4%;text-align:center;}
        table.rapidMethods textarea {width:100%; box-sizing:border-box; }
        table.rapidMethods select {width:100%; box-sizing:border-box; }
    </style><style type="text/css">
        table.detailedMethods th {white-space:normal;}
        table.detailedMethods tbody td:nth-child(1) {width:5%;text-align:center;}
        table.detailedMethods tbody td:nth-child(2) {width:10%;text-align:center;}
        table.detailedMethods tbody td:nth-child(3) {width:10%;text-align:center;}
        table.detailedMethods tbody td:nth-child(4) {width:10%;text-align:center;}
        table.detailedMethods tbody td:nth-child(5) {width:10%;text-align:center;}
        table.detailedMethods tbody td:nth-child(6) {width:10%;text-align:center;}
        table.detailedMethods tbody td:nth-child(7) {width:10%;text-align:center;}
        table.detailedMethods tbody td:nth-child(8) {width:10%;text-align:center;}
        table.detailedMethods tbody td:nth-child(9) {width:10%;text-align:center;}
        table.detailedMethods tbody td:nth-child(10) {width:10%;text-align:center;}
        table.detailedMethods td:last-child {width:4%;text-align:center;}
        table.detailedMethods textarea {width:100%; box-sizing:border-box; }
        table.detailedMethods select {width:100%; box-sizing:border-box; }
    </style>
    <div class="output-block" id="koSeagrass_Bed_Monitoring">
            <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Seagrass Bed Monitoring</h3>
        <div data-bind="if:transients.optional">
            <label class="checkbox" ><input type="checkbox" data-bind="checked:outputNotCompleted"> <span data-bind="text:transients.questionText"></span> </label>
        </div>
        <div id="Seagrass_Bed_Monitoring-content" data-bind="visible:!outputNotCompleted()">
        <!-- add the dynamic components -->
            <div class="row-fluid space-after " >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span8"><h4 class='text-default text-left'><b>Survey Event Details</b></h4></span></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Record submitted by<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The name of the person who is submitting this record.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input  class="span8 input-small" data-bind='value:data.recordedBy'  data-validation-engine='validate[required]' type='text' class='input-small'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Observers (full names)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The name of the person or party that undertook the survey event.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input  class="span8 input-small" data-bind='value:data.observedBy'  type='text' class='input-small'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Survey date<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The date on which the survey was undertaken.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><div class="input-append"><input data-bind="datepicker:data.surveyDate.date" type="text" size="12" data-validation-engine='validate[required]'/><span class="add-on open-datepicker"><i class="icon-th"></i></span></div></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Start time<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The start time at which the survey was made.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>End time<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The finish time at which the survey was made.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Seagrass Zone</label></span><select class="span8" data-bind='value:data.seagrassZoneNumber,options:transients.seagrassZoneNumberConstraints,optionsCaption:"Please select"'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Sea Search method<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The sampling method used'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.seaSearchMethod,options:transients.seaSearchMethodConstraints,optionsCaption:"Please select"'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Main seagrass species<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The most dominant or abundant species of seagrass occurring within the sample plot.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.dominantSpecies,options:transients.dominantSpeciesConstraints,optionsCaption:"Please select"'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Comments<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Enter any comments for the survey event - eg. flowers of seeds present, physical damage, marine pests, other ...'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span8" data-bind='value:data.eventNotes'></textarea></span></div><div class="row-fluid"><span class="span12">    <span  class="span8"><h4>Mapping Notes:</h4><i>Select a Marine Protected Area location from the drop-down list. Zoom in on the map, select the marker, then click on the actual site.<p><b>Give the site a name in the 'Matched locality' field, then save</b> the location to store it for future use.</i><p><b>If you are entering GPS coordinates</b> for your location, please use WGS84 decimal latitude/longitude to 7 decimal places to ensure accuracy and compatibility with the mapping facility being used in the form.</i></span></span></div></div><div class="span6">
<div class="row-fluid"><span class="span12">    </span></div></div></div>
<div class="row-fluid space-after " >
<span class="span12">    <span  class="span12"><h4 class='text-default text-left'><b>Rapid methods (small or large sites) - 3.1.1 & 3.2.1</b></h4></span></span></div>
<div class="row-fluid space-after " >
<span class="span12">    <span  class="span12">Please enter a value for every column in each of the quadrats that were assessed. <font style='color:red; weight:bold'>Note that 'Total % cover' (excluding epiphytes) must not be greater than 49.</font></span></span></div>
<div class="row-fluid space-after output-section" >
<div class="row-fluid ">
            <table class="table table-bordered rapidMethods " >
                <thead><tr><th>Quadrat No.</th><th>Photo<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Upload images of sampled quadrats.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Sediment type</th><th>Zostera muelleri % cover<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Zostera muelleri'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Heterozostera nigricaulis % cover<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Heterozostera nigricaulis'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Posidonia australis % cover<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Posidonia australis'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Other species name(s)</th><th>Other species % cover</th><th>Bare sed. % cover</th><th>Algal % cover (not epiphytes)</th><th>Total % cover<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Aggregate total % cover of main species.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Epiphytes % cover</th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'rapidMethodsviewTmpl', foreach: data.rapidMethods}"></tbody>
                <script id="rapidMethodsviewTmpl" type="text/html"><tr>
                    <td><span  data-bind='text:quadratId'></span></td>
                    <td><div id="fileupload" data-url="/image/upload" data-bind="imageUpload:{target:image, config:{}}"
     class="fileupload-buttonbar">

    <table><tbody class="files"></tbody></table>
    <!-- The fileinput-button span is used to style the file input field as button -->
    <span class="btn fileinput-button">
        <i class="icon-plus"></i>
        <input type="file" name="files" multiple/>
        <span data-bind="visible:image().length">Add more images</span>
        <span data-bind="visible:!image().length">Add images</span>
    </span>

</div></td>
                    <td><select data-bind='value:sedimentType,options:transients.sedimentTypeConstraints,optionsCaption:"Please select"'></select></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:percentCoverZosteraMuelleri' data-validation-engine='validate[min[0],max[100],custom[number]]' type='number' class='input-mini'/></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:percentCoverHeterozosteraNigricaulis' data-validation-engine='validate[min[0],max[100],custom[number]]' type='number' class='input-mini'/></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:percentCoverPosidoniaAustralis' data-validation-engine='validate[min[0],max[100],custom[number]]' type='number' class='input-mini'/></td>
                    <td><input  class="input-small" data-bind='value:otherSpeciesName'  type='text' class='input-small'/></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:percentCoverOtherSpecies' data-validation-engine='validate[min[0],max[100],custom[number]]' type='number' class='input-mini'/></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:percentCoverBareSediment' data-validation-engine='validate[min[0],max[100],custom[number]]' type='number' class='input-mini'/></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:percentCoverAlgae' data-validation-engine='validate[min[0],max[100],custom[number]]' type='number' class='input-mini'/></td>
                    <td><span  data-bind='text:percentCoverTotal'></span></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:percentCoverEpiphytes' data-validation-engine='validate[min[0],max[100],custom[number]]' type='number' class='input-mini'/></td>
                    <td><i data-bind='click:$root.removerapidMethodsRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
<tr><td colspan="13">
            <div class="text-left" style="margin:5px">
                <a data-bind="click:downloadrapidMethodsTemplateWithData" class="btn"><i class="fa fa-download"></i> Download the data from this table (.xlsx)</a>
            </div>
            </tr>                </tfoot>
            </table>
        </div>
</div>
<div class="row-fluid space-after " >
<span class="span12">    <span  class="span12"><h4 class='text-default text-left'><b>Detailed methods (small or large sites) - 3.1.2 & 3.2.2</b></h4></span></span></div>
<div class="row-fluid space-after output-section" >
<div class="row-fluid ">
            <table class="table table-bordered detailedMethods " >
                <thead><tr><th>Quadrat No.</th><th>Canopy height (cm)</th><th>No. of shoots (PA only - 1/2 quadrat)</th><th>No. of Snails</th><th>No. of Bivalves</th><th>No. of Seastars</th><th>No. of Urchins</th><th>No. of Sponges</th><th>Other</th><th>Total No. of Organisms<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Aggregate total number of organisms.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'detailedMethodsviewTmpl', foreach: data.detailedMethods}"></tbody>
                <script id="detailedMethodsviewTmpl" type="text/html"><tr>
                    <td><span  data-bind='text:quadratId'></span></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:canopyHeightInCentimetres' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:noOfShootsPa' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:numberOfSnails' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:numberOfBivalves' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:numberOfSeastars' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:numberOfUrchins' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:numberOfSponges' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:numberOfOther' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></td>
                    <td><span  data-bind='text:totalNumberOfOrganisms'></span></td>
                    <td><i data-bind='click:$root.removedetailedMethodsRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
<tr><td colspan="11">
            <div class="text-left" style="margin:5px">
                <a data-bind="click:downloaddetailedMethodsTemplateWithData" class="btn"><i class="fa fa-download"></i> Download the data from this table (.xlsx)</a>
            </div>
            </tr>                </tfoot>
            </table>
        </div>
</div>
<!-- The template to display files available for upload -->
<script id="template-upload" type="text/x-tmpl">
    {% for (var i=0, file; file=o.files[i]; i++) { %}
    <tr class="template-upload fade">
        <td class="preview"><span class="fade"></span></td>
        <td class="name"><span>{%=file.name%}</span></td>
        <td class="size"><span>{%=o.formatFileSize(file.size)%}</span></td>
        {% if (file.error) { %}
        <td class="error" colspan="2"><span class="label label-important">{%=locale.fileupload.error%}</span> {%=locale.fileupload.errors[file.error] || file.error%}</td>
        {% } else if (o.files.valid && !i) { %}
        <td>
            <div class="progress progress-success progress-striped active"><div class="bar" style="width:0%;"></div></div>
        </td>
        <td class="start">{% if (!o.options.autoUpload) { %}
            <button class="btn btn-primary">
                <i class="icon-upload icon-white"></i>
                <span>{%=locale.fileupload.start%}</span>
            </button>
            {% } %}</td>
        {% } else { %}
        <td colspan="2"></td>
        {% } %}
        <td class="cancel">{% if (!i) { %}
            <button class="btn btn-warning">
                <i class="icon-ban-circle icon-white"></i>
                <span>{%=locale.fileupload.cancel%}</span>
            </button>
            {% } %}</td>
    </tr>
    {% } %}
</script>
<!-- The template to display files available for download -->
<script id="template-download" type="text/x-tmpl">
    {% for (var i=0, file; file=o.files[i]; i++) { %}
    <tr class="template-download fade">
        {% if (file.error) { %}
        <td></td>
        <td><div class="name">{%=file.name%}</div><div class="size">{%=o.formatFileSize(file.size)%}</div></td>
        <td class="error" colspan="2"><span class="label label-important">{%=locale.fileupload.error%}</span> {%=locale.fileupload.errors[file.error] || file.error%}</td>
        {% } else { %}
        <td class="preview">{% if (file.thumbnail_url) { %}
            <a href="{%=file.url%}" title="{%=file.name%}" rel="gallery" download="{%=file.name%}"><img src="{%=file.thumbnail_url%}"></a>
            {% } %}</td>
        <td class="name" colspan="2">
            <a href="{%=file.url%}" title="{%=file.name%}" rel="{%=file.thumbnail_url&&'gallery'%}" download="{%=file.name%}">{%=file.name%}</a>
            <div class="size">{%=o.formatFileSize(file.size)%}</div>
        </td>

        {% } %}
        <td>
            <button class="delete-image delete btn btn-mini" data-type="DELETE" data-url="https://fieldcapture.ala.org.au/image?id=" data-filename="{%=file.name%}">
                <i class="icon-trash"></i>
                <span>{%=locale.fileupload.destroy%}</span>
            </button>
        </td>
    </tr>
    {% } %}
</script>
        </div>
        


        
    </div>
    

<!-- /ko -->

</div>




</div>

<script src="static/jNGzWep9YTzJQCsSRDWGKonJ7ycvNMNQauAe6AcGX4T.js" type="text/javascript" ></script>





<script src="static/5zeDycYZFxJsfDd3W1kuhrN47XnIMrbhS6gdHDvcExv.js" type="text/javascript" ></script>

<script src="static/ulxBmo4RrKTNT3DuFHethb4EOZpwQfvefxNXivDIbzp.js" type="text/javascript" ></script>








<!--[if gte IE 8]><script src="static/knxjs4G9Cquc79O3iYW107XikPB1Z1ii8QWrtBpzlSP.js" type="text/javascript" ></script><![endif]-->
<script src="static/nRrltgvxdEHd5BqRR1v4XU3ZStOrhDScuH03g4r8E6O.js" type="text/javascript" ></script>

<script src="static/iRQrJhH2zDlUTI4nXr10v5JHksIJyPjoe8fHSE4QZcI.js" type="text/javascript" ></script>

<script src="static/NsIfUsVWId7YD36PcnVeycNW6GCdIRgD7cdnhiQldmM.js" type="text/javascript" ></script>









<script src="static/IZCc6ZgD3MepYbz4UqlDLzMDNNghSCivcfGebmF9V2d.js" type="text/javascript" ></script>
<script src="static/NwE7QStklZyP86Oe5o9TUAwbaHqgfflXARrIBoL6Q5s.js" type="text/javascript" ></script>




<script src="static/e9gGniNN5cG3OR4oPVWd5lYoxE5Xf282hFe7d4FTQbq.js" type="text/javascript" ></script>


<script src="static/CRNxISj7t7ZCV7B8M8dFtBK7x7R4tGVO36INoBz8gQX.js" type="text/javascript" ></script>

<script src="static/QhlSgFWjl35vcaCRa5cKxHZxRWSSluzptQUKz3PHr9s.js" type="text/javascript" ></script>


<script src="static/8WCQyXwicnBgTdLQ4F5jUFtmVXmqG9eUZKvo74wOnIT.js" type="text/javascript" ></script>
<script src="static/9HtLc6nfgO9H72LVVZxetW45ZR623Fx8EhEdydgOq2F.js" type="text/javascript" ></script>
<script src="static/wkrwT3eqoZlWXFPCQRTvkdsdvwzT5Lw2H89f9eTkQdb.js" type="text/javascript" ></script>


<script type="text/javascript">
    
    // load dynamic models - usually objects in a list
            var Output_seagrassBedMonitoring_rapidMethodsRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.quadratId = ko.observable(orZero(data['quadratId'])).extend({numericString:2});
            this.sedimentType = ko.observable(orBlank(data['sedimentType']));
            self.transients.sedimentTypeConstraints = ["Mud","Fine Sand","Sand","Coarse Sand","Gravel"];
            this.percentCoverZosteraMuelleri = ko.observable(orZero(data['percentCoverZosteraMuelleri'])).extend({numericString:2});
            this.percentCoverHeterozosteraNigricaulis = ko.observable(orZero(data['percentCoverHeterozosteraNigricaulis'])).extend({numericString:2});
            this.percentCoverPosidoniaAustralis = ko.observable(orZero(data['percentCoverPosidoniaAustralis'])).extend({numericString:2});
            this.otherSpeciesName = ko.observable(orBlank(data['otherSpeciesName']));
            this.percentCoverOtherSpecies = ko.observable(orZero(data['percentCoverOtherSpecies'])).extend({numericString:2});
            this.percentCoverBareSediment = ko.observable(orZero(data['percentCoverBareSediment'])).extend({numericString:2});
            this.percentCoverAlgae = ko.observable(orZero(data['percentCoverAlgae'])).extend({numericString:2});
            this.percentCoverEpiphytes = ko.observable(orZero(data['percentCoverEpiphytes'])).extend({numericString:2});
                    self.percentCoverTotal = ko.computed(function () {
                        if (isNaN(Number(self.percentCoverPosidoniaAustralis())) || isNaN(Number(self.percentCoverZosteraMuelleri())) || isNaN(Number(self.percentCoverHeterozosteraNigricaulis())) || isNaN(Number(self.percentCoverOtherSpecies())) || isNaN(Number(self.percentCoverBareSediment())) || isNaN(Number(self.percentCoverAlgae()))) { return 0; }
                        return Number(self.percentCoverPosidoniaAustralis()) + Number(self.percentCoverZosteraMuelleri()) + Number(self.percentCoverHeterozosteraNigricaulis()) + Number(self.percentCoverOtherSpecies()) + Number(self.percentCoverBareSediment()) + Number(self.percentCoverAlgae());
                    });
        };
        var Output_seagrassBedMonitoring_detailedMethodsRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.quadratId = ko.observable(orZero(data['quadratId'])).extend({numericString:2});
            this.canopyHeightInCentimetres = ko.observable(orZero(data['canopyHeightInCentimetres'])).extend({numericString:2});
            this.noOfShootsPa = ko.observable(orZero(data['noOfShootsPa'])).extend({numericString:2});
            this.numberOfSnails = ko.observable(orZero(data['numberOfSnails'])).extend({numericString:2});
            this.numberOfBivalves = ko.observable(orZero(data['numberOfBivalves'])).extend({numericString:2});
            this.numberOfSeastars = ko.observable(orZero(data['numberOfSeastars'])).extend({numericString:2});
            this.numberOfUrchins = ko.observable(orZero(data['numberOfUrchins'])).extend({numericString:2});
            this.numberOfSponges = ko.observable(orZero(data['numberOfSponges'])).extend({numericString:2});
            this.numberOfOther = ko.observable(orZero(data['numberOfOther'])).extend({numericString:2});
                    self.totalNumberOfOrganisms = ko.computed(function () {
                        if (isNaN(Number(self.numberOfSnails())) || isNaN(Number(self.numberOfBivalves())) || isNaN(Number(self.numberOfSeastars())) || isNaN(Number(self.numberOfSponges())) || isNaN(Number(self.numberOfOther()))) { return 0; }
                        return Number(self.numberOfSnails()) + Number(self.numberOfBivalves()) + Number(self.numberOfSeastars()) + Number(self.numberOfSponges()) + Number(self.numberOfOther());
                    });
        };
        var speciesLists = [];
        var site = {};


    window["ViewModel"] = function (output, site, config) {
        var self = this;
        if (!output) {
            output = {};
        }
        var activityId = output.activityId || config.activityId || '';
        self.name = "";
        self.outputId = orBlank(output.outputId);

        self.data = {};
        self.transients = {};
        var notCompleted = output.outputNotCompleted;

        if (notCompleted === undefined) {
            notCompleted = config.collapsedByDefault;
        }

        self.transients.selectedSite = ko.observable(site);
        self.outputNotCompleted = ko.observable(notCompleted);
        self.transients.optional = config.optional || false;
        self.transients.questionText = config.optionalQuestionText || 'Not applicable';
        self.transients.dummy = ko.observable();

        self.downloadDataTemplate = function(listName) {
            var data = ko.mapping.toJS(self.data[listName](), {ignore:['transients']});
            var params = {
                listName:listName,
                type:self.name,
                data:JSON.stringify(data)
            };
            var url = '/activity/excelOutputTemplate';
            $.fileDownload(url, {
                httpMethod:'POST',
                data:params
            });

        };


        // add declarations for dynamic data
        
            self.data.recordedBy = ko.observable();

            self.data.observedBy = ko.observable();

            self.data.surveyDate = ko.observable().extend({simpleDate: false});

            self.data.seagrassZoneNumber = ko.observable();
            self.transients.seagrassZoneNumberConstraints = ["Intertidal seagrass","Subtidal seagrass"];

            self.data.seaSearchMethod = ko.observable();
            self.transients.seaSearchMethodConstraints = ["2.1 Cover quadrats - algae and invertebrates","2.2 Catching snails and other mobile creatures"];

            self.data.dominantSpecies = ko.observable();
            self.transients.dominantSpeciesConstraints = ["Amphibolis antarctica","Heterozostera nigricaulis","Posidonia australis","Zostera muelleri"];

            self.data.eventNotes = ko.observable();

            self.data.rapidMethods = ko.observableArray([]);
            self.selectedrapidMethodsRow = ko.observable();
        

            self.loadrapidMethods = function (data, append) {
                if (!append) {
                    self.data.rapidMethods([]);
                }
                if (data === undefined) {
                                        self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"1","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"2","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"3","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"4","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"5","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"6","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"7","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"8","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"9","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"10","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"11","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"12","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"13","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"14","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"15","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"16","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"17","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"18","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"19","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"20","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                } else {
                    $.each(data, function (i, obj) {
                        self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow(obj));
                    });
                }
            };
            self.downloadrapidMethodsTemplateWithData = function() {
                self.downloadDataTemplate('rapidMethods');
            }

            self.addrapidMethodsRow = function () {
                var newRow = new Output_seagrassBedMonitoring_rapidMethodsRow();
                self.data.rapidMethods.push(newRow);
                
            };
            self.removerapidMethodsRow = function (row) {
                self.data.rapidMethods.remove(row);
                
            };
            self.rapidMethodsrowCount = function () {
                return self.data.rapidMethods().length;
            };

            self.rapidMethodsTableDataUploadVisible = ko.observable(false);
            self.showrapidMethodsTableDataUpload = function() {
                self.rapidMethodsTableDataUploadVisible(!self.rapidMethodsTableDataUploadVisible());
            };

            self.templateDownloadUrl = function(type) {
                return '/proxy/excelOutputTemplate?listName=rapidMethods&type=';
            }

            self.rapidMethodsTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadrapidMethods(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "rapidMethodstemplate-upload",
                    downloadTemplateId: "rapidMethodstemplate-download",
                    formData:{type:'null', listName:'rapidMethods'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.detailedMethods = ko.observableArray([]);
            self.selecteddetailedMethodsRow = ko.observable();
        

            self.loaddetailedMethods = function (data, append) {
                if (!append) {
                    self.data.detailedMethods([]);
                }
                if (data === undefined) {
                                        self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"1","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"2","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"3","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"4","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"5","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"6","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"7","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"8","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"9","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"10","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"11","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"12","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"13","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"14","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"15","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"16","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"17","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"18","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"19","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"20","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                } else {
                    $.each(data, function (i, obj) {
                        self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow(obj));
                    });
                }
            };
            self.downloaddetailedMethodsTemplateWithData = function() {
                self.downloadDataTemplate('detailedMethods');
            }

            self.adddetailedMethodsRow = function () {
                var newRow = new Output_seagrassBedMonitoring_detailedMethodsRow();
                self.data.detailedMethods.push(newRow);
                
            };
            self.removedetailedMethodsRow = function (row) {
                self.data.detailedMethods.remove(row);
                
            };
            self.detailedMethodsrowCount = function () {
                return self.data.detailedMethods().length;
            };

            self.detailedMethodsTableDataUploadVisible = ko.observable(false);
            self.showdetailedMethodsTableDataUpload = function() {
                self.detailedMethodsTableDataUploadVisible(!self.detailedMethodsTableDataUploadVisible());
            };

            self.templateDownloadUrl = function(type) {
                return '/proxy/excelOutputTemplate?listName=detailedMethods&type=';
            }

            self.detailedMethodsTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loaddetailedMethods(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "detailedMethodstemplate-upload",
                    downloadTemplateId: "detailedMethodstemplate-download",
                    formData:{type:'null', listName:'detailedMethods'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };
            self.transients.site = site;

        // this will be called when generating a savable model to remove transient properties
        self.removeBeforeSave = function (jsData) {
            // add code to remove any transients added by the dynamic tags
            
            delete jsData.activityType;
            delete jsData.transients;
            return jsData;
        };

        // this returns a JS object ready for saving
        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
            if (self.outputNotCompleted()) {
                jsData.data = {};
            }

            // get rid of any transient observables
            return self.removeBeforeSave(jsData);
        };

        // this is a version of toJSON that just returns the model as it will be saved
        // it is used for detecting when the model is modified (in a way that should invoke a save)
        // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.loadData = function (data, documents) {
            // load dynamic data
                            self.data['recordedBy'](data['recordedBy']);
                self.data['observedBy'](data['observedBy']);
                self.data['surveyDate'](data['surveyDate']);
                self.data['seagrassZoneNumber'](data['seagrassZoneNumber']);
                self.data['seaSearchMethod'](data['seaSearchMethod']);
                self.data['dominantSpecies'](data['dominantSpecies']);
                self.data['eventNotes'](data['eventNotes']);
                self.loadrapidMethods(data.rapidMethods);
                self.loaddetailedMethods(data.detailedMethods);


            // if there is no data in tables then add an empty row for the user to add data
            if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                self.addRow();
            }
            self.transients.dummy.notifySubscribers();
        };

        self.attachDocument = function(target) {
            var url = config.documentUpdateUrl || fcConfig.documentUpdateUrl;
            showDocumentAttachInModal(url, new DocumentViewModel({role:'information', stage:config.stage},{activityId:activityId, projectId:config.projectId}), '#attachDocument')
                    .done(function(result) {
                        target(new DocumentViewModel(result))
                    });
        };
        self.editDocumentMetadata = function(document) {
            var url = (config.documentUpdateUrl || fcConfig.documentUpdateUrl) + "/" + document.documentId;
            showDocumentAttachInModal(url, document, '#attachDocument');
        };
        self.deleteDocument = function(document) {
            document.status('deleted');
            var url = (config.documentDeleteUrl || fcConfig.documentDeleteUrl)+'/'+document.documentId;
            $.post(url, {}, function() {});

        };
    };
</script><script type="text/javascript">
        $(function(){

            var viewModelName = "Seagrass_Bed_MonitoringViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var Output_seagrassBedMonitoring_rapidMethodsRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.quadratId = ko.observable(orZero(data['quadratId'])).extend({numericString:2});
            this.sedimentType = ko.observable(orBlank(data['sedimentType']));
            self.transients.sedimentTypeConstraints = ["Mud","Fine Sand","Sand","Coarse Sand","Gravel"];
            this.percentCoverZosteraMuelleri = ko.observable(orZero(data['percentCoverZosteraMuelleri'])).extend({numericString:2});
            this.percentCoverHeterozosteraNigricaulis = ko.observable(orZero(data['percentCoverHeterozosteraNigricaulis'])).extend({numericString:2});
            this.percentCoverPosidoniaAustralis = ko.observable(orZero(data['percentCoverPosidoniaAustralis'])).extend({numericString:2});
            this.otherSpeciesName = ko.observable(orBlank(data['otherSpeciesName']));
            this.percentCoverOtherSpecies = ko.observable(orZero(data['percentCoverOtherSpecies'])).extend({numericString:2});
            this.percentCoverBareSediment = ko.observable(orZero(data['percentCoverBareSediment'])).extend({numericString:2});
            this.percentCoverAlgae = ko.observable(orZero(data['percentCoverAlgae'])).extend({numericString:2});
            this.percentCoverEpiphytes = ko.observable(orZero(data['percentCoverEpiphytes'])).extend({numericString:2});
                    self.percentCoverTotal = ko.computed(function () {
                        if (isNaN(Number(self.percentCoverPosidoniaAustralis())) || isNaN(Number(self.percentCoverZosteraMuelleri())) || isNaN(Number(self.percentCoverHeterozosteraNigricaulis())) || isNaN(Number(self.percentCoverOtherSpecies())) || isNaN(Number(self.percentCoverBareSediment())) || isNaN(Number(self.percentCoverAlgae()))) { return 0; }
                        return Number(self.percentCoverPosidoniaAustralis()) + Number(self.percentCoverZosteraMuelleri()) + Number(self.percentCoverHeterozosteraNigricaulis()) + Number(self.percentCoverOtherSpecies()) + Number(self.percentCoverBareSediment()) + Number(self.percentCoverAlgae());
                    });
        };
        var Output_seagrassBedMonitoring_detailedMethodsRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.quadratId = ko.observable(orZero(data['quadratId'])).extend({numericString:2});
            this.canopyHeightInCentimetres = ko.observable(orZero(data['canopyHeightInCentimetres'])).extend({numericString:2});
            this.noOfShootsPa = ko.observable(orZero(data['noOfShootsPa'])).extend({numericString:2});
            this.numberOfSnails = ko.observable(orZero(data['numberOfSnails'])).extend({numericString:2});
            this.numberOfBivalves = ko.observable(orZero(data['numberOfBivalves'])).extend({numericString:2});
            this.numberOfSeastars = ko.observable(orZero(data['numberOfSeastars'])).extend({numericString:2});
            this.numberOfUrchins = ko.observable(orZero(data['numberOfUrchins'])).extend({numericString:2});
            this.numberOfSponges = ko.observable(orZero(data['numberOfSponges'])).extend({numericString:2});
            this.numberOfOther = ko.observable(orZero(data['numberOfOther'])).extend({numericString:2});
                    self.totalNumberOfOrganisms = ko.computed(function () {
                        if (isNaN(Number(self.numberOfSnails())) || isNaN(Number(self.numberOfBivalves())) || isNaN(Number(self.numberOfSeastars())) || isNaN(Number(self.numberOfSponges())) || isNaN(Number(self.numberOfOther()))) { return 0; }
                        return Number(self.numberOfSnails()) + Number(self.numberOfBivalves()) + Number(self.numberOfSeastars()) + Number(self.numberOfSponges()) + Number(self.numberOfOther());
                    });
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output, config) {
                var self = this;
                self.name = "Seagrass Bed Monitoring";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                var notCompleted = output.outputNotCompleted;

                if (notCompleted === undefined) {
                    notCompleted = config.collapsedByDefault;
                }
                self.transients.selectedSite = ko.observable(site);
                self.outputNotCompleted = ko.observable(notCompleted);
                self.transients.optional = config.optional || false;
                self.transients.questionText = config.optionalQuestionText || 'Not applicable';
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.recordedBy = ko.observable();

            self.data.observedBy = ko.observable();

            self.data.surveyDate = ko.observable().extend({simpleDate: false});

            self.data.seagrassZoneNumber = ko.observable();
            self.transients.seagrassZoneNumberConstraints = ["Intertidal seagrass","Subtidal seagrass"];

            self.data.seaSearchMethod = ko.observable();
            self.transients.seaSearchMethodConstraints = ["2.1 Cover quadrats - algae and invertebrates","2.2 Catching snails and other mobile creatures"];

            self.data.dominantSpecies = ko.observable();
            self.transients.dominantSpeciesConstraints = ["Amphibolis antarctica","Heterozostera nigricaulis","Posidonia australis","Zostera muelleri"];

            self.data.eventNotes = ko.observable();

            self.data.rapidMethods = ko.observableArray([]);
            self.selectedrapidMethodsRow = ko.observable();
        

            self.loadrapidMethods = function (data, append) {
                if (!append) {
                    self.data.rapidMethods([]);
                }
                if (data === undefined) {
                                        self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"1","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"2","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"3","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"4","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"5","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"6","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"7","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"8","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"9","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"10","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"11","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"12","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"13","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"14","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"15","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"16","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"17","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"18","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"19","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                    self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow({"sedimentType":"","percentCoverOtherSpecies":"","percentCoverPosidoniaAustralis":"","percentCoverTotal":"","percentCoverEpiphytes":"","percentCoverBareSediment":"","otherSpeciesName":"","percentCoverZosteraMuelleri":"","quadratId":"20","percentCoverHeterozosteraNigricaulis":"","percentCoverAlgae":"","speciesImage":""}));
                } else {
                    $.each(data, function (i, obj) {
                        self.data.rapidMethods.push(new Output_seagrassBedMonitoring_rapidMethodsRow(obj));
                    });
                }
            };
            self.downloadrapidMethodsTemplateWithData = function() {
                self.downloadDataTemplate('rapidMethods');
            }

            self.addrapidMethodsRow = function () {
                var newRow = new Output_seagrassBedMonitoring_rapidMethodsRow();
                self.data.rapidMethods.push(newRow);
                
            };
            self.removerapidMethodsRow = function (row) {
                self.data.rapidMethods.remove(row);
                
            };
            self.rapidMethodsrowCount = function () {
                return self.data.rapidMethods().length;
            };

            self.rapidMethodsTableDataUploadVisible = ko.observable(false);
            self.showrapidMethodsTableDataUpload = function() {
                self.rapidMethodsTableDataUploadVisible(!self.rapidMethodsTableDataUploadVisible());
            };

            self.templateDownloadUrl = function(type) {
                return '/proxy/excelOutputTemplate?listName=rapidMethods&type=Seagrass+Bed+Monitoring';
            }

            self.rapidMethodsTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadrapidMethods(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "rapidMethodstemplate-upload",
                    downloadTemplateId: "rapidMethodstemplate-download",
                    formData:{type:'Seagrass Bed Monitoring', listName:'rapidMethods'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.detailedMethods = ko.observableArray([]);
            self.selecteddetailedMethodsRow = ko.observable();
        

            self.loaddetailedMethods = function (data, append) {
                if (!append) {
                    self.data.detailedMethods([]);
                }
                if (data === undefined) {
                                        self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"1","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"2","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"3","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"4","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"5","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"6","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"7","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"8","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"9","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"10","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"11","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"12","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"13","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"14","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"15","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"16","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"17","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"18","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"19","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                    self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow({"numberOfSponges":"","numberOfBivalves":"","totalNumberOfOrganisms":"","quadratId":"20","numberOfOther":"","canopyHeightInCentimetres":"","numberOfSnails":"","numberOfSeastars":"","noOfShootsPa":"","numberOfUrchins":""}));
                } else {
                    $.each(data, function (i, obj) {
                        self.data.detailedMethods.push(new Output_seagrassBedMonitoring_detailedMethodsRow(obj));
                    });
                }
            };
            self.downloaddetailedMethodsTemplateWithData = function() {
                self.downloadDataTemplate('detailedMethods');
            }

            self.adddetailedMethodsRow = function () {
                var newRow = new Output_seagrassBedMonitoring_detailedMethodsRow();
                self.data.detailedMethods.push(newRow);
                
            };
            self.removedetailedMethodsRow = function (row) {
                self.data.detailedMethods.remove(row);
                
            };
            self.detailedMethodsrowCount = function () {
                return self.data.detailedMethods().length;
            };

            self.detailedMethodsTableDataUploadVisible = ko.observable(false);
            self.showdetailedMethodsTableDataUpload = function() {
                self.detailedMethodsTableDataUploadVisible(!self.detailedMethodsTableDataUploadVisible());
            };

            self.templateDownloadUrl = function(type) {
                return '/proxy/excelOutputTemplate?listName=detailedMethods&type=Seagrass+Bed+Monitoring';
            }

            self.detailedMethodsTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loaddetailedMethods(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "detailedMethodstemplate-upload",
                    downloadTemplateId: "detailedMethodstemplate-download",
                    formData:{type:'Seagrass Bed Monitoring', listName:'detailedMethods'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                    
                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    if (self.outputNotCompleted()) {
                        jsData.data = {};
                    }
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.data['recordedBy'](data['recordedBy']);
                self.data['observedBy'](data['observedBy']);
                self.data['surveyDate'](data['surveyDate']);
                self.data['seagrassZoneNumber'](data['seagrassZoneNumber']);
                self.data['seaSearchMethod'](data['seaSearchMethod']);
                self.data['dominantSpecies'](data['dominantSpecies']);
                self.data['eventNotes'](data['eventNotes']);
                self.loadrapidMethods(data.rapidMethods);
                self.loaddetailedMethods(data.detailedMethods);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Seagrass Bed Monitoring') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            var config = JSON.parse('\u007b\u0022outputName\u0022:\u0022Seagrass Bed Monitoring\u0022\u002c\u0022optional\u0022:false\u002c\u0022collapsedByDefault\u0022:false\u007d');
            window[viewModelInstance] = new this[viewModelName](savedOutput, config);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koSeagrass_Bed_Monitoring"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(window[viewModelInstance], window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        </script><script type="text/javascript">


    /* Master controller for page. This handles saving each model as required. */
    var Master = function () {
        var self = this;
        this.subscribers = [];
        // client models register their name and methods to participate in saving
        self.register = function (modelInstanceName, getMethod, isDirtyMethod, resetMethod) {
            this.subscribers.push({
                model: modelInstanceName,
                get: getMethod,
                isDirty: isDirtyMethod,
                reset: resetMethod
            });
        };
        // master isDirty flag for the whole page - can control button enabling
        this.isDirty  = function () {
            var dirty = false;
            $.each(this.subscribers, function(i, obj) {
                dirty = dirty || obj.isDirty();
            });
            return dirty;
        };

        this.validate = function() {
            var valid = $('#validation-container').validationEngine('validate');
            if (valid) {
                // Check that forms with multiple optional sections have at least one of those sections completed.
                var optionalCount = 0;
                var notCompletedCount = 0;
                $.each(self.subscribers, function(i, obj) {
                    if (obj.model !== 'activityModel' && obj.model !== 'photoPoints') {
                        if (obj.model.transients.optional) {
                            optionalCount++;
                            if (obj.model.outputNotCompleted()) {
                                notCompletedCount++;
                            }
                        }
                    }
                });
                if (optionalCount > 1 && notCompletedCount == optionalCount) {
                   valid = false;
                   bootbox.alert("<p>To 'Save changes', the mandatory fields of at least one section of this form must be completed.</p>"+
                        "<p>If all sections are 'Not applicable' please contact your grant manager to discuss alternate form options</p>");
                }
            }

            return valid;
        };
        /**
         * Makes an ajax call to save any sections that have been modified. This includes the activity
         * itself and each output.
         *
         * Modified outputs are injected as a list into the activity object. If there is nothing to save
         * in the activity itself, then the root is an object that is empty except for the outputs list.
         *
         * NOTE that the model for each section must register itself to be included in this save.
         *
         * Validates the entire page before saving.
         * @return -1 if the page was not modified, 0 if validation failed, 1 if validation succeeded (or was not requested).
         */
        this.save = function (validate) {
            // Ensure any active change is committed - the knockout binding typically fires on blur.
            $( document.activeElement ).blur();

            if (validate === undefined) {
                validate = true;
            }
            var activityData, outputs = [];

            var success = true;
            if (validate) {
                success = self.validate();
            }
            if (!self.isDirty()) {
                mobileBindings.onSaveActivity(-1, null);
                return -1;
            }
            if (success) {
                $.each(this.subscribers, function(i, obj) {
                    if (obj.model === 'activityModel') {
                        activityData = obj.get();
                    } else {
                        outputs.push(obj.get());
                    }
                });

                if (activityData === undefined) { activityData = {}}
                activityData.outputs = outputs;

                var toSave = JSON.stringify(activityData);
                mobileBindings.onSaveActivity(1, toSave);

            }
            else {
                mobileBindings.onSaveActivity(0, null);
            }
            return success?1:0;
        };

        this.reset = function () {
            $.each(this.subscribers, function(i, obj) {
                if (obj.isDirty()) {
                    obj.reset();
                }
            });
        };

        this.addSite = function(site) {
            var viewModel = ko.dataFor(document.getElementById('site'));
            viewModel.transients.sites.push(site);
            viewModel.siteId(site.siteId);
        }
    };

    if (mobileBindings == undefined) {
        var mobileBindings = {
        
            loadActivity:function(){return "{}"},
        
        
            loadSites:function(){return "[]"},
        
        
            loadThemes:function(){return "[]"},
        

        supportsNewSite:function() { return true; },
        onSaveActivity:function(){},
        createNewSite:function(){}
    };
}
var master = new Master();
var activity = JSON.parse(mobileBindings.loadActivity());
var sites = JSON.parse(mobileBindings.loadSites());
var themes = JSON.parse(mobileBindings.loadThemes());

$(function(){

var scroll = false;

    scroll = true;

$('#validation-container').validationEngine('attach', {scroll: scroll});

$('.helphover').popover({animation: true, trigger:'hover'});

$('#reset').click(function () {
master.reset();
});

function ViewModel (act, sites, themes) {
var self = this;
var today = new Date().toISOStringNoMillis();

self.activityId = act.activityId;
self.description = ko.observable(act.description);
self.notes = ko.observable(act.notes);
self.startDate = ko.observable(act.startDate || today).extend({simpleDate: false});
self.endDate = ko.observable(act.endDate).extend({simpleDate: false});
self.plannedStartDate = ko.observable(act.plannedStartDate).extend({simpleDate: false});
self.plannedEndDate = ko.observable(act.plannedEndDate).extend({simpleDate: false});
self.eventPurpose = ko.observable(act.eventPurpose);
self.fieldNotes = ko.observable(act.fieldNotes);
self.associatedProgram = ko.observable(act.associatedProgram);
self.associatedSubProgram = ko.observable(act.associatedSubProgram);
self.progress = ko.observable(act.progress);
self.mainTheme = ko.observable(act.mainTheme);
self.type = ko.observable(act.type);
self.siteId = ko.observable(act.siteId);
self.projectId = act.projectId;
self.transients = {};
self.transients.sites = ko.observableArray(sites);
self.transients.photoPoints = ko.computed(function() {
    var site = $.grep(self.transients.sites(), function(site, index) { return site.siteId == self.siteId(); })[0];
     if (site) {
         return site.photoPoints ? site.photoPoints : site.poi;
     }
     return [];
});
self.transients.activityProgressValues = ['planned','started','finished'];
self.transients.themes = themes?themes:[];
self.transients.markedAsFinished = ko.observable(act.progress === 'finished');
self.transients.markedAsFinished.subscribe(function (finished) {
    self.progress(finished ? 'finished' : 'started');
    if (finished || !self.endDate()) {
        self.endDate(today);
    }
});
self.transients.siteImgUrl = ko.computed(function() {
    if (self.siteId()) {
         var site = $.grep(self.transients.sites(), function(site, index) { return site.siteId == self.siteId(); })[0];
         if (site) {
            var lat,lon;
            if (site.centroidLat !== undefined && site.centroidLon !== undefined) {
                lat = site.centroidLat;
                lon = site.centroidLon;
            }
            else if (site.extent && site.extent.geometry && site.extent.geometry.centre) {
                lat = site.extent.geometry.centre[1];
                lon = site.extent.geometry.centre[0];
            }
            if (lat !== undefined && lon !== undefined) {
                $('#siteLocationImage').show();
                return fcConfig.googleStaticUrl+lat+","+lon;
            }
         }
    }
    return "";
});
self.siteLoadError = function(data, event) {
    $('#siteLocationImage').hide();
};

self.transients.newSiteSupported = ko.observable( mobileBindings.supportsNewSite());

self.modelForSaving = function () {
    // get model as a plain javascript object
    var jsData = ko.toJS(self);
    delete jsData.transients;
    return jsData;
};
self.modelAsJSON = function () {
    return JSON.stringify(self.modelForSaving());
};

self.save = function (callback, key) {
};

self.createNewSite = function() {
    mobileBindings.createNewSite();
}

self.notImplemented = function () {
    alert("Not implemented yet.")
};

self.attachPhotoPoint = function(e) {
    console.log(e);
};
self.dirtyFlag = ko.dirtyFlag(self, false);

// make sure progress moves to started if we save any data (unless already finished)
// (do this here so the model becomes dirty)
self.progress(self.transients.markedAsFinished() ? 'finished' : 'started');
}


var viewModel = new ViewModel(activity, sites, themes);

ko.applyBindings(viewModel);

master.register('activityModel', viewModel.modelForSaving, viewModel.dirtyFlag.isDirty, viewModel.dirtyFlag.reset);


// Workaround for Android bug 6721 - prevents components under the datepicker from receiving clicks on the datepicker.
var disabled = null;
$('[data-bind^=datepicker]').datepicker().on('show', function() {
    if (disabled == null) {
        disabled = $("input:enabled, select:enabled, button:enabled");
        disabled.prop('disabled', true);
    }
});
$('[data-bind^=datepicker]').datepicker().on('hide', function() {
    if (disabled !== null) {
        disabled.prop('disabled', false);
        disabled = null;
    }
});

});


</script>
</body>
</html>
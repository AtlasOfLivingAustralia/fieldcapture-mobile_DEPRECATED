

<!DOCTYPE html>
<head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <style type="text/css">
        input[type=checkbox] {
            -webkit-transform: scale(1.5); margin:50px;
        }
    </style>
    
    <script src="static/UGoJGyG3j2UCffTg3vnOdi0FsnS2OvrmrsZD6WxaXGy.js" type="text/javascript" ></script>
<link href="static/Eu8FNKwJJQI8mVJO3VIshatRN1bunflYHvvdqk06tbf.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="static/090onaZX1M508oSWqGmMeETZ9NkUA9p4CCTW3MUpRPc.css" type="text/css" rel="stylesheet" media="screen, projection" />

<link href="static/CidRUyEAqkZsnDRPRiaGZBy7vd4DOlnRqweu4CsVcIG.css" type="text/css" rel="stylesheet" media="screen" />
<link href="static/tDKPE9VWZfBnSnxBkPC52ml2dXticvlQDl9aR8VpM2o.css" type="text/css" rel="stylesheet" media="screen, projection" />
<!--[if lt IE 7]><link href="static/v1vjA9BeNpSU8cuoTuVhTEUm6boSzwYQcgfPKKMkqgv.css" type="text/css" rel="stylesheet" media="screen, projection" /><![endif]-->

<link href="http://www.ala.org.au/wp-content/themes/ala2011/images/favicon.ico" rel="shortcut icon" />
<!--[if lt IE 9]><script src="static/Yh1Txee3hFzExJ4P1str7tGV24zQMEYtxqtlYJ5ukR0.js" type="text/javascript" ></script><![endif]-->
<link href="static/6tuLClj7N5eYCZpx7vLn8juIbQUXBkCnWRUJFY7UDCz.css" type="text/css" rel="stylesheet" media="screen,print" />
<link href="/static/7ARiB2rJgSkfi68hxnSlcG9Ot0gQ863DYxkCmSHQweE.png" rel="shortcut icon" />
<link href="/static/14SWTr4VqVh6tnlUlgBtue6IJZ7gwE1y42RT7ya5GGW.png" rel="shortcut icon" />

<link href="static/KYGDEVRRaKjNbTXJkHmicmzo9vFrnnzCnGLcxKjR04f.css" type="text/css" rel="stylesheet" media="screen,print" />

<link href="static/uUQBvO5ITMKwLfoRb2u62GbHXEzxtsbrSWq8MBAOrbX.css" type="text/css" rel="stylesheet" media="screen,print" />
<link href="static/2OXdKoom668LE7PLl0qjJCaLG7Pu7Jv869tAsS4e1oT.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="static/AcXIjLTuc87n8sfxBjJRQSoBIUwP9RnCyK8Sv82i7eV.css" type="text/css" rel="stylesheet" media="screen, projection" />
<script type="text/javascript">
    var fcConfig = {
        serverUrl: "https://fieldcapture-test.ala.org.au",
        activityUpdateUrl: "/activity/ajaxUpdate",
        activityDeleteUrl: "/activity/ajaxDelete",
        projectViewUrl: "/project/index/",
        siteViewUrl: "/site/index/",
        bieUrl: "http://bie.ala.org.au",
        speciesProfileUrl: "/proxy/speciesProfile"
        },
        here = document.location.href;
    </script>
    

    <meta name="layout" content="mobile"/>

    
    

</head>

<body>

<div id="content" class="clearfix">
    
<div class="container-fluid validationEngineContainer" id="validation-container">
<div id="koActivityMainBlock">

    <div class="row-fluid">
        <div class="span12">
            <!-- Common activity fields -->

            <div class="row-fluid space-after">
                <div class="span4">

                    <label class="for-readonly">Type</label>
                    <span class="readonly-text" data-bind="text:type"></span>
                </div>
                <div class="span8">

                    <label class="for-readonly">Description</label>
                    <span class="readonly-text" data-bind="text:description"></span>
                </div>
            </div>


            <div class="row-fluid space-after">
                <div class="span4">
                    <label class="for-readonly inline">Planned start date</label>
                    <span class="readonly-text" data-bind="text:plannedStartDate.formattedDate"></span>
                </div>
                <div class="span8">
                    <label class="for-readonly inline">Planned end date</label>
                    <span class="readonly-text" data-bind="text:plannedEndDate.formattedDate"></span>
                </div>
            </div>

            <div class="well">

            <div class="row-fluid space-after">
                <div class="span4 required">
                    <label for="startDate"><b>Actual start date</b>
                        <a href='#' class='helphover' data-original-title='Start date' data-placement='top' data-content='Date the activity was started.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a>
                    </label>


                    <div class="input-append">
                        <input data-bind='datepicker:startDate.date' name='startDate' id='startDate' type='text' size='16' class='input-xlarge' targetField='startDate.date' data-validation-engine='validate[required]' />
<span class='add-on open-datepicker'>
  <i class='icon-th'>&nbsp;</i>
</span>
                    </div>

                </div>
                <div class="span8 required">
                    <label for="endDate"><b>Actual end date</b>
                        <a href='#' class='helphover' data-original-title='End date' data-placement='top' data-content='Date the activity finished.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a>
                    </label>

                    <div class="input-append">
                        <input data-bind='datepicker:endDate.date' name='endDate' id='endDate' type='text' size='16' class='input-xlarge' targetField='endDate.date' data-validation-engine='validate[future[startDate]]' />
<span class='add-on open-datepicker'>
  <i class='icon-th'>&nbsp;</i>
</span>
                    </div>

                </div>
            </div>
            <div class="row-fluid space-after">
                <div class="span6">
                    <label for="theme"><b>Major theme</b></label>
                    <select id="theme" data-bind="value:mainTheme, options:transients.themes, optionsCaption:'Choose..'" class="input-xlarge">
                    </select>
                </div>

            </div>
            <div class="row-fluid">
                <div class="span4">
                    <label for="site"><b>Site</b></label>
                    <select id='site' width='100%' data-bind='options:transients.sites,optionsText:"name",optionsValue:"siteId",value:siteId,optionsCaption:"Choose a site..."'>&nbsp;</select>

                    <br/>Leave blank if this activity is not associated with a specific site.

                </div>

                <div class="span2">
                    <button class="btn btn-info" data-bind="click:createNewSite">Create new Site</button>
                </div>

                <div class="span6">
                    <img width="250" height="200" data-bind="attr:{src:transients.siteImgUrl}"/>
                </div>


            </div>
            </div>
        </div>
    </div>

</div>

<!-- ko stopBinding: true -->

    
    
    
    <div class="output-block" id="koSampling_Site_Information">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Sampling Site Information<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after " >
<div class="span12">
<div class="row-fluid"><span class="span12">    <span  class="span8">This form is used to record vegetation and site assessment information using the Biodiversity Fund Ecological Monitoring Methodology. The guide for this methodology is available from the Department of Environment website at <strong><a href='http://www.environment.gov.au/cleanenergyfuture/biodiversity-fund/meri/pubs/eco-monitoring-guide.pdf' target='_blank'>http://www.environment.gov.au/cleanenergyfuture/biodiversity-fund/meri/pubs/eco-monitoring-guide.pdf</a></a></strong>.<br>More information is also available on the Native Vegetation Information System (NVIS) at <strong><a href='http://www.environment.gov.au/topics/science-and-research/databases-and-maps/national-vegetation-information-system' target='_blank'>http://www.environment.gov.au/topics/science-and-research/databases-and-maps/national-vegetation-information-system</a></strong>, including maps and descriptions of the major vegetation groups and sub-groups</span></span></div></div></div>
<div class="row-fluid space-after output-section" >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Recorder name:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The name of the person responsible for recording and assuring the quality of the data record.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input  class="span8 input-small" data-bind='value:data.recorderName'  type='text' class='input-small'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Compass bearing of sampled transect (deg mag):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The compass bearing in magnetic degrees of the sampled transect from the starting position of the transect.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.transectBearing' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>What type of assessment event was this?:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Is this an initial assessment of the site or not?'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.assessmentEventType,options:transients.assessmentEventTypeConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></span></div></div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>NVIS major vegetation group:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Major vegetation group from the Native Vegetation Information system'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.nvisGroup,options:transients.nvisGroupConstraints,optionsCaption:"Please select"'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>NVIS major vegetation sub-group:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Major vegetation sub-group from the Native Vegetation Information system'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.nvisSubGroup,options:transients.nvisSubGroupConstraints,optionsCaption:"Please select"'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>General Description / Comments / Notes:</label></span><textarea  class="span8" data-bind='value:data.notes'></textarea></span></div></div></div>

        
    </div>

    
    
    <style type="text/css">
        table.photoPoints td:nth-child(1) {width:25%;}
        table.photoPoints td:nth-child(1) select {width:100%;}
        table.photoPoints td:nth-child(2) {width:40%;}
        table.photoPoints td:nth-child(2) select {width:100%;}
        table.photoPoints td:nth-child(3) {width:20%;}
        table.photoPoints td:nth-child(3) select {width:100%;}
        table.photoPoints td:last-child {width:5%;min-width:70px;text-align:center;}
        table.photoPoints textarea {width:98%;}
    </style>
    <div class="output-block" id="koPhoto_Points">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Photo Points<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after " >
<span class="span12">    <span  class="span12"><strong>Note:</strong> Photo points are created and managed as a part of the site definition.  In order to record a photo point you first need to add a 'point of interest' to the site with a type of 'photo point'. When the site is selected for this activity, a row for each defined photo point will then appear in the table below, allowing you to upload your image taken at the time of the survey.</span></span></div>
<div class="row-fluid space-after " data-bind="visible:transients.site.siteId && !data.photoPoints().length">
<span class="span12">    <span  class="span12"><span><h4>Note: There are no photo points defined for this site.</h4></span></span></span></div>
<div class="row-fluid space-after " data-bind="visible:!transients.site.siteId">
<span class="span12">    <span  class="span12"><span><h4>Note: A site has not yet been selected for this activity. In order to upload a photo point image you must select the site at which this activity is being undertaken, and the site must have the photo point location recorded as a 'point of interest'.</h4></span></span></span></div>
<div class="row-fluid ">
            <table class="table table-bordered photoPoints " data-bind="independentlyValidated:data.photoPoints">
                <thead><tr><th>Photo point</th><th>Photo(s)</th><th>Comment</th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:photoPointstemplateToUse, foreach: data.photoPoints}"></tbody>
                <script id="photoPointsviewTmpl" type="text/html"><tr>
                    <td>
        <div><b><span data-bind="text:name"/></b></div>
        <div>Lat:<span data-bind="text:lat"/></div>
        <div>Lon:<span data-bind="text:lon"/></div>
        <div>Bearing:<span data-bind="text:bearing"/></div>
        </td>
                    <td><ul class="imageList" data-bind="foreach: photo"><li><img data-bind="attr:{src: thumbnail_url}"></img></li></ul></td>
                    <td><span  data-bind='text:comment'></span></td>
                    <td>
                        <button class='btn btn-mini' data-bind='click:$root.editphotoPointsRow, enable:!$root.photoPointsEditing()' title='edit'><i class='icon-edit'></i> Edit</button>
                        <button class='btn btn-mini' data-bind='click:$root.removephotoPointsRow, enable:!$root.photoPointsEditing()' title='remove'><i class='icon-trash'></i> Remove</button>
                    </td>
                </tr></script>
                <script id="photoPointseditTmpl" type="text/html"><tr>
                    <td>
        <div><b><span data-bind="text:name"/></b></div>
        <div>Lat:<span data-bind="text:lat"/></div>
        <div>Lon:<span data-bind="text:lon"/></div>
        <div>Bearing:<span data-bind="text:bearing"/></div>
        </td>
                    <td><div id="fileupload" data-url="/image/upload" data-bind="fileUpload:photo"
     class="fileupload-buttonbar">

    <table><tbody class="files"></tbody></table>
    <!-- The fileinput-button span is used to style the file input field as button -->
    <span class="btn fileinput-button">
        <i class="icon-plus"></i>
        <input type="file" name="files" multiple/>
        <span data-bind="visible:photo().length">Add more images</span>
        <span data-bind="visible:!photo().length">Add images</span>
    </span>

</div></td>
                    <td><input  class="input-small" data-bind='value:comment'  type='text' class='input-small'/></td>
                    <td>
                        <a class='btn btn-success btn-mini' data-bind='click:$root.acceptphotoPoints' href='#' title='save'>Update</a>
                        <a class='btn btn-mini' data-bind='click:$root.cancelphotoPoints' href='#' title='cancel'>Cancel</a>
                    </td>
                </tr></script>
                <tfoot>
                </tfoot>
            </table>
        </div>
<!-- The template to display files available for upload -->
<script id="template-upload" type="text/x-tmpl">
    {% for (var i=0, file; file=o.files[i]; i++) { %}
    <tr class="template-upload fade">
        <td class="preview"><span class="fade"></span></td>
        <td class="name"><span>{%=file.name%}</span></td>
        <td class="size"><span>{%=o.formatFileSize(file.size)%}</span></td>
        {% if (file.error) { %}
        <td class="error" colspan="2"><span class="label label-important">{%=locale.fileupload.error%}</span> {%=locale.fileupload.errors[file.error] || file.error%}</td>
        {% } else if (o.files.valid && !i) { %}
        <td>
            <div class="progress progress-success progress-striped active"><div class="bar" style="width:0%;"></div></div>
        </td>
        <td class="start">{% if (!o.options.autoUpload) { %}
            <button class="btn btn-primary">
                <i class="icon-upload icon-white"></i>
                <span>{%=locale.fileupload.start%}</span>
            </button>
            {% } %}</td>
        {% } else { %}
        <td colspan="2"></td>
        {% } %}
        <td class="cancel">{% if (!i) { %}
            <button class="btn btn-warning">
                <i class="icon-ban-circle icon-white"></i>
                <span>{%=locale.fileupload.cancel%}</span>
            </button>
            {% } %}</td>
    </tr>
    {% } %}
</script>
<!-- The template to display files available for download -->
<script id="template-download" type="text/x-tmpl">
    {% for (var i=0, file; file=o.files[i]; i++) { %}
    <tr class="template-download fade">
        {% if (file.error) { %}
        <td></td>
        <td><div class="name">{%=file.name%}</div><div class="size">{%=o.formatFileSize(file.size)%}</div></td>
        <td class="error" colspan="2"><span class="label label-important">{%=locale.fileupload.error%}</span> {%=locale.fileupload.errors[file.error] || file.error%}</td>
        {% } else { %}
        <td class="preview">{% if (file.thumbnail_url) { %}
            <a href="{%=file.url%}" title="{%=file.name%}" rel="gallery" download="{%=file.name%}"><img src="{%=file.thumbnail_url%}"></a>
            {% } %}</td>
        <td class="name" colspan="2">
            <a href="{%=file.url%}" title="{%=file.name%}" rel="{%=file.thumbnail_url&&'gallery'%}" download="{%=file.name%}">{%=file.name%}</a>
            <div class="size">{%=o.formatFileSize(file.size)%}</div>
        </td>

        {% } %}
        <td>
            <button class="delete-image delete btn btn-mini" data-type="DELETE" data-url="https://fieldcapture-test.ala.org.au/image?id=" data-filename="{%=file.name%}">
                <i class="icon-trash"></i>
                <span>{%=locale.fileupload.destroy%}</span>
            </button>
        </td>
    </tr>
    {% } %}
</script>
        
    </div>

    
    
    <style type="text/css">
        table.groundCoverSamples td:nth-child(1) {width:10%;text-align:center;}
        table.groundCoverSamples td:nth-child(1) select {width:100%;}
        table.groundCoverSamples td:nth-child(2) {width:10%;text-align:center;}
        table.groundCoverSamples td:nth-child(2) select {width:100%;}
        table.groundCoverSamples td:nth-child(3) {width:10%;text-align:center;}
        table.groundCoverSamples td:nth-child(3) select {width:100%;}
        table.groundCoverSamples td:nth-child(4) {width:10%;text-align:center;}
        table.groundCoverSamples td:nth-child(4) select {width:100%;}
        table.groundCoverSamples td:nth-child(5) {width:10%;text-align:center;}
        table.groundCoverSamples td:nth-child(5) select {width:100%;}
        table.groundCoverSamples td:nth-child(6) {width:10%;text-align:center;}
        table.groundCoverSamples td:nth-child(6) select {width:100%;}
        table.groundCoverSamples td:nth-child(7) {width:10%;text-align:center;}
        table.groundCoverSamples td:nth-child(7) select {width:100%;}
        table.groundCoverSamples td:nth-child(8) {width:10%;text-align:center;}
        table.groundCoverSamples td:nth-child(8) select {width:100%;}
        table.groundCoverSamples td:last-child {width:4%;text-align:center;}
        table.groundCoverSamples textarea {width:98%;}
    </style>
    <div class="output-block" id="koField_Sheet_1_-_Ground_Cover">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Field Sheet 1 - Ground Cover<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after " >
<span class="span12">    <span  class="span12">Please record all ground cover information at each sampling point (1m intervals) along the transect.</span></span></div>
<div class="row-fluid ">
            <table class="table table-bordered groundCoverSamples " >
                <thead><tr><th>Point (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Distance in metres along the transect that a record is made'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Native Plants<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of individual native plants touched by the staff within 1 metre of the ground at the sampling point '>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Exotic Plants<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of individual exotic plants touched by the staff within 1 metre of the ground at the sampling point '>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Cryptogram</th><th>Organic Litter</th><th>Bare ground</th><th>Rock</th><th>Water</th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'groundCoverSamplesviewTmpl', foreach: data.groundCoverSamples}"></tbody>
                <script id="groundCoverSamplesviewTmpl" type="text/html"><tr>
                    <td><span  data-bind='text:sampleLocation'></span></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:numberOfNativePlants' data-validation-engine='validate[min[0],max[3],custom[number]]' type='number' class='input-mini'/></td>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:numberOfExoticPlants' data-validation-engine='validate[min[0],max[3],custom[number]]' type='number' class='input-mini'/></td>
                    <td><input name='cryptogramPresent' data-bind='checked:cryptogramPresent' type='checkbox' class='checkbox'/></td>
                    <td><input name='organicLitterPresent' data-bind='checked:organicLitterPresent' type='checkbox' class='checkbox'/></td>
                    <td><input name='bareGroundPresent' data-bind='checked:bareGroundPresent' data-validation-engine='validate[groupRequired[rockOrBareGround]]' type='checkbox' class='checkbox'/></td>
                    <td><input name='rockPresent' data-bind='checked:rockPresent' data-validation-engine='validate[groupRequired[rockOrBareGround]]' type='checkbox' class='checkbox'/></td>
                    <td><input name='waterPresent' data-bind='checked:waterPresent' type='checkbox' class='checkbox'/></td>
                    <td><i data-bind='click:$root.removegroundCoverSamplesRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                </tfoot>
            </table>
        </div>

        
    </div>

    
    
    <style type="text/css">
        table.evidenceOfExoticFauna td:nth-child(1) {width:10%;text-align:center;}
        table.evidenceOfExoticFauna td:nth-child(1) select {width:100%;}
        table.evidenceOfExoticFauna td:nth-child(2) {width:20%;}
        table.evidenceOfExoticFauna td:nth-child(2) select {width:100%;}
        table.evidenceOfExoticFauna td:nth-child(3) {width:60%;}
        table.evidenceOfExoticFauna td:nth-child(3) select {width:100%;}
        table.evidenceOfExoticFauna td:last-child {width:4%;text-align:center;}
        table.evidenceOfExoticFauna textarea {width:98%;}
    </style>
    <div class="output-block" id="koField_Sheet_2_-_Exotic_Fauna">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Field Sheet 2 - Exotic Fauna<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after " >
<span class="span12">    <span  class="span12">Please record any evidence of the presence of exotic fauna that you find along the sampling transect. This is recorded as the type of evidence and distance along the transect, and any noteworthy observations associated with it.</span></span></div>
<div class="row-fluid ">
            <table class="table table-bordered evidenceOfExoticFauna " >
                <thead><tr><th class="required">Point (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Distance in metres along the transect that a record is made'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th class="required">Evidence<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The type of evidence of the presence of exotic fauna observed'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Comment</th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'evidenceOfExoticFaunaviewTmpl', foreach: data.evidenceOfExoticFauna}"></tbody>
                <script id="evidenceOfExoticFaunaviewTmpl" type="text/html"><tr>
                    <td><input class="input-mini" style="text-align:center" data-bind='value:sampleLocation' data-validation-engine='validate[required,min[0],max[50],custom[number]]' type='number' class='input-mini'/></td>
                    <td><select data-bind='value:evidence,options:transients.evidenceConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></td>
                    <td><textarea  data-bind='value:comment'></textarea></td>
                    <td><i data-bind='click:$root.removeevidenceOfExoticFaunaRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr><td colspan="0" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addevidenceOfExoticFaunaRow">
                        <i class="icon-plus"></i> Add a row</button>
                        <button type="button" class="btn btn-small" data-bind="click:showevidenceOfExoticFaunaTableDataUpload"><i class="icon-upload"></i> Upload data for this table</button>


                    </td></tr>
<tr data-bind="visible:evidenceOfExoticFaunaTableDataUploadVisible"><td colspan="0">
                <div class="text-error text-left">
                    Note: Only valid exact scientific names will be matched and populated from the database (indicated by a green tick). Unmatched species will load, but will be indicated by a green <b>?</b>. Please check your uploaded data and correct as required.
                </div>
                <div class="text-left" style="margin:5px">
                    <a href="/proxy/excelOutputTemplate?type=Field Sheet 2 - Exotic Fauna&listName=evidenceOfExoticFauna" target="evidenceOfExoticFaunaTemplateDownload" class="btn">Step 1 - Download template (.xlsx)</a>
                </div>
                <div class="text-left" style="margin:5px;">
                    <input type="checkbox" data-bind="checked:appendTableRows" style="margin-right:5px">Append uploaded data to table (unticking this checkbox will result in all table rows being replaced)
                </div>

                <div class="btn fileinput-button" style="margin-left:5px">
                        <input id="evidenceOfExoticFaunaTableDataUpload" type="file" name="data" data-bind="fileUploadNoImage:evidenceOfExoticFaunaTableDataUploadOptions">
                        Step 2 - Upload populated template
                </div>

                    </td></tr> <script id="evidenceOfExoticFaunatemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="evidenceOfExoticFaunatemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>

        
    </div>

    
    
    
    <div class="output-block" id="koField_Sheet_3_-_Overstorey_and_Midstorey_Projected_Crown_Cover">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Field Sheet 3 - Overstorey and Midstorey Projected Crown Cover<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after " >
<span class="span12">    <span  class="span12">Please enter information about the structure of the canopy and midstorey layers by recording the start and finish distances along the transect for each plant with projecting foliage. <br><strong>NB.: Only complete this section if the vegetation type has distinctive canopy and/or midstorey layers.</strong></span></span></div>
<div class="row-fluid space-after " >
<span class="span12">    <span  class="span12"><h3>Transect (projected crown cover - overstorey species)</h3></span></span></div>
<div class="row-fluid space-after " >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span8"><h4>Native overstorey</h4></span></span></div><div class="row-fluid ">
            <table class="table table-bordered nativeOverstoreyCoverSamples " >
                <thead><tr><th>Start (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The distance in metres along the transect from the origin where foliage from an individual plant begins to project over the path of the transect. Each individual plant with projecting foliage should be recorded separately.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>End (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The distance in metres along the transect from the origin where foliage from an individual plant ceases to project over the path of the transect.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Width (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The difference in metres between the start and end positions along the transect where foliage from an individual plant projecting over the path of the transect. This represents the width of the canopy.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'nativeOverstoreyCoverSamplesviewTmpl', foreach: data.nativeOverstoreyCoverSamples}"></tbody>
                <script id="nativeOverstoreyCoverSamplesviewTmpl" type="text/html"><tr>
                    <td><input class="input-small" style="text-align:center" data-bind='value:start' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><input class="input-small" style="text-align:center" data-bind='value:end' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><span  data-bind='text:width'></span></td>
                    <td><i data-bind='click:$root.removenativeOverstoreyCoverSamplesRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr>
                    <td colspan='2'><span >Total native overstorey width (m)</span></td>
                    <td><span  class="value" data-bind='text:data.totalNativeOverstoreyCover'></span></td>
                    <td></td>
                </tr>
                <tr><td colspan="4" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addnativeOverstoreyCoverSamplesRow">
                        <i class="icon-plus"></i> Add a row</button>
                        <button type="button" class="btn btn-small" data-bind="click:shownativeOverstoreyCoverSamplesTableDataUpload"><i class="icon-upload"></i> Upload data for this table</button>


                    </td></tr>
<tr data-bind="visible:nativeOverstoreyCoverSamplesTableDataUploadVisible"><td colspan="4">
                <div class="text-error text-left">
                    Note: Only valid exact scientific names will be matched and populated from the database (indicated by a green tick). Unmatched species will load, but will be indicated by a green <b>?</b>. Please check your uploaded data and correct as required.
                </div>
                <div class="text-left" style="margin:5px">
                    <a href="/proxy/excelOutputTemplate?type=Field Sheet 3 - Overstorey and Midstorey Projected Crown Cover&listName=nativeOverstoreyCoverSamples" target="nativeOverstoreyCoverSamplesTemplateDownload" class="btn">Step 1 - Download template (.xlsx)</a>
                </div>
                <div class="text-left" style="margin:5px;">
                    <input type="checkbox" data-bind="checked:appendTableRows" style="margin-right:5px">Append uploaded data to table (unticking this checkbox will result in all table rows being replaced)
                </div>

                <div class="btn fileinput-button" style="margin-left:5px">
                        <input id="nativeOverstoreyCoverSamplesTableDataUpload" type="file" name="data" data-bind="fileUploadNoImage:nativeOverstoreyCoverSamplesTableDataUploadOptions">
                        Step 2 - Upload populated template
                </div>

                    </td></tr> <script id="nativeOverstoreyCoverSamplestemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="nativeOverstoreyCoverSamplestemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>
</div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span8"><h4>Exotic overstorey</h4></span></span></div><div class="row-fluid ">
            <table class="table table-bordered exoticOverstoreyCoverSamples " >
                <thead><tr><th>Start (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The distance in metres along the transect from the origin where foliage from an individual plant begins to project over the path of the transect. Each individual plant with projecting foliage should be recorded separately.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>End (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The distance in metres along the transect from the origin where foliage from an individual plant ceases to project over the path of the transect.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Width (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The difference in metres between the start and end positions along the transect where foliage from an individual plant projecting over the path of the transect. This represents the width of the canopy.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'exoticOverstoreyCoverSamplesviewTmpl', foreach: data.exoticOverstoreyCoverSamples}"></tbody>
                <script id="exoticOverstoreyCoverSamplesviewTmpl" type="text/html"><tr>
                    <td><input class="input-small" style="text-align:center" data-bind='value:start' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><input class="input-small" style="text-align:center" data-bind='value:end' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><span  data-bind='text:width'></span></td>
                    <td><i data-bind='click:$root.removeexoticOverstoreyCoverSamplesRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr>
                    <td colspan='2'><span >Total exotic overstorey width (m)</span></td>
                    <td><span  class="value" data-bind='text:data.totalExoticOverstoreyCover'></span></td>
                    <td></td>
                </tr>
                <tr><td colspan="4" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addexoticOverstoreyCoverSamplesRow">
                        <i class="icon-plus"></i> Add a row</button>
                        <button type="button" class="btn btn-small" data-bind="click:showexoticOverstoreyCoverSamplesTableDataUpload"><i class="icon-upload"></i> Upload data for this table</button>


                    </td></tr>
<tr data-bind="visible:exoticOverstoreyCoverSamplesTableDataUploadVisible"><td colspan="4">
                <div class="text-error text-left">
                    Note: Only valid exact scientific names will be matched and populated from the database (indicated by a green tick). Unmatched species will load, but will be indicated by a green <b>?</b>. Please check your uploaded data and correct as required.
                </div>
                <div class="text-left" style="margin:5px">
                    <a href="/proxy/excelOutputTemplate?type=Field Sheet 3 - Overstorey and Midstorey Projected Crown Cover&listName=exoticOverstoreyCoverSamples" target="exoticOverstoreyCoverSamplesTemplateDownload" class="btn">Step 1 - Download template (.xlsx)</a>
                </div>
                <div class="text-left" style="margin:5px;">
                    <input type="checkbox" data-bind="checked:appendTableRows" style="margin-right:5px">Append uploaded data to table (unticking this checkbox will result in all table rows being replaced)
                </div>

                <div class="btn fileinput-button" style="margin-left:5px">
                        <input id="exoticOverstoreyCoverSamplesTableDataUpload" type="file" name="data" data-bind="fileUploadNoImage:exoticOverstoreyCoverSamplesTableDataUploadOptions">
                        Step 2 - Upload populated template
                </div>

                    </td></tr> <script id="exoticOverstoreyCoverSamplestemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="exoticOverstoreyCoverSamplestemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>
</div></div>
<div class="row-fluid space-after " >
<span class="span12">    <span  class="span12"><h3>Transect (projected crown cover - midstorey species)</h3></span></span></div>
<div class="row-fluid space-after " >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span8"><h4>Native midstorey</h4></span></span></div><div class="row-fluid ">
            <table class="table table-bordered nativeMidstoreyCoverSamples " >
                <thead><tr><th>Start (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The distance in metres along the transect from the origin where foliage from an individual plant begins to project over the path of the transect. Each individual plant with projecting foliage should be recorded separately.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>End (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The distance in metres along the transect from the origin where foliage from an individual plant ceases to project over the path of the transect.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Width (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The difference in metres between the start and end positions along the transect where foliage from an individual plant projecting over the path of the transect. This represents the width of the canopy.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'nativeMidstoreyCoverSamplesviewTmpl', foreach: data.nativeMidstoreyCoverSamples}"></tbody>
                <script id="nativeMidstoreyCoverSamplesviewTmpl" type="text/html"><tr>
                    <td><input class="input-small" style="text-align:center" data-bind='value:start' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><input class="input-small" style="text-align:center" data-bind='value:end' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><span  data-bind='text:width'></span></td>
                    <td><i data-bind='click:$root.removenativeMidstoreyCoverSamplesRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr>
                    <td colspan='2'><span >Total native midstorey width (m)</span></td>
                    <td><span  class="value" data-bind='text:data.totalNativeMidstoreyCover'></span></td>
                    <td></td>
                </tr>
                <tr><td colspan="4" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addnativeMidstoreyCoverSamplesRow">
                        <i class="icon-plus"></i> Add a row</button>
                        <button type="button" class="btn btn-small" data-bind="click:shownativeMidstoreyCoverSamplesTableDataUpload"><i class="icon-upload"></i> Upload data for this table</button>


                    </td></tr>
<tr data-bind="visible:nativeMidstoreyCoverSamplesTableDataUploadVisible"><td colspan="4">
                <div class="text-error text-left">
                    Note: Only valid exact scientific names will be matched and populated from the database (indicated by a green tick). Unmatched species will load, but will be indicated by a green <b>?</b>. Please check your uploaded data and correct as required.
                </div>
                <div class="text-left" style="margin:5px">
                    <a href="/proxy/excelOutputTemplate?type=Field Sheet 3 - Overstorey and Midstorey Projected Crown Cover&listName=nativeMidstoreyCoverSamples" target="nativeMidstoreyCoverSamplesTemplateDownload" class="btn">Step 1 - Download template (.xlsx)</a>
                </div>
                <div class="text-left" style="margin:5px;">
                    <input type="checkbox" data-bind="checked:appendTableRows" style="margin-right:5px">Append uploaded data to table (unticking this checkbox will result in all table rows being replaced)
                </div>

                <div class="btn fileinput-button" style="margin-left:5px">
                        <input id="nativeMidstoreyCoverSamplesTableDataUpload" type="file" name="data" data-bind="fileUploadNoImage:nativeMidstoreyCoverSamplesTableDataUploadOptions">
                        Step 2 - Upload populated template
                </div>

                    </td></tr> <script id="nativeMidstoreyCoverSamplestemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="nativeMidstoreyCoverSamplestemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>
</div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span8"><h4>Exotic midstorey</h4></span></span></div><div class="row-fluid ">
            <table class="table table-bordered exoticMidstoreyCoverSamples " >
                <thead><tr><th>Start (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The distance in metres along the transect from the origin where foliage from an individual plant begins to project over the path of the transect. Each individual plant with projecting foliage should be recorded separately.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>End (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The distance in metres along the transect from the origin where foliage from an individual plant ceases to project over the path of the transect.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Width (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The difference in metres between the start and end positions along the transect where foliage from an individual plant projecting over the path of the transect. This represents the width of the canopy.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'exoticMidstoreyCoverSamplesviewTmpl', foreach: data.exoticMidstoreyCoverSamples}"></tbody>
                <script id="exoticMidstoreyCoverSamplesviewTmpl" type="text/html"><tr>
                    <td><input class="input-small" style="text-align:center" data-bind='value:start' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><input class="input-small" style="text-align:center" data-bind='value:end' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><span  data-bind='text:width'></span></td>
                    <td><i data-bind='click:$root.removeexoticMidstoreyCoverSamplesRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr>
                    <td colspan='2'><span >Total exotic midstorey width (m)</span></td>
                    <td><span  class="value" data-bind='text:data.totalExoticMidstoreyCover'></span></td>
                    <td></td>
                </tr>
                <tr><td colspan="4" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addexoticMidstoreyCoverSamplesRow">
                        <i class="icon-plus"></i> Add a row</button>
                        <button type="button" class="btn btn-small" data-bind="click:showexoticMidstoreyCoverSamplesTableDataUpload"><i class="icon-upload"></i> Upload data for this table</button>


                    </td></tr>
<tr data-bind="visible:exoticMidstoreyCoverSamplesTableDataUploadVisible"><td colspan="4">
                <div class="text-error text-left">
                    Note: Only valid exact scientific names will be matched and populated from the database (indicated by a green tick). Unmatched species will load, but will be indicated by a green <b>?</b>. Please check your uploaded data and correct as required.
                </div>
                <div class="text-left" style="margin:5px">
                    <a href="/proxy/excelOutputTemplate?type=Field Sheet 3 - Overstorey and Midstorey Projected Crown Cover&listName=exoticMidstoreyCoverSamples" target="exoticMidstoreyCoverSamplesTemplateDownload" class="btn">Step 1 - Download template (.xlsx)</a>
                </div>
                <div class="text-left" style="margin:5px;">
                    <input type="checkbox" data-bind="checked:appendTableRows" style="margin-right:5px">Append uploaded data to table (unticking this checkbox will result in all table rows being replaced)
                </div>

                <div class="btn fileinput-button" style="margin-left:5px">
                        <input id="exoticMidstoreyCoverSamplesTableDataUpload" type="file" name="data" data-bind="fileUploadNoImage:exoticMidstoreyCoverSamplesTableDataUploadOptions">
                        Step 2 - Upload populated template
                </div>

                    </td></tr> <script id="exoticMidstoreyCoverSamplestemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="exoticMidstoreyCoverSamplestemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>
</div></div>

        
    </div>

    
    
    <style type="text/css">
        table.crownTypeSamples td:nth-child(2) {text-align:center;}
        table.crownTypeSamples td:nth-child(3) {text-align:center;}
        table.crownTypeSamples td:last-child {width:4%;text-align:center;}
        table.crownTypeSamples textarea {width:98%;}
    </style>
    <div class="output-block" id="koField_Sheet_4_-_Crown_Type">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Field Sheet 4 - Crown Type<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after " >
<span class="span12">    <span  class="span12">Locate up to 10 points along the transect that are each at least 3m apart and where the <strong>native overstorey canopy</strong> is directly overhead and other conditions specified in the Biodiversity Fund Ecological Monitoring Guide are met. Record the distance along the transect and the type of canopy (looking vertically) as a percentage - see Appendix B in the monitoring guide.</span></span></div>
<div class="row-fluid space-after " >
<span class="span12">    <span  class="span12"><b>Only complete this part if the vegetation type has a distinctive overstorey</b></span></span></div>
<div class="row-fluid ">
            <table class="table table-bordered crownTypeSamples " >
                <thead><tr><th></th><th>Distance along transect (m)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The distance from the origin along the sampling transect in metres at which canopy type percentage is recorded.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Crown Type (%)<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The canopy foliage cover estimated using the Biodiversity Fund Ecological Monitoring methodology, expressed as a percentage.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'crownTypeSamplesviewTmpl', foreach: data.crownTypeSamples}"></tbody>
                <script id="crownTypeSamplesviewTmpl" type="text/html"><tr>
                    <td><span  data-bind='text:sampleName'></span></td>
                    <td><input class="input-small" style="text-align:center" data-bind='value:distanceAlongTransect' data-validation-engine='validate[min[0],max[50],custom[number]]' type='number' class='input-mini'/></td>
                    <td><input class="input-small" style="text-align:center" data-bind='value:crownType' data-validation-engine='validate[min[0],max[100],custom[number]]' type='number' class='input-mini'/></td>
                    <td><i data-bind='click:$root.removecrownTypeSamplesRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr>
                    <td colspan='2'><span >Average crown type (%)</span></td>
                    <td><span  class="value" data-bind='text:data.averageCrownType'></span></td>
                    <td></td>
                </tr>
                </tfoot>
            </table>
        </div>

        
    </div>

    
    
    <style type="text/css">
        table.speciesList td:nth-child(1) {width:80%;}
        table.speciesList td:nth-child(1) select {width:100%;}
        table.speciesList td:nth-child(2) {width:20%;}
        table.speciesList td:nth-child(2) select {width:100%;}
        table.speciesList td:last-child {width:4%;text-align:center;}
        table.speciesList textarea {width:98%;}
    </style>
    <div class="output-block" id="koField_Sheet_5_-_Species_Diversity">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Field Sheet 5 - Species Diversity<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after " >
<span class="span12">    <span  class="span12">Please record all species present in the 20m x 20m plot marked out for this assessment.</span></span></div>
<div class="row-fluid space-after " >
<span class="span12">    <span  class="span12"><p>This sheet differs from the hard copy worksheet - it combines Field Sheet 5 & 6.  Please attempt to identify each species, in particular the exotics.</p></span></span></div>
<div class="row-fluid ">
            <table class="table table-bordered speciesList " >
                <thead><tr><th>Species<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The species present at the site.  If not identified, select "Unknown or unlisted species" from the list'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Native/Exotic<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Specifies whether the species is native to the site or exotic'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'speciesListviewTmpl', foreach: data.speciesList}"></tbody>
                <script id="speciesListviewTmpl" type="text/html"><tr>
                    <td>
<span class="input-prepend input-append" data-bind="with:species">
    <span class="add-on" data-bind="visible:!transients.editing(), css:{'btn-success':name()}"><i class="icon-white" data-bind="css:{'icon-ok':listId()!='unmatched' && name(), 'icon-question-sign':listId()=='unmatched'}"></i></span><span class="add-on" data-bind="visible:transients.editing()"><img src="/static/Xo2jbaJ5EFqa59u9g4c4ybpCpw3wFWKhQdzZwNmmktO.gif" alt="saving icon" /></span><input type="text" data-bind="value:transients.textFieldValue,event:{focusout:focusLost},autocomplete:{url:'/search/species', render: renderItem, listId: list, result:speciesSelected, valueChangeCallback:textFieldChanged}" />
    <span class="add-on" data-bind="visible: !transients.editing() && name()">
        <a href="#" data-bind="popover: {title: name, content: transients.speciesInformation}"><i class="icon-info-sign"></i></a>
    </span>
</span>
</td>
                    <td><select data-bind='value:nativeOrExotic,options:transients.nativeOrExoticConstraints,optionsCaption:"Please select"'></select></td>
                    <td><i data-bind='click:$root.removespeciesListRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr><td colspan="0" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addspeciesListRow">
                        <i class="icon-plus"></i> Add a row</button>
                        <button type="button" class="btn btn-small" data-bind="click:showspeciesListTableDataUpload"><i class="icon-upload"></i> Upload data for this table</button>


                    </td></tr>
<tr data-bind="visible:speciesListTableDataUploadVisible"><td colspan="0">
                <div class="text-error text-left">
                    Note: Only valid exact scientific names will be matched and populated from the database (indicated by a green tick). Unmatched species will load, but will be indicated by a green <b>?</b>. Please check your uploaded data and correct as required.
                </div>
                <div class="text-left" style="margin:5px">
                    <a href="/proxy/excelOutputTemplate?type=Field Sheet 5 - Species Diversity&listName=speciesList" target="speciesListTemplateDownload" class="btn">Step 1 - Download template (.xlsx)</a>
                </div>
                <div class="text-left" style="margin:5px;">
                    <input type="checkbox" data-bind="checked:appendTableRows" style="margin-right:5px">Append uploaded data to table (unticking this checkbox will result in all table rows being replaced)
                </div>

                <div class="btn fileinput-button" style="margin-left:5px">
                        <input id="speciesListTableDataUpload" type="file" name="data" data-bind="fileUploadNoImage:speciesListTableDataUploadOptions">
                        Step 2 - Upload populated template
                </div>

                    </td></tr> <script id="speciesListtemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="speciesListtemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>

        
    </div>

<!-- /ko -->

</div>




</div>

<script src="static/DzazZ2ePykd4QRUJlInoAO1LMvzeVxjM2JRcis2usBm.js" type="text/javascript" ></script>



<script src="static/N1Pu1Yy1dAP26vjRfEw0sZtbZhL03ir303dL4C7EaVF.js" type="text/javascript" ></script>

<script src="static/gfz9yoFSoT3bDIgFJCbjPP9WLeFgekRHSp7KxcpYrwj.js" type="text/javascript" ></script>
<script src="static/HpQC03jqzgdovdmQNni1bswagCkkBPaWGDIzgICGcvq.js" type="text/javascript" ></script>









<!--[if gte IE 8]><script src="static/knxjs4G9Cquc79O3iYW107XikPB1Z1ii8QWrtBpzlSP.js" type="text/javascript" ></script><![endif]-->
<script src="static/kSJb30BxnBzyoP0WndxrtZbaNWzT8x6LP2Cp7xI9PH4.js" type="text/javascript" ></script>
<script src="static/NbeGWZssK95I6Y1Oz4lzxzRtDzf9dyFLZiTstPEonQa.js" type="text/javascript" ></script>
<script src="static/L85LaBY6yhQwMk24PuXWgqwvtkfvbmMZ3ExPR9xK96.js" type="text/javascript" ></script>
<script src="static/MZjUSqmNLHqbPwhDcAMpejU18pr9ndMRCGKpPBHdSDL.js" type="text/javascript" ></script>
<script src="static/w51VyweI3KQvr6P2DTUzBcR9OpWeX0ktL7UktpeA1k.js" type="text/javascript" ></script>





<script src="static/7l2mDQFFpMnG14cXQPTKd94AN71T8yUF6dHUA2LCJIo.js" type="text/javascript" ></script>
<script src="static/ZbrF5cz3bJrkAqBXLrAlOmoaIYntVDIKpviQs5E8Rhy.js" type="text/javascript" ></script>
<script src="static/yzVPTi9KJTOMgo1ytEFVw7JiBXXkkbj5dU3cYZoIuS.js" type="text/javascript" ></script>

<script src="static/IZCc6ZgD3MepYbz4UqlDLzMDNNghSCivcfGebmF9V2d.js" type="text/javascript" ></script>
<script type="text/javascript">
        $(function(){

            var viewModelName = "Sampling_Site_InformationViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Sampling Site Information";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.recorderName = ko.observable();

            self.data.transectBearing = ko.observable();

            self.data.nvisGroup = ko.observable();
            self.transients.nvisGroupConstraints = ["MVG 1 - Rainforests and Vine Thickets","MVG 2 - Eucalypt Tall Open Forests","MVG 3 - Eucalypt Open Forests","MVG 4 - Eucalypt Low Open Forests","MVG 5 - Eucalypt Woodlands","MVG 6 - Acacia Forests and Woodlands","MVG 7 - Callitris Forests and Woodlands","MVG 8 - Casuarina Forests and Woodlands","MVG 9 - Melaleuca Forests and Woodlands","MVG 10 - Other Forests and Woodlands","MVG 12 - Tropical Eucalypt Woodlands/Grasslands","MVG 14 - Mallee Woodlands and Shrublands","MVG 30 - Unclassified Forest","MVG 11 - Eucalypt Open Woodlands","MVG 13 - Acacia Open Woodlands","MVG 32 - Mallee Open Woodlands and Sparse Mallee Shrublands","MVG 31 - Other Open Woodlands","MVG 15 - Low Closed Forests and Tall Closed Shrublands","MVG 16 - Acacia Shrublands","MVG 17 - Other Shrublands","MVG 18 - Heathlands","MVG 19 - Tussock Grasslands","MVG 20 - Hummock Grasslands","MVG 21 - Other Grasslands, Herblands, Sedgelands and Rushlands","MVG 22 - Chenopod Shrublands, Samphire Shrublands and Forblands","MVG 23 - Mangroves","MVG 24 - Inland aquatic - freshwater, salt lakes, lagoons","MVG 25 - Cleared, non-native vegetation, buildings","MVG 26 - Unclassified native vegetation","MVG 27 - Naturally bare - sand, rock, claypan, mudflat","MVG 28 - Sea and estuaries","MVG 29 - Regrowth, modified native vegetation","MVG 99 - Unknown/no data"];

            self.data.nvisSubGroup = ko.observable();
            self.transients.nvisSubGroupConstraints = ["MVS 1 - Cool temperate rainforest","MVS 2 - Tropical or sub-tropical rainforest","MVS 3 - Eucalyptus (+/- tall) open forest with a dense broad-leaved and/or tree-fern understorey (wet sclerophyll)","MVS 4 - Eucalyptus open forests with a shrubby understorey","MVS 5 - Eucalyptus open forests with a grassy understorey","MVS 6 - Warm Temperate Rainforest","MVS 7 - Tropical Eucalyptus forest and woodlands with a tall annual grassy understorey","MVS 8 - Eucalyptus woodlands with a shrubby understorey","MVS 9 - Eucalyptus woodlands with a tussock grass understorey","MVS 10 - Eucalyptus woodlands with a hummock grass understorey","MVS 11 - Tropical mixed spp forests and woodlands","MVS 12 - Callitris forests and woodlands","MVS 13 - Brigalow (Acacia harpophylla) forests and woodlands","MVS 14 - Other Acacia forests and woodlands","MVS 15 - Melaleuca open forests and woodlands","MVS 16 - Other forests and woodlands","MVS 17 - Boulders/rock with algae, lichen or scattered plants, or alpine fjaeldmarks","MVS 18 - Eucalyptus low open woodlands with hummock grass","MVS 19 - Eucalyptus low open woodlands with tussock grass","MVS 20 - Mulga (Acacia aneura) woodlands +/- tussock grass +/- forbs","MVS 21 - Other Acacia tall open shrublands and [tall] shrublands","MVS 22 - Acacia (+/- low) open woodlands and shrublands with chenopods","MVS 23 - Acacia (+/- low) open woodlands and shrublands with hummock grass","MVS 24 - Acacia (+/- low) open woodlands and shrublands +/- tussock grass","MVS 25 - Acacia (+/- low) open woodlands and sparse shrublands with a shrubby understorey","MVS 26 - Casuarina and Allocasuarina forests and woodlands","MVS 27 - Mallee with hummock grass","MVS 28 - Low closed forest or tall closed shrublands (including Acacia, Melaleuca and Banksia)","MVS 29 - Mallee with a dense shrubby understorey","MVS 30 - Heath","MVS 31 - Saltbush and Bluebush shrublands","MVS 32 - Other shrublands","MVS 33 - Hummock grasslands","MVS 34 - Mitchell grass (Astrebla) tussock grasslands","MVS 35 - Blue grass (Dicanthium) and tall bunch grass (Vitiveria syn: Chrysopogon) tussock grasslands","MVS 36 - Temperate tussock grasslands","MVS 37 - Other tussock grasslands","MVS 38 - Wet tussock grassland with herbs, sedges or rushes, herblands or ferns","MVS 39 - Mixed chenopod, samphire +/- forbs","MVS 40 - Mangroves","MVS 41 - Saline or brackish sedgelands or grasslands","MVS 42 - Naturally bare, sand, rock, claypan, mudflat","MVS 43 - Salt lakes and lagoons","MVS 44 - Freshwater, dams, lakes, lagoons or aquatic plants","MVS 45 - Mulga (Acacia aneura) open woodlands and sparse shrublands +/- tussock grass","MVS 46 - Sea, estuaries (includes seagrass)","MVS 47 - Eucalyptus open woodlands with shrubby understorey","MVS 48 - Eucalyptus open woodlands with a grassy understorey","MVS 49 - Melaleuca shrublands and open shrublands","MVS 50 - Banksia woodlands","MVS 51 - Mulga (Acacia aneura) woodlands and shrublands with hummock grass","MVS 52 - Mulga (Acacia aneura) open woodlands and sparse shrublands with hummock grass","MVS 53 - Eucalyptus low open woodlands with a shrubby understorey","MVS 54 - Eucalyptus tall open forest with a fine-leaved shrubby understorey","MVS 55 - Mallee  with an open shrubby understorey","MVS 56 - Eucalyptus (+/- low) open woodlands with a chenopod or samphire understorey","MVS 57 - Lignum shrublands and wetlands","MVS 58 - Leptospermum forests and woodlands","MVS 59 - Eucalyptus woodlands with ferns, herbs, sedges, rushes or wet tussock grassland","MVS 60 - Eucalyptus tall open forests and open forests with ferns, herbs, sedges, rushes or wet tussock grasses","MVS 61 - Mallee with a tussock grass understorey","MVS 62 - Dry rainforest or vine thickets","MVS 63 - Sedgelands, rushs or reeds","MVS 64 - Other grasslands","MVS 65 - Eucalyptus woodlands with a chenopod or samphire understorey","MVS 66 - Open mallee woodlands and sparse mallee shrublands with a hummock grass understorey","MVS 67 - Open mallee woodlands and sparse mallee shrublands with a tussock grass understorey","MVS 68 - Open mallee woodlands and sparse mallee shrublands with an open shrubby understorey","MVS 69 - Open mallee woodlands and sparse mallee shrublands with a dense shrubby understorey","MVS 70 - Callitris open woodlands","MVS 71 - Casuarina and Allocasuarina open woodlands with a tussock grass understorey","MVS 72 - Casuarina and Allocasuarina open woodlands with a hummock grass understorey","MVS 73 - Casuarin-a and Allocasuarina open woodlands with a chenopod shrub understorey","MVS 74 - Casuarina and Allocasuarina open woodlands with a shrubby understorey","MVS 75 - Melaleuca open woodlands","MVS 79 - Other open Woodlands","MVS 80 - Other sparse shrublands and sparse heathlands","MVS 90 - Regrowth or modified forests and woodlands","MVS 91 - Regrowth or modified shrublands","MVS 92 - Regrowth or modified graminoids","MVS 93 - Regrowth or modified chenopod shrublands, samphire or forblands","MVS 96 - Unclassified Forest","MVS 97 - Unclassified native vegetation","MVS 98 - Cleared, non-native vegetation, buildings","MVS 99 - Unknown/No data"];

            self.data.assessmentEventType = ko.observable();
            self.transients.assessmentEventTypeConstraints = ["Initial assessment","Follow-up assessment"];

            self.data.notes = ko.observable();
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                    
                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.data['recorderName'](data['recorderName']);
                self.data['transectBearing'](orZero(data['transectBearing']));
                self.data['nvisGroup'](data['nvisGroup']);
                self.data['nvisSubGroup'](data['nvisSubGroup']);
                self.data['assessmentEventType'](data['assessmentEventType']);
                self.data['notes'](data['notes']);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Sampling Site Information') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koSampling_Site_Information"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        
        $(function(){

            var viewModelName = "Photo_PointsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var PhotoPointsRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.isSelected = ko.observable(false);

            this.commit = function () {
                self.doAction('commit');
            };
            this.reset = function () {
                self.doAction('reset');
            };
            this.doAction = function (action) {
                var prop, item;
                for (prop in self) {
                    if (self.hasOwnProperty(prop)) {
                        item = self[prop];
                        if (ko.isObservable(item) && item[action]) {
                           item[action]();
                        }
                    }
                }
            };
            this.isNew = false;
            this.toJSON = function () {
                return ko.mapping.toJS(this, {'ignore':['transients', 'isNew', 'isSelected']});
            };
            this.name = ko.protectedObservable(orBlank(data['name']));
            this.photo = ko.observableArray();
            if (data['photo'] instanceof Array) {
                this.photo(data['photo']);
            } else if (data['photo']) {
                this.photo.push(data['photo']);
            }
            this.comment = ko.protectedObservable(orBlank(data['comment']));
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Photo Points";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.photoPoints = ko.observableArray([]);
            self.selectedphotoPointsRow = ko.observable();
        
            self.addphotoPointsRow = function () {
                var newRow = new PhotoPointsRow();
                self.data.photoPoints.push(newRow);
                newRow.isNew = true; self.editphotoPointsRow(newRow);
            };
            self.removephotoPointsRow = function (row) {
                self.data.photoPoints.remove(row);
                self.selectedphotoPointsRow(null);
            };
            self.photoPointsrowCount = function () {
                return self.data.photoPoints().length;
            };

            self.photoPointsTableDataUploadVisible = ko.observable(false);
            self.showphotoPointsTableDataUpload = function() {
                self.photoPointsTableDataUploadVisible(!self.photoPointsTableDataUploadVisible());
            };

            self.photoPointsTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadphotoPoints(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "photoPointstemplate-upload",
                    downloadTemplateId: "photoPointstemplate-download",
                    formData:{type:'Photo Points', listName:'photoPoints'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.photoPointstemplateToUse = function (row) {
                return self.selectedphotoPointsRow() === row ? 'photoPointseditTmpl' : 'photoPointsviewTmpl';
            };
            self.editphotoPointsRow = function (row) {
                self.selectedphotoPointsRow(row);
                row.isSelected(true);
            };
            self.acceptphotoPoints = function (row, event) {
            if($(event.currentTarget).closest('.validationEngineContainer').validationEngine('validate')) {
                // todo: validation
                row.commit();
                self.selectedphotoPointsRow(null);
                row.isSelected(false);
                row.isNew = false;
                };
            };
            self.cancelphotoPoints = function (row) {
                if (row.isNew) {
                    self.removephotoPointsRow(row);
                } else {
                    row.reset();
                    self.selectedphotoPointsRow(null);
                    row.isSelected(false);
                }
            };
            self.photoPointsEditing = function() {
                return self.selectedphotoPointsRow() != null;
            };
var PhotoPoint = function(data) {
    this.name = data.name;
    this.lat = data.geometry.decimalLatitude;
    this.lon = data.geometry.decimalLongitude;
    this.bearing = data.geometry.bearing;
    this.description = data.description;
};

self.loadphotoPoints = function(data) {
    var photoPointByName = function(name, data) {
        var photoPoint;
        if (data !== undefined) {
            $.each(data, function(index, obj) {
                if (obj.name === name) {
                    photoPoint = obj;
                    return false;
                }
            });
        }
        return photoPoint;
    };
    if (site !== undefined && site.poi !== undefined) {
        $.each(site.poi, function(index, obj) {
            var photoPoint = new PhotoPoint(obj);
            var photoPointData = photoPointByName(obj.name, data);
            if (photoPointData === undefined) {
                photoPointData = {comment:"", photo:[]};
            }
            var row = new PhotoPointsRow(photoPointData);
            $.extend(row, photoPoint);

            self.data.photoPoints.push(row);
        });
    }
};

self.removePhotoPoint = function(photoPoint) {
   self.data.photoPoints.remove(photoPoint);
};            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                                    delete jsData.selectedphotoPointsRow;
                delete jsData.photoPointsTableDataUploadOptions
                delete jsData.photoPointsTableDataUploadVisible

                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.loadphotoPoints(data['photoPoints']);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Photo Points') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koPhoto_Points"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        
        $(function(){

            var viewModelName = "Field_Sheet_1_-_Ground_CoverViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var GroundCoverSamplesRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.sampleLocation = ko.observable(orZero(data['sampleLocation']));
            this.numberOfNativePlants = ko.observable(orZero(data['numberOfNativePlants']));
            this.numberOfExoticPlants = ko.observable(orZero(data['numberOfExoticPlants']));
            this.cryptogramPresent = ko.observable(orFalse(data['cryptogramPresent']));
            this.organicLitterPresent = ko.observable(orFalse(data['organicLitterPresent']));
            this.bareGroundPresent = ko.observable(orFalse(data['bareGroundPresent']));
            this.rockPresent = ko.observable(orFalse(data['rockPresent']));
            this.waterPresent = ko.observable(orFalse(data['waterPresent']));
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Field Sheet 1 - Ground Cover";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.groundCoverSamples = ko.observableArray([]);
            self.selectedgroundCoverSamplesRow = ko.observable();
        

            self.loadgroundCoverSamples = function (data, append) {
                if (!append) {
                    self.data.groundCoverSamples([]);
                }
                if (data === undefined) {
                                        self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":1}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":2}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":3}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":4}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":5}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":6}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":7}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":8}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":9}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":10}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":11}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":12}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":13}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":14}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":15}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":16}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":17}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":18}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":19}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":20}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":21}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":22}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":23}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":24}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":25}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":26}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":27}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":28}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":29}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":30}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":31}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":32}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":33}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":34}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":35}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":36}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":37}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":38}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":39}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":40}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":41}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":42}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":43}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":44}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":45}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":46}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":47}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":48}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":49}));
                    self.data.groundCoverSamples.push(new GroundCoverSamplesRow({"sampleLocation":50}));
                } else {
                    $.each(data, function (i, obj) {
                        self.data.groundCoverSamples.push(new GroundCoverSamplesRow(obj));
                    });
                }
            };

            self.addgroundCoverSamplesRow = function () {
                var newRow = new GroundCoverSamplesRow();
                self.data.groundCoverSamples.push(newRow);
                
            };
            self.removegroundCoverSamplesRow = function (row) {
                self.data.groundCoverSamples.remove(row);
                
            };
            self.groundCoverSamplesrowCount = function () {
                return self.data.groundCoverSamples().length;
            };

            self.groundCoverSamplesTableDataUploadVisible = ko.observable(false);
            self.showgroundCoverSamplesTableDataUpload = function() {
                self.groundCoverSamplesTableDataUploadVisible(!self.groundCoverSamplesTableDataUploadVisible());
            };

            self.groundCoverSamplesTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadgroundCoverSamples(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "groundCoverSamplestemplate-upload",
                    downloadTemplateId: "groundCoverSamplestemplate-download",
                    formData:{type:'Field Sheet 1 - Ground Cover', listName:'groundCoverSamples'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                                    delete jsData.selectedgroundCoverSamplesRow;
                delete jsData.groundCoverSamplesTableDataUploadOptions
                delete jsData.groundCoverSamplesTableDataUploadVisible

                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.loadgroundCoverSamples(data.groundCoverSamples);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Field Sheet 1 - Ground Cover') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koField_Sheet_1_-_Ground_Cover"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        
        $(function(){

            var viewModelName = "Field_Sheet_2_-_Exotic_FaunaViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var EvidenceOfExoticFaunaRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.sampleLocation = ko.observable(orZero(data['sampleLocation']));
            this.evidence = ko.observable(orBlank(data['evidence']));
            self.transients.evidenceConstraints = ["","Hole","Scats","Live","Tracks","Fur or feathers","Warren","Den","Soil","Scratchings","Damage","Other"];
            this.comment = ko.observable(orBlank(data['comment']));
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Field Sheet 2 - Exotic Fauna";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.evidenceOfExoticFauna = ko.observableArray([]);
            self.selectedevidenceOfExoticFaunaRow = ko.observable();
        

            self.loadevidenceOfExoticFauna = function (data, append) {
                if (!append) {
                    self.data.evidenceOfExoticFauna([]);
                }
                if (data === undefined) {
                                        self.data.evidenceOfExoticFauna.push(new EvidenceOfExoticFaunaRow({"sampleLocation":"","evidence":"","comment":""}));
                } else {
                    $.each(data, function (i, obj) {
                        self.data.evidenceOfExoticFauna.push(new EvidenceOfExoticFaunaRow(obj));
                    });
                }
            };

            self.addevidenceOfExoticFaunaRow = function () {
                var newRow = new EvidenceOfExoticFaunaRow();
                self.data.evidenceOfExoticFauna.push(newRow);
                
            };
            self.removeevidenceOfExoticFaunaRow = function (row) {
                self.data.evidenceOfExoticFauna.remove(row);
                
            };
            self.evidenceOfExoticFaunarowCount = function () {
                return self.data.evidenceOfExoticFauna().length;
            };

            self.evidenceOfExoticFaunaTableDataUploadVisible = ko.observable(false);
            self.showevidenceOfExoticFaunaTableDataUpload = function() {
                self.evidenceOfExoticFaunaTableDataUploadVisible(!self.evidenceOfExoticFaunaTableDataUploadVisible());
            };

            self.evidenceOfExoticFaunaTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadevidenceOfExoticFauna(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "evidenceOfExoticFaunatemplate-upload",
                    downloadTemplateId: "evidenceOfExoticFaunatemplate-download",
                    formData:{type:'Field Sheet 2 - Exotic Fauna', listName:'evidenceOfExoticFauna'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                                    delete jsData.selectedevidenceOfExoticFaunaRow;
                delete jsData.evidenceOfExoticFaunaTableDataUploadOptions
                delete jsData.evidenceOfExoticFaunaTableDataUploadVisible

                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.loadevidenceOfExoticFauna(data.evidenceOfExoticFauna);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Field Sheet 2 - Exotic Fauna') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koField_Sheet_2_-_Exotic_Fauna"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        
        $(function(){

            var viewModelName = "Field_Sheet_3_-_Overstorey_and_Midstorey_Projected_Crown_CoverViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var NativeOverstoreyCoverSamplesRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.start = ko.observable(orZero(data['start']));
            this.end = ko.observable(orZero(data['end']));
                    self.width = ko.computed(function () {
                        if (isNaN(Number(self.end())) || isNaN(Number(self.start()))) { return 0; }
                        return Number(self.end()) - Number(self.start());
                    });
        };
        var ExoticOverstoreyCoverSamplesRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.start = ko.observable(orZero(data['start']));
            this.end = ko.observable(orZero(data['end']));
                    self.width = ko.computed(function () {
                        if (isNaN(Number(self.end())) || isNaN(Number(self.start()))) { return 0; }
                        return Number(self.end()) - Number(self.start());
                    });
        };
        var NativeMidstoreyCoverSamplesRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.start = ko.observable(orZero(data['start']));
            this.end = ko.observable(orZero(data['end']));
                    self.width = ko.computed(function () {
                        if (isNaN(Number(self.end())) || isNaN(Number(self.start()))) { return 0; }
                        return Number(self.end()) - Number(self.start());
                    });
        };
        var ExoticMidstoreyCoverSamplesRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.start = ko.observable(orZero(data['start']));
            this.end = ko.observable(orZero(data['end']));
                    self.width = ko.computed(function () {
                        if (isNaN(Number(self.end())) || isNaN(Number(self.start()))) { return 0; }
                        return Number(self.end()) - Number(self.start());
                    });
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Field Sheet 3 - Overstorey and Midstorey Projected Crown Cover";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.nativeOverstoreyCoverSamples = ko.observableArray([]);
            self.selectednativeOverstoreyCoverSamplesRow = ko.observable();
        

            self.loadnativeOverstoreyCoverSamples = function (data, append) {
                if (!append) {
                    self.data.nativeOverstoreyCoverSamples([]);
                }
                if (data === undefined) {
                    self.addnativeOverstoreyCoverSamplesRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.nativeOverstoreyCoverSamples.push(new NativeOverstoreyCoverSamplesRow(obj));
                    });
                }
            };

            self.addnativeOverstoreyCoverSamplesRow = function () {
                var newRow = new NativeOverstoreyCoverSamplesRow();
                self.data.nativeOverstoreyCoverSamples.push(newRow);
                
            };
            self.removenativeOverstoreyCoverSamplesRow = function (row) {
                self.data.nativeOverstoreyCoverSamples.remove(row);
                
            };
            self.nativeOverstoreyCoverSamplesrowCount = function () {
                return self.data.nativeOverstoreyCoverSamples().length;
            };

            self.nativeOverstoreyCoverSamplesTableDataUploadVisible = ko.observable(false);
            self.shownativeOverstoreyCoverSamplesTableDataUpload = function() {
                self.nativeOverstoreyCoverSamplesTableDataUploadVisible(!self.nativeOverstoreyCoverSamplesTableDataUploadVisible());
            };

            self.nativeOverstoreyCoverSamplesTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadnativeOverstoreyCoverSamples(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "nativeOverstoreyCoverSamplestemplate-upload",
                    downloadTemplateId: "nativeOverstoreyCoverSamplestemplate-download",
                    formData:{type:'Field Sheet 3 - Overstorey and Midstorey Projected Crown Cover', listName:'nativeOverstoreyCoverSamples'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.totalNativeOverstoreyCover = ko.computed(function () {
                var total = 0;
                for(var i = 0; i < self.data.nativeOverstoreyCoverSamples().length; i++) {
                    var value = self.data.nativeOverstoreyCoverSamples()[i].width();
                        total = total + Number(value); 
                }
                return total;
            });

            self.data.exoticOverstoreyCoverSamples = ko.observableArray([]);
            self.selectedexoticOverstoreyCoverSamplesRow = ko.observable();
        

            self.loadexoticOverstoreyCoverSamples = function (data, append) {
                if (!append) {
                    self.data.exoticOverstoreyCoverSamples([]);
                }
                if (data === undefined) {
                    self.addexoticOverstoreyCoverSamplesRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.exoticOverstoreyCoverSamples.push(new ExoticOverstoreyCoverSamplesRow(obj));
                    });
                }
            };

            self.addexoticOverstoreyCoverSamplesRow = function () {
                var newRow = new ExoticOverstoreyCoverSamplesRow();
                self.data.exoticOverstoreyCoverSamples.push(newRow);
                
            };
            self.removeexoticOverstoreyCoverSamplesRow = function (row) {
                self.data.exoticOverstoreyCoverSamples.remove(row);
                
            };
            self.exoticOverstoreyCoverSamplesrowCount = function () {
                return self.data.exoticOverstoreyCoverSamples().length;
            };

            self.exoticOverstoreyCoverSamplesTableDataUploadVisible = ko.observable(false);
            self.showexoticOverstoreyCoverSamplesTableDataUpload = function() {
                self.exoticOverstoreyCoverSamplesTableDataUploadVisible(!self.exoticOverstoreyCoverSamplesTableDataUploadVisible());
            };

            self.exoticOverstoreyCoverSamplesTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadexoticOverstoreyCoverSamples(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "exoticOverstoreyCoverSamplestemplate-upload",
                    downloadTemplateId: "exoticOverstoreyCoverSamplestemplate-download",
                    formData:{type:'Field Sheet 3 - Overstorey and Midstorey Projected Crown Cover', listName:'exoticOverstoreyCoverSamples'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.totalExoticOverstoreyCover = ko.computed(function () {
                var total = 0;
                for(var i = 0; i < self.data.exoticOverstoreyCoverSamples().length; i++) {
                    var value = self.data.exoticOverstoreyCoverSamples()[i].width();
                        total = total + Number(value); 
                }
                return total;
            });

            self.data.nativeMidstoreyCoverSamples = ko.observableArray([]);
            self.selectednativeMidstoreyCoverSamplesRow = ko.observable();
        

            self.loadnativeMidstoreyCoverSamples = function (data, append) {
                if (!append) {
                    self.data.nativeMidstoreyCoverSamples([]);
                }
                if (data === undefined) {
                    self.addnativeMidstoreyCoverSamplesRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.nativeMidstoreyCoverSamples.push(new NativeMidstoreyCoverSamplesRow(obj));
                    });
                }
            };

            self.addnativeMidstoreyCoverSamplesRow = function () {
                var newRow = new NativeMidstoreyCoverSamplesRow();
                self.data.nativeMidstoreyCoverSamples.push(newRow);
                
            };
            self.removenativeMidstoreyCoverSamplesRow = function (row) {
                self.data.nativeMidstoreyCoverSamples.remove(row);
                
            };
            self.nativeMidstoreyCoverSamplesrowCount = function () {
                return self.data.nativeMidstoreyCoverSamples().length;
            };

            self.nativeMidstoreyCoverSamplesTableDataUploadVisible = ko.observable(false);
            self.shownativeMidstoreyCoverSamplesTableDataUpload = function() {
                self.nativeMidstoreyCoverSamplesTableDataUploadVisible(!self.nativeMidstoreyCoverSamplesTableDataUploadVisible());
            };

            self.nativeMidstoreyCoverSamplesTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadnativeMidstoreyCoverSamples(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "nativeMidstoreyCoverSamplestemplate-upload",
                    downloadTemplateId: "nativeMidstoreyCoverSamplestemplate-download",
                    formData:{type:'Field Sheet 3 - Overstorey and Midstorey Projected Crown Cover', listName:'nativeMidstoreyCoverSamples'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.totalNativeMidstoreyCover = ko.computed(function () {
                var total = 0;
                for(var i = 0; i < self.data.nativeMidstoreyCoverSamples().length; i++) {
                    var value = self.data.nativeMidstoreyCoverSamples()[i].width();
                        total = total + Number(value); 
                }
                return total;
            });

            self.data.exoticMidstoreyCoverSamples = ko.observableArray([]);
            self.selectedexoticMidstoreyCoverSamplesRow = ko.observable();
        

            self.loadexoticMidstoreyCoverSamples = function (data, append) {
                if (!append) {
                    self.data.exoticMidstoreyCoverSamples([]);
                }
                if (data === undefined) {
                    self.addexoticMidstoreyCoverSamplesRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.exoticMidstoreyCoverSamples.push(new ExoticMidstoreyCoverSamplesRow(obj));
                    });
                }
            };

            self.addexoticMidstoreyCoverSamplesRow = function () {
                var newRow = new ExoticMidstoreyCoverSamplesRow();
                self.data.exoticMidstoreyCoverSamples.push(newRow);
                
            };
            self.removeexoticMidstoreyCoverSamplesRow = function (row) {
                self.data.exoticMidstoreyCoverSamples.remove(row);
                
            };
            self.exoticMidstoreyCoverSamplesrowCount = function () {
                return self.data.exoticMidstoreyCoverSamples().length;
            };

            self.exoticMidstoreyCoverSamplesTableDataUploadVisible = ko.observable(false);
            self.showexoticMidstoreyCoverSamplesTableDataUpload = function() {
                self.exoticMidstoreyCoverSamplesTableDataUploadVisible(!self.exoticMidstoreyCoverSamplesTableDataUploadVisible());
            };

            self.exoticMidstoreyCoverSamplesTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadexoticMidstoreyCoverSamples(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "exoticMidstoreyCoverSamplestemplate-upload",
                    downloadTemplateId: "exoticMidstoreyCoverSamplestemplate-download",
                    formData:{type:'Field Sheet 3 - Overstorey and Midstorey Projected Crown Cover', listName:'exoticMidstoreyCoverSamples'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.totalExoticMidstoreyCover = ko.computed(function () {
                var total = 0;
                for(var i = 0; i < self.data.exoticMidstoreyCoverSamples().length; i++) {
                    var value = self.data.exoticMidstoreyCoverSamples()[i].width();
                        total = total + Number(value); 
                }
                return total;
            });
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                    
                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.loadnativeOverstoreyCoverSamples(data.nativeOverstoreyCoverSamples);
                self.loadexoticOverstoreyCoverSamples(data.exoticOverstoreyCoverSamples);
                self.loadnativeMidstoreyCoverSamples(data.nativeMidstoreyCoverSamples);
                self.loadexoticMidstoreyCoverSamples(data.exoticMidstoreyCoverSamples);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Field Sheet 3 - Overstorey and Midstorey Projected Crown Cover') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koField_Sheet_3_-_Overstorey_and_Midstorey_Projected_Crown_Cover"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        
        $(function(){

            var viewModelName = "Field_Sheet_4_-_Crown_TypeViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var CrownTypeSamplesRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.sampleName = ko.observable(orBlank(data['sampleName']));
            this.distanceAlongTransect = ko.observable(orZero(data['distanceAlongTransect']));
            this.crownType = ko.observable(orZero(data['crownType']));
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Field Sheet 4 - Crown Type";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.crownTypeSamples = ko.observableArray([]);
            self.selectedcrownTypeSamplesRow = ko.observable();
        

            self.loadcrownTypeSamples = function (data, append) {
                if (!append) {
                    self.data.crownTypeSamples([]);
                }
                if (data === undefined) {
                                        self.data.crownTypeSamples.push(new CrownTypeSamplesRow({"distanceAlongTransect":"","sampleName":"Tree canopy 1","crownType":""}));
                    self.data.crownTypeSamples.push(new CrownTypeSamplesRow({"distanceAlongTransect":"","sampleName":"Tree canopy 2","crownType":""}));
                    self.data.crownTypeSamples.push(new CrownTypeSamplesRow({"distanceAlongTransect":"","sampleName":"Tree canopy 3","crownType":""}));
                    self.data.crownTypeSamples.push(new CrownTypeSamplesRow({"distanceAlongTransect":"","sampleName":"Tree canopy 4","crownType":""}));
                    self.data.crownTypeSamples.push(new CrownTypeSamplesRow({"distanceAlongTransect":"","sampleName":"Tree canopy 5","crownType":""}));
                    self.data.crownTypeSamples.push(new CrownTypeSamplesRow({"distanceAlongTransect":"","sampleName":"Tree canopy 6","crownType":""}));
                    self.data.crownTypeSamples.push(new CrownTypeSamplesRow({"distanceAlongTransect":"","sampleName":"Tree canopy 7","crownType":""}));
                    self.data.crownTypeSamples.push(new CrownTypeSamplesRow({"distanceAlongTransect":"","sampleName":"Tree canopy 8","crownType":""}));
                    self.data.crownTypeSamples.push(new CrownTypeSamplesRow({"distanceAlongTransect":"","sampleName":"Tree canopy 9","crownType":""}));
                    self.data.crownTypeSamples.push(new CrownTypeSamplesRow({"distanceAlongTransect":"","sampleName":"Tree canopy 10","crownType":""}));
                } else {
                    $.each(data, function (i, obj) {
                        self.data.crownTypeSamples.push(new CrownTypeSamplesRow(obj));
                    });
                }
            };

            self.addcrownTypeSamplesRow = function () {
                var newRow = new CrownTypeSamplesRow();
                self.data.crownTypeSamples.push(newRow);
                
            };
            self.removecrownTypeSamplesRow = function (row) {
                self.data.crownTypeSamples.remove(row);
                
            };
            self.crownTypeSamplesrowCount = function () {
                return self.data.crownTypeSamples().length;
            };

            self.crownTypeSamplesTableDataUploadVisible = ko.observable(false);
            self.showcrownTypeSamplesTableDataUpload = function() {
                self.crownTypeSamplesTableDataUploadVisible(!self.crownTypeSamplesTableDataUploadVisible());
            };

            self.crownTypeSamplesTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadcrownTypeSamples(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "crownTypeSamplestemplate-upload",
                    downloadTemplateId: "crownTypeSamplestemplate-download",
                    formData:{type:'Field Sheet 4 - Crown Type', listName:'crownTypeSamples'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.averageCrownType = ko.computed(function () {
                var total = 0;
                var count = 0;
                for(var i = 0; i < self.data.crownTypeSamples().length; i++) {
                    var value = self.data.crownTypeSamples()[i].crownType();
                        if (!isNaN(parseFloat(value))) {
                                total = total + Number(value);
                                count++;
                        }
                }
                return count > 0 ? total/count : 0;
            });
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                                    delete jsData.selectedcrownTypeSamplesRow;
                delete jsData.crownTypeSamplesTableDataUploadOptions
                delete jsData.crownTypeSamplesTableDataUploadVisible

                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.loadcrownTypeSamples(data.crownTypeSamples);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Field Sheet 4 - Crown Type') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koField_Sheet_4_-_Crown_Type"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        
        $(function(){

            var viewModelName = "Field_Sheet_5_-_Species_DiversityViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var SpeciesListRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.species =  new SpeciesViewModel(data['species'], speciesLists);
            this.nativeOrExotic = ko.observable(orBlank(data['nativeOrExotic']));
            self.transients.nativeOrExoticConstraints = ["Native","Exotic"];
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Field Sheet 5 - Species Diversity";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.speciesList = ko.observableArray([]);
            self.selectedspeciesListRow = ko.observable();
        

            self.loadspeciesList = function (data, append) {
                if (!append) {
                    self.data.speciesList([]);
                }
                if (data === undefined) {
                    self.addspeciesListRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.speciesList.push(new SpeciesListRow(obj));
                    });
                }
            };

            self.addspeciesListRow = function () {
                var newRow = new SpeciesListRow();
                self.data.speciesList.push(newRow);
                
            };
            self.removespeciesListRow = function (row) {
                self.data.speciesList.remove(row);
                
            };
            self.speciesListrowCount = function () {
                return self.data.speciesList().length;
            };

            self.speciesListTableDataUploadVisible = ko.observable(false);
            self.showspeciesListTableDataUpload = function() {
                self.speciesListTableDataUploadVisible(!self.speciesListTableDataUploadVisible());
            };

            self.speciesListTableDataUploadOptions = {
                    url:'/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadspeciesList(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "speciesListtemplate-upload",
                    downloadTemplateId: "speciesListtemplate-download",
                    formData:{type:'Field Sheet 5 - Species Diversity', listName:'speciesList'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                                    delete jsData.selectedspeciesListRow;
                delete jsData.speciesListTableDataUploadOptions
                delete jsData.speciesListTableDataUploadVisible

                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.loadspeciesList(data.speciesList);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Field Sheet 5 - Species Diversity') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koField_Sheet_5_-_Species_Diversity"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        


    /* Master controller for page. This handles saving each model as required. */
    var Master = function () {
        var self = this;
        this.subscribers = [];
        // client models register their name and methods to participate in saving
        self.register = function (modelInstanceName, getMethod, isDirtyMethod, resetMethod) {
            this.subscribers.push({
                model: modelInstanceName,
                get: getMethod,
                isDirty: isDirtyMethod,
                reset: resetMethod
            });
        };
        // master isDirty flag for the whole page - can control button enabling
        this.isDirty  = function () {
            var dirty = false;
            $.each(this.subscribers, function(i, obj) {
                dirty = dirty || obj.isDirty();
            });
            return dirty;
        };
        /**
         * Makes an ajax call to save any sections that have been modified. This includes the activity
         * itself and each output.
         *
         * Modified outputs are injected as a list into the activity object. If there is nothing to save
         * in the activity itself, then the root is an object that is empty except for the outputs list.
         *
         * NOTE that the model for each section must register itself to be included in this save.
         *
         * Validates the entire page before saving.
         */
        this.save = function () {

            var activityData, outputs = [];
            if ($('#validation-container').validationEngine('validate')) {
                $.each(this.subscribers, function(i, obj) {
                   // if (obj.isDirty()) {
                        if (obj.model === 'activityModel') {
                            activityData = obj.get();
                        } else {
                            outputs.push(obj.get());
                        }
                    //}
                });
                if (outputs.length === 0 && activityData === undefined) {
                    alert("Nothing to save.");
                    return;
                }
                if (activityData === undefined) { activityData = {}}
                activityData.outputs = outputs;

                var toSave = JSON.stringify(activityData);
                console.log("saving"+toSave);
                mobileBindings.saveActivity(toSave);

            }

        };

        this.reset = function () {
            $.each(this.subscribers, function(i, obj) {
                if (obj.isDirty()) {
                    obj.reset();
                }
            });
        };
    };

    if (mobileBindings == undefined) {
        var mobileBindings = {
        
            loadActivity:function(){return "{}"},
        
        
            loadSites:function(){return "[]"},
        

        saveActivity:function(){},
        createNewSite:function(){}
    };
}
var master = new Master();
var activity = JSON.parse(mobileBindings.loadActivity());
var themes = ['theme1', 'theme2'];

var sites = JSON.parse(mobileBindings.loadSites());


$(function(){

    $('#validation-container').validationEngine('attach', {scroll: false});

    $('.helphover').popover({animation: true, trigger:'hover'});

    $('#reset').click(function () {
        master.reset();
    });


    ko.bindingHandlers.editOutput = {
        init: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
            var outputName = ko.utils.unwrapObservable(valueAccessor()),
                activity = bindingContext.$root,
                outputId;

            // search for corresponding outputs in the activity data
            $.each(activity.outputs, function (i,output) { // iterate output data in the activity to
                                                              // find any matching the meta-model name
                if (output.name === outputName) {
                    outputId = output.outputId;
                }
            });
            if (outputId) {
                // build edit link
                $(element).html('Edit data');
                $(element).attr('href', fcConfig.serverUrl + "/output/edit/" + outputId +
                    "?returnTo=" + here);
            } else {
                // build create link
                $(element).attr('href', fcConfig.serverUrl + '/output/create?activityId=' + activity.activityId +
                    '&outputName=' + encodeURIComponent(outputName) +
                    "&returnTo=" + here);
            }
        }
    };

    function ViewModel (act, sites) {
        var self = this;
        self.activityId = act.activityId;
        self.description = ko.observable(act.description);
        self.notes = ko.observable(act.notes);
        self.startDate = ko.observable(act.startDate).extend({simpleDate: false});
        self.endDate = ko.observable(act.endDate || act.plannedEndDate).extend({simpleDate: false});
        self.plannedStartDate = ko.observable(act.plannedStartDate).extend({simpleDate: false});
        self.plannedEndDate = ko.observable(act.plannedEndDate).extend({simpleDate: false});
        self.eventPurpose = ko.observable(act.eventPurpose);
        self.fieldNotes = ko.observable(act.fieldNotes);
        self.associatedProgram = ko.observable(act.associatedProgram);
        self.associatedSubProgram = ko.observable(act.associatedSubProgram);
        self.progress = ko.observable(act.progress);
        self.mainTheme = ko.observable(act.mainTheme);
        self.type = ko.observable(act.type);
        self.siteId = ko.observable(act.siteId);
        self.projectId = act.projectId;
        self.transients = {};
        self.transients.sites = sites;
        self.transients.activityProgressValues = ['planned','started','finished'];
        self.transients.themes = themes;
        self.transients.markedAsFinished = ko.observable(act.progress === 'finished');
        self.transients.markedAsFinished.subscribe(function (finished) {
            self.progress(finished ? 'finished' : 'started');
        });
        self.transients.siteImgUrl = ko.computed(function() {
            if (self.siteId()) {
                 var site = $.grep(self.transients.sites, function(site, index) { return site.siteId == self.siteId(); })[0];
                 if (site && site.extent && site.extent.geometry && site.extent.geometry.centre) {
                    return  "http://maps.googleapis.com/maps/api/staticmap?maptype=terrian&zoom=12&sensor=false&size=250x200&markers=color:red%7C"+site.extent.geometry.centre[1]+","+site.extent.geometry.centre[0]+"&centre=false";
                 }
            }
            return "";
        });

        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.toJS(self);
            delete jsData.transients;
            return jsData;
        };
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.save = function (callback, key) {
        };

        self.createNewSite = function() {
            mobileBindings.createNewSite();
        }

        self.notImplemented = function () {
            alert("Not implemented yet.")
        };
        self.dirtyFlag = ko.dirtyFlag(self, false);

        // make sure progress moves to started if we save any data (unless already finished)
        // (do this here so the model becomes dirty)
        self.progress(self.transients.markedAsFinished() ? 'finished' : 'started');
    }


    var viewModel = new ViewModel(activity, sites);

    ko.applyBindings(viewModel);

    master.register('activityModel', viewModel.modelForSaving, viewModel.dirtyFlag.isDirty, viewModel.dirtyFlag.reset);
});
</script>
</body>
</html>
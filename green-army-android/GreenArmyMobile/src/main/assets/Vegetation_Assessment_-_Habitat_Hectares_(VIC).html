{error=Failed calling web service. class java.io.IOException Server returned HTTP response code: 500 for URL: http://devt.ala.org.au:8087/fieldcapture/mobile/activityForm/Vegetation%20Assessment%20-%20Habitat%20Hectares%20(VIC) URL= http://devt.ala.org.au:8087/fieldcapture/mobile/activityForm/Vegetation%20Assessment%20-%20Habitat%20Hectares%20(VIC)., statusCode=500, detail=




<!DOCTYPE html>
<!--[if IE 7]><html lang="en" class="ie ie7"><![endif]-->
<!--[if IE 8]><html lang="en" class="ie ie8"><![endif]-->
<!--[if IE 9]><html lang="en" class="ie ie9"><![endif]-->
<!--[if !IE]><!--><html lang="en"><!--<![endif]-->
<head>
    <title>Grails Runtime Exception</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <script src="fieldcapture/static/UGoJGyG3j2UCffTg3vnOdi0FsnS2OvrmrsZD6WxaXGy.js" type="text/javascript" ></script>
<link href="fieldcapture/static/090onaZX1M508oSWqGmMeETZ9NkUA9p4CCTW3MUpRPc.css" type="text/css" rel="stylesheet" media="screen, projection" />

<link href="fieldcapture/static/CidRUyEAqkZsnDRPRiaGZBy7vd4DOlnRqweu4CsVcIG.css" type="text/css" rel="stylesheet" media="screen" />
<link href="fieldcapture/static/tDKPE9VWZfBnSnxBkPC52ml2dXticvlQDl9aR8VpM2o.css" type="text/css" rel="stylesheet" media="screen, projection" />
<!--[if lt IE 7]><link href="fieldcapture/static/v1vjA9BeNpSU8cuoTuVhTEUm6boSzwYQcgfPKKMkqgv.css" type="text/css" rel="stylesheet" media="screen, projection" /><![endif]-->

<link href="fieldcapture/static/Eu8FNKwJJQI8mVJO3VIshatRN1bunflYHvvdqk06tbf.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="http://www.ala.org.au/wp-content/themes/ala2011/images/favicon.ico" rel="shortcut icon" />
<!--[if lt IE 9]><script src="fieldcapture/static/Yh1Txee3hFzExJ4P1str7tGV24zQMEYtxqtlYJ5ukR0.js" type="text/javascript" ></script><![endif]-->
<link href="fieldcapture/static/6tuLClj7N5eYCZpx7vLn8juIbQUXBkCnWRUJFY7UDCz.css" type="text/css" rel="stylesheet" media="screen,print" />
<link href="/fieldcapture/static/7ARiB2rJgSkfi68hxnSlcG9Ot0gQ863DYxkCmSHQweE.png" rel="shortcut icon" />
<link href="/fieldcapture/static/14SWTr4VqVh6tnlUlgBtue6IJZ7gwE1y42RT7ya5GGW.png" rel="shortcut icon" />

<link href="fieldcapture/static/KYGDEVRRaKjNbTXJkHmicmzo9vFrnnzCnGLcxKjR04f.css" type="text/css" rel="stylesheet" media="screen,print" />

<link href="fieldcapture/static/uUQBvO5ITMKwLfoRb2u62GbHXEzxtsbrSWq8MBAOrbX.css" type="text/css" rel="stylesheet" media="screen,print" />
<link href="fieldcapture/static/2OXdKoom668LE7PLl0qjJCaLG7Pu7Jv869tAsS4e1oT.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="fieldcapture/static/AcXIjLTuc87n8sfxBjJRQSoBIUwP9RnCyK8Sv82i7eV.css" type="text/css" rel="stylesheet" media="screen, projection" />
<script type="text/javascript">
    var fcConfig = {
        serverUrl: "http://devt.ala.org.au:8087/fieldcapture",
        activityUpdateUrl: "/fieldcapture/activity/ajaxUpdate",
        activityDeleteUrl: "/fieldcapture/activity/ajaxDelete",
        projectViewUrl: "/fieldcapture/project/index/",
        siteViewUrl: "/fieldcapture/site/index/",
        bieUrl: "http://bie.ala.org.au",
        speciesProfileUrl: "/fieldcapture/proxy/speciesProfile"
        },
        here = document.location.href;
    </script>
    
		
		<meta name="layout" content="nrm">
		<link rel="stylesheet" href="/fieldcapture/static/ZpvQl8LFqnCT7yFUReaIri2ASlUt1FqzRB1qUKtXIdj.css" type="text/css">
	
</head>
<body class="" id="" onload="">



<div id="body-wrapper">
    <div class="navbar navbar-inverse navbar-static-top" id="header">
        <div class="navbar-inner">
            <div class="container-fluid">
                <div class="nav logo">
                    <a href="/fieldcapture/">
                        <img src="/fieldcapture/static/RrjzrZ0Ci0GPLETIr8x8KUMjfJtZKvifrUtMCedwKRB.png" alt="Australian Government Emblem" />
                    </a>
                </div>
                <div class="nav-collapse collapse pull-right">
                    <span class="merit">MERIT</span>
                    <form action="/fieldcapture/search/index" method="get" class="search merit" >
                        <p>
                            <label for="keywords"><span class="hide">Full text search</span><input type="text" name="query" id="keywords" value=""></label>
                            <input type="hidden" name="collection" value="agencies">
                            <input type="hidden" name="profile" value="nrm_env">
                            <input type="hidden" name="form" value="simple">
                            <input type="submit" value="search" class="search button">
                        </p>
                    </form>
                </div>
            </div><!--/.container-fluid -->
            
                <!-- Markup to include ONLY when in test or dev -->
                <div class="row-fluid">
                    <div class="span12" id="testWatermark">
                        This is a test system and any data added in this system will be removed and lost.
                        To add your proper data go to <a href="http://fieldcapture.ala.org.au">http://fieldcapture.ala.org.au</a>
                    </div>
                </div>
            
        </div><!--/.navbar-inner -->
    </div><!--/.navbar -->

    <div id="dcNav" class="clearfix ">

        <div class="navbar navbar-inverse container-fluid ">
            
            <ul class="nav">
                <li><a href="/fieldcapture/" class="active hidden-desktop"><i class="icon-home">&nbsp;</i>&nbsp;Home</a></li>
            </ul>
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>
            <div class="nav-collapse collapse">
                <ul class="nav">
                    <li class=''>
  <a href='/fieldcapture/' class='visible-desktop'>
    <i class='icon-home'>&nbsp;</i>&nbspHome
  </a>
</li>
<li class=''>
  <a href='/fieldcapture/home/about'>
    <i class='icon-info-sign'>&nbsp;</i>&nbspAbout
  </a>
</li>
<li class=''>
  <a href='/fieldcapture/home/help'>
    <i class='icon-question-sign'>&nbsp;</i>&nbspHelp
  </a>
</li>
<li class=''>
  <a href='/fieldcapture/home/contacts'>
    <i class='icon-envelope'>&nbsp;</i>&nbspContacts
  </a>
</li>
                </ul>
                <div class="navbar-form pull-right nav-collapse collapse">
                    <span id="buttonBar">
                        
<div class="btn-group">
    <a href='https://auth.ala.org.au/cas/login?service=http://devt.ala.org.au:8087/fieldcapture/mobile/activityForm/Vegetation%20Assessment%20-%20Habitat%20Hectares%20(VIC)' class='btn btn-small btn-inverse btn-login'><span><i class='icon-off icon-white'></i> Log in</span></a>
</div>
                        
                    </span>
                </div>
            </div>
        </div><!-- /.navbar-inner -->
    </div>

    <div id="content" class="clearfix">
        
    <div id="wrapper" class="container-fluid">
        <h1 style="margin:20px 0;">An error occurred</h1>
        
            <h1>Error 500: Internal Server Error</h1>
<dl class="error-details">
<dt>URI</dt><dd>/fieldcapture/mobile/activityForm/Vegetation%20Assessment%20-%20Habitat%20Hectares%20(VIC)</dd>
<dt>Class</dt><dd>java.lang.NullPointerException</dd><dt>Message</dt><dd>Cannot invoke method addClass() on null object</dd></dl><h2>Around line 464 of <span class="filename">grails-app/views/activity/mobile.gsp</span></h2>
<pre class="snippet"></pre><h2>Around line 464 of <span class="filename">AbstractFilter.java</span></h2>
<pre class="snippet"></pre><h2>Around line 110 of <span class="filename">grails-app/views/activity/mobile.gsp</span></h2>
<pre class="snippet"><code class="line"><span class="lineNumber">107:</span>    &lt;div class=&quot;output-block&quot; id=&quot;ko${blockId}&quot;&gt;</code><code class="line"><span class="lineNumber">108:</span>        &lt;h3 data-bind=&quot;css:{modified:dirtyFlag.isDirty},attr:{title:&#39;Has been modified&#39;}&quot;&gt;${outputName}&lt;i class=&quot;icon-asterisk modified-icon&quot; data-bind=&quot;visible:dirtyFlag.isDirty&quot; title=&quot;Has been modified&quot; style=&quot;display: none;&quot;&gt;&lt;/i&gt;&lt;/h3&gt;</code><code class="line"><span class="lineNumber">109:</span>        &lt;!-- add the dynamic components --&gt;</code><code class="line error"><span class="lineNumber">110:</span>        &lt;md:modelView model=&quot;${model}&quot; site=&quot;${site}&quot; edit=&quot;true&quot; output=&quot;${outputName}&quot; /&gt;</code><code class="line"><span class="lineNumber">111:</span>        &lt;r:script&gt;</code><code class="line"><span class="lineNumber">112:</span>        $(function(){</code><code class="line"><span class="lineNumber">113:</span></code></pre><h2>Around line 167 of <span class="filename">grails-app/taglib/au/org/ala/fieldcapture/ModelTagLib.groovy</span></h2>
<pre class="snippet"><code class="line"><span class="lineNumber">164:</span>        }</code><code class="line"><span class="lineNumber">165:</span></code><code class="line"><span class="lineNumber">166:</span>        if (model.postLabel) {</code><code class="line error"><span class="lineNumber">167:</span>            labelAttributes.addClass &#39;postLabel&#39;</code><code class="line"><span class="lineNumber">168:</span>            result += &quot;&lt;span ${labelAttributes.toString()}&gt;${model.postLabel}&lt;/span&gt;&quot;</code><code class="line"><span class="lineNumber">169:</span>        }</code><code class="line"><span class="lineNumber">170:</span></code></pre><h2>Around line 226 of <span class="filename">grails-app/taglib/au/org/ala/fieldcapture/ModelTagLib.groovy</span></h2>
<pre class="snippet"><code class="line"><span class="lineNumber">223:</span></code><code class="line"><span class="lineNumber">224:</span>    // convenience method for the above</code><code class="line"><span class="lineNumber">225:</span>    def dataTag(attrs, model, context, editable) {</code><code class="line error"><span class="lineNumber">226:</span>        dataTag(attrs, model, context, editable, null, null, null)</code><code class="line"><span class="lineNumber">227:</span>    }</code><code class="line"><span class="lineNumber">228:</span></code><code class="line"><span class="lineNumber">229:</span>    def specialProperties(attrs, properties) {</code></pre><h2>Around line 619 of <span class="filename">grails-app/taglib/au/org/ala/fieldcapture/ModelTagLib.groovy</span></h2>
<pre class="snippet"><code class="line"><span class="lineNumber">616:</span>        model.columns.eachWithIndex { col, i -&gt;</code><code class="line"><span class="lineNumber">617:</span>            col.type = col.type ?: getType(attrs, col.source, model.source)</code><code class="line"><span class="lineNumber">618:</span>            //log.debug &quot;col = ${col}&quot;</code><code class="line error"><span class="lineNumber">619:</span>            out &lt;&lt; INDENT*5 &lt;&lt; &quot;&lt;td&gt;&quot; &lt;&lt; dataTag(attrs, col, &#39;&#39;, edit) &lt;&lt; &quot;&lt;/td&gt;&quot; &lt;&lt; &quot;\n&quot;</code><code class="line"><span class="lineNumber">620:</span>        }</code><code class="line"><span class="lineNumber">621:</span>        if (model.editableRows) {</code><code class="line"><span class="lineNumber">622:</span>                out &lt;&lt; INDENT*5 &lt;&lt; &quot;&lt;td&gt;\n&quot;</code></pre><h2>Around line 616 of <span class="filename">grails-app/taglib/au/org/ala/fieldcapture/ModelTagLib.groovy</span></h2>
<pre class="snippet"><code class="line"><span class="lineNumber">613:</span></code><code class="line"><span class="lineNumber">614:</span>    def tableViewTemplate(out, attrs, model, edit) {</code><code class="line"><span class="lineNumber">615:</span>        out &lt;&lt; INDENT*4 &lt;&lt; &quot;&lt;script id=\&quot;${model.source}viewTmpl\&quot; type=\&quot;text/html\&quot;&gt;&lt;tr&gt;\n&quot;</code><code class="line error"><span class="lineNumber">616:</span>        model.columns.eachWithIndex { col, i -&gt;</code><code class="line"><span class="lineNumber">617:</span>            col.type = col.type ?: getType(attrs, col.source, model.source)</code><code class="line"><span class="lineNumber">618:</span>            //log.debug &quot;col = ${col}&quot;</code><code class="line"><span class="lineNumber">619:</span>            out &lt;&lt; INDENT*5 &lt;&lt; &quot;&lt;td&gt;&quot; &lt;&lt; dataTag(attrs, col, &#39;&#39;, edit) &lt;&lt; &quot;&lt;/td&gt;&quot; &lt;&lt; &quot;\n&quot;</code></pre><h2>Around line 577 of <span class="filename">grails-app/taglib/au/org/ala/fieldcapture/ModelTagLib.groovy</span></h2>
<pre class="snippet"><code class="line"><span class="lineNumber">574:</span>                tableEditTemplate(out, attrs, table)</code><code class="line"><span class="lineNumber">575:</span>            } else {</code><code class="line"><span class="lineNumber">576:</span>                // write the view template</code><code class="line error"><span class="lineNumber">577:</span>                tableViewTemplate(out, attrs, table, attrs.edit)</code><code class="line"><span class="lineNumber">578:</span>            }</code><code class="line"><span class="lineNumber">579:</span>        } else {</code><code class="line"><span class="lineNumber">580:</span>            out &lt;&lt; INDENT*4 &lt;&lt; &quot;&lt;tbody data-bind=\&quot;foreach: data.${table.source}\&quot;&gt;&lt;tr&gt;\n&quot;</code></pre><h2>Around line 510 of <span class="filename">grails-app/taglib/au/org/ala/fieldcapture/ModelTagLib.groovy</span></h2>
<pre class="snippet"><code class="line"><span class="lineNumber">507:</span>        if (isprint) {</code><code class="line"><span class="lineNumber">508:</span>            tableBodyPrint out, attrs, model</code><code class="line"><span class="lineNumber">509:</span>        } else {</code><code class="line error"><span class="lineNumber">510:</span>            tableBodyEdit out, attrs, model</code><code class="line"><span class="lineNumber">511:</span>            footer out, attrs, model</code><code class="line"><span class="lineNumber">512:</span>        }</code><code class="line"><span class="lineNumber">513:</span></code></pre><h2>Around line 362 of <span class="filename">grails-app/taglib/au/org/ala/fieldcapture/ModelTagLib.groovy</span></h2>
<pre class="snippet"><code class="line"><span class="lineNumber">359:</span>                out &lt;&lt; &quot;&lt;/div&gt;&quot;</code><code class="line"><span class="lineNumber">360:</span>            }</code><code class="line"><span class="lineNumber">361:</span>            else if (it.type == &#39;table&#39;) {</code><code class="line error"><span class="lineNumber">362:</span>                table out, attrs, it</code><code class="line"><span class="lineNumber">363:</span>            } else {</code><code class="line"><span class="lineNumber">364:</span>                // Wrap data elements in rows to reset the bootstrap indentation on subsequent spans to save the</code><code class="line"><span class="lineNumber">365:</span>                // model definition from needing to do so.</code></pre><h2>Around line 350 of <span class="filename">grails-app/taglib/au/org/ala/fieldcapture/ModelTagLib.groovy</span></h2>
<pre class="snippet"><code class="line"><span class="lineNumber">347:</span></code><code class="line"><span class="lineNumber">348:</span>        def span = context == &#39;row&#39;? (int)(parentSpan / model.items.size()) : LAYOUT_COLUMNS</code><code class="line"><span class="lineNumber">349:</span></code><code class="line error"><span class="lineNumber">350:</span>        model.items.each { it -&gt;</code><code class="line"><span class="lineNumber">351:</span>            AttributeMap at = new AttributeMap()</code><code class="line"><span class="lineNumber">352:</span>            at.addClass(it.css)</code><code class="line"><span class="lineNumber">353:</span>            // inject computed from data model</code></pre><h2>Around line 339 of <span class="filename">grails-app/taglib/au/org/ala/fieldcapture/ModelTagLib.groovy</span></h2>
<pre class="snippet"><code class="line"><span class="lineNumber">336:</span>        if (model.align == &#39;right&#39;) {</code><code class="line"><span class="lineNumber">337:</span>            out &lt;&lt; &quot;&lt;div class=\&quot;pull-right\&quot;&gt;\n&quot;</code><code class="line"><span class="lineNumber">338:</span>        }</code><code class="line error"><span class="lineNumber">339:</span>        items(out, attrs, model, parentSpan, &#39;row&#39;)</code><code class="line"><span class="lineNumber">340:</span>        if (model.align == &#39;right&#39;) {</code><code class="line"><span class="lineNumber">341:</span>            out &lt;&lt; &quot;&lt;/div&gt;\n&quot;</code><code class="line"><span class="lineNumber">342:</span>        }</code></pre><h2>Around line 50 of <span class="filename">grails-app/taglib/au/org/ala/fieldcapture/ModelTagLib.groovy</span></h2>
<pre class="snippet"><code class="line"><span class="lineNumber">47:</span>                    section out, attrs, mod</code><code class="line"><span class="lineNumber">48:</span>                case &#39;row&#39;:</code><code class="line"><span class="lineNumber">49:</span>                    def span = LAYOUT_COLUMNS</code><code class="line error"><span class="lineNumber">50:</span>                    row out, attrs, mod, span</code><code class="line"><span class="lineNumber">51:</span>                    break</code><code class="line"><span class="lineNumber">52:</span>                case &#39;photoPoints&#39;:</code><code class="line"><span class="lineNumber">53:</span>                    photoPoints out, attrs, mod, index</code></pre><h2>Around line 38 of <span class="filename">grails-app/taglib/au/org/ala/fieldcapture/ModelTagLib.groovy</span></h2>
<pre class="snippet"><code class="line"><span class="lineNumber">35:</span></code><code class="line"><span class="lineNumber">36:</span>    def viewModelItems(attrs, out, items) {</code><code class="line"><span class="lineNumber">37:</span></code><code class="line error"><span class="lineNumber">38:</span>        items?.eachWithIndex { mod, index -&gt;</code><code class="line"><span class="lineNumber">39:</span>            switch (mod.type) {</code><code class="line"><span class="lineNumber">40:</span>                case &#39;table&#39;:</code><code class="line"><span class="lineNumber">41:</span>                    table out, attrs, mod</code></pre><h2>Around line 31 of <span class="filename">grails-app/taglib/au/org/ala/fieldcapture/ModelTagLib.groovy</span></h2>
<pre class="snippet"><code class="line"><span class="lineNumber">28:</span>     * @attrs edit if true the html will support the editing of values</code><code class="line"><span class="lineNumber">29:</span>     */</code><code class="line"><span class="lineNumber">30:</span>    def modelView = { attrs -&gt;</code><code class="line error"><span class="lineNumber">31:</span>        viewModelItems(attrs, out, attrs.model?.viewModel)</code><code class="line"><span class="lineNumber">32:</span></code><code class="line"><span class="lineNumber">33:</span>        renderDeferredTemplates out</code><code class="line"><span class="lineNumber">34:</span>    }</code></pre><h2>Around line 195 of <span class="filename">PageFragmentCachingFilter.java</span></h2>
<pre class="snippet"><code class="line"><span class="lineNumber">192:</span>			if (CollectionUtils.isEmpty(cacheOperations)) {</code><code class="line"><span class="lineNumber">193:</span>				log.debug(&quot;No cacheable annotation found for {}:{} {}&quot;,</code><code class="line"><span class="lineNumber">194:</span>						new Object[] { request.getMethod(), request.getRequestURI(), getContext() });</code><code class="line error"><span class="lineNumber">195:</span>				chain.doFilter(request, response);</code><code class="line"><span class="lineNumber">196:</span>				return;</code><code class="line"><span class="lineNumber">197:</span>			}</code><code class="line"><span class="lineNumber">198:</span></code></pre><h2>Around line 63 of <span class="filename">AbstractFilter.java</span></h2>
<pre class="snippet"><code class="line"><span class="lineNumber">60:</span>		try {</code><code class="line"><span class="lineNumber">61:</span>			// NO_FILTER set for RequestDispatcher forwards to avoid double gzipping</code><code class="line"><span class="lineNumber">62:</span>			if (filterNotDisabled(request)) {</code><code class="line error"><span class="lineNumber">63:</span>				doFilter(request, response, chain);</code><code class="line"><span class="lineNumber">64:</span>			}</code><code class="line"><span class="lineNumber">65:</span>			else {</code><code class="line"><span class="lineNumber">66:</span>				chain.doFilter(req, res);</code></pre><h2>Trace</h2><pre class="stack">    Line | Method
-&gt;&gt;  464 | doFilter  in /grails-app/views/activity/mobile.gsp
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

Caused by GrailsTagException: Error executing tag &lt;md:modelView&gt;: Cannot invoke method addClass() on null object
-&gt;&gt;  110 | doCall    in /grails-app/views/activity/mobile.gsp
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

Caused by NullPointerException: Cannot invoke method addClass() on null object
-&gt;&gt;  167 | dataTag   in ModelTagLib.groovy
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
|    226 | dataTag   in     &#39;&#39;
|    619 | doCall .  in     &#39;&#39;
|    616 | tableViewTemplate in     &#39;&#39;
|    577 | tableBodyEdit in     &#39;&#39;
|    510 | table     in     &#39;&#39;
|    362 | doCall .  in     &#39;&#39;
|    350 | items     in     &#39;&#39;
|    339 | row . . . in     &#39;&#39;
|     50 | doCall    in     &#39;&#39;
|     38 | viewModelItems in     &#39;&#39;
|     31 | doCall    in     &#39;&#39;
|    110 | doCall .  in Users_god08d_Documents_ala_fieldcapture_FieldCapture_grails_app_views_activity_mobile_gsp$_run_closure2
|    413 | run       in Users_god08d_Documents_ala_fieldcapture_FieldCapture_grails_app_views_activity_mobile_gsp
|    195 | doFilter  in PageFragmentCachingFilter.java
|     63 | doFilter  in AbstractFilter.java
|    200 | doFilter  in au.org.ala.cas.client.UriFilter
|     65 | doFilter  in org.jasig.cas.client.session.SingleSignOutFilter
|   1145 | runWorker in java.util.concurrent.ThreadPoolExecutor
|    615 | run       in java.util.concurrent.ThreadPoolExecutor$Worker
^    744 | run . . . in java.lang.Thread
</pre>
        
        <div class="space-before space-after">&nbsp</div>
	
    </div><!-- /#content -->

    <div id="footer">
        <div id="footer-wrapper">
            <div class="container-fluid">
                <p>While efforts are made to ensure the accuracy of the ecological information contained in MERIT, for confirmation of authoritative data please contact the Department of the Environment.</p><p>This site has been developed by the <a href="http://www.ala.org.au" target="_blank">Atlas of Living Australia</a> in 2013. Please report issues to <strong><a href="mailto:MERIT@environment.gov.au">MERIT@environment.gov.au</a></strong></p>
<div class="large-space-before">Â© 2013 <a href="http://www.nrm.gov.au/about/copyright.html" target="_blank">Commonwealth of Australia</a></div>
            </div>
            <div class="container-fluid">
                <div class="large-space-before">
                    <button class="btn btn-mini" id="toggleFluid">toggle fixed/fluid width</button>
                    
            </div>
        </div>

    </div>
</div><!-- /#body-wrapper -->



<!-- current env = development -->


<script src="fieldcapture/static/DzazZ2ePykd4QRUJlInoAO1LMvzeVxjM2JRcis2usBm.js" type="text/javascript" ></script>



<script src="fieldcapture/static/gfz9yoFSoT3bDIgFJCbjPP9WLeFgekRHSp7KxcpYrwj.js" type="text/javascript" ></script>
<script src="fieldcapture/static/HpQC03jqzgdovdmQNni1bswagCkkBPaWGDIzgICGcvq.js" type="text/javascript" ></script>









<!--[if gte IE 8]><script src="fieldcapture/static/knxjs4G9Cquc79O3iYW107XikPB1Z1ii8QWrtBpzlSP.js" type="text/javascript" ></script><![endif]-->
<script src="fieldcapture/static/kSJb30BxnBzyoP0WndxrtZbaNWzT8x6LP2Cp7xI9PH4.js" type="text/javascript" ></script>
<script src="fieldcapture/static/N1Pu1Yy1dAP26vjRfEw0sZtbZhL03ir303dL4C7EaVF.js" type="text/javascript" ></script>

<script src="fieldcapture/static/NbeGWZssK95I6Y1Oz4lzxzRtDzf9dyFLZiTstPEonQa.js" type="text/javascript" ></script>
<script src="fieldcapture/static/L85LaBY6yhQwMk24PuXWgqwvtkfvbmMZ3ExPR9xK96.js" type="text/javascript" ></script>
<script src="fieldcapture/static/MZjUSqmNLHqbPwhDcAMpejU18pr9ndMRCGKpPBHdSDL.js" type="text/javascript" ></script>
<script src="fieldcapture/static/1nCsTsYbdgqupwL47F4n7c98ss299Uck5fAVxaO9UuE.js" type="text/javascript" ></script>





<script src="fieldcapture/static/7l2mDQFFpMnG14cXQPTKd94AN71T8yUF6dHUA2LCJIo.js" type="text/javascript" ></script>
<script src="fieldcapture/static/ZbrF5cz3bJrkAqBXLrAlOmoaIYntVDIKpviQs5E8Rhy.js" type="text/javascript" ></script>
<script src="fieldcapture/static/yzVPTi9KJTOMgo1ytEFVw7JiBXXkkbj5dU3cYZoIuS.js" type="text/javascript" ></script>

<script src="fieldcapture/static/IZCc6ZgD3MepYbz4UqlDLzMDNNghSCivcfGebmF9V2d.js" type="text/javascript" ></script>
<script type="text/javascript">
        $(function(){

            var viewModelName = "Vegetation_AssessmentViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var VegetationAssessmentRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.poiId = ko.observable(orBlank(data['poiId']));
            this.species =  new SpeciesViewModel(data['species'], speciesLists);
            this.lifeform = ko.observable(orBlank(data['lifeform']));
            self.transients.lifeformConstraints = ["Tree - Overstorey","Tree - Mid-storey","Large shrub","Small shrub","Grass","Cryptogram"];
            this.native = ko.observable(orBlank(data['native']));
            self.transients.nativeConstraints = ["Native","Exotic"];
            this.number = ko.observable(orZero(data['number']));
            this.averageHeight = ko.observable(orZero(data['averageHeight']));
            this.treeDBHcm = ko.observable(orZero(data['treeDBHcm']));
            this.treeCanopyMeasureMetres = ko.observable(orZero(data['treeCanopyMeasureMetres']));
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Vegetation Assessment";
                self.outputId = "";
                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
            
            self.data.vegetationType = ko.observable();

            self.data.vegetationCommunity = ko.observable();

            self.data.vegetationFormation = ko.observable();
            self.data.dominantStructuralSpecies = new SpeciesViewModel({}, speciesLists);
            self.data.subDominantStructuralSpecies = new SpeciesViewModel({}, speciesLists);

            self.data.vegetationAssessment = ko.observableArray([]);
            self.selectedvegetationAssessmentRow = ko.observable();
        

            self.loadvegetationAssessment = function (data, append) {
                if (!append) {
                    self.data.vegetationAssessment([]);
                }
                if (data === undefined) {
                    self.addvegetationAssessmentRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.vegetationAssessment.push(new VegetationAssessmentRow(obj));
                    });
                }
            };

            self.addvegetationAssessmentRow = function () {
                var newRow = new VegetationAssessmentRow();
                self.data.vegetationAssessment.push(newRow);
                
            };
            self.removevegetationAssessmentRow = function (row) {
                self.data.vegetationAssessment.remove(row);
                
            };
            self.vegetationAssessmentrowCount = function () {
                return self.data.vegetationAssessment().length;
            };

            self.vegetationAssessmentTableDataUploadVisible = ko.observable(false);
            self.showvegetationAssessmentTableDataUpload = function() {
                self.vegetationAssessmentTableDataUploadVisible(!self.vegetationAssessmentTableDataUploadVisible());
            };

            self.vegetationAssessmentTableDataUploadOptions = {
                    url:'/fieldcapture/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadvegetationAssessment(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "vegetationAssessmenttemplate-upload",
                    downloadTemplateId: "vegetationAssessmenttemplate-download",
                    formData:{type:'Vegetation Assessment', listName:'vegetationAssessment'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };
            self.transients.site = site;

            // this will be called when generating a savable model to remove transient properties
            self.removeBeforeSave = function (jsData) {
                // add code to remove any transients added by the dynamic tags
                            delete jsData.selectedvegetationAssessmentRow;
                delete jsData.vegetationAssessmentTableDataUploadOptions
                delete jsData.vegetationAssessmentTableDataUploadVisible

            delete jsData.activityType;
            delete jsData.transients;
            return jsData;
        };

        // this returns a JS object ready for saving
        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
            // get rid of any transient observables
            return self.removeBeforeSave(jsData);
        };

        // this is a version of toJSON that just returns the model as it will be saved
        // it is used for detecting when the model is modified (in a way that should invoke a save)
        // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.loadData = function (outputId, data) {
            self.outputId = outputId;
            // load dynamic data
                            self.data['vegetationType'](data['vegetationType']);
                self.data['vegetationCommunity'](data['vegetationCommunity']);
                self.data['vegetationFormation'](data['vegetationFormation']);
                self.data['dominantStructuralSpecies'].loadData(data['dominantStructuralSpecies']);
                self.data['subDominantStructuralSpecies'].loadData(data['subDominantStructuralSpecies']);
                self.loadvegetationAssessment(data.vegetationAssessment);


            // if there is no data in tables then add an empty row for the user to add data
            if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                self.addRow();
            }
            self.transients.dummy.notifySubscribers();
        };
    };

    window[viewModelInstance] = new this[viewModelName]();
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koVegetation_Assessment"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
             window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);

            // Check for locally saved data for this output - this will happen in the event of a session timeout
            // for example.
            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            console.log(savedData);
            var savedOutput = null;
            var savedOutputId = null;
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Vegetation Assessment') {
                        if (tmpOutput.data) {
                            savedOutput = tmpOutput.data;

                        }
                    }
                });
            }
            if (savedOutput) {
                window[viewModelInstance].loadData(savedOutputId, savedOutput);
            }
        });

        
        $(function(){

            var viewModelName = "Site_ConditionViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var UnderStoreyLifeformsRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.lifeform = ko.observable(orBlank(data['lifeform']));
            this.species =  new SpeciesViewModel(data['species'], speciesLists);
            this.number = ko.observable(orZero(data['number']));
            this.coverPercent = ko.observable(orZero(data['coverPercent']));
            this.present = ko.observable(orFalse(data['present']));
            this.present = ko.observable(orFalse(data['present']));
        };
        var SpeciesRecruitmentRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.species =  new SpeciesViewModel(data['species'], speciesLists);
            this.adequateRecruitment = ko.observable(orFalse(data['adequateRecruitment']));
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Site Condition";
                self.outputId = "";
                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
            
            self.data.surveyArea = ko.observable();

            self.data.numberOfLargeTrees = ko.observable();

            self.data.largeTreeCanopyHealthPercent = ko.observable();

            self.data.canopyCoverPercent = ko.observable();

            self.data.canopyHealthPercent = ko.observable();

            self.data.totalWeedCoverPercent = ko.observable();

            self.data.highThreatWeedCoverPercent = ko.observable();

            self.data.underStoreyLifeforms = ko.observableArray([]);
            self.selectedunderStoreyLifeformsRow = ko.observable();
        

            self.loadunderStoreyLifeforms = function (data, append) {
                if (!append) {
                    self.data.underStoreyLifeforms([]);
                }
                if (data === undefined) {
                    self.addunderStoreyLifeformsRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.underStoreyLifeforms.push(new UnderStoreyLifeformsRow(obj));
                    });
                }
            };

            self.addunderStoreyLifeformsRow = function () {
                var newRow = new UnderStoreyLifeformsRow();
                self.data.underStoreyLifeforms.push(newRow);
                
            };
            self.removeunderStoreyLifeformsRow = function (row) {
                self.data.underStoreyLifeforms.remove(row);
                
            };
            self.underStoreyLifeformsrowCount = function () {
                return self.data.underStoreyLifeforms().length;
            };

            self.underStoreyLifeformsTableDataUploadVisible = ko.observable(false);
            self.showunderStoreyLifeformsTableDataUpload = function() {
                self.underStoreyLifeformsTableDataUploadVisible(!self.underStoreyLifeformsTableDataUploadVisible());
            };

            self.underStoreyLifeformsTableDataUploadOptions = {
                    url:'/fieldcapture/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadunderStoreyLifeforms(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "underStoreyLifeformstemplate-upload",
                    downloadTemplateId: "underStoreyLifeformstemplate-download",
                    formData:{type:'Site Condition', listName:'underStoreyLifeforms'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.speciesRecruitment = ko.observableArray([]);
            self.selectedspeciesRecruitmentRow = ko.observable();
        

            self.loadspeciesRecruitment = function (data, append) {
                if (!append) {
                    self.data.speciesRecruitment([]);
                }
                if (data === undefined) {
                    self.addspeciesRecruitmentRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.speciesRecruitment.push(new SpeciesRecruitmentRow(obj));
                    });
                }
            };

            self.addspeciesRecruitmentRow = function () {
                var newRow = new SpeciesRecruitmentRow();
                self.data.speciesRecruitment.push(newRow);
                
            };
            self.removespeciesRecruitmentRow = function (row) {
                self.data.speciesRecruitment.remove(row);
                
            };
            self.speciesRecruitmentrowCount = function () {
                return self.data.speciesRecruitment().length;
            };

            self.speciesRecruitmentTableDataUploadVisible = ko.observable(false);
            self.showspeciesRecruitmentTableDataUpload = function() {
                self.speciesRecruitmentTableDataUploadVisible(!self.speciesRecruitmentTableDataUploadVisible());
            };

            self.speciesRecruitmentTableDataUploadOptions = {
                    url:'/fieldcapture/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadspeciesRecruitment(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "speciesRecruitmenttemplate-upload",
                    downloadTemplateId: "speciesRecruitmenttemplate-download",
                    formData:{type:'Site Condition', listName:'speciesRecruitment'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.recruitmentDiversity = ko.observable();
            self.transients.recruitmentDiversityConstraints = ["No evidence of recruitment","< 30% adequate","30% - 70% adequate",">= 70% adequate"];

            self.data.organicLitterCoverPercent = ko.observable();

            self.data.averageLogLength = ko.observable();

            self.data.largeTreesScore = ko.observable();

            self.data.canopyCoverScore = ko.observable();

            self.data.weedScore = ko.observable();

            self.data.understoreyScore = ko.observable();

            self.data.recruitmentScore = ko.observable();

            self.data.organicLitterScore = ko.observable();

            self.data.logScore = ko.observable();

            self.data.benchmarkTreesPerHa = ko.observable();
            self.transients.site = site;

            // this will be called when generating a savable model to remove transient properties
            self.removeBeforeSave = function (jsData) {
                // add code to remove any transients added by the dynamic tags
                            delete jsData.selectedunderStoreyLifeformsRow;
                delete jsData.underStoreyLifeformsTableDataUploadOptions
                delete jsData.underStoreyLifeformsTableDataUploadVisible

            delete jsData.activityType;
            delete jsData.transients;
            return jsData;
        };

        // this returns a JS object ready for saving
        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
            // get rid of any transient observables
            return self.removeBeforeSave(jsData);
        };

        // this is a version of toJSON that just returns the model as it will be saved
        // it is used for detecting when the model is modified (in a way that should invoke a save)
        // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.loadData = function (outputId, data) {
            self.outputId = outputId;
            // load dynamic data
                            self.data['surveyArea'](orZero(data['surveyArea']));
                self.data['numberOfLargeTrees'](orZero(data['numberOfLargeTrees']));
                self.data['largeTreeCanopyHealthPercent'](orZero(data['largeTreeCanopyHealthPercent']));
                self.data['canopyCoverPercent'](orZero(data['canopyCoverPercent']));
                self.data['canopyHealthPercent'](orZero(data['canopyHealthPercent']));
                self.data['totalWeedCoverPercent'](orZero(data['totalWeedCoverPercent']));
                self.data['highThreatWeedCoverPercent'](orZero(data['highThreatWeedCoverPercent']));
                self.loadunderStoreyLifeforms(data.underStoreyLifeforms);
                self.loadspeciesRecruitment(data.speciesRecruitment);
                self.data['recruitmentDiversity'](data['recruitmentDiversity']);
                self.data['organicLitterCoverPercent'](orZero(data['organicLitterCoverPercent']));
                self.data['averageLogLength'](orZero(data['averageLogLength']));
                self.data['largeTreesScore'](orZero(data['largeTreesScore']));
                self.data['canopyCoverScore'](orZero(data['canopyCoverScore']));
                self.data['weedScore'](orZero(data['weedScore']));
                self.data['understoreyScore'](orZero(data['understoreyScore']));
                self.data['recruitmentScore'](orZero(data['recruitmentScore']));
                self.data['organicLitterScore'](orZero(data['organicLitterScore']));
                self.data['logScore'](orZero(data['logScore']));
                self.data['benchmarkTreesPerHa'](orZero(data['benchmarkTreesPerHa']));


            // if there is no data in tables then add an empty row for the user to add data
            if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                self.addRow();
            }
            self.transients.dummy.notifySubscribers();
        };
    };

    window[viewModelInstance] = new this[viewModelName]();
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koSite_Condition"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
             window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);

            // Check for locally saved data for this output - this will happen in the event of a session timeout
            // for example.
            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            console.log(savedData);
            var savedOutput = null;
            var savedOutputId = null;
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Site Condition') {
                        if (tmpOutput.data) {
                            savedOutput = tmpOutput.data;

                        }
                    }
                });
            }
            if (savedOutput) {
                window[viewModelInstance].loadData(savedOutputId, savedOutput);
            }
        });

        
    // Prevent console.log() killing IE
    if (typeof console == "undefined") {
        this.console = {log: function() {}};
    }

    $(document).ready(function (e) {

        $.ajaxSetup({ cache: false });

        $("#btnLogout").click(function (e) {
            window.location = "/fieldcapture/logout/index";
        });

        $(".btnAdministration").click(function (e) {
            window.location = "/fieldcapture/admin/index";
        });
        $('#btnDashboard').click(function(e) {
            window.location = "/fieldcapture/report/dashboard"
        });

        $(".btnProfile").click(function (e) {
            window.location = "/fieldcapture/myProfile";
        });

        $("#toggleFluid").click(function(el){
            var fluidNo = $('div.container-fluid').length;
            var fixNo = $('div.container').length;
            //console.log("counts", fluidNo, fixNo);
            if (fluidNo > fixNo) {
                $('div.container-fluid').addClass('container').removeClass('container-fluid');
            } else {
                $('div.container').addClass('container-fluid').removeClass('container');
            }
        });

        // Set up a timer that will periodically poll the server to keep the session alive
        var intervalSeconds = 5 * 60;

        setInterval(function() {
            $.ajax("/fieldcapture/ajax/keepSessionAlive").done(function(data) {});
        }, intervalSeconds * 1000);

    }); // end document ready

</script>
</body>
</html>}